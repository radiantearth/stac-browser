<template>
  <b-card no-body class="catalog-card" :class="{queued: !this.data}" v-b-visible.200="load">
    <b-row no-gutters>
      <b-col :md="thumbnail ? 8 : 12">
        <b-card-body>
          <b-card-title>
            <StacLink :link="catalog" :title="title" class="stretched-link" />
          </b-card-title>
          <b-card-text v-if="data && data.description" class="intro">
            {{ data.description }}
          </b-card-text>
          <b-card-text v-if="temporalExtent"><small class="text-muted">{{ temporalExtent | TemporalExtent }}</small></b-card-text>
        </b-card-body>
      </b-col>
      <b-col md="4" v-if="thumbnail" class="thumbnail">
        <b-card-img :src="thumbnail.href" :alt="thumbnail.title" fluid></b-card-img>
      </b-col>
    </b-row>
  </b-card>
</template>

<script>
import { mapGetters } from 'vuex';
import StacLink from './StacLink.vue';
import STAC from '../stac';

export default {
  name: 'Catalog',
  components: {
    StacLink
  },
  props: {
    catalog: {
      type: Object,
      required: true
    }
  },
  computed: {
    ...mapGetters(['getStac']),
    data() {
      if (this.catalog instanceof STAC) {
        return this.catalog;
      }
      else {
        return this.getStac(this.catalog.href);
      }
    },
    thumbnail() {
      if (this.data) {
        let thumbnails = this.data.getThumbnails(true, 'thumbnail');
        if (thumbnails.length > 0) {
          return thumbnails[0];
        }
      }
      return null;
    },
    title() {
      if (this.data) {
        return this.data.title || this.data.id;
      }
      return null;
    },
    temporalExtent() {
      if (this.data?.isCollection() && this.data.extent?.temporal?.interval.length > 0) {
        let extent = this.data.extent.temporal.interval[0]; 
        if (extent[0] && extent[1]) {
          return this.data.extent.temporal.interval[0];
        }
      }
      return null;
    }
  },
  methods: {
    load(visible) {
      if (this.catalog instanceof STAC) {
        return;
      }
      this.$store.commit(visible ? 'queue' : 'unqueue', this.catalog.href);
    }
  }
}
</script>

<style lang="scss">
.catalog-card {
  min-width: 50%;
  box-sizing: border-box;
  margin-top: 1em;

  &.queued {
    min-height: 10rem;
  }

  .intro {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .row {
    height: 100%;
  }
  .thumbnail {
    text-align: center;
    height: 100%;
  }
  .card-img {
    width: auto;
    height: auto;
    max-width: 100%;
    max-height: 100%;
  }
}
</style>