{"version":3,"file":"SentinelHub--hjVW0HL.js","sources":["../../node_modules/ol/source/SentinelHub.js"],"sourcesContent":["/**\n * @module ol/source/SentinelHub\n */\n\nimport {\n  equivalent as equivalentProjections,\n  get as getProjection,\n} from '../proj.js';\nimport DataTileSource from './DataTile.js';\n\nconst defaultProcessUrl = 'https://services.sentinel-hub.com/api/v1/process';\n\nconst defaultTokenUrl =\n  'https://services.sentinel-hub.com/auth/realms/main/protocol/openid-connect/token';\n\nconst defaultEvalscriptVersion = '3';\n\n/**\n * @type {import('../size.js').Size}\n */\nconst defaultTileSize = [512, 512];\n\nconst maxRetries = 10;\nconst baseDelay = 500;\n\n/**\n * @typedef {Object} AuthConfig\n * @property {string} [tokenUrl='https://services.sentinel-hub.com/auth/realms/main/protocol/openid-connect/token'] The URL to get the authentication token.\n * @property {string} clientId The client ID.\n * @property {string} clientSecret The client secret.\n */\n\n/**\n * @typedef {Object} AccessTokenClaims\n * @property {number} exp The expiration time of the token (in seconds).\n */\n\n/**\n * @typedef {Object} Evalscript\n * @property {Setup} setup The setup function.\n * @property {EvaluatePixel} evaluatePixel The function to transform input samples into output values.\n * @property {UpdateOutput} [updateOutput] Optional function to adjust the output bands.\n * @property {UpdateOutputMetadata} [updateOutputMetadata] Optional function to update the output metadata.\n * @property {Collections} [preProcessScenes] Optional function called before processing.\n * @property {string} [version='3'] The Evalscript version.\n */\n\n/**\n * @typedef {function(): SetupResult} Setup\n */\n\n/**\n * @typedef {function(Sample|Array<Sample>, Scenes, InputMetadata, CustomData, OutputMetadata): OutputValues|Array<number>|void} EvaluatePixel\n */\n\n/**\n * @typedef {function(Object<string, UpdatedOutputDescription>): void} UpdateOutput\n */\n\n/**\n * @typedef {function(Scenes, InputMetadata, OutputMetadata): void} UpdateOutputMetadata\n */\n\n/**\n * @typedef {Object} SetupResult\n * @property {Array<string>|Array<InputDescription>} input Description of the input data.\n * @property {OutputDescription|Array<OutputDescription>} output Description of the output data.\n * @property {'SIMPLE'|'ORBIT'|'TILE'} [mosaicking='SIMPLE'] Control how samples from input scenes are composed.\n */\n\n/**\n * @typedef {Object} InputDescription\n * @property {Array<string>} bands Input band identifiers.\n * @property {string|Array<string>} [units] Input band units.\n * @property {Array<string>} [metadata] Properties to include in the input metadata.\n */\n\n/**\n * @typedef {Object} OutputDescription\n * @property {string} [id='default'] Output identifier.\n * @property {number} bands Number of output bands.\n * @property {SampleType} [sampleType='AUTO'] Output sample type.\n * @property {number} [nodataValue] Output nodata value.\n */\n\n/**\n * @typedef {Object} UpdatedOutputDescription\n * @property {number} bands Number of output bands.\n */\n\n/**\n * @typedef {'INT8'|'UINT8'|'INT16'|'UINT16'|'FLOAT32'|'AUTO'} SampleType\n */\n\n/**\n * @typedef {Object<string, number>} Sample\n */\n\n/**\n * @typedef {Object} Collections\n * @property {string} [from] For 'ORBIT' mosaicking, this will be the start of the search interval.\n * @property {string} [to] For 'ORBIT' mosaicking, this will be the end of the search interval.\n * @property {Scenes} scenes The scenes in the collection.\n */\n\n/**\n * @typedef {Object} Scenes\n * @property {Array<Orbit>} [orbit] Information about scenes included in the tile when 'mosaicking' is 'ORBIT'.\n * @property {Array<Tile>} [tiles] Information about scenes included in the tile when 'mosaicking' is 'TILE'.\n */\n\n/**\n * @typedef {Object} Orbit\n * @property {string} dateFrom The earliest date for all scenes included in the tile.\n * @property {string} dateTo The latest date for scenes included in the tile.\n * @property {Array} tiles Metadata for each tile.\n */\n\n/**\n * @typedef {Object} Tile\n * @property {string} date The date of scene used in the tile.\n * @property {number} cloudCoverage The estimated percentage of pixels obscured by clouds in the scene.\n * @property {string} dataPath The path to the data in storage.\n * @property {number} shId The internal identifier for the scene.\n */\n\n/**\n * @typedef {Object} InputMetadata\n * @property {string} serviceVersion The version of the service used for processing.\n * @property {number} normalizationFactor The factor used to convert digital number (DN) values to reflectance.\n */\n\n/**\n * @typedef {Object<string, unknown>} CustomData\n */\n\n/**\n * @typedef {Object} OutputMetadata\n * @property {Object} userData Arbitrary user data.\n */\n\n/**\n * @typedef {Object<string, Array<number>>} OutputValues\n */\n\n/**\n * @typedef {Object} ProcessRequest\n * @property {ProcessRequestInput} input Input data configuration.\n * @property {string} evalscript The Evalscript used for processing.\n * @property {ProcessRequestOutput} [output] The output configuration.\n */\n\n/**\n * @typedef {Object} ProcessRequestInput\n * @property {ProcessRequestInputBounds} bounds The bounding box of the input data.\n * @property {Array<ProcessRequestInputDataItem>} data The intput data.\n */\n\n/**\n * @typedef {Object} ProcessRequestInputDataItem\n * @property {string} [type] The type of the input data.\n * @property {string} [id] The identifier of the input data.\n * @property {DataFilter} [dataFilter] The filter to apply to the input data.\n * @property {Object<string, unknown>} [processing] The processing to apply to the input data.\n */\n\n/**\n * @typedef {Object} DataFilter\n * @property {TimeRange} [timeRange] The data time range.\n * @property {number} [maxCloudCoverage] The maximum cloud coverage (0-100).\n */\n\n/**\n * @typedef {Object} TimeRange\n * @property {string} [from] The start time (inclusive).\n * @property {string} [to] The end time (inclusive).\n */\n\n/**\n * @typedef {Object} ProcessRequestInputBounds\n * @property {Array<number>} [bbox] The bounding box of the input data.\n * @property {ProcessRequestInputBoundsProperties} [properties] The properties of the bounding box.\n * @property {import(\"geojson\").Geometry} [geometry] The geometry of the bounding box.\n */\n\n/**\n * @typedef {Object} ProcessRequestInputBoundsProperties\n * @property {string} crs The coordinate reference system of the bounding box.\n */\n\n/**\n * @typedef {Object} ProcessRequestOutput\n * @property {number} [width] Image width in pixels.\n * @property {number} [height] Image height in pixels.\n * @property {number} [resx] Spatial resolution in the x direction.\n * @property {number} [resy] Spatial resolution in the y direction.\n * @property {Array<ProcessRequestOutputResponse>} [responses] Response configuration.\n */\n\n/**\n * @typedef {Object} ProcessRequestOutputResponse\n * @property {string} [identifier] Identifier used to connect results to outputs from the setup.\n * @property {ProcessRequestOutputFormat} [format] Response format.\n */\n\n/**\n * @typedef {Object} ProcessRequestOutputFormat\n * @property {string} [type] The output format type.\n */\n\n/**\n * @param {Evalscript} evalscript The object to serialize.\n * @return {string} The serialized Evalscript.\n */\nfunction serializeEvalscript(evalscript) {\n  const version = evalscript.version || defaultEvalscriptVersion;\n  return `//VERSION=${version}\n    ${serializeFunction('setup', evalscript.setup)}\n    ${serializeFunction('evaluatePixel', evalscript.evaluatePixel)}\n    ${serializeFunction('updateOutput', evalscript.updateOutput)}\n  `;\n}\n\n/**\n * Get a loaded image given a response.\n *\n * @param {Response} response The response.\n * @return {Promise<HTMLImageElement>} The image.\n */\nasync function imageFromResponse(response) {\n  const blob = await response.blob();\n\n  return new Promise((resolve, reject) => {\n    const image = new Image();\n    const blobUrl = URL.createObjectURL(blob);\n    image.onload = () => {\n      URL.revokeObjectURL(blobUrl);\n      resolve(image);\n    };\n    image.onerror = () => {\n      URL.revokeObjectURL(blobUrl);\n      reject(new Error('Failed to load image'));\n    };\n    image.src = blobUrl;\n  });\n}\n\n/**\n * @param {number} ms Milliseconds.\n * @return {Promise<void>} A promise that resolves after the given time.\n */\nfunction delay(ms) {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\n/**\n * @param {AuthConfig} auth The authentication configuration.\n * @return {Promise<string>} The authentication token.\n */\nasync function getToken(auth) {\n  const url = auth.tokenUrl || defaultTokenUrl;\n  const body = new URLSearchParams();\n  body.append('grant_type', 'client_credentials');\n  body.append('client_id', auth.clientId);\n  body.append('client_secret', auth.clientSecret);\n\n  /**\n   * @type {RequestInit}\n   */\n  const options = {\n    method: 'POST',\n    headers: {'Content-Type': 'application/x-www-form-urlencoded'},\n    body,\n  };\n  const response = await fetch(url, options);\n  if (!response.ok) {\n    if (response.status === 401) {\n      throw new Error('Bad client id or secret');\n    }\n    throw new Error('Failed to get token');\n  }\n  const data = await response.json();\n  return data.access_token;\n}\n\n/**\n * @param {string} token The access token to parse.\n * @return {AccessTokenClaims} The parsed token claims.\n */\nexport function parseTokenClaims(token) {\n  const base64EncodedClaims = token\n    .split('.')[1]\n    .replace(/-/g, '+')\n    .replace(/_/g, '/');\n\n  const chars = atob(base64EncodedClaims).split('');\n  const count = chars.length;\n  const uriEncodedChars = new Array(count);\n  for (let i = 0; i < count; ++i) {\n    const c = chars[i];\n    uriEncodedChars[i] = '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n  }\n\n  return JSON.parse(decodeURIComponent(uriEncodedChars.join('')));\n}\n\n/**\n * Gets a CRS identifier accepted by Sentinel Hub.\n * See https://docs.sentinel-hub.com/api/latest/api/process/crs/.\n *\n * @param {import(\"../proj/Projection.js\").default} projection The projection.\n * @return {string} The projection identifier accepted by Sentinel Hub.\n */\nexport function getProjectionIdentifier(projection) {\n  const ogcId = 'http://www.opengis.net/def/crs/';\n  const code = projection.getCode();\n  if (code.startsWith(ogcId)) {\n    return code;\n  }\n  if (code.startsWith('EPSG:')) {\n    return `${ogcId}EPSG/0/${code.slice(5)}`;\n  }\n  if (equivalentProjections(projection, getProjection('EPSG:4326'))) {\n    return `${ogcId}EPSG/0/4326`;\n  }\n\n  // hope for the best\n  return code;\n}\n\n/**\n * This is intended to work with named functions, anonymous functions, arrow functions, and object methods.\n * Due to how the Evalscript is executed, these are serialized as function expressions using `var`.\n *\n * @param {string} name The name of the function.\n * @param {Function|undefined} func The function to serialize.\n * @return {string} The serialized function.\n */\nexport function serializeFunction(name, func) {\n  if (!func) {\n    return '';\n  }\n  let expression = func.toString();\n  if (\n    func.name &&\n    func.name !== 'function' &&\n    expression.match(new RegExp('^' + func.name.replace('$', '\\\\$') + '\\\\b'))\n  ) {\n    // assume function came from an object property using method syntax\n    expression = 'function ' + expression;\n  }\n  return `var ${name} = ${expression};`;\n}\n\n/**\n * @typedef {Object} Options\n * @property {AuthConfig|string} [auth] The authentication configuration with `clientId` and `clientSecret` or an access token.\n * See [Sentinel Hub authentication](https://docs.sentinel-hub.com/api/latest/api/overview/authentication/)\n * for details.  If not provided in the constructor, the source will not be rendered until {@link module:ol/source/SentinelHub~SentinelHub#setAuth}\n * is called.\n * @property {Array<ProcessRequestInputDataItem>} [data] The input data configuration.  If not provided in the constructor,\n * the source will not be rendered until {@link module:ol/source/SentinelHub~SentinelHub#setData} is called.\n * @property {Evalscript|string} [evalscript] The process applied to the input data.  If not provided in the constructor,\n * the source will not be rendered until {@link module:ol/source/SentinelHub~SentinelHub#setEvalscript} is called.  See the\n * `setEvalscript` documentation for details on the restrictions when passing process functions.\n * @property {number|import(\"../size.js\").Size} [tileSize=[512, 512]] The pixel width and height of the source tiles.\n * @property {string} [url='https://services.sentinel-hub.com/api/v1/process'] The Sentinel Hub Processing API URL.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * @property {boolean} [attributionsCollapsible=true] Allow the attributions to be collapsed.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {boolean} [wrapX=true] Wrap the world horizontally.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n */\n\n/**\n * @classdesc\n * A tile source that generates tiles using the Sentinel Hub [Processing API](https://docs.sentinel-hub.com/api/latest/api/process/).\n * All of the constructor options are optional, however the source will not be ready for rendering until the `auth`, `data`,\n * and `evalscript` properties are provided.  These can be set after construction with the {@link module:ol/source/SentinelHub~SentinelHub#setAuth},\n * {@link module:ol/source/SentinelHub~SentinelHub#setData}, and {@link module:ol/source/SentinelHub~SentinelHub#setEvalscript}\n * methods.\n *\n * If there are errors while configuring the source or fetching an access token, the `change` event will be fired and the\n * source state will be set to `error`.  See the {@link module:ol/source/SentinelHub~SentinelHub#getError} method for\n * details on handling these errors.\n * @api\n */\nclass SentinelHub extends DataTileSource {\n  /**\n   * @param {Options} [options] Sentinel Hub options.\n   */\n  constructor(options) {\n    /**\n     * @type {Options}\n     */\n    const config = options || {};\n\n    super({\n      state: 'loading',\n      projection: config.projection,\n      attributionsCollapsible: config.attributionsCollapsible,\n      interpolate: config.interpolate,\n      tileSize: config.tileSize || defaultTileSize,\n      wrapX: config.wrapX !== undefined ? config.wrapX : true,\n      transition: config.transition,\n    });\n\n    this.setLoader((x, y, z) => this.loadTile_(x, y, z, 1));\n\n    /**\n     * @type {Error|null}\n     */\n    this.error_ = null;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.evalscript_ = '';\n\n    /**\n     * @type {Array<ProcessRequestInputDataItem>|null}\n     * @private\n     */\n    this.inputData_ = null;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.processUrl_ = config.url || defaultProcessUrl;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.token_ = '';\n\n    /**\n     * @type {ReturnType<typeof setTimeout>}\n     * @private\n     */\n    this.tokenRenewalId_;\n\n    if (config.auth) {\n      this.setAuth(config.auth);\n    }\n\n    if (config.data) {\n      this.setData(config.data);\n    }\n\n    if (config.evalscript) {\n      this.setEvalscript(config.evalscript);\n    }\n  }\n\n  /**\n   * Set the authentication configuration for the source (if not provided in the constructor).\n   * If an object with `clientId` and `clientSecret` is provided, an access token will be fetched\n   * and used with processing requests.  Alternatively, an access token can be supplied directly.\n   *\n   * @param {AuthConfig|string} auth The auth config or access token.\n   * @api\n   */\n  async setAuth(auth) {\n    clearTimeout(this.tokenRenewalId_);\n\n    if (typeof auth === 'string') {\n      this.token_ = auth;\n      this.fireWhenReady_();\n      return;\n    }\n\n    /**\n     * @type {string}\n     */\n    let token;\n\n    /**\n     * @type {AccessTokenClaims}\n     */\n    let claims;\n\n    try {\n      token = await getToken(auth);\n      claims = parseTokenClaims(token);\n    } catch (error) {\n      this.error_ = error;\n      this.setState('error');\n      return;\n    }\n    this.token_ = token;\n\n    const expiry = claims.exp * 1000;\n    const timeout = Math.max(expiry - Date.now() - 60 * 1000, 1);\n    this.tokenRenewalId_ = setTimeout(() => this.setAuth(auth), timeout);\n    this.fireWhenReady_();\n  }\n\n  /**\n   * Set or update the input data used.\n   *\n   * @param {Array<ProcessRequestInputDataItem>} data The input data configuration.\n   * @api\n   */\n  setData(data) {\n    this.inputData_ = data;\n    this.fireWhenReady_();\n  }\n\n  /**\n   * Set or update the Evalscript used to process the data.  Either a process object or a string\n   * Evalscript can be provided.  If a process object is provided, it will be serialized to produce the\n   * Evalscript string.  Because these functions will be serialized and executed by the Processing API,\n   * they cannot refer to other variables or functions that are not provided by the Processing API\n   * context.\n   *\n   * @param {Evalscript|string} evalscript The process to apply to the input data.\n   * @api\n   */\n  setEvalscript(evalscript) {\n    let script;\n    if (typeof evalscript === 'string') {\n      script = evalscript;\n    } else {\n      try {\n        script = serializeEvalscript(evalscript);\n      } catch (error) {\n        this.error_ = error;\n        this.setState('error');\n        return;\n      }\n    }\n    this.evalscript_ = script;\n    this.fireWhenReady_();\n  }\n\n  fireWhenReady_() {\n    if (!this.token_ || !this.evalscript_ || !this.inputData_) {\n      return;\n    }\n    const state = this.getState();\n    if (state === 'ready') {\n      this.changed();\n      return;\n    }\n    this.setState('ready');\n  }\n\n  /**\n   * @param {number} z The z tile index.\n   * @param {number} x The x tile index.\n   * @param {number} y The y tile index.\n   * @param {number} attempt The attempt number (starting with 1).  Incremented with retries.\n   * @return {Promise<import('../DataTile.js').Data>} The composed tile data.\n   * @private\n   */\n  async loadTile_(z, x, y, attempt) {\n    const tileGrid = this.getTileGrid();\n    const extent = tileGrid.getTileCoordExtent([z, x, y]);\n    const tileSize = this.getTileSize(z);\n    const projection = this.getProjection();\n\n    /**\n     * @type {ProcessRequest}\n     */\n    const body = {\n      input: {\n        bounds: {\n          bbox: extent,\n          properties: {crs: getProjectionIdentifier(projection)},\n        },\n        data: this.inputData_,\n      },\n      output: {\n        width: tileSize[0],\n        height: tileSize[1],\n      },\n      evalscript: this.evalscript_,\n    };\n\n    /**\n     * @type {RequestInit}\n     */\n    const options = {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${this.token_}`,\n        'Access-Control-Request-Headers': 'Retry-After',\n      },\n      body: JSON.stringify(body),\n      credentials: 'include',\n    };\n\n    const response = await fetch(this.processUrl_, options);\n    if (!response.ok) {\n      if (response.status === 429 && attempt < maxRetries - 1) {\n        // The Retry-After header includes unreasonable wait times, instead use exponential backoff.\n        const retryAfter = baseDelay * 2 ** attempt;\n        await delay(retryAfter);\n        return this.loadTile_(x, y, z, attempt + 1);\n      }\n      throw new Error(`Failed to get tile: ${response.statusText}`);\n    }\n\n    return imageFromResponse(response);\n  }\n\n  /**\n   * When the source state is `error`, use this function to get more information about the error.\n   * To debug a faulty configuration, you may want to use a listener like this:\n   * ```js\n   * source.on('change', () => {\n   *   if (source.getState() === 'error') {\n   *     console.error(source.getError());\n   *   }\n   * });\n   * ```\n   *\n   * @return {Error|null} A source loading error.\n   * @api\n   */\n  getError() {\n    return this.error_;\n  }\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    clearTimeout(this.tokenRenewalId_);\n    super.disposeInternal();\n  }\n}\n\nexport default SentinelHub;\n"],"names":["defaultProcessUrl","defaultTokenUrl","defaultEvalscriptVersion","defaultTileSize","maxRetries","baseDelay","serializeEvalscript","evalscript","serializeFunction","imageFromResponse","response","blob","resolve","reject","image","blobUrl","delay","ms","getToken","auth","url","body","parseTokenClaims","token","base64EncodedClaims","chars","count","uriEncodedChars","i","c","getProjectionIdentifier","projection","ogcId","code","equivalentProjections","getProjection","name","func","expression","SentinelHub","DataTileSource","options","config","x","y","z","claims","error","expiry","timeout","data","script","attempt","extent","tileSize","retryAfter"],"mappings":"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","x_google_ignoreList":[0]}