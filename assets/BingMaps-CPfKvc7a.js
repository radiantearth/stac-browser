import{y as z,an as R,q as U,_ as A}from"./GeoJSON-BlyzYhKz.js";import{c as I}from"./tilecoord-DYaQ6NdW.js";import{e as M,c as K}from"./Tile-8IayXPne.js";import{a as k}from"./tileurlfunction-CsB_e4FB.js";import C from"./TileImage-BzZFQQFS.js";import"./index-4V-ffF_e.js";import"./utils-BXWzvTjY.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-CVtNDUBO.js";import"./useStateClass-BGbSLWFN-lMazZNQ7.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--B1-KiooU.js";import"./TileGrid-D2Qra4XP.js";import"./TileRange-2Tc-Ry00.js";import"./uri-BxyrIhx_.js";import"./Tile-BrHfHitc.js";import"./Tile-lMrQctYw.js";import"./common-0gNrjJbx.js";import"./UrlTile-CxpuZoX4.js";import"./TileEventType-CTN_nmJ7.js";function E(m){const e=m[0],t=new Array(e);let r=1<<e-1,i,s;for(i=0;i<e;++i)s=48,m[1]&r&&(s+=1),m[2]&r&&(s+=2),t[i]=String.fromCharCode(s),r>>=1;return t.join("")}const G='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class se extends C{constructor(e){const t=e.hidpi!==void 0?e.hidpi:!1;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,projection:z("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=e.culture!==void 0?e.culture:"en-us",this.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;const r=(e.url||"https://dev.virtualearth.net/REST/v1/Imagery/Metadata/")+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(r).then(i=>i.json()).then(i=>this.handleImageryMetadataResponse(i))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1){this.setState("error");return}const t=e.resourceSets[0].resources[0],r=this.maxZoom_==-1?t.zoomMax:this.maxZoom_,i=this.getProjection(),s=M(i),u=this.hidpi_?2:1,b=t.imageWidth==t.imageHeight?t.imageWidth/u:[t.imageWidth/u,t.imageHeight/u],j=K({extent:s,minZoom:t.zoomMin,maxZoom:r,tileSize:b});this.tileGrid=j;const v=this.culture_,P=this.hidpi_,y=this.placeholderTiles_;if(this.tileUrlFunction=k(t.imageUrlSubdomains.map(function(h){const n=[0,0,0],c=t.imageUrl.replace("{subdomain}",h).replace("{culture}",v);return(function(o,d,S){if(!o)return;I(o[0],o[1],o[2],n);const p=new URL(c.replace("{quadkey}",E(n))),a=p.searchParams;return P&&(a.set("dpi","d1"),a.set("device","mobile")),y===!0?a.delete("n"):y===!1&&a.set("n","z"),p.toString()})})),t.imageryProviders){const h=R(z("EPSG:4326"),this.getProjection());this.setAttributions(n=>{const c=[],o=n.viewState,d=this.getTileGrid(),S=d.getZForResolution(o.resolution,this.zDirection),a=d.getTileCoordForCoordAndZ(o.center,S)[0];return t.imageryProviders.map(function(x){let _=!1;const T=x.coverageAreas;for(let g=0,Z=T.length;g<Z;++g){const f=T[g];if(a>=f.zoomMin&&a<=f.zoomMax){const l=f.bbox,w=[l[1],l[0],l[3],l[2]],F=U(w,h);if(A(F,n.extent)){_=!0;break}}}_&&c.push(x.attribution)}),c.push(G),c})}this.setState("ready")}}export{se as default,E as quadKey};
//# sourceMappingURL=BingMaps-CPfKvc7a.js.map
