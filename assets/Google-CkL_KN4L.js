import{U as m,bW as y,bf as T,bd as d}from"./GeoJSON-BlyzYhKz.js";import{c as b,e as f}from"./Tile-8IayXPne.js";import v from"./TileImage-BzZFQQFS.js";import"./index-4V-ffF_e.js";import"./utils-BXWzvTjY.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-CVtNDUBO.js";import"./useStateClass-BGbSLWFN-lMazZNQ7.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--B1-KiooU.js";import"./tilecoord-DYaQ6NdW.js";import"./TileGrid-D2Qra4XP.js";import"./TileRange-2Tc-Ry00.js";import"./Tile-BrHfHitc.js";import"./Tile-lMrQctYw.js";import"./common-0gNrjJbx.js";import"./UrlTile-CxpuZoX4.js";import"./tileurlfunction-CsB_e4FB.js";import"./uri-BxyrIhx_.js";import"./TileEventType-CTN_nmJ7.js";const x=22;class C extends v{constructor(t){const s=!!t.highDpi;super({attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,projection:"EPSG:3857",reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,tilePixelRatio:s?2:1,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.apiKey_=t.key,this.error_=null;const e={mapType:t.mapType||"roadmap",language:t.language||"en-US",region:t.region||"US"};t.imageFormat&&(e.imageFormat=t.imageFormat),t.scale&&(e.scale=t.scale),s&&(e.highDpi=!0),t.layerTypes&&(e.layerTypes=t.layerTypes),t.styles&&(e.styles=t.styles),t.overlay===!0&&(e.overlay=!0),t.apiOptions&&(e.apiOptions=t.apiOptions),this.sessionTokenRequest_=e,this.sessionTokenValue_,this.sessionRefreshId_,this.previousViewportAttribution_,this.previousViewportExtent_;const i=t.url||"https://tile.googleapis.com/";this.createSessionUrl_=i+"v1/createSession",this.tileUrl_=i+"v1/2dtiles",this.attributionUrl_=i+"tile/v1/viewport",this.createSession_()}getError(){return this.error_}fetchSessionToken(t,s){return fetch(t,s)}async createSession_(){const t=this.createSessionUrl_+"?key="+this.apiKey_,s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},e=await this.fetchSessionToken(t,s);if(!e.ok){try{const r=await e.json();this.error_=new Error(r.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const i=await e.json(),n=this.getTilePixelRatio(1),p=[i.tileWidth/n,i.tileHeight/n];this.tileGrid=b({extent:f(this.getProjection()),maxZoom:x,tileSize:p});const h=i.session;this.sessionTokenValue_=h;const o=this.apiKey_,c=this.tileUrl_;this.tileUrlFunction=function(r,a,S){const _=r[0],g=r[1],w=r[2];return`${c}/${_}/${g}/${w}?session=${h}&key=${o}`};const l=parseInt(i.expiry,10)*1e3,u=Math.max(l-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),u),this.setAttributions(this.fetchAttributions_.bind(this)),this.setState("ready")}async fetchAttributions_(t){if(t.viewHints[m.ANIMATING]||t.viewHints[m.INTERACTING]||t.animate)return this.previousViewportAttribution_;const[s,e]=y(T(t.extent),t.viewState.projection),[i,n]=y(d(t.extent),t.viewState.projection),o=`zoom=${this.getTileGrid().getZForResolution(t.viewState.resolution,this.zDirection)}&north=${n}&south=${e}&east=${i}&west=${s}`;if(this.previousViewportExtent_==o)return this.previousViewportAttribution_;this.previousViewportExtent_=o;const c=this.sessionTokenValue_,l=this.apiKey_,r=`${this.attributionUrl_}?session=${c}&key=${l}&${o}`;return this.previousViewportAttribution_=await fetch(r).then(a=>a.json()).then(a=>a.copyright),this.previousViewportAttribution_}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}export{C as default};
//# sourceMappingURL=Google-CkL_KN4L.js.map
