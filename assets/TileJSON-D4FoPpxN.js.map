{"version":3,"file":"TileJSON-D4FoPpxN.js","sources":["../../node_modules/ol/source/TileJSON.js"],"sourcesContent":["/**\n * @module ol/source/TileJSON\n */\n// FIXME check order of async callbacks\n\n/**\n * See https://mapbox.com/developers/api/.\n */\n\nimport {applyTransform, intersects} from '../extent.js';\nimport {jsonp as requestJSONP} from '../net.js';\nimport {get as getProjection, getTransformFromProjections} from '../proj.js';\nimport {createXYZ, extentFromProjection} from '../tilegrid.js';\nimport {createFromTemplates} from '../tileurlfunction.js';\nimport TileImage from './TileImage.js';\n\n/**\n * @typedef {Object} Config\n * @property {string} [name] The name.\n * @property {string} [description] The description.\n * @property {string} [version] The version.\n * @property {string} [attribution] The attribution.\n * @property {string} [template] The template.\n * @property {string} [legend] The legend.\n * @property {string} [scheme] The scheme.\n * @property {Array<string>} tiles The tile URL templates.\n * @property {Array<string>} [grids] Optional grids.\n * @property {number} [minzoom] Minimum zoom level.\n * @property {number} [maxzoom] Maximum zoom level.\n * @property {Array<number>} [bounds] Optional bounds.\n * @property {Array<number>} [center] Optional center.\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {boolean} [jsonp=false] Use JSONP with callback to load the TileJSON.\n * Useful when the server does not support CORS..\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {Config} [tileJSON] TileJSON configuration for this source.\n * If not provided, `url` must be configured.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {number|import(\"../size.js\").Size} [tileSize=[256, 256]] The tile size used by the tile service.\n * Note: `tileSize` and other non-standard TileJSON properties are currently ignored.\n * @property {string} [url] URL to the TileJSON file. If not provided, `tileJSON` must be configured.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @classdesc\n * Layer source for tile data in TileJSON format.\n * @api\n */\nclass TileJSON extends TileImage {\n  /**\n   * @param {Options} options TileJSON options.\n   */\n  constructor(options) {\n    super({\n      attributions: options.attributions,\n      cacheSize: options.cacheSize,\n      crossOrigin: options.crossOrigin,\n      interpolate: options.interpolate,\n      projection: getProjection('EPSG:3857'),\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n      state: 'loading',\n      tileLoadFunction: options.tileLoadFunction,\n      wrapX: options.wrapX !== undefined ? options.wrapX : true,\n      transition: options.transition,\n      zDirection: options.zDirection,\n    });\n\n    /**\n     * @type {Config}\n     * @private\n     */\n    this.tileJSON_ = null;\n\n    /**\n     * @type {number|import(\"../size.js\").Size}\n     * @private\n     */\n    this.tileSize_ = options.tileSize;\n\n    if (options.url) {\n      if (options.jsonp) {\n        requestJSONP(\n          options.url,\n          this.handleTileJSONResponse.bind(this),\n          this.handleTileJSONError.bind(this),\n        );\n      } else {\n        const client = new XMLHttpRequest();\n        client.addEventListener('load', this.onXHRLoad_.bind(this));\n        client.addEventListener('error', this.onXHRError_.bind(this));\n        client.open('GET', options.url);\n        client.send();\n      }\n    } else if (options.tileJSON) {\n      this.handleTileJSONResponse(options.tileJSON);\n    } else {\n      throw new Error('Either `url` or `tileJSON` options must be provided');\n    }\n  }\n\n  /**\n   * @private\n   * @param {Event} event The load event.\n   */\n  onXHRLoad_(event) {\n    const client = /** @type {XMLHttpRequest} */ (event.target);\n    // status will be 0 for file:// urls\n    if (!client.status || (client.status >= 200 && client.status < 300)) {\n      let response;\n      try {\n        response = /** @type {Config} */ (JSON.parse(client.responseText));\n      } catch {\n        this.handleTileJSONError();\n        return;\n      }\n      this.handleTileJSONResponse(response);\n    } else {\n      this.handleTileJSONError();\n    }\n  }\n\n  /**\n   * @private\n   * @param {Event} event The error event.\n   */\n  onXHRError_(event) {\n    this.handleTileJSONError();\n  }\n\n  /**\n   * @return {Config} The tilejson object.\n   * @api\n   */\n  getTileJSON() {\n    return this.tileJSON_;\n  }\n\n  /**\n   * @protected\n   * @param {Config} tileJSON Tile JSON.\n   */\n  handleTileJSONResponse(tileJSON) {\n    const epsg4326Projection = getProjection('EPSG:4326');\n\n    const sourceProjection = this.getProjection();\n    let extent;\n    if (tileJSON['bounds'] !== undefined) {\n      const transform = getTransformFromProjections(\n        epsg4326Projection,\n        sourceProjection,\n      );\n      extent = applyTransform(tileJSON['bounds'], transform);\n    }\n\n    const gridExtent = extentFromProjection(sourceProjection);\n    const minZoom = tileJSON['minzoom'] || 0;\n    const maxZoom = tileJSON['maxzoom'] || 22;\n    const tileGrid = createXYZ({\n      extent: gridExtent,\n      maxZoom: maxZoom,\n      minZoom: minZoom,\n      tileSize: this.tileSize_,\n    });\n    this.tileGrid = tileGrid;\n\n    this.tileUrlFunction = createFromTemplates(tileJSON['tiles'], tileGrid);\n\n    if (tileJSON['attribution'] && !this.getAttributions()) {\n      const attributionExtent = extent !== undefined ? extent : gridExtent;\n      this.setAttributions(function (frameState) {\n        if (intersects(attributionExtent, frameState.extent)) {\n          return [tileJSON['attribution']];\n        }\n        return null;\n      });\n    }\n    this.tileJSON_ = tileJSON;\n    this.setState('ready');\n  }\n\n  /**\n   * @protected\n   */\n  handleTileJSONError() {\n    this.setState('error');\n  }\n}\n\nexport default TileJSON;\n"],"names":["TileJSON","TileImage","options","getProjection","requestJSONP","client","event","response","tileJSON","epsg4326Projection","sourceProjection","extent","transform","getTransformFromProjections","applyTransform","gridExtent","extentFromProjection","minZoom","maxZoom","tileGrid","createXYZ","createFromTemplates","attributionExtent","frameState","intersects"],"mappings":"g0BAsEA,MAAMA,UAAiBC,CAAU,CAI/B,YAAYC,EAAS,CA2BnB,GA1BA,MAAM,CACJ,aAAcA,EAAQ,aACtB,UAAWA,EAAQ,UACnB,YAAaA,EAAQ,YACrB,YAAaA,EAAQ,YACrB,WAAYC,EAAc,WAAW,EACrC,2BAA4BD,EAAQ,2BACpC,MAAO,UACP,iBAAkBA,EAAQ,iBAC1B,MAAOA,EAAQ,QAAU,OAAYA,EAAQ,MAAQ,GACrD,WAAYA,EAAQ,WACpB,WAAYA,EAAQ,UAC1B,CAAK,EAMD,KAAK,UAAY,KAMjB,KAAK,UAAYA,EAAQ,SAErBA,EAAQ,IACV,GAAIA,EAAQ,MACVE,EACEF,EAAQ,IACR,KAAK,uBAAuB,KAAK,IAAI,EACrC,KAAK,oBAAoB,KAAK,IAAI,CAC5C,MACa,CACL,MAAMG,EAAS,IAAI,eACnBA,EAAO,iBAAiB,OAAQ,KAAK,WAAW,KAAK,IAAI,CAAC,EAC1DA,EAAO,iBAAiB,QAAS,KAAK,YAAY,KAAK,IAAI,CAAC,EAC5DA,EAAO,KAAK,MAAOH,EAAQ,GAAG,EAC9BG,EAAO,KAAI,CACb,SACSH,EAAQ,SACjB,KAAK,uBAAuBA,EAAQ,QAAQ,MAE5C,OAAM,IAAI,MAAM,qDAAqD,CAEzE,CAMA,WAAWI,EAAO,CAChB,MAAMD,EAAwCC,EAAM,OAEpD,GAAI,CAACD,EAAO,QAAWA,EAAO,QAAU,KAAOA,EAAO,OAAS,IAAM,CACnE,IAAIE,EACJ,GAAI,CACFA,EAAkC,KAAK,MAAMF,EAAO,YAAY,CAClE,MAAQ,CACN,KAAK,oBAAmB,EACxB,MACF,CACA,KAAK,uBAAuBE,CAAQ,CACtC,MACE,KAAK,oBAAmB,CAE5B,CAMA,YAAYD,EAAO,CACjB,KAAK,oBAAmB,CAC1B,CAMA,aAAc,CACZ,OAAO,KAAK,SACd,CAMA,uBAAuBE,EAAU,CAC/B,MAAMC,EAAqBN,EAAc,WAAW,EAE9CO,EAAmB,KAAK,cAAa,EAC3C,IAAIC,EACJ,GAAIH,EAAS,SAAc,OAAW,CACpC,MAAMI,EAAYC,EAChBJ,EACAC,CACR,EACMC,EAASG,EAAeN,EAAS,OAAWI,CAAS,CACvD,CAEA,MAAMG,EAAaC,EAAqBN,CAAgB,EAClDO,EAAUT,EAAS,SAAc,EACjCU,EAAUV,EAAS,SAAc,GACjCW,EAAWC,EAAU,CACzB,OAAQL,EACR,QAASG,EACT,QAASD,EACT,SAAU,KAAK,SACrB,CAAK,EAKD,GAJA,KAAK,SAAWE,EAEhB,KAAK,gBAAkBE,EAAoBb,EAAS,MAAUW,CAAQ,EAElEX,EAAS,aAAkB,CAAC,KAAK,gBAAe,EAAI,CACtD,MAAMc,EAAoBX,IAAW,OAAYA,EAASI,EAC1D,KAAK,gBAAgB,SAAUQ,EAAY,CACzC,OAAIC,EAAWF,EAAmBC,EAAW,MAAM,EAC1C,CAACf,EAAS,WAAc,EAE1B,IACT,CAAC,CACH,CACA,KAAK,UAAYA,EACjB,KAAK,SAAS,OAAO,CACvB,CAKA,qBAAsB,CACpB,KAAK,SAAS,OAAO,CACvB,CACF","x_google_ignoreList":[0]}