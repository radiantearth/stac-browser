const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Catalogs-Dz7EqeDG.js","assets/index-CZLOmM9h.js","assets/utils-BXWzvTjY.js","assets/_commonjsHelpers-CE1G-McA.js","assets/I18N-DlIXJTel.js","assets/index-BchvTk2E.css","assets/BBadge.vue_vue_type_script_setup_true_lang-D9DEOOtU-DQSQ_ncW.js","assets/ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--fUwaC9LK.js","assets/CardMixin-b3IsQzpS.js","assets/formatters-Bu1xqIVM.js","assets/helper-DO3U350M.js","assets/datatypes-XrFOh23H.js","assets/BCard.vue_vue_type_script_setup_true_lang-9RhyvL8I-D1RGNDPh.js","assets/BCardText.vue_vue_type_script_setup_true_lang-SRGbviaO-DW79Ov6T.js","assets/Loading-BiqIFc9G.js","assets/Loading-BLYcl2tz.css","assets/Catalogs-BHomv16X.css","assets/Items-B_Bl3kaA.js","assets/BCollapse.vue_vue_type_script_setup_true_lang-BUisG8-R-DMx0sunT.js","assets/MapView-c6ulO_6Q.js","assets/GeoJSON-R3UKT-HL.js","assets/BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-B3EEl1J0.js","assets/useStateClass-BGbSLWFN-CfFJOZ-N.js","assets/GeoJSON-Bh2emOAl.css","assets/WMTSCapabilities-DwENE38Z.js","assets/Image-BTKjfYgO.js","assets/ImageLayer-DQmw8JRt.js","assets/BaseImage-BB2cQhK1.js","assets/Tile-C4Xe4Jsw.js","assets/TileLayer-CFECeYJq.js","assets/DataTile-Cpbmp6XE.js","assets/Tile-D5_jQukL.js","assets/Tile-C5ZRrw8J.js","assets/common-CNSMZ-XJ.js","assets/TileRange-2Tc-Ry00.js","assets/LRUCache-B6KlwMNH.js","assets/tilecoord-dopSHpTK.js","assets/BaseTile-CNu8dWie.js","assets/TileProperty-BF4LcWSy.js","assets/VectorTile-xwD0A_8W.js","assets/WebGLTile-BV0PhtOK.js","assets/compileUtil-DEnn5dPp.js","assets/mat4-CeypvY8Z.js","assets/ImageStatic-5Z3DBPQY.js","assets/Image-CYNHnAhC.js","assets/resolution-CU8ppKQ3.js","assets/common-9rOs42pz.js","assets/static-Blh58NLG.js","assets/TileJSON--yJ-jeyM.js","assets/net-w7bkb1TX.js","assets/Tile-CGQSeYqc.js","assets/TileGrid-mLXcoPrk.js","assets/tileurlfunction-DmkOJjED.js","assets/uri-U2Ph9pMv.js","assets/TileImage-DdiVMzv7.js","assets/UrlTile-C_TWD9nq.js","assets/TileEventType-CTN_nmJ7.js","assets/TileWMS-CrwreiGy.js","assets/wms-CoDoB5G4.js","assets/VectorTile-BqxmZo_1.js","assets/WMTS-BLaAEZka.js","assets/XYZ-CQ2vnLun.js","assets/DataTile-BGk-ZqiN.js","assets/MVT-BV320Wkh.js","assets/index-B7hVku7z.js","assets/geotiff-DOj7PqDV.js","assets/__vite-browser-external-B1O5LaIO.js","assets/MapView-eDbLtyS8.css"])))=>i.map(i=>d[i]);
import{a4 as P,n as i,B as m,y as f,bk as z,bl as n,p as a,q as s,L as c,b4 as D,K as u,G as o,b7 as q,H as p,I as U,b6 as N,_ as G,b1 as H,d as K,ck as W,cl as Z,cm as j,cn as J,bp as w,bw as Q,co as X,cp as Y,cq as x,cr as ee,br as te,bs as ie,bt as S,bu as _}from"./index-CZLOmM9h.js";import{d as h}from"./utils-BXWzvTjY.js";import{S as ae}from"./SearchFilter-BoVjqQci.js";import{L as se}from"./Loading-BiqIFc9G.js";import{a as re,_ as oe}from"./BTabs.vue_vue_type_script_setup_true_lang-CU4B0ph2-DdMb9itT.js";import"./I18N-DlIXJTel.js";import"./_commonjsHelpers-CE1G-McA.js";import"./BForm.vue_vue_type_script_setup_true_lang-u44ElAm9-BXKo2xbS.js";import"./BFormInput.vue_vue_type_script_setup_true_lang-DRDhfD8d-UEFXxaIb.js";import"./useStateClass-BGbSLWFN-CfFJOZ-N.js";import"./debounce-BHqBzJ1a-inCByRg3.js";import"./BBadge.vue_vue_type_script_setup_true_lang-D9DEOOtU-DQSQ_ncW.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--fUwaC9LK.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-B3EEl1J0.js";import"./BFormCheckboxGroup.vue_vue_type_script_setup_true_lang-Dx_mpGFE-CUyvnRW1.js";import"./BFormGroup.vue_vue_type_script_setup_true_lang-RIWLdYTY-CUN4WT8G.js";import"./BCard.vue_vue_type_script_setup_true_lang-9RhyvL8I-D1RGNDPh.js";import"./BDropdownText.vue_vue_type_script_setup_true_lang-Cm6QYE9x-B_pTdJ5i.js";import"./startOfWeek-m7vVpAR3.js";import"./en-US-DRXoBfJp.js";import"./match-DN4VZKeM.js";import"./buildMatchPatternFn-_eSDZv-o.js";import"./helper-CaHhXSPV.js";import"./helper-DO3U350M.js";const ne={viewBox:"0 0 16 16",width:"1.2em",height:"1.2em"};function le(e,t){return i(),m("svg",ne,[...t[0]||(t[0]=[f("path",{fill:"currentColor",d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"},null,-1)])])}const ce=P({name:"bi-square",render:le}),he={viewBox:"0 0 16 16",width:"1.2em",height:"1.2em"};function ue(e,t){return i(),m("svg",he,[...t[0]||(t[0]=[f("g",{fill:"currentColor"},[f("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),f("path",{d:"M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093l3.473-4.425z"})],-1)])])}const de=P({name:"bi-check-square",render:ue}),pe=K({name:"Search",components:{Catalogs:S(()=>_(()=>import("./Catalogs-Dz7EqeDG.js").then(e=>e.b),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]))),BTabs:oe,BTab:re,ErrorAlert:W,Loading:se,SearchFilter:ae,Items:S(()=>_(()=>import("./Items-B_Bl3kaA.js"),__vite__mapDeps([17,1,2,3,4,5,6,7,18,8,9,10,11,12,13,14,15]))),MapView:S(()=>_(()=>import("./MapView-c6ulO_6Q.js"),__vite__mapDeps([19,1,2,3,4,5,20,21,22,7,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67]))),StacLink:S(()=>_(()=>import("./index-CZLOmM9h.js").then(e=>e.cZ),__vite__mapDeps([1,2,3,4,5])))},props:{loadParent:{type:String,default:null}},data(){return{parent:null,error:null,errorId:null,link:null,loading:!1,data:null,itemFilters:{},collectionFilters:{},activeSearch:void 0,selectedCollections:{}}},computed:{...ie(["catalogUrl","catalogTitle","searchResultsPerPage","itemsPerPage","collectionsPerPage"]),...te(["canSearchItems","canSearchCollections","getStac","root","collectionLink","parentLink","fromBrowserPath","toBrowserPath"]),selectedCollectionCount(){return h.size(this.selectedCollections)},totalCount(){return typeof this.data.numberMatched=="number"?this.data.numberMatched:null},searchLink(){return this.isCollectionSearch?this.collectionSearch:this.itemSearch},collectionSearch(){return this.canSearchCollections&&this.parent&&this.parent.getApiCollectionsLink()},itemSearch(){return this.canSearchItems&&this.parent&&this.parent.getSearchLink()},resultCollection(){return this.isCollectionSearch?new x({collections:this.results,links:[]}):new ee({type:"FeatureCollection",features:this.results,links:[]})},results(){if(h.size(this.data)===0)return[];let e=this.isCollectionSearch?this.data.collections:this.data.features,t=this.isCollectionSearch?"Collection":"Feature";return Array.isArray(e)?e.map(r=>{try{if(!h.isObject(r)||r.type!==t)return null;let d=h.getLinkWithRel(r.links,"self"),g;d?.href&&(g=h.toAbsolute(d.href,this.link.href));let C=X(r,g,this.toBrowserPath(g));return C=Y(this.$store.state,C),C}catch(d){return console.error(d),null}}).filter(r=>r instanceof w):[]},pagination(){return h.getPaginationLinks(this.data)},filters(){return this.isCollectionSearch?this.collectionFilters:this.itemFilters},isCollectionSearch(){return this.collectionSearch&&this.activeSearch==="search-collections-tab"},pageDescription(){let e=Q([this.collectionLink,this.parentLink,this.root],this.catalogTitle);return this.$t("search.metaDescription",{title:e})},noFurtherItems(){return this.link&&this.link.rel==="next"}},watch:{activeSearch(){this.data=null},searchLink:{immediate:!0,handler(){this.searchLink&&this.showPage()}}},async created(){let e=this.catalogUrl;this.loadParent?(e=this.fromBrowserPath(this.loadParent),this.parent=this.getStac(e)):this.parent=this.root,this.parent||(await this.$store.dispatch("load",{url:e}),this.root||await this.$store.dispatch("config",{catalogUrl:e}),this.parent=this.getStac(e),this.showPage())},methods:{openItemSearch(){this.itemFilters.collections=Object.keys(this.selectedCollections),this.activeSearch="search-items-tab",this.selectedCollections={}},selectForItemSearch(e){this.selectedCollections[e.id]?delete this.selectedCollections[e.id]:this.selectedCollections[e.id]=!0},canFilterItems(e){return e instanceof w?!!e.getApiItemsLink():!1},async loadResults(e){this.error=null,this.errorId=null,this.loading=!0;try{this.link=h.addFiltersToLink(e,this.filters,this.searchResultsPerPage);let t=this.isCollectionSearch?"collections":"features",r=await Z(this.$store,this.link);r&&this.showPage(r.config.url),!h.isObject(r.data)||!Array.isArray(r.data[t])?(this.data={},this.error=this.$t(this.isCollectionSearch?"errors.invalidStacCollections":"errors.invalidStacItems")):this.data=r.data}catch(t){this.data={},this.error=j(t),this.errorId=J(t)}finally{this.loading=!1}},async setFilters(e,t=!1){this.isCollectionSearch?this.collectionFilters=e:this.itemFilters=e,t?this.data=null:await this.loadResults(this.searchLink)},showPage(e){this.$store.commit("showPage",{url:e,page:()=>({title:this.$t("search.title"),description:this.pageDescription})})}}}),me={class:"search d-flex flex-column"},fe={key:0,id:"search-map"},ge={class:"ms-2"};function Ce(e,t,r,d,g,C){const b=n("Loading"),y=n("ErrorAlert"),F=n("SearchFilter"),v=n("b-tab"),L=n("b-tabs"),I=D,k=q,A=n("MapView"),V=de,B=ce,$=G,E=n("StacLink"),T=N,R=n("Catalogs"),M=n("Items"),O=H;return i(),m("main",me,[e.parent?e.searchLink?(i(),a(O,{key:2},{default:s(()=>[c(I,{class:"left"},{default:s(()=>[c(L,{modelValue:e.activeSearch,"onUpdate:modelValue":t[0]||(t[0]=l=>e.activeSearch=l)},{default:s(()=>[e.collectionSearch?(i(),a(v,{key:0,title:e.$t("search.tabs.collections"),id:"search-collections-tab"},{default:s(()=>[c(F,{parent:e.parent,title:"",value:e.collectionFilters,type:"Collections",onInput:e.setFilters},null,8,["parent","value","onInput"])]),_:1},8,["title"])):u("",!0),t[1]||(t[1]=o()),e.itemSearch?(i(),a(v,{key:1,title:e.$t("search.tabs.items"),id:"search-items-tab"},{default:s(()=>[c(F,{parent:e.parent,title:"",value:e.itemFilters,type:"Global",onInput:e.setFilters},null,8,["parent","value","onInput"])]),_:1},8,["title"])):u("",!0)]),_:1},8,["modelValue"])]),_:1}),t[5]||(t[5]=o()),c(I,{class:"right"},{default:s(()=>[e.loading?(i(),a(b,{key:0,fill:"",top:""})):e.error?(i(),a(y,{key:1,description:e.error,id:e.errorId},null,8,["description","id"])):e.data===null?(i(),a(k,{key:2,variant:"info",show:""},{default:s(()=>[o(p(e.$t("search.modifyCriteria")),1)]),_:1})):e.results.length===0&&e.noFurtherItems?(i(),a(k,{key:3,variant:"info",show:""},{default:s(()=>[o(p(e.$t("search.noFurtherItemsFound")),1)]),_:1})):e.results.length===0?(i(),a(k,{key:4,variant:"warning",show:""},{default:s(()=>[o(p(e.$t("search.noItemsFound")),1)]),_:1})):(i(),m(U,{key:5},[e.resultCollection?(i(),m("div",fe,[c(A,{stac:e.parent,children:e.resultCollection,onfocusOnly:"",popover:""},null,8,["stac","children"])])):u("",!0),t[4]||(t[4]=o()),e.isCollectionSearch?(i(),a(R,{key:1,catalogs:e.results,collectionsOnly:"",pagination:e.pagination,loading:e.loading,onPaginate:e.loadResults,count:e.totalCount,apiFilters:e.collectionFilters},{catalogFooter:s(l=>[e.itemSearch||e.canFilterItems(l.data)?(i(),a(T,{key:0,vertical:"",size:"sm"},{default:s(()=>[e.itemSearch?(i(),a($,{key:0,variant:"outline-primary",pressed:e.selectedCollections[l.data.id],onClick:ke=>e.selectForItemSearch(l.data)},{default:s(()=>[e.selectedCollections[l.data.id]?(i(),a(V,{key:0})):(i(),a(B,{key:1})),t[2]||(t[2]=o()),f("span",ge,p(e.$t("search.selectForItemSearch")),1)]),_:2},1032,["pressed","onClick"])):u("",!0),t[3]||(t[3]=o()),c(E,{button:{variant:"outline-primary",disabled:!e.canFilterItems(l.data)},data:l.data,title:e.$t("search.filterCollection"),state:{itemFilterOpen:1}},null,8,["button","data","title"])]),_:2},1024)):u("",!0)]),_:1},8,["catalogs","pagination","loading","onPaginate","count","apiFilters"])):(i(),a(M,{key:2,stac:e.parent,items:e.results,api:!0,allowFilter:!1,pagination:e.pagination,loading:e.loading,onPaginate:e.loadResults,count:e.totalCount,apiFilters:e.itemFilters},null,8,["stac","items","pagination","loading","onPaginate","count","apiFilters"]))],64))]),_:1})]),_:1})):(i(),a(y,{key:1,description:e.$t("search.notSupported")},null,8,["description"])):(i(),a(b,{key:0,stretch:""})),t[6]||(t[6]=o()),e.selectedCollectionCount>0?(i(),a(k,{key:3,show:"",variant:"dark",class:"selected-collections-action"},{default:s(()=>[c($,{onClick:e.openItemSearch,variant:"primary",size:"lg"},{default:s(()=>[o(p(e.$t("search.useInItemSearch",e.selectedCollectionCount,{count:e.selectedCollectionCount})),1)]),_:1},8,["onClick"])]),_:1})):u("",!0)])}const Ge=z(pe,[["render",Ce]]);export{Ge as default};
//# sourceMappingURL=Search-7b5F5LEL.js.map
