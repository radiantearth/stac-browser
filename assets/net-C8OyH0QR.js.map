{"version":3,"file":"net-C8OyH0QR.js","sources":["../../node_modules/ol/net.js"],"sourcesContent":["/**\n * @module ol/net\n */\nimport {getUid} from './util.js';\n\n/**\n * Simple JSONP helper. Supports error callbacks and a custom callback param.\n * The error callback will be called when no JSONP is executed after 10 seconds.\n *\n * @param {string} url Request url. A 'callback' query parameter will be\n *     appended.\n * @param {Function} callback Callback on success.\n * @param {Function} [errback] Callback on error.\n * @param {string} [callbackParam] Custom query parameter for the JSONP\n *     callback. Default is 'callback'.\n */\nexport function jsonp(url, callback, errback, callbackParam) {\n  const script = document.createElement('script');\n  const key = 'olc_' + getUid(callback);\n  function cleanup() {\n    delete window[key];\n    script.parentNode.removeChild(script);\n  }\n  script.async = true;\n  script.src =\n    url +\n    (url.includes('?') ? '&' : '?') +\n    (callbackParam || 'callback') +\n    '=' +\n    key;\n  const timer = setTimeout(function () {\n    cleanup();\n    if (errback) {\n      errback();\n    }\n  }, 10000);\n  window[key] = function (data) {\n    clearTimeout(timer);\n    cleanup();\n    callback(data);\n  };\n  document.head.appendChild(script);\n}\n\nexport class ResponseError extends Error {\n  /**\n   * @param {XMLHttpRequest} response The XHR object.\n   */\n  constructor(response) {\n    const message = 'Unexpected response status: ' + response.status;\n    super(message);\n\n    /**\n     * @type {string}\n     */\n    this.name = 'ResponseError';\n\n    /**\n     * @type {XMLHttpRequest}\n     */\n    this.response = response;\n  }\n}\n\nexport class ClientError extends Error {\n  /**\n   * @param {XMLHttpRequest} client The XHR object.\n   */\n  constructor(client) {\n    super('Failed to issue request');\n\n    /**\n     * @type {string}\n     */\n    this.name = 'ClientError';\n\n    /**\n     * @type {XMLHttpRequest}\n     */\n    this.client = client;\n  }\n}\n\n/**\n * @param {string} url The URL.\n * @return {Promise<Object>} A promise that resolves to the JSON response.\n */\nexport function getJSON(url) {\n  return new Promise(function (resolve, reject) {\n    /**\n     * @param {ProgressEvent<XMLHttpRequest>} event The load event.\n     */\n    function onLoad(event) {\n      const client = event.target;\n      // status will be 0 for file:// urls\n      if (!client.status || (client.status >= 200 && client.status < 300)) {\n        let data;\n        try {\n          data = JSON.parse(client.responseText);\n        } catch (err) {\n          const message = 'Error parsing response text as JSON: ' + err.message;\n          reject(new Error(message));\n          return;\n        }\n        resolve(data);\n        return;\n      }\n\n      reject(new ResponseError(client));\n    }\n\n    /**\n     * @param {ProgressEvent<XMLHttpRequest>} event The error event.\n     */\n    function onError(event) {\n      reject(new ClientError(event.target));\n    }\n\n    const client = new XMLHttpRequest();\n    client.addEventListener('load', onLoad);\n    client.addEventListener('error', onError);\n    client.open('GET', url);\n    client.setRequestHeader('Accept', 'application/json');\n    client.send();\n  });\n}\n\n/**\n * @param {string} base The base URL.\n * @param {string} url The potentially relative URL.\n * @return {string} The full URL.\n */\nexport function resolveUrl(base, url) {\n  if (url.includes('://')) {\n    return url;\n  }\n  return new URL(url, base).href;\n}\n\nlet originalXHR;\nexport function overrideXHR(xhr) {\n  if (typeof XMLHttpRequest !== 'undefined') {\n    originalXHR = XMLHttpRequest;\n  }\n  global.XMLHttpRequest = xhr;\n}\n\nexport function restoreXHR() {\n  global.XMLHttpRequest = originalXHR;\n}\n"],"names":["jsonp","url","callback","errback","callbackParam","script","key","getUid","cleanup","timer","data","ResponseError","response","message","ClientError","client","getJSON","resolve","reject","onLoad","event","err","onError","resolveUrl","base"],"mappings":"0CAgBO,SAASA,EAAMC,EAAKC,EAAUC,EAASC,EAAe,CAC3D,MAAMC,EAAS,SAAS,cAAc,QAAQ,EACxCC,EAAM,OAASC,EAAOL,CAAQ,EACpC,SAASM,GAAU,CACjB,OAAO,OAAOF,CAAG,EACjBD,EAAO,WAAW,YAAYA,CAAM,CACtC,CACAA,EAAO,MAAQ,GACfA,EAAO,IACLJ,GACCA,EAAI,SAAS,GAAG,EAAI,IAAM,KACT,YAElBK,EACF,MAAMG,EAAQ,WAAW,UAAY,CACnCD,EAAO,EACHL,GACFA,EAAO,CAEX,EAAG,GAAK,EACR,OAAOG,CAAG,EAAI,SAAUI,EAAM,CAC5B,aAAaD,CAAK,EAClBD,EAAO,EACPN,EAASQ,CAAI,CACf,EACA,SAAS,KAAK,YAAYL,CAAM,CAClC,CAEO,MAAMM,UAAsB,KAAM,CAIvC,YAAYC,EAAU,CACpB,MAAMC,EAAU,+BAAiCD,EAAS,OAC1D,MAAMC,CAAO,EAKb,KAAK,KAAO,gBAKZ,KAAK,SAAWD,CAClB,CACF,CAEO,MAAME,UAAoB,KAAM,CAIrC,YAAYC,EAAQ,CAClB,MAAM,yBAAyB,EAK/B,KAAK,KAAO,cAKZ,KAAK,OAASA,CAChB,CACF,CAMO,SAASC,EAAQf,EAAK,CAC3B,OAAO,IAAI,QAAQ,SAAUgB,EAASC,EAAQ,CAI5C,SAASC,EAAOC,EAAO,CACrB,MAAML,EAASK,EAAM,OAErB,GAAI,CAACL,EAAO,QAAWA,EAAO,QAAU,KAAOA,EAAO,OAAS,IAAM,CACnE,IAAIL,EACJ,GAAI,CACFA,EAAO,KAAK,MAAMK,EAAO,YAAY,CACvC,OAASM,EAAK,CACZ,MAAMR,EAAU,wCAA0CQ,EAAI,QAC9DH,EAAO,IAAI,MAAML,CAAO,CAAC,EACzB,MACF,CACAI,EAAQP,CAAI,EACZ,MACF,CAEAQ,EAAO,IAAIP,EAAcI,CAAM,CAAC,CAClC,CAKA,SAASO,EAAQF,EAAO,CACtBF,EAAO,IAAIJ,EAAYM,EAAM,MAAM,CAAC,CACtC,CAEA,MAAML,EAAS,IAAI,eACnBA,EAAO,iBAAiB,OAAQI,CAAM,EACtCJ,EAAO,iBAAiB,QAASO,CAAO,EACxCP,EAAO,KAAK,MAAOd,CAAG,EACtBc,EAAO,iBAAiB,SAAU,kBAAkB,EACpDA,EAAO,KAAI,CACb,CAAC,CACH,CAOO,SAASQ,EAAWC,EAAMvB,EAAK,CACpC,OAAIA,EAAI,SAAS,KAAK,EACbA,EAEF,IAAI,IAAIA,EAAKuB,CAAI,EAAE,IAC5B","x_google_ignoreList":[0]}