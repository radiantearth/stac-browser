{"version":3,"file":"mapguide-DuFbAmiA.js","sources":["../../node_modules/ol/source/mapguide.js"],"sourcesContent":["/**\n * @module ol/source/mapguide\n */\n\nimport {decode} from '../Image.js';\nimport {getCenter, getHeight, getWidth} from '../extent.js';\nimport {appendParams} from '../uri.js';\nimport {getRequestExtent} from './Image.js';\n\n/**\n * @typedef {Object} LoaderOptions\n * @property {string} url The mapagent url.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {number} [displayDpi=96] The display resolution.\n * @property {number} [metersPerUnit=1] The meters-per-unit value.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting\n * the image from the remote server.\n * @property {boolean} [useOverlay] If `true`, will use `GETDYNAMICMAPOVERLAYIMAGE`.\n * @property {number} [ratio=1] Ratio. `1` means image requests are the size of the map viewport, `2` means\n * twice the width and height of the map viewport, and so on. Must be `1` or higher.\n * @property {Object} [params] Additional query parameters.\n * @property {function(HTMLImageElement, string): Promise<import('../DataTile.js').ImageLike>} [load] Function\n * to perform loading of the image. Receives the created `HTMLImageElement` and the desired `src` as argument and\n * returns a promise resolving to the loaded or decoded image. Default is {@link module:ol/Image.decode}.\n */\n\n/**\n * @param {import(\"../extent.js\").Extent} extent The map extents.\n * @param {import(\"../size.js\").Size} size The viewport size.\n * @param {number} metersPerUnit The meters-per-unit value.\n * @param {number} dpi The display resolution.\n * @return {number} The computed map scale.\n */\nfunction getScale(extent, size, metersPerUnit, dpi) {\n  const mcsW = getWidth(extent);\n  const mcsH = getHeight(extent);\n  const devW = size[0];\n  const devH = size[1];\n  const mpp = 0.0254 / dpi;\n  if (devH * mcsW > devW * mcsH) {\n    return (mcsW * metersPerUnit) / (devW * mpp); // width limited\n  }\n  return (mcsH * metersPerUnit) / (devH * mpp); // height limited\n}\n\n/**\n * @param {string} baseUrl The mapagent url.\n * @param {Object<string, string|number>} params Request parameters.\n * @param {import(\"../extent.js\").Extent} extent Extent.\n * @param {import(\"../size.js\").Size} size Size.\n * @param {boolean} useOverlay If `true`, will use `GETDYNAMICMAPOVERLAYIMAGE`.\n * @param {number} metersPerUnit The meters-per-unit value.\n * @param {number} displayDpi The display resolution.\n * @return {string} The mapagent map image request URL.\n */\nfunction getUrl(\n  baseUrl,\n  params,\n  extent,\n  size,\n  useOverlay,\n  metersPerUnit,\n  displayDpi,\n) {\n  const scale = getScale(extent, size, metersPerUnit, displayDpi);\n  const center = getCenter(extent);\n  const baseParams = {\n    'OPERATION': useOverlay ? 'GETDYNAMICMAPOVERLAYIMAGE' : 'GETMAPIMAGE',\n    'VERSION': '2.0.0',\n    'LOCALE': 'en',\n    'CLIENTAGENT': 'ol/source/ImageMapGuide source',\n    'CLIP': '1',\n    'SETDISPLAYDPI': displayDpi,\n    'SETDISPLAYWIDTH': Math.round(size[0]),\n    'SETDISPLAYHEIGHT': Math.round(size[1]),\n    'SETVIEWSCALE': scale,\n    'SETVIEWCENTERX': center[0],\n    'SETVIEWCENTERY': center[1],\n  };\n  Object.assign(baseParams, params);\n  return appendParams(baseUrl, baseParams);\n}\n\n/**\n * Creates a loader for MapGuide images.\n * @param {LoaderOptions} options Image ArcGIS Rest Options.\n * @return {import('../Image.js').ImageObjectPromiseLoader} ArcGIS Rest image.\n * @api\n */\nexport function createLoader(options) {\n  const load = options.load || decode;\n  const useOverlay = options.useOverlay ?? false;\n  const metersPerUnit = options.metersPerUnit || 1;\n  const displayDpi = options.displayDpi || 96;\n  const ratio = options.ratio ?? 1;\n  const crossOrigin = options.crossOrigin ?? null;\n\n  return function (extent, resolution, pixelRatio) {\n    const image = new Image();\n    image.crossOrigin = crossOrigin;\n    extent = getRequestExtent(extent, resolution, pixelRatio, ratio);\n    const width = getWidth(extent) / resolution;\n    const height = getHeight(extent) / resolution;\n    const size = [width * pixelRatio, height * pixelRatio];\n    const src = getUrl(\n      options.url,\n      options.params,\n      extent,\n      size,\n      useOverlay,\n      metersPerUnit,\n      displayDpi,\n    );\n    return load(image, src).then((image) => ({image, extent, pixelRatio}));\n  };\n}\n"],"names":["getScale","extent","size","metersPerUnit","dpi","mcsW","getWidth","mcsH","getHeight","devW","devH","mpp","getUrl","baseUrl","params","useOverlay","displayDpi","scale","center","getCenter","baseParams","appendParams","createLoader","options","load","decode","ratio","crossOrigin","resolution","pixelRatio","image","getRequestExtent","width","height","src"],"mappings":"+lBAmCA,SAASA,EAASC,EAAQC,EAAMC,EAAeC,EAAK,CAClD,MAAMC,EAAOC,EAASL,CAAM,EACtBM,EAAOC,EAAUP,CAAM,EACvBQ,EAAOP,EAAK,CAAC,EACbQ,EAAOR,EAAK,CAAC,EACbS,EAAM,MAASP,EACrB,OAAIM,EAAOL,EAAOI,EAAOF,EACfF,EAAOF,GAAkBM,EAAOE,GAElCJ,EAAOJ,GAAkBO,EAAOC,EAC1C,CAYA,SAASC,EACPC,EACAC,EACAb,EACAC,EACAa,EACAZ,EACAa,EACA,CACA,MAAMC,EAAQjB,EAASC,EAAQC,EAAMC,EAAea,CAAU,EACxDE,EAASC,EAAUlB,CAAM,EACzBmB,EAAa,CACjB,UAAaL,EAAa,4BAA8B,cACxD,QAAW,QACX,OAAU,KACV,YAAe,iCACf,KAAQ,IACR,cAAiBC,EACjB,gBAAmB,KAAK,MAAMd,EAAK,CAAC,CAAC,EACrC,iBAAoB,KAAK,MAAMA,EAAK,CAAC,CAAC,EACtC,aAAgBe,EAChB,eAAkBC,EAAO,CAAC,EAC1B,eAAkBA,EAAO,CAAC,CAC9B,EACE,cAAO,OAAOE,EAAYN,CAAM,EACzBO,EAAaR,EAASO,CAAU,CACzC,CAQO,SAASE,EAAaC,EAAS,CACpC,MAAMC,EAAOD,EAAQ,MAAQE,EACvBV,EAAaQ,EAAQ,YAAc,GACnCpB,EAAgBoB,EAAQ,eAAiB,EACzCP,EAAaO,EAAQ,YAAc,GACnCG,EAAQH,EAAQ,OAAS,EACzBI,EAAcJ,EAAQ,aAAe,KAE3C,OAAO,SAAUtB,EAAQ2B,EAAYC,EAAY,CAC/C,MAAMC,EAAQ,IAAI,MAClBA,EAAM,YAAcH,EACpB1B,EAAS8B,EAAiB9B,EAAQ2B,EAAYC,EAAYH,CAAK,EAC/D,MAAMM,EAAQ1B,EAASL,CAAM,EAAI2B,EAC3BK,EAASzB,EAAUP,CAAM,EAAI2B,EAC7B1B,EAAO,CAAC8B,EAAQH,EAAYI,EAASJ,CAAU,EAC/CK,EAAMtB,EACVW,EAAQ,IACRA,EAAQ,OACRtB,EACAC,EACAa,EACAZ,EACAa,CACN,EACI,OAAOQ,EAAKM,EAAOI,CAAG,EAAE,KAAMJ,IAAW,CAAC,MAAAA,EAAO,OAAA7B,EAAQ,WAAA4B,CAAU,EAAE,CACvE,CACF","x_google_ignoreList":[0]}