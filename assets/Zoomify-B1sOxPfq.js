import{I as j}from"./Tile-Bg7ozswn.js";import{f as v,as as D,b5 as R,a4 as L,u as M}from"./GeoJSON-BoRJWQIG.js";import{T as Z}from"./TileGrid-r8UQ2tK6.js";import{a as k}from"./tileurlfunction-naLPssJX.js";import{e as A}from"./uri-CWE-Y_zl.js";import O from"./TileImage-BNMca0aI.js";import"./Tile-Dd8tR1PC.js";import"./common-CLWpeXJR.js";import"./index-B3F0456b.js";import"./utils-BXWzvTjY.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-DO3czC2y.js";import"./useStateClass-BGbSLWFN-eI-Q6wqs.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--5aly-L7g.js";import"./TileRange-2Tc-Ry00.js";import"./tilecoord-DBpIeO-O.js";import"./Tile-BqAKaOfQ.js";import"./UrlTile-CjdLFnBY.js";import"./TileEventType-CTN_nmJ7.js";class P extends j{constructor(e,l,s,n,a,c,i){super(l,s,n,a,c,i),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==v.LOADED){const l=this.tileSize_;if(e.width==l[0]&&e.height==l[1])return this.zoomifyImage_=e,e;const s=D(l[0],l[1]);return s.drawImage(e,0,0),this.zoomifyImage_=s.canvas,s.canvas}return e}}class me extends O{constructor(e){const l=e.size,s=e.tierSizeCalculation!==void 0?e.tierSizeCalculation:"default",n=e.tilePixelRatio||1,a=l[0],c=l[1],i=[],u=e.tileSize||R;let r=u*n;switch(s){case"default":for(;a>r||c>r;)i.push([Math.ceil(a/r),Math.ceil(c/r)]),r+=r;break;case"truncated":let t=a,o=c;for(;t>r||o>r;)i.push([Math.ceil(t/r),Math.ceil(o/r)]),t>>=1,o>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}i.push([1,1]),i.reverse();const m=[n],d=[0];for(let t=1,o=i.length;t<o;t++)m.push(n<<t),d.push(i[t-1][0]*i[t-1][1]+d[t-1]);m.reverse();const p=new Z({tileSize:u,extent:e.extent||[0,-c,a,0],resolutions:m});let h=e.url;h&&!h.includes("{TileGroup}")&&!h.includes("{tileIndex}")&&(h+="{TileGroup}/{z}-{x}-{y}.jpg");const w=A(h);let f=u*n;function y(t){return(function(o,W,H){if(!o)return;const g=o[0],x=o[1],I=o[2],S=x+I*i[g][0],F=(S+d[g])/f|0,G={z:g,x,y:I,tileIndex:S,TileGroup:"TileGroup"+F};return t.replace(/\{(\w+?)\}/g,function(X,b){return G[b]})})}const z=k(w.map(y)),E=P.bind(null,L(u*n));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:n,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:E,tileGrid:p,tileUrlFunction:z,transition:e.transition}),this.zDirection=e.zDirection;const U=p.getTileCoordForCoordAndResolution(M(p.getExtent()),m[m.length-1]),_=z(U,1,null),T=new Image;T.addEventListener("error",()=>{f=u,this.changed()}),T.src=_}}export{P as CustomTile,me as default};
//# sourceMappingURL=Zoomify-B1sOxPfq.js.map
