{"version":3,"file":"ogcTileUtil-CC5XC0Pn.js","sources":["../../node_modules/ol/source/ogcTileUtil.js"],"sourcesContent":["/**\n * @module ol/source/ogcTileUtil\n */\n\nimport {error as logError} from '../console.js';\nimport {getIntersection as intersectExtents} from '../extent.js';\nimport {getJSON, resolveUrl} from '../net.js';\nimport {get as getProjection} from '../proj.js';\nimport TileGrid from '../tilegrid/TileGrid.js';\n\n/**\n * See https://ogcapi.ogc.org/tiles/.\n */\n\n/**\n * @typedef {'map' | 'vector'} TileType\n */\n\n/**\n * @typedef {'topLeft' | 'bottomLeft'} CornerOfOrigin\n */\n\n/**\n * @typedef {Object} TileSet\n * @property {TileType} dataType Type of data represented in the tileset.\n * @property {string} [tileMatrixSetDefinition] Reference to a tile matrix set definition.\n * @property {TileMatrixSet} [tileMatrixSet] Tile matrix set definition.\n * @property {Array<TileMatrixSetLimit>} [tileMatrixSetLimits] Tile matrix set limits.\n * @property {Array<Link>} links Tileset links.\n */\n\n/**\n * @typedef {Object} Link\n * @property {string} rel The link rel attribute.\n * @property {string} href The link URL.\n * @property {string} type The link type.\n */\n\n/**\n * @typedef {Object} TileMatrixSetLimit\n * @property {string} tileMatrix The tile matrix id.\n * @property {number} minTileRow The minimum tile row.\n * @property {number} maxTileRow The maximum tile row.\n * @property {number} minTileCol The minimum tile column.\n * @property {number} maxTileCol The maximum tile column.\n */\n\n/**\n * @typedef {Object} TileMatrixSet\n * @property {string} id The tile matrix set identifier.\n * @property {string|CrsUri|CrsWkt|CrsReferenceSystem} crs The coordinate reference system.\n * @property {Array<string>} [orderedAxes] Axis order.\n * @property {Array<TileMatrix>} tileMatrices Array of tile matrices.\n */\n\n/**\n * @typedef {Object} CrsUri\n * @property {string} uri Reference to one coordinate reference system (CRS).\n */\n\n/**\n * @typedef {Object} CrsWkt\n * @property {Object} wkt JSON encoding for WKT representation of CRS 2.0.\n */\n\n/**\n * @typedef {Object} CrsReferenceSystem\n * @property {Object} referenceSystem Data structure as defined in the MD_ReferenceSystem of the ISO 19115.\n */\n\n/**\n * @typedef {Object} TileMatrix\n * @property {string} id The tile matrix identifier.\n * @property {number} cellSize The pixel resolution (map units per pixel).\n * @property {Array<number>} pointOfOrigin The map location of the matrix origin.\n * @property {CornerOfOrigin} [cornerOfOrigin='topLeft'] The corner of the matrix that represents the origin ('topLeft' or 'bottomLeft').\n * @property {number} matrixWidth The number of columns.\n * @property {number} matrixHeight The number of rows.\n * @property {number} tileWidth The pixel width of a tile.\n * @property {number} tileHeight The pixel height of a tile.\n */\n\n/**\n * @type {Object<string, boolean>}\n */\nconst knownMapMediaTypes = {\n  'image/png': true,\n  'image/jpeg': true,\n  'image/gif': true,\n  'image/webp': true,\n};\n\n/**\n * @type {Object<string, boolean>}\n */\nconst knownVectorMediaTypes = {\n  'application/vnd.mapbox-vector-tile': true,\n  'application/geo+json': true,\n};\n\n/**\n * @typedef {Object} TileSetInfo\n * @property {string} urlTemplate The tile URL template.\n * @property {import(\"../proj/Projection.js\").default} projection The source projection.\n * @property {import(\"../tilegrid/TileGrid.js\").default} grid The tile grid.\n * @property {import(\"../Tile.js\").UrlFunction} urlFunction The tile URL function.\n */\n\n/**\n * @typedef {Object} SourceInfo\n * @property {string} url The tile set URL.\n * @property {string} mediaType The preferred tile media type.\n * @property {Array<string>} [supportedMediaTypes] The supported media types.\n * @property {import(\"../proj/Projection.js\").default} projection The source projection.\n * @property {Object} [context] Optional context for constructing the URL.\n * @property {Array<string>} [collections] Optional collections to append the URL with.\n */\n\n/**\n * @param {string} tileUrlTemplate Tile URL template.\n * @param {Array<string>} collections List of collections to include as query parameter.\n * @return {string} The tile URL template with appended collections query parameter.\n */\nexport function appendCollectionsQueryParam(tileUrlTemplate, collections) {\n  if (!collections.length) {\n    return tileUrlTemplate;\n  }\n\n  // making sure we can always construct a URL instance.\n  const url = new URL(tileUrlTemplate, 'file:/');\n\n  if (url.pathname.split('/').includes('collections')) {\n    logError(\n      'The \"collections\" query parameter cannot be added to collection endpoints',\n    );\n    return tileUrlTemplate;\n  }\n  // According to conformance class\n  // http://www.opengis.net/spec/ogcapi-tiles-1/1.0/conf/collections-selection\n  // commata in the identifiers of the `collections` query parameter\n  // need to be URLEncoded, while the commata separating the identifiers\n  // should not.\n  const encodedCollections = collections\n    .map((c) => encodeURIComponent(c))\n    .join(',');\n\n  url.searchParams.append('collections', encodedCollections);\n  const baseUrl = tileUrlTemplate.split('?')[0];\n  const queryParams = decodeURIComponent(url.searchParams.toString());\n  return `${baseUrl}?${queryParams}`;\n}\n\n/**\n * @param {Array<Link>} links Tileset links.\n * @param {string} [mediaType] The preferred media type.\n * @param {Array<string>} [collections] Optional collections to append the URL with.\n * @return {string} The tile URL template.\n */\nexport function getMapTileUrlTemplate(links, mediaType, collections) {\n  let tileUrlTemplate;\n  let fallbackUrlTemplate;\n  for (let i = 0; i < links.length; ++i) {\n    const link = links[i];\n    if (link.rel === 'item') {\n      if (link.type === mediaType) {\n        tileUrlTemplate = link.href;\n        break;\n      }\n      if (knownMapMediaTypes[link.type]) {\n        fallbackUrlTemplate = link.href;\n      } else if (!fallbackUrlTemplate && link.type.startsWith('image/')) {\n        fallbackUrlTemplate = link.href;\n      }\n    }\n  }\n\n  if (!tileUrlTemplate) {\n    if (fallbackUrlTemplate) {\n      tileUrlTemplate = fallbackUrlTemplate;\n    } else {\n      throw new Error('Could not find \"item\" link');\n    }\n  }\n\n  if (collections) {\n    tileUrlTemplate = appendCollectionsQueryParam(tileUrlTemplate, collections);\n  }\n\n  return tileUrlTemplate;\n}\n\n/**\n * @param {Array<Link>} links Tileset links.\n * @param {string} [mediaType] The preferred media type.\n * @param {Array<string>} [supportedMediaTypes] The media types supported by the parser.\n * @param {Array<string>} [collections] Optional collections to append the URL with.\n * @return {string} The tile URL template.\n */\nexport function getVectorTileUrlTemplate(\n  links,\n  mediaType,\n  supportedMediaTypes,\n  collections,\n) {\n  let tileUrlTemplate;\n  let fallbackUrlTemplate;\n\n  /**\n   * Lookup of URL by media type.\n   * @type {Object<string, string>}\n   */\n  const hrefLookup = {};\n\n  for (let i = 0; i < links.length; ++i) {\n    const link = links[i];\n    hrefLookup[link.type] = link.href;\n    if (link.rel === 'item') {\n      if (link.type === mediaType) {\n        tileUrlTemplate = link.href;\n        break;\n      }\n      if (knownVectorMediaTypes[link.type]) {\n        fallbackUrlTemplate = link.href;\n      }\n    }\n  }\n\n  if (!tileUrlTemplate && supportedMediaTypes) {\n    for (let i = 0; i < supportedMediaTypes.length; ++i) {\n      const supportedMediaType = supportedMediaTypes[i];\n      if (hrefLookup[supportedMediaType]) {\n        tileUrlTemplate = hrefLookup[supportedMediaType];\n        break;\n      }\n    }\n  }\n\n  if (!tileUrlTemplate) {\n    if (fallbackUrlTemplate) {\n      tileUrlTemplate = fallbackUrlTemplate;\n    } else {\n      throw new Error('Could not find \"item\" link');\n    }\n  }\n\n  if (collections) {\n    tileUrlTemplate = appendCollectionsQueryParam(tileUrlTemplate, collections);\n  }\n\n  return tileUrlTemplate;\n}\n\n/**\n * @param {SourceInfo} sourceInfo The source info.\n * @param {TileMatrixSet} tileMatrixSet Tile matrix set.\n * @param {string} tileUrlTemplate Tile URL template.\n * @param {Array<TileMatrixSetLimit>} [tileMatrixSetLimits] Tile matrix set limits.\n * @return {TileSetInfo} Tile set info.\n */\nfunction parseTileMatrixSet(\n  sourceInfo,\n  tileMatrixSet,\n  tileUrlTemplate,\n  tileMatrixSetLimits,\n) {\n  let projection = sourceInfo.projection;\n  if (!projection) {\n    if (typeof tileMatrixSet.crs === 'string') {\n      projection = getProjection(tileMatrixSet.crs);\n    } else if ('uri' in tileMatrixSet.crs) {\n      projection = getProjection(tileMatrixSet.crs.uri);\n    }\n    if (!projection) {\n      throw new Error(`Unsupported CRS: ${JSON.stringify(tileMatrixSet.crs)}`);\n    }\n  }\n  const orderedAxes = tileMatrixSet.orderedAxes;\n  const axisOrientation = orderedAxes\n    ? orderedAxes\n        .slice(0, 2)\n        .map((s) => s.replace(/E|X|Lon/i, 'e').replace(/N|Y|Lat/i, 'n'))\n        .join('')\n    : projection.getAxisOrientation();\n  const backwards = !axisOrientation.startsWith('en');\n\n  const matrices = tileMatrixSet.tileMatrices;\n\n  /**\n   * @type {Object<string, TileMatrix>}\n   */\n  const matrixLookup = {};\n  for (let i = 0; i < matrices.length; ++i) {\n    const matrix = matrices[i];\n    matrixLookup[matrix.id] = matrix;\n  }\n\n  /**\n   * @type {Object<string, TileMatrixSetLimit>}\n   */\n  const limitLookup = {};\n\n  /**\n   * @type {Array<string>}\n   */\n  const matrixIds = [];\n\n  if (tileMatrixSetLimits) {\n    for (let i = 0; i < tileMatrixSetLimits.length; ++i) {\n      const limit = tileMatrixSetLimits[i];\n      const id = limit.tileMatrix;\n      matrixIds.push(id);\n      limitLookup[id] = limit;\n    }\n  } else {\n    for (let i = 0; i < matrices.length; ++i) {\n      const id = matrices[i].id;\n      matrixIds.push(id);\n    }\n  }\n\n  const length = matrixIds.length;\n  const origins = new Array(length);\n  const resolutions = new Array(length);\n  const sizes = new Array(length);\n  const tileSizes = new Array(length);\n  const extent = [-Infinity, -Infinity, Infinity, Infinity];\n\n  for (let i = 0; i < length; ++i) {\n    const id = matrixIds[i];\n    const matrix = matrixLookup[id];\n    const origin = matrix.pointOfOrigin;\n    if (backwards) {\n      origins[i] = [origin[1], origin[0]];\n    } else {\n      origins[i] = origin;\n    }\n    resolutions[i] = matrix.cellSize;\n    sizes[i] = [matrix.matrixWidth, matrix.matrixHeight];\n    tileSizes[i] = [matrix.tileWidth, matrix.tileHeight];\n    const limit = limitLookup[id];\n    if (limit) {\n      const tileMapWidth = matrix.cellSize * matrix.tileWidth;\n      const minX = origins[i][0] + limit.minTileCol * tileMapWidth;\n      const maxX = origins[i][0] + (limit.maxTileCol + 1) * tileMapWidth;\n\n      const tileMapHeight = matrix.cellSize * matrix.tileHeight;\n      const upsideDown = matrix.cornerOfOrigin === 'bottomLeft';\n\n      let minY;\n      let maxY;\n      if (upsideDown) {\n        minY = origins[i][1] + limit.minTileRow * tileMapHeight;\n        maxY = origins[i][1] + (limit.maxTileRow + 1) * tileMapHeight;\n      } else {\n        minY = origins[i][1] - (limit.maxTileRow + 1) * tileMapHeight;\n        maxY = origins[i][1] - limit.minTileRow * tileMapHeight;\n      }\n\n      intersectExtents(extent, [minX, minY, maxX, maxY], extent);\n    }\n  }\n\n  const tileGrid = new TileGrid({\n    origins: origins,\n    resolutions: resolutions,\n    sizes: sizes,\n    tileSizes: tileSizes,\n    extent: tileMatrixSetLimits ? extent : undefined,\n  });\n\n  const context = sourceInfo.context;\n  const base = sourceInfo.url;\n\n  /** @type {import('../Tile.js').UrlFunction} */\n  function tileUrlFunction(tileCoord, pixelRatio, projection) {\n    if (!tileCoord) {\n      return undefined;\n    }\n\n    const id = matrixIds[tileCoord[0]];\n    const matrix = matrixLookup[id];\n    const upsideDown = matrix.cornerOfOrigin === 'bottomLeft';\n\n    const localContext = {\n      tileMatrix: id,\n      tileCol: tileCoord[1],\n      tileRow: upsideDown ? -tileCoord[2] - 1 : tileCoord[2],\n    };\n\n    if (tileMatrixSetLimits) {\n      const limit = limitLookup[matrix.id];\n      if (\n        localContext.tileCol < limit.minTileCol ||\n        localContext.tileCol > limit.maxTileCol ||\n        localContext.tileRow < limit.minTileRow ||\n        localContext.tileRow > limit.maxTileRow\n      ) {\n        return undefined;\n      }\n    }\n\n    Object.assign(\n      localContext,\n      {\n        z: localContext.tileMatrix,\n        x: localContext.tileCol,\n        y: localContext.tileRow,\n      },\n      context,\n    );\n\n    const url = tileUrlTemplate.replace(/\\{(\\w+?)\\}/g, function (m, p) {\n      return localContext[p];\n    });\n\n    return resolveUrl(base, url);\n  }\n\n  return {\n    grid: tileGrid,\n    projection: projection,\n    urlTemplate: tileUrlTemplate,\n    urlFunction: tileUrlFunction,\n  };\n}\n\n/**\n * @param {SourceInfo} sourceInfo The source info.\n * @param {TileSet} tileSet Tile set.\n * @return {TileSetInfo|Promise<TileSetInfo>} Tile set info.\n */\nfunction parseTileSetMetadata(sourceInfo, tileSet) {\n  const tileMatrixSetLimits = tileSet.tileMatrixSetLimits;\n  /** @type {string} */\n  let tileUrlTemplate;\n\n  if (tileSet.dataType === 'map') {\n    tileUrlTemplate = getMapTileUrlTemplate(\n      tileSet.links,\n      sourceInfo.mediaType,\n      sourceInfo.collections,\n    );\n  } else if (tileSet.dataType === 'vector') {\n    tileUrlTemplate = getVectorTileUrlTemplate(\n      tileSet.links,\n      sourceInfo.mediaType,\n      sourceInfo.supportedMediaTypes,\n      sourceInfo.collections,\n    );\n  } else {\n    throw new Error('Expected tileset data type to be \"map\" or \"vector\"');\n  }\n\n  if (tileSet.tileMatrixSet) {\n    return parseTileMatrixSet(\n      sourceInfo,\n      tileSet.tileMatrixSet,\n      tileUrlTemplate,\n      tileMatrixSetLimits,\n    );\n  }\n\n  const tileMatrixSetLink = tileSet.links.find(\n    (link) =>\n      link.rel === 'http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme',\n  );\n  if (!tileMatrixSetLink) {\n    throw new Error(\n      'Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet',\n    );\n  }\n  const tileMatrixSetDefinition = tileMatrixSetLink.href;\n\n  const url = resolveUrl(sourceInfo.url, tileMatrixSetDefinition);\n  return getJSON(url).then(function (tileMatrixSet) {\n    return parseTileMatrixSet(\n      sourceInfo,\n      tileMatrixSet,\n      tileUrlTemplate,\n      tileMatrixSetLimits,\n    );\n  });\n}\n\n/**\n * @param {SourceInfo} sourceInfo Source info.\n * @return {Promise<TileSetInfo>} Tile set info.\n */\nexport function getTileSetInfo(sourceInfo) {\n  return getJSON(sourceInfo.url).then(function (tileSet) {\n    return parseTileSetMetadata(sourceInfo, tileSet);\n  });\n}\n"],"names":["knownMapMediaTypes","knownVectorMediaTypes","appendCollectionsQueryParam","tileUrlTemplate","collections","url","logError","encodedCollections","c","baseUrl","queryParams","getMapTileUrlTemplate","links","mediaType","fallbackUrlTemplate","i","link","getVectorTileUrlTemplate","supportedMediaTypes","hrefLookup","supportedMediaType","parseTileMatrixSet","sourceInfo","tileMatrixSet","tileMatrixSetLimits","projection","getProjection","orderedAxes","backwards","s","matrices","matrixLookup","matrix","limitLookup","matrixIds","limit","id","length","origins","resolutions","sizes","tileSizes","extent","origin","tileMapWidth","minX","maxX","tileMapHeight","upsideDown","minY","maxY","intersectExtents","tileGrid","TileGrid","context","base","tileUrlFunction","tileCoord","pixelRatio","localContext","m","p","resolveUrl","parseTileSetMetadata","tileSet","tileMatrixSetLink","tileMatrixSetDefinition","getJSON","getTileSetInfo"],"mappings":"qhBAqFA,MAAMA,EAAqB,CACzB,YAAa,GACb,aAAc,GACd,YAAa,GACb,aAAc,EAChB,EAKMC,EAAwB,CAC5B,qCAAsC,GACtC,uBAAwB,EAC1B,EAyBO,SAASC,EAA4BC,EAAiBC,EAAa,CACxE,GAAI,CAACA,EAAY,OACf,OAAOD,EAIT,MAAME,EAAM,IAAI,IAAIF,EAAiB,QAAQ,EAE7C,GAAIE,EAAI,SAAS,MAAM,GAAG,EAAE,SAAS,aAAa,EAChDC,OAAAA,EACE,2EACN,EACWH,EAOT,MAAMI,EAAqBH,EACxB,IAAKI,GAAM,mBAAmBA,CAAC,CAAC,EAChC,KAAK,GAAG,EAEXH,EAAI,aAAa,OAAO,cAAeE,CAAkB,EACzD,MAAME,EAAUN,EAAgB,MAAM,GAAG,EAAE,CAAC,EACtCO,EAAc,mBAAmBL,EAAI,aAAa,SAAQ,CAAE,EAClE,MAAO,GAAGI,CAAO,IAAIC,CAAW,EAClC,CAQO,SAASC,EAAsBC,EAAOC,EAAWT,EAAa,CACnE,IAAID,EACAW,EACJ,QAASC,EAAI,EAAGA,EAAIH,EAAM,OAAQ,EAAEG,EAAG,CACrC,MAAMC,EAAOJ,EAAMG,CAAC,EACpB,GAAIC,EAAK,MAAQ,OAAQ,CACvB,GAAIA,EAAK,OAASH,EAAW,CAC3BV,EAAkBa,EAAK,KACvB,KACF,EACIhB,EAAmBgB,EAAK,IAAI,GAErB,CAACF,GAAuBE,EAAK,KAAK,WAAW,QAAQ,KAC9DF,EAAsBE,EAAK,KAE/B,CACF,CAEA,GAAI,CAACb,EACH,GAAIW,EACFX,EAAkBW,MAElB,OAAM,IAAI,MAAM,4BAA4B,EAIhD,OAAIV,IACFD,EAAkBD,EAA4BC,EAAiBC,CAAW,GAGrED,CACT,CASO,SAASc,EACdL,EACAC,EACAK,EACAd,EACA,CACA,IAAID,EACAW,EAMJ,MAAMK,EAAa,CAAA,EAEnB,QAASJ,EAAI,EAAGA,EAAIH,EAAM,OAAQ,EAAEG,EAAG,CACrC,MAAMC,EAAOJ,EAAMG,CAAC,EAEpB,GADAI,EAAWH,EAAK,IAAI,EAAIA,EAAK,KACzBA,EAAK,MAAQ,OAAQ,CACvB,GAAIA,EAAK,OAASH,EAAW,CAC3BV,EAAkBa,EAAK,KACvB,KACF,CACIf,EAAsBe,EAAK,IAAI,IACjCF,EAAsBE,EAAK,KAE/B,CACF,CAEA,GAAI,CAACb,GAAmBe,EACtB,QAASH,EAAI,EAAGA,EAAIG,EAAoB,OAAQ,EAAEH,EAAG,CACnD,MAAMK,EAAqBF,EAAoBH,CAAC,EAChD,GAAII,EAAWC,CAAkB,EAAG,CAClCjB,EAAkBgB,EAAWC,CAAkB,EAC/C,KACF,CACF,CAGF,GAAI,CAACjB,EACH,GAAIW,EACFX,EAAkBW,MAElB,OAAM,IAAI,MAAM,4BAA4B,EAIhD,OAAIV,IACFD,EAAkBD,EAA4BC,EAAiBC,CAAW,GAGrED,CACT,CASA,SAASkB,EACPC,EACAC,EACApB,EACAqB,EACA,CACA,IAAIC,EAAaH,EAAW,WAC5B,GAAI,CAACG,IACC,OAAOF,EAAc,KAAQ,SAC/BE,EAAaC,EAAcH,EAAc,GAAG,EACnC,QAASA,EAAc,MAChCE,EAAaC,EAAcH,EAAc,IAAI,GAAG,GAE9C,CAACE,GACH,MAAM,IAAI,MAAM,oBAAoB,KAAK,UAAUF,EAAc,GAAG,CAAC,EAAE,EAG3E,MAAMI,EAAcJ,EAAc,YAO5BK,EAAY,EANMD,EACpBA,EACG,MAAM,EAAG,CAAC,EACV,IAAKE,GAAMA,EAAE,QAAQ,WAAY,GAAG,EAAE,QAAQ,WAAY,GAAG,CAAC,EAC9D,KAAK,EAAE,EACVJ,EAAW,mBAAkB,GACE,WAAW,IAAI,EAE5CK,EAAWP,EAAc,aAKzBQ,EAAe,CAAA,EACrB,QAAShB,EAAI,EAAGA,EAAIe,EAAS,OAAQ,EAAEf,EAAG,CACxC,MAAMiB,EAASF,EAASf,CAAC,EACzBgB,EAAaC,EAAO,EAAE,EAAIA,CAC5B,CAKA,MAAMC,EAAc,CAAA,EAKdC,EAAY,CAAA,EAElB,GAAIV,EACF,QAAST,EAAI,EAAGA,EAAIS,EAAoB,OAAQ,EAAET,EAAG,CACnD,MAAMoB,EAAQX,EAAoBT,CAAC,EAC7BqB,EAAKD,EAAM,WACjBD,EAAU,KAAKE,CAAE,EACjBH,EAAYG,CAAE,EAAID,CACpB,KAEA,SAASpB,EAAI,EAAGA,EAAIe,EAAS,OAAQ,EAAEf,EAAG,CACxC,MAAMqB,EAAKN,EAASf,CAAC,EAAE,GACvBmB,EAAU,KAAKE,CAAE,CACnB,CAGF,MAAMC,EAASH,EAAU,OACnBI,EAAU,IAAI,MAAMD,CAAM,EAC1BE,EAAc,IAAI,MAAMF,CAAM,EAC9BG,EAAQ,IAAI,MAAMH,CAAM,EACxBI,EAAY,IAAI,MAAMJ,CAAM,EAC5BK,EAAS,CAAC,KAAW,KAAW,IAAU,GAAQ,EAExD,QAAS3B,EAAI,EAAGA,EAAIsB,EAAQ,EAAEtB,EAAG,CAC/B,MAAMqB,EAAKF,EAAUnB,CAAC,EAChBiB,EAASD,EAAaK,CAAE,EACxBO,EAASX,EAAO,cAClBJ,EACFU,EAAQvB,CAAC,EAAI,CAAC4B,EAAO,CAAC,EAAGA,EAAO,CAAC,CAAC,EAElCL,EAAQvB,CAAC,EAAI4B,EAEfJ,EAAYxB,CAAC,EAAIiB,EAAO,SACxBQ,EAAMzB,CAAC,EAAI,CAACiB,EAAO,YAAaA,EAAO,YAAY,EACnDS,EAAU1B,CAAC,EAAI,CAACiB,EAAO,UAAWA,EAAO,UAAU,EACnD,MAAMG,EAAQF,EAAYG,CAAE,EAC5B,GAAID,EAAO,CACT,MAAMS,EAAeZ,EAAO,SAAWA,EAAO,UACxCa,EAAOP,EAAQvB,CAAC,EAAE,CAAC,EAAIoB,EAAM,WAAaS,EAC1CE,EAAOR,EAAQvB,CAAC,EAAE,CAAC,GAAKoB,EAAM,WAAa,GAAKS,EAEhDG,EAAgBf,EAAO,SAAWA,EAAO,WACzCgB,EAAahB,EAAO,iBAAmB,aAE7C,IAAIiB,EACAC,EACAF,GACFC,EAAOX,EAAQvB,CAAC,EAAE,CAAC,EAAIoB,EAAM,WAAaY,EAC1CG,EAAOZ,EAAQvB,CAAC,EAAE,CAAC,GAAKoB,EAAM,WAAa,GAAKY,IAEhDE,EAAOX,EAAQvB,CAAC,EAAE,CAAC,GAAKoB,EAAM,WAAa,GAAKY,EAChDG,EAAOZ,EAAQvB,CAAC,EAAE,CAAC,EAAIoB,EAAM,WAAaY,GAG5CI,EAAiBT,EAAQ,CAACG,EAAMI,EAAMH,EAAMI,CAAI,EAAGR,CAAM,CAC3D,CACF,CAEA,MAAMU,EAAW,IAAIC,EAAS,CAC5B,QAASf,EACT,YAAaC,EACb,MAAOC,EACP,UAAWC,EACX,OAAQjB,EAAsBkB,EAAS,MAC3C,CAAG,EAEKY,EAAUhC,EAAW,QACrBiC,EAAOjC,EAAW,IAGxB,SAASkC,EAAgBC,EAAWC,EAAYjC,EAAY,CAC1D,GAAI,CAACgC,EACH,OAGF,MAAMrB,EAAKF,EAAUuB,EAAU,CAAC,CAAC,EAC3BzB,EAASD,EAAaK,CAAE,EACxBY,EAAahB,EAAO,iBAAmB,aAEvC2B,EAAe,CACnB,WAAYvB,EACZ,QAASqB,EAAU,CAAC,EACpB,QAAST,EAAa,CAACS,EAAU,CAAC,EAAI,EAAIA,EAAU,CAAC,CAC3D,EAEI,GAAIjC,EAAqB,CACvB,MAAMW,EAAQF,EAAYD,EAAO,EAAE,EACnC,GACE2B,EAAa,QAAUxB,EAAM,YAC7BwB,EAAa,QAAUxB,EAAM,YAC7BwB,EAAa,QAAUxB,EAAM,YAC7BwB,EAAa,QAAUxB,EAAM,WAE7B,MAEJ,CAEA,OAAO,OACLwB,EACA,CACE,EAAGA,EAAa,WAChB,EAAGA,EAAa,QAChB,EAAGA,EAAa,OACxB,EACML,CACN,EAEI,MAAMjD,EAAMF,EAAgB,QAAQ,cAAe,SAAUyD,EAAGC,EAAG,CACjE,OAAOF,EAAaE,CAAC,CACvB,CAAC,EAED,OAAOC,EAAWP,EAAMlD,CAAG,CAC7B,CAEA,MAAO,CACL,KAAM+C,EACN,WAAY3B,EACZ,YAAatB,EACb,YAAaqD,CACjB,CACA,CAOA,SAASO,EAAqBzC,EAAY0C,EAAS,CACjD,MAAMxC,EAAsBwC,EAAQ,oBAEpC,IAAI7D,EAEJ,GAAI6D,EAAQ,WAAa,MACvB7D,EAAkBQ,EAChBqD,EAAQ,MACR1C,EAAW,UACXA,EAAW,WACjB,UACa0C,EAAQ,WAAa,SAC9B7D,EAAkBc,EAChB+C,EAAQ,MACR1C,EAAW,UACXA,EAAW,oBACXA,EAAW,WACjB,MAEI,OAAM,IAAI,MAAM,oDAAoD,EAGtE,GAAI0C,EAAQ,cACV,OAAO3C,EACLC,EACA0C,EAAQ,cACR7D,EACAqB,CACN,EAGE,MAAMyC,EAAoBD,EAAQ,MAAM,KACrChD,GACCA,EAAK,MAAQ,sDACnB,EACE,GAAI,CAACiD,EACH,MAAM,IAAI,MACR,qFACN,EAEE,MAAMC,EAA0BD,EAAkB,KAE5C5D,EAAMyD,EAAWxC,EAAW,IAAK4C,CAAuB,EAC9D,OAAOC,EAAQ9D,CAAG,EAAE,KAAK,SAAUkB,EAAe,CAChD,OAAOF,EACLC,EACAC,EACApB,EACAqB,CACN,CACE,CAAC,CACH,CAMO,SAAS4C,GAAe9C,EAAY,CACzC,OAAO6C,EAAQ7C,EAAW,GAAG,EAAE,KAAK,SAAU0C,EAAS,CACrD,OAAOD,EAAqBzC,EAAY0C,CAAO,CACjD,CAAC,CACH","x_google_ignoreList":[0]}