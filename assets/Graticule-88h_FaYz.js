import{y as F,Z as M,bZ as z,m as D,af as N,b_ as O,V,S as v,b$ as j,i as C,bP as X,h as R,aK as q,J as H,C as K,c0 as Z,c1 as J,v as U,Y as $,D as Q,u as T,W as tt,F as et,_ as W,bu as Y,aB as I,a1 as k,w as g,q as B,aA as E,bv as G}from"./GeoJSON-BlyzYhKz.js";import"./index-4V-ffF_e.js";import"./utils-BXWzvTjY.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-CVtNDUBO.js";import"./useStateClass-BGbSLWFN-lMazZNQ7.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--B1-KiooU.js";function A(x,t,a){const l=[];let i=x(0),s=x(1),e=t(i),n=t(s);const L=[s,i],f=[n,e],m=[1,0],r={};let c=1e5,u,o,_,d,h,b;for(;--c>0&&m.length>0;)_=m.pop(),i=L.pop(),e=f.pop(),b=_.toString(),b in r||(l.push(e[0],e[1]),r[b]=!0),d=m.pop(),s=L.pop(),n=f.pop(),h=(_+d)/2,u=x(h),o=t(u),z(o[0],o[1],e[0],e[1],n[0],n[1])<a?(l.push(n[0],n[1]),b=d.toString(),r[b]=!0):(m.push(d,h,h,_),f.push(n,o,o,e),L.push(s,u,u,i));return l}function it(x,t,a,l,i){const s=F("EPSG:4326");return A(function(e){return[x,t+(a-t)*e]},M(s,l),i)}function at(x,t,a,l,i){const s=F("EPSG:4326");return A(function(e){return[t+(a-t)*e,x]},M(s,l),i)}function st(x){if(!(x.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const t=x.inversePixelTransform[0],a=x.inversePixelTransform[1],l=Math.sqrt(t*t+a*a),i=x.frameState,s=D(x.inversePixelTransform.slice(),i.coordinateToPixelTransform),e=N(i.viewState.resolution,l);let n;return new O(x.context,l,i.extent,s,i.viewState.rotation,e,n)}const nt=new v({color:"rgba(0,0,0,0.2)"}),lt=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class ft extends V{constructor(t){t=t||{};const a=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},t);delete a.maxLines,delete a.strokeStyle,delete a.targetSize,delete a.showLabels,delete a.lonLabelFormatter,delete a.latLabelFormatter,delete a.lonLabelPosition,delete a.latLabelPosition,delete a.lonLabelStyle,delete a.latLabelStyle,delete a.intervals,super(a),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=t.targetSize!==void 0?t.targetSize:100,this.maxLines_=t.maxLines!==void 0?t.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=t.strokeStyle!==void 0?t.strokeStyle:nt,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,t.showLabels&&(this.lonLabelFormatter_=t.lonLabelFormatter==null?j.bind(this,"EW"):t.lonLabelFormatter,this.latLabelFormatter_=t.latLabelFormatter==null?j.bind(this,"NS"):t.latLabelFormatter,this.lonLabelPosition_=t.lonLabelPosition==null?0:t.lonLabelPosition,this.latLabelPosition_=t.latLabelPosition==null?1:t.latLabelPosition,this.lonLabelStyleBase_=new C({text:t.lonLabelStyle!==void 0?t.lonLabelStyle.clone():new X({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new R({color:"rgba(0,0,0,1)"}),stroke:new v({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=l=>{const i=l.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(i),this.lonLabelStyleBase_},this.latLabelStyleBase_=new C({text:t.latLabelStyle!==void 0?t.latLabelStyle.clone():new X({font:"12px Calibri,sans-serif",textAlign:"right",fill:new R({color:"rgba(0,0,0,1)"}),stroke:new v({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=l=>{const i=l.get("graticule_label");return this.latLabelStyleBase_.getText().setText(i),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(q.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=t.intervals!==void 0?t.intervals:lt,this.setSource(new H({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new K,overlaps:!1,useSpatialIndex:!1,wrapX:t.wrapX})),this.featurePool_=[],this.lineStyle_=new C({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(t,a){let l=t.slice();return this.projection_&&this.getSource().getWrapX()&&Z(l,this.projection_),this.loadedExtent_&&(J(this.loadedExtent_,l,a)?l=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[l]}loaderFunction(t,a,l){this.loadedExtent_=t;const i=this.getSource(),s=this.getExtent()||[-1/0,-1/0,1/0,1/0],e=U(s,t);if(this.renderedExtent_&&$(this.renderedExtent_,e)&&this.renderedResolution_===a||(this.renderedExtent_=e,this.renderedResolution_=a,Q(e)))return;const n=T(e),L=a*a/4;(!this.projection_||!tt(this.projection_,l))&&this.updateProjectionInfo_(l),this.createGraticule_(e,n,a,L);let m=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(m+=this.meridians_.length),this.parallelsLabels_&&(m+=this.parallels_.length);let r;for(;m>this.featurePool_.length;)r=new et,this.featurePool_.push(r);const c=i.getFeaturesCollection();c.clear();let u=0,o,_;for(o=0,_=this.meridians_.length;o<_;++o)r=this.featurePool_[u++],r.setGeometry(this.meridians_[o]),r.setStyle(this.lineStyle_),c.push(r);for(o=0,_=this.parallels_.length;o<_;++o)r=this.featurePool_[u++],r.setGeometry(this.parallels_[o]),r.setStyle(this.lineStyle_),c.push(r)}addMeridian_(t,a,l,i,s,e){const n=this.getMeridian_(t,a,l,i,e);if(W(n.getExtent(),s)){if(this.meridiansLabels_){const L=this.lonLabelFormatter_(t);e in this.meridiansLabels_?this.meridiansLabels_[e].text=L:this.meridiansLabels_[e]={geom:new Y([]),text:L}}this.meridians_[e++]=n}return e}addParallel_(t,a,l,i,s,e){const n=this.getParallel_(t,a,l,i,e);if(W(n.getExtent(),s)){if(this.parallelsLabels_){const L=this.latLabelFormatter_(t);e in this.parallelsLabels_?this.parallelsLabels_[e].text=L:this.parallelsLabels_[e]={geom:new Y([]),text:L}}this.parallels_[e++]=n}return e}drawLabels_(t){const a=t.frameState.viewState.rotation,l=t.frameState.viewState.resolution,i=t.frameState.size,s=t.frameState.extent,e=T(s);let n=s;if(a){const o=i[0]*l,_=i[1]*l;n=[e[0]-o/2,e[1]-_/2,e[0]+o/2,e[1]+_/2]}let L=0,f=0,m=this.latLabelPosition_<.5;const r=this.projection_.getExtent(),c=I(r);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!k(r,s)){L=Math.floor((s[0]-r[0])/c),f=Math.ceil((s[2]-r[2])/c);const o=Math.abs(a)>Math.PI/2;m=m!==o}const u=st(t);for(let o=L;o<=f;++o){let _=this.meridians_.length+this.parallels_.length,d,h,b,y;if(this.meridiansLabels_)for(h=0,b=this.meridiansLabels_.length;h<b;++h){const S=this.meridians_[h];if(!a&&o===0)y=this.getMeridianPoint_(S,s,h);else{const p=S.clone();p.translate(o*c,0),p.rotate(-a,e),y=this.getMeridianPoint_(p,n,h),y.rotate(a,e)}d=this.featurePool_[_++],d.setGeometry(y),d.set("graticule_label",this.meridiansLabels_[h].text),u.drawFeature(d,this.lonLabelStyle_(d))}if(this.parallelsLabels_&&(o===L&&m||o===f&&!m))for(h=0,b=this.parallels_.length;h<b;++h){const S=this.parallels_[h];if(!a&&o===0)y=this.getParallelPoint_(S,s,h);else{const p=S.clone();p.translate(o*c,0),p.rotate(-a,e),y=this.getParallelPoint_(p,n,h),y.rotate(a,e)}d=this.featurePool_[_++],d.setGeometry(y),d.set("graticule_label",this.parallelsLabels_[h].text),u.drawFeature(d,this.latLabelStyle_(d))}}}createGraticule_(t,a,l,i){const s=this.getInterval_(l);if(s==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let e=!1;const n=this.projection_.getExtent(),L=I(n);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!k(n,t)&&(I(t)>=L?(t[0]=n[0],t[2]=n[2]):e=!0);const f=[g(a[0],this.minX_,this.maxX_),g(a[1],this.minY_,this.maxY_)],m=this.toLonLatTransform_(f);isNaN(m[1])&&(m[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let r=g(m[0],this.minLon_,this.maxLon_),c=g(m[1],this.minLat_,this.maxLat_);const u=this.maxLines_;let o,_,d,h,b=t;e||(b=[g(t[0],this.minX_,this.maxX_),g(t[1],this.minY_,this.maxY_),g(t[2],this.minX_,this.maxX_),g(t[3],this.minY_,this.maxY_)]);const y=B(b,this.toLonLatTransform_,void 0,8);let S=y[3],p=y[2],P=y[1],w=y[0];if(e||(E(b,this.bottomLeft_)&&(w=this.minLon_,P=this.minLat_),E(b,this.bottomRight_)&&(p=this.maxLon_,P=this.minLat_),E(b,this.topLeft_)&&(w=this.minLon_,S=this.maxLat_),E(b,this.topRight_)&&(p=this.maxLon_,S=this.maxLat_),S=g(S,c,this.maxLat_),p=g(p,r,this.maxLon_),P=g(P,this.minLat_,c),w=g(w,this.minLon_,r)),r=Math.floor(r/s)*s,h=g(r,this.minLon_,this.maxLon_),_=this.addMeridian_(h,P,S,i,t,0),o=0,e)for(;(h-=s)>=w&&o++<u;)_=this.addMeridian_(h,P,S,i,t,_);else for(;h!=this.minLon_&&o++<u;)h=Math.max(h-s,this.minLon_),_=this.addMeridian_(h,P,S,i,t,_);if(h=g(r,this.minLon_,this.maxLon_),o=0,e)for(;(h+=s)<=p&&o++<u;)_=this.addMeridian_(h,P,S,i,t,_);else for(;h!=this.maxLon_&&o++<u;)h=Math.min(h+s,this.maxLon_),_=this.addMeridian_(h,P,S,i,t,_);for(this.meridians_.length=_,this.meridiansLabels_&&(this.meridiansLabels_.length=_),c=Math.floor(c/s)*s,d=g(c,this.minLat_,this.maxLat_),_=this.addParallel_(d,w,p,i,t,0),o=0;d!=this.minLat_&&o++<u;)d=Math.max(d-s,this.minLat_),_=this.addParallel_(d,w,p,i,t,_);for(d=g(c,this.minLat_,this.maxLat_),o=0;d!=this.maxLat_&&o++<u;)d=Math.min(d+s,this.maxLat_),_=this.addParallel_(d,w,p,i,t,_);this.parallels_.length=_,this.parallelsLabels_&&(this.parallelsLabels_.length=_)}getInterval_(t){const a=this.projectionCenterLonLat_[0],l=this.projectionCenterLonLat_[1];let i=-1;const s=Math.pow(this.targetSize_*t,2),e=[],n=[];for(let L=0,f=this.intervals_.length;L<f;++L){const m=g(this.intervals_[L]/2,0,90),r=g(l,-90+m,90-m);if(e[0]=a-m,e[1]=r-m,n[0]=a+m,n[1]=r+m,this.fromLonLatTransform_(e,e),this.fromLonLatTransform_(n,n),Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)<=s)break;i=this.intervals_[L]}return i}getMeridian_(t,a,l,i,s){const e=it(t,a,l,this.projection_,i);let n=this.meridians_[s];return n?(n.setFlatCoordinates("XY",e),n.changed()):(n=new G(e,"XY"),this.meridians_[s]=n),n}getMeridianPoint_(t,a,l){const i=t.getFlatCoordinates();let s=1,e=i.length-1;i[s]>i[e]&&(s=e,e=1);const n=Math.max(a[1],i[s]),L=Math.min(a[3],i[e]),f=g(a[1]+Math.abs(a[1]-a[3])*this.lonLabelPosition_,n,L),r=[i[s-1]+(i[e-1]-i[s-1])*(f-i[s])/(i[e]-i[s]),f],c=this.meridiansLabels_[l].geom;return c.setCoordinates(r),c}getMeridians(){return this.meridians_}getParallel_(t,a,l,i,s){const e=at(t,a,l,this.projection_,i);let n=this.parallels_[s];return n?(n.setFlatCoordinates("XY",e),n.changed()):n=new G(e,"XY"),n}getParallelPoint_(t,a,l){const i=t.getFlatCoordinates();let s=0,e=i.length-2;i[s]>i[e]&&(s=e,e=0);const n=Math.max(a[0],i[s]),L=Math.min(a[2],i[e]),f=g(a[0]+Math.abs(a[0]-a[2])*this.latLabelPosition_,n,L),m=i[s+1]+(i[e+1]-i[s+1])*(f-i[s])/(i[e]-i[s]),r=[f,m],c=this.parallelsLabels_[l].geom;return c.setCoordinates(r),c}getParallels(){return this.parallels_}updateProjectionInfo_(t){const a=F("EPSG:4326"),l=t.getWorldExtent();this.maxLat_=l[3],this.maxLon_=l[2],this.minLat_=l[1],this.minLon_=l[0];const i=M(t,a);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=i;else{const e=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(n,L,f){f=f||2;const m=i(n,L,f);for(let r=0,c=m.length;r<c;r+=f)m[r]<e&&(m[r]+=360);return m}}this.fromLonLatTransform_=M(a,t);const s=B([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=s[0],this.maxX_=s[2],this.minY_=s[1],this.maxY_=s[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(T(t.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=t}}export{ft as default};
//# sourceMappingURL=Graticule-88h_FaYz.js.map
