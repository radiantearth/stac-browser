import{ag as _,w as b,as as R,aR as w,ak as c}from"./GeoJSON-BlyzYhKz.js";import{e as d,c as y,d as x,f as C,n as S}from"./compileUtil-l9W4qAYP.js";import{S as v}from"./RenderTarget-Fi-4iEgp.js";import{W as D}from"./VectorLayer-DjTod3Ya.js";import"./index-4V-ffF_e.js";import"./utils-BXWzvTjY.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-CVtNDUBO.js";import"./useStateClass-BGbSLWFN-lMazZNQ7.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--B1-KiooU.js";import"./mat4-CeypvY8Z.js";import"./DataTile-uej8eNh4.js";import"./Tile-lMrQctYw.js";import"./Tile-BrHfHitc.js";import"./common-0gNrjJbx.js";import"./TileRange-2Tc-Ry00.js";import"./LRUCache-CwUIRQIv.js";import"./tilecoord-DYaQ6NdW.js";import"./VectorStyleRenderer-DZuyQVTl.js";import"./worldUtil-BIjz9cws.js";const r={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},B=["#00f","#0ff","#0f0","#ff0","#f00"];class Q extends _{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.filter_=e.filter??!0,this.styleVariables_=e.variables||{},this.gradient_=null,this.addChangeListener(r.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:B),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const i=e.weight?e.weight:"weight";this.weight_=i,this.setRenderOrder(null)}getBlur(){return this.get(r.BLUR)}getGradient(){return this.get(r.GRADIENT)}getRadius(){return this.get(r.RADIUS)}handleGradientChanged_(){this.gradient_=G(this.getGradient())}setBlur(e){const t=this.get(r.BLUR);if(this.set(r.BLUR,e),typeof e=="number"&&typeof t=="number"){this.changed();return}this.clearRenderer()}setGradient(e){this.set(r.GRADIENT,e)}setRadius(e){const t=this.get(r.RADIUS);if(this.set(r.RADIUS,e),typeof e=="number"&&typeof t=="number"){this.changed();return}this.clearRenderer()}setFilter(e){this.filter_=e,this.changed(),this.clearRenderer()}setWeight(e){this.weight_=e,this.changed(),this.clearRenderer()}createRenderer(){const e=new v,t=S(),i=d(t,this.filter_,w);let a=d(t,this.getRadius(),c),o=d(t,this.getBlur(),c);const s={};typeof this.getBlur()=="number"&&(o="a_blur",s.a_blur=()=>this.getBlur(),e.addUniform("a_blur","float")),typeof this.getRadius()=="number"&&(a="a_radius",s.a_radius=()=>this.getRadius(),e.addUniform("a_radius","float"));const h={};let n=null;if(typeof this.weight_=="string"||typeof this.weight_=="function"){const u=typeof this.weight_=="string"?g=>g.get(this.weight_):this.weight_;h.prop_weight={size:1,callback:g=>{const m=u(g);return m!==void 0?b(m,0,1):1}},n="a_prop_weight",e.addAttribute("a_prop_weight","float")}else{const u=["clamp",this.weight_,0,1];n=d(t,u,c)}e.addFragmentShaderFunction(`float getBlurSlope() {
  float blur = max(1., ${o});
  float radius = ${a};
  return radius / blur;
}`).setSymbolSizeExpression(`vec2(${a} + ${o}) * 2.`).setSymbolColorExpression(`vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * getBlurSlope()) * ${n})`).setStrokeColorExpression(`vec4(smoothstep(0., 1., (1. - length(currentRadiusPx * 2. / v_width)) * getBlurSlope()) * ${n})`).setStrokeWidthExpression(`(${a} + ${o}) * 2.`).setFillColorExpression(`vec4(${n})`).setFragmentDiscardExpression(`!${i}`),y(e,t);const p=x(t),f=C(t,this.styleVariables_);return new D(this,{className:this.getClassName(),variables:this.styleVariables_,style:{builder:e,attributes:{...p,...h},uniforms:{...f,...s}},disableHitDetection:!1,postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}renderDeclutter(){}}function G(l){const i=R(1,256),a=i.createLinearGradient(0,0,1,256),o=1/(l.length-1);for(let s=0,h=l.length;s<h;++s)a.addColorStop(s*o,l[s]);return i.fillStyle=a,i.fillRect(0,0,1,256),i.canvas}export{Q as default};
//# sourceMappingURL=Heatmap-BRcOPrfX.js.map
