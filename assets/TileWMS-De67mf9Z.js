import{ao as P,y as T,ap as j,X as d,aq as y,ar as b}from"./GeoJSON-BlyzYhKz.js";import{c as S}from"./common-0gNrjJbx.js";import{h as F}from"./tilecoord-DYaQ6NdW.js";import{a as G}from"./uri-BxyrIhx_.js";import O from"./TileImage-BzZFQQFS.js";import{getRequestParams as p,DEFAULT_VERSION as _,getImageSrc as L}from"./wms-0jfoL_hc.js";import"./index-4V-ffF_e.js";import"./utils-BXWzvTjY.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-CVtNDUBO.js";import"./useStateClass-BGbSLWFN-lMazZNQ7.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--B1-KiooU.js";import"./Tile-BrHfHitc.js";import"./Tile-lMrQctYw.js";import"./Tile-8IayXPne.js";import"./TileGrid-D2Qra4XP.js";import"./TileRange-2Tc-Ry00.js";import"./UrlTile-CxpuZoX4.js";import"./tileurlfunction-CsB_e4FB.js";import"./TileEventType-CTN_nmJ7.js";import"./Image-0ePVgDVk.js";import"./resolution-CU8ppKQ3.js";import"./common-9rOs42pz.js";class et extends O{constructor(t){t=t||{};const e=Object.assign({},t.params);super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.params_=e,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.tmpExtent_=P(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(t,e,s,r){const n=T(s),i=this.getProjection()||n;let a=this.getTileGrid();a||(a=this.getTileGridForProjection(i));const o=j(t,n,i),f=S(i,n,t,e),m=a.getZForResolution(f,this.zDirection),h=a.getResolution(m),c=a.getTileCoordForCoordAndZ(o,m);if(a.getResolutions().length<=c[0])return;let u=a.getTileCoordExtent(c,this.tmpExtent_);const g=this.gutter_;g!==0&&(u=d(u,h*g,u));const l={QUERY_LAYERS:this.params_.LAYERS};Object.assign(l,p(this.params_,"GetFeatureInfo"),r);const E=Math.floor((o[0]-u[0])/h),R=Math.floor((u[3]-o[1])/h);return l[this.v13_?"I":"X"]=E,l[this.v13_?"J":"Y"]=R,this.getRequestUrl_(c,u,1,i||n,l)}getLegendUrl(t,e){if(this.urls[0]===void 0)return;const s={SERVICE:"WMS",VERSION:_,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(e===void 0||e.LAYER===void 0){const r=this.params_.LAYERS;if(!(!Array.isArray(r)||r.length===1))return;s.LAYER=r}if(t!==void 0){const r=this.getProjection()?this.getProjection().getMetersPerUnit():1,n=28e-5;s.SCALE=t*r/n}return Object.assign(s,e),G(this.urls[0],s)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(t,e,s,r,n){const i=this.urls;if(!i)return;let a;if(i.length==1)a=i[0];else{const o=y(F(t),i.length);a=i[o]}return L(e,(this.tileGrid||this.getTileGridForProjection(r)).getResolution(t[0]),s,r,a,n,this.serverType_)}getTilePixelRatio(t){return!this.hidpi_||this.serverType_===void 0?1:t}getKeyForParams_(){let t=0;const e=[];for(const s in this.params_)e[t++]=s+"-"+this.params_[s];return e.join("/")}setParams_(t){this.params_=t,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(t){this.setParams_(Object.assign({},t))}updateParams(t){this.setParams_(Object.assign(this.params_,t))}updateV13_(){const t=this.params_.VERSION||_;this.v13_=b(t,"1.3")>=0}tileUrlFunction(t,e,s){let r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(s)),r.getResolutions().length<=t[0])return;e!=1&&(!this.hidpi_||this.serverType_===void 0)&&(e=1);const n=r.getResolution(t[0]);let i=r.getTileCoordExtent(t,this.tmpExtent_);const a=this.gutter_;a!==0&&(i=d(i,n*a,i));const o=Object.assign({},p(this.params_,"GetMap"));return this.getRequestUrl_(t,i,e,s,o)}}export{et as default};
//# sourceMappingURL=TileWMS-De67mf9Z.js.map
