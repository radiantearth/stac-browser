import{l as X,y as E,v as Y}from"./GeoJSON-BlyzYhKz.js";import{g as L,r as v}from"./net-tq6Ez6OH.js";import{T as $}from"./TileGrid-D2Qra4XP.js";import"./index-4V-ffF_e.js";import"./utils-BXWzvTjY.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-CVtNDUBO.js";import"./useStateClass-BGbSLWFN-lMazZNQ7.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--B1-KiooU.js";import"./TileRange-2Tc-Ry00.js";import"./tilecoord-DYaQ6NdW.js";const q={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},F={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function W(t,n){if(!n.length)return t;const o=new URL(t,"file:/");if(o.pathname.split("/").includes("collections"))return X('The "collections" query parameter cannot be added to collection endpoints'),t;const r=n.map(l=>encodeURIComponent(l)).join(",");o.searchParams.append("collections",r);const i=t.split("?")[0],c=decodeURIComponent(o.searchParams.toString());return`${i}?${c}`}function G(t,n,o){let r,i;for(let c=0;c<t.length;++c){const l=t[c];if(l.rel==="item"){if(l.type===n){r=l.href;break}(q[l.type]||!i&&l.type.startsWith("image/"))&&(i=l.href)}}if(!r)if(i)r=i;else throw new Error('Could not find "item" link');return o&&(r=W(r,o)),r}function J(t,n,o,r){let i,c;const l={};for(let p=0;p<t.length;++p){const s=t[p];if(l[s.type]=s.href,s.rel==="item"){if(s.type===n){i=s.href;break}F[s.type]&&(c=s.href)}}if(!i&&o)for(let p=0;p<o.length;++p){const s=o[p];if(l[s]){i=l[s];break}}if(!i)if(c)i=c;else throw new Error('Could not find "item" link');return r&&(i=W(i,r)),i}function A(t,n,o,r){let i=t.projection;if(!i&&(typeof n.crs=="string"?i=E(n.crs):"uri"in n.crs&&(i=E(n.crs.uri)),!i))throw new Error(`Unsupported CRS: ${JSON.stringify(n.crs)}`);const c=n.orderedAxes,p=!(c?c.slice(0,2).map(e=>e.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):i.getAxisOrientation()).startsWith("en"),s=n.tileMatrices,T={};for(let e=0;e<s.length;++e){const f=s[e];T[f.id]=f}const k={},w=[];if(r)for(let e=0;e<r.length;++e){const f=r[e],a=f.tileMatrix;w.push(a),k[a]=f}else for(let e=0;e<s.length;++e){const f=s[e].id;w.push(f)}const x=w.length,g=new Array(x),j=new Array(x),M=new Array(x),z=new Array(x),b=[-1/0,-1/0,1/0,1/0];for(let e=0;e<x;++e){const f=w[e],a=T[f],h=a.pointOfOrigin;p?g[e]=[h[1],h[0]]:g[e]=h,j[e]=a.cellSize,M[e]=[a.matrixWidth,a.matrixHeight],z[e]=[a.tileWidth,a.tileHeight];const d=k[f];if(d){const y=a.cellSize*a.tileWidth,m=g[e][0]+d.minTileCol*y,R=g[e][0]+(d.maxTileCol+1)*y,u=a.cellSize*a.tileHeight,C=a.cornerOfOrigin==="bottomLeft";let O,U;C?(O=g[e][1]+d.minTileRow*u,U=g[e][1]+(d.maxTileRow+1)*u):(O=g[e][1]-(d.maxTileRow+1)*u,U=g[e][1]-d.minTileRow*u),Y(b,[m,O,R,U],b)}}const H=new $({origins:g,resolutions:j,sizes:M,tileSizes:z,extent:r?b:void 0}),P=t.context,D=t.url;function N(e,f,a){if(!e)return;const h=w[e[0]],d=T[h],y=d.cornerOfOrigin==="bottomLeft",m={tileMatrix:h,tileCol:e[1],tileRow:y?-e[2]-1:e[2]};if(r){const u=k[d.id];if(m.tileCol<u.minTileCol||m.tileCol>u.maxTileCol||m.tileRow<u.minTileRow||m.tileRow>u.maxTileRow)return}Object.assign(m,{z:m.tileMatrix,x:m.tileCol,y:m.tileRow},P);const R=o.replace(/\{(\w+?)\}/g,function(u,C){return m[C]});return v(D,R)}return{grid:H,projection:i,urlTemplate:o,urlFunction:N}}function S(t,n){const o=n.tileMatrixSetLimits;let r;if(n.dataType==="map")r=G(n.links,t.mediaType,t.collections);else if(n.dataType==="vector")r=J(n.links,t.mediaType,t.supportedMediaTypes,t.collections);else throw new Error('Expected tileset data type to be "map" or "vector"');if(n.tileMatrixSet)return A(t,n.tileMatrixSet,r,o);const i=n.links.find(p=>p.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!i)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const c=i.href,l=v(t.url,c);return L(l).then(function(p){return A(t,p,r,o)})}function oe(t){return L(t.url).then(function(n){return S(t,n)})}export{W as appendCollectionsQueryParam,G as getMapTileUrlTemplate,oe as getTileSetInfo,J as getVectorTileUrlTemplate};
//# sourceMappingURL=ogcTileUtil-CC5XC0Pn.js.map
