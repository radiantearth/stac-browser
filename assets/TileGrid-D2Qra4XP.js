import{T as R,c as m}from"./TileRange-2Tc-Ry00.js";import{ah as c,bk as Z,a3 as z,b5 as E,a4 as d,b4 as F,b0 as X,w as Y,bl as A,b1 as f,bi as x}from"./GeoJSON-BlyzYhKz.js";import{c as T}from"./tilecoord-DYaQ6NdW.js";const _=[0,0,0],g=5;class w{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,c(Z(this.resolutions_,(e,o)=>o-e),"`resolutions` must be sorted in descending order");let n;if(!t.origins){for(let e=0,o=this.resolutions_.length-1;e<o;++e)if(!n)n=this.resolutions_[e]/this.resolutions_[e+1];else if(this.resolutions_[e]/this.resolutions_[e+1]!==n){n=void 0;break}}this.zoomFactor_=n,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,c(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=t.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=z(i)),c(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,c(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:E,c(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((e,o)=>{const s=new R(Math.min(0,e[0]),Math.max(e[0]-1,-1),Math.min(0,e[1]),Math.max(e[1]-1,-1));if(i){const r=this.getTileRangeForExtentAndZ(i,o);s.minX=Math.max(r.minX,s.minX),s.maxX=Math.min(r.maxX,s.maxX),s.minY=Math.max(r.minY,s.minY),s.maxY=Math.min(r.maxY,s.maxY)}return s}):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,n,i){const e=this.getTileRangeForExtentAndZ(t,n);for(let o=e.minX,s=e.maxX;o<=s;++o)for(let r=e.minY,h=e.maxY;r<=h;++r)i([n,o,r])}forEachTileCoordParentTileRange(t,n,i,e){let o,s,r,h=null,l=t[0]-1;for(this.zoomFactor_===2?(s=t[1],r=t[2]):h=this.getTileCoordExtent(t,e);l>=this.minZoom;){if(s!==void 0&&r!==void 0?(s=Math.floor(s/2),r=Math.floor(r/2),o=m(s,s,r,r,i)):o=this.getTileRangeForExtentAndZ(h,l,i),n(l,o))return!0;--l}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,n,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const o=t[1]*2,s=t[2]*2;return m(o,o+1,s,s+1,n)}const e=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(e,t[0]+1,n)}return null}getTileRangeForTileCoordAndZ(t,n,i){if(n>this.maxZoom||n<this.minZoom)return null;const e=t[0],o=t[1],s=t[2];if(n===e)return m(o,s,o,s,i);if(this.zoomFactor_){const h=Math.pow(this.zoomFactor_,n-e),l=Math.floor(o*h),a=Math.floor(s*h);if(n<e)return m(l,l,a,a,i);const u=Math.floor(h*(o+1))-1,S=Math.floor(h*(s+1))-1;return m(l,u,a,S,i)}const r=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,n,i)}getTileRangeForExtentAndZ(t,n,i){this.getTileCoordForXYAndZ_(t[0],t[3],n,!1,_);const e=_[1],o=_[2];this.getTileCoordForXYAndZ_(t[2],t[1],n,!0,_);const s=_[1],r=_[2];return m(e,s,o,r,i)}getTileCoordCenter(t){const n=this.getOrigin(t[0]),i=this.getResolution(t[0]),e=d(this.getTileSize(t[0]),this.tmpSize_);return[n[0]+(t[1]+.5)*e[0]*i,n[1]-(t[2]+.5)*e[1]*i]}getTileCoordExtent(t,n){const i=this.getOrigin(t[0]),e=this.getResolution(t[0]),o=d(this.getTileSize(t[0]),this.tmpSize_),s=i[0]+t[1]*o[0]*e,r=i[1]-(t[2]+1)*o[1]*e,h=s+o[0]*e,l=r+o[1]*e;return F(s,r,h,l,n)}getTileCoordForCoordAndResolution(t,n,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],n,!1,i)}getTileCoordForXYAndResolution_(t,n,i,e,o){const s=this.getZForResolution(i),r=i/this.getResolution(s),h=this.getOrigin(s),l=d(this.getTileSize(s),this.tmpSize_);let a=r*(t-h[0])/i/l[0],u=r*(h[1]-n)/i/l[1];return e?(a=f(a,g)-1,u=f(u,g)-1):(a=x(a,g),u=x(u,g)),T(s,a,u,o)}getTileCoordForXYAndZ_(t,n,i,e,o){const s=this.getOrigin(i),r=this.getResolution(i),h=d(this.getTileSize(i),this.tmpSize_);let l=(t-s[0])/r/h[0],a=(s[1]-n)/r/h[1];return e?(l=f(l,g)-1,a=f(a,g)-1):(l=x(l,g),a=x(a,g)),T(i,l,a,o)}getTileCoordForCoordAndZ(t,n,i){return this.getTileCoordForXYAndZ_(t[0],t[1],n,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,n){const i=X(this.resolutions_,t,n||0);return Y(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,n){return A(n,0,n.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const n=this.resolutions_.length,i=new Array(n);for(let e=this.minZoom;e<n;++e)i[e]=this.getTileRangeForExtentAndZ(t,e);this.fullTileRanges_=i}}export{w as T};
//# sourceMappingURL=TileGrid-D2Qra4XP.js.map
