import{ax as j,v as D,ay as E,U as v,D as H,az as N,A as b,aA as P,aB as U,aC as Y,_ as F,a1 as G,aD as S}from"./GeoJSON-BlyzYhKz.js";class z extends j{constructor(t){super(t),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(t){const l=t.layerStatesArray[t.layerIndex],g=t.pixelRatio,n=t.viewState,a=n.resolution,s=this.getLayer().getSource(),e=t.viewHints;let i=t.extent;if(l.extent!==void 0&&(i=D(i,E(l.extent,n.projection))),!e[v.ANIMATING]&&!e[v.INTERACTING]&&!H(i))if(s){const r=n.projection,o=s.getImage(i,a,g,r);o&&(this.loadImage(o)?this.image=o:o.getState()===N.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(t){const l=this.frameState;if(!l)return null;const g=this.getLayer(),n=b(l.pixelToCoordinateTransform,t.slice()),a=g.getExtent();if(a&&!P(a,n))return null;const s=this.image.getExtent(),e=this.image.getImage(),i=U(s),r=Math.floor(e.width*((n[0]-s[0])/i));if(r<0||r>=e.width)return null;const o=Y(s),h=Math.floor(e.height*((s[3]-n[1])/o));return h<0||h>=e.height?null:this.getImageData(e,r,h)}renderFrame(t,l){const g=this.image,n=g.getExtent(),a=g.getResolution(),[s,e]=Array.isArray(a)?a:[a,a],i=g.getPixelRatio(),r=t.layerStatesArray[t.layerIndex],o=t.pixelRatio,h=t.viewState,R=h.center,w=h.resolution,A=o*s/(w*i),C=o*e/(w*i);this.prepareContainer(t,l);const T=this.context.canvas.width,M=this.context.canvas.height,c=this.getRenderContext(t);let u=!1,p=!0;if(r.extent){const m=E(r.extent,h.projection);p=F(m,t.extent),u=p&&!G(m,t.extent),u&&this.clipUnrotated(c,t,m)}const d=g.getImage(),x=S(this.tempTransform,T/2,M/2,A,C,0,i*(n[0]-R[0])/s,i*(R[1]-n[3])/e);this.renderedResolution=e*o/i;const I=d.width*x[0],f=d.height*x[3];if(this.getLayer().getSource().getInterpolate()||(c.imageSmoothingEnabled=!1),this.preRender(c,t),p&&I>=.5&&f>=.5){const m=x[4],L=x[5],y=r.opacity;y!==1&&(c.save(),c.globalAlpha=y),c.drawImage(d,0,0,+d.width,+d.height,m,L,I,f),y!==1&&c.restore()}return this.postRender(this.context,t),u&&c.restore(),c.imageSmoothingEnabled=!0,this.container}}export{z as C};
//# sourceMappingURL=ImageLayer-Bn5NP1Zc.js.map
