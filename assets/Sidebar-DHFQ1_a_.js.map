{"version":3,"file":"Sidebar-DHFQ1_a_.js","sources":["../../src/components/Tree.vue","../../src/components/Sidebar.vue"],"sourcesContent":["<template>\n  <ul class=\"tree\" v-visible=\"load\">\n    <li>\n      <b-button v-if=\"pagination\" size=\"sm\" variant=\"light\" disabled>\n        <b-icon-three-dots />\n      </b-button>\n      <template v-else-if=\"mayHaveChildren\">\n        <b-button size=\"sm\" variant=\"light\" @click=\"toggle\">\n          <b-icon-folder-minus v-if=\"expanded\" />\n          <b-icon-folder-plus v-else />\n        </b-button>\n      </template>\n      <b-button v-else size=\"sm\" variant=\"light\" :to=\"to\">\n        <b-icon-file-earmark-richtext />\n      </b-button><!--\n      \n      --><b-button size=\"sm\" variant=\"light\" :class=\"{path: onPath || active}\" :disabled=\"!to && !active\" :to=\"to\" @click=\"onClick\">\n        {{ title }}\n      </b-button>\n\n      <template v-if=\"expanded && mayHaveChildren\">\n        <ul v-if=\"loading\" class=\"tree\">\n          <li><b-spinner :label=\"$t('loading')\" small /></li>\n        </ul>\n        <ul v-else-if=\"childs.length === 0\" class=\"tree\">\n          <li>\n            <b-button size=\"sm\" variant=\"light\" disabled>\n              {{ $t('tree.noChildren') }}\n            </b-button>\n          </li>\n        </ul>\n        <template v-else>\n          <Tree v-for=\"(child, i) in shownChilds\" :key=\"i\" :item=\"child\" :parent=\"stac\" :path=\"path\" />\n          <b-button class=\"show-more\" v-if=\"hasMore\" variant=\"light\" @click=\"showMore\" v-visible.300=\"showMore\">{{ $t('showMore') }}</b-button>\n        </template>\n      </template>\n    </li>\n  </ul>\n</template>\n\n<script>\nimport { mapGetters, mapState } from 'vuex';\nimport Utils from '../utils';\nimport { getDisplayTitle, Collection } from '../models/stac';\nimport { STAC } from 'stac-js';\n\nexport default {\n  name: 'Tree',\n  props: {\n    item: {\n      type: Object,\n      required: true\n    },\n    parent: {\n      type: Object,\n      default: null\n    },\n    path: {\n      type: Array,\n      default: () => ([])\n    }\n  },\n  data() {\n    return {\n      expanded: false,\n      loading: false,\n      chunk: 1,\n      childs: []\n    };\n  },\n  computed: {\n    ...mapState(['data', 'apiCatalogPriority']),\n    ...mapGetters(['getStac']),\n    onClick() {\n      if (!this.to && this.mayHaveChildren) {\n        return this.toggle;\n      }\n      return null;\n    },\n    stac() {\n      if (this.pagination) {\n        return null;\n      }\n      else if (this.item instanceof STAC) {\n        let stac = this.getStac(this.item.getAbsoluteUrl());\n        if (!this.loading && stac) {\n          return stac;\n        }\n        else {\n          return this.item;\n        }\n      }\n      else {\n        return this.getStac(this.link);\n      }\n    },\n    link() {\n      if (this.pagination) {\n        if (this.parent) {\n          return this.parent.getAbsoluteUrl();\n        }\n        else {\n          return null;\n        }\n      }\n      else if (Utils.isObject(this.item) && typeof this.item.href === 'string') {\n        if (this.parent) {\n          return Utils.toAbsolute(this.item.href, this.parent.getAbsoluteUrl());\n        }\n        else {\n          return this.item.href;\n        }\n      }\n      return null;\n    },\n    mayHaveChildren() {\n      if (this.item instanceof STAC) {\n        return this.item.isCatalogLike();\n      }\n      else if (this.link) {\n        return this.item.rel !== 'item';\n      }\n      return false;\n    },\n    to() {\n      if (this.active) {\n        return null;\n      }\n      if (this.pagination) {\n        if (this.parent && (!this.data || this.parent.getAbsoluteUrl() !== this.data.getAbsoluteUrl())) {\n          return this.parent.getBrowserPath();\n        }\n        else {\n          return null;\n        }\n      }\n      else if (this.stac instanceof STAC) {\n        return this.stac.getBrowserPath();\n      }\n      return null;\n    },\n    title() {\n      if (this.pagination) {\n        return this.$t('tree.moreCollectionPagesAvailable');\n      }\n      return getDisplayTitle([this.item, this.stac]);\n    },\n    hasMore() {\n      return this.childs.length > this.shownChilds.length;\n    },\n    shownChilds() {\n      return this.childs.slice(0, this.chunk * 50);\n    },\n    onPath() {\n      if (!Array.isArray(this.path) || !this.stac) {\n        return false;\n      }\n      return this.path.includes(this.stac);\n    },\n    active() {\n      return this.stac && this.stac === this.data;\n    },\n    pagination() {\n      return ['next', 'prev', 'previous'].includes(this.item.rel);\n    }\n  },\n  watch: {\n    onPath: {\n      immediate: true,\n      handler() {\n        if (this.onPath) {\n          this.expanded = true;\n        }\n      }\n    },\n    stac: {\n      immediate: true,\n      handler(newStac, oldStac) {\n        if (newStac instanceof Collection) {\n          newStac.setApiDataListener('tree', () => this.updateChilds());\n        }\n        if (oldStac instanceof Collection) {\n          oldStac.setApiDataListener('tree');\n        }\n        this.updateChilds();\n      }\n    }\n  },\n  created() {\n    if (!this.parent) {\n      this.expanded = true;\n    }\n  },\n  methods: {\n    updateChilds() {\n      if (this.stac && this.stac.isCatalogLike()) {\n        this.childs = this.stac.getChildren(this.apiCatalogPriority);\n      }\n      else {\n        this.childs = [];\n      }\n    },\n    showMore() {\n      this.chunk++;\n    },\n    load(visible) {\n      if (!this.stac && this.link && !this.pagination) {\n        this.$store.commit(visible ? 'queue' : 'unqueue', this.link);\n      }\n    },\n    async toggle() {\n      this.expanded = !this.expanded;\n      if (this.expanded && !this.pagination) {\n        this.loading = true;\n        let url = this.item instanceof STAC ? this.item.getAbsoluteUrl() : this.item.href;\n        await this.$store.dispatch(\"load\", { url });\n        this.loading = false;\n      }\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.tree {\n  list-style-type: none;\n  margin: 0;\n  padding: 0;\n\n  > li {\n    white-space: nowrap;\n  }\n\n  .path {\n    font-weight: bold;\n  }\n\n  .tree {\n    margin-left: 1.5em;\n  }\n\n  .show-more {\n    width: calc(100% - 1.5em);\n    box-sizing: border-box;\n    margin-left: 1.5em;\n  }\n}\n</style>\n","<template>\n  <b-offcanvas\n    initial-animation id=\"sidebar\" :model-value=\"modelValue\" @update:model-value=\"emit\"\n    :title=\"$t('browse')\" teleport-to=\"#stac-browser\" footer-class=\"offcanvas-footer\"\n  >\n    <template #default>\n      <Loading v-if=\"loading\" />\n      <Tree v-else-if=\"root\" :item=\"root\" :path=\"parents\" />\n    </template>\n    <template v-if=\"allowSelectCatalog\" #footer>\n      <b-button class=\"switch-catalog\" variant=\"light\">\n        <router-link to=\"/\"><b-icon-arrow-left-right /> {{ $t('sidebar.switchCatalog') }}</router-link>\n      </b-button>\n    </template>\n  </b-offcanvas>\n</template>\n\n<script>\nimport { mapGetters, mapState } from 'vuex';\nimport Loading from './Loading.vue';\nimport Tree from './Tree.vue';\nimport { BOffcanvas } from 'bootstrap-vue-next';\n\nexport default {\n  name: 'Sidebar',\n  components: {\n    Loading,\n    Tree,\n    BOffcanvas\n  },\n  props: {\n    modelValue: {\n      type: Boolean,\n      required: true\n    }\n  },\n  emits: ['update:modelValue'],\n  data() {\n    return {\n      loading: true\n    };\n  },\n  computed: {\n    ...mapState(['allowSelectCatalog', 'parents']),\n    ...mapGetters(['root'])\n  },\n  watch: {\n    modelValue: {\n      immediate: true,\n      async handler(visible) {\n        if (visible) {\n          try {\n            this.loading = true;\n            await this.$store.dispatch('loadParents');\n          } finally {\n            this.loading = false;\n          }\n        }\n\n        if (visible) {\n          document.body.classList.add(\"sidebar\");\n        }\n        else {\n          document.body.classList.remove(\"sidebar\");\n        }\n      }\n    },\n    $route() {\n      // Close sidebar when route changes\n      this.emit(false);\n    }\n  },\n  methods: {\n    emit(value) {\n      this.$emit('update:modelValue', value);\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\">\n@import 'bootstrap/scss/mixins';\n@import \"../theme/variables.scss\";\n\n#stac-browser #sidebar {\n  width: 50%;\n  min-width: 400px;\n  max-width: 600px;\n  padding-top: $header-margin;\n  background-color: $light;\n\n  @include media-breakpoint-down(sm) {\n    width: 100%;\n    min-width: 100px;\n    max-width: 100%;\n  }\n\n  .offcanvas-header {\n    padding: 0.5rem 1rem;\n\n    .offcanvas-title {\n      font-size: 1.5rem;\n    }\n  }\n\n  .offcanvas-body {\n    padding: 0.5rem 1rem;\n\n    .tree {\n      &.root {\n        margin: 0;\n        padding: 0;\n      }\n    }\n  }\n\n  .offcanvas-footer {\n    border-top: 1px solid rgba(0,0,0,.125);\n\n    .switch-catalog {\n      width: 100%;\n    }\n  }\n}\n\n</style>\n"],"names":["_sfc_main","mapState","mapGetters","STAC","stac","Utils","getDisplayTitle","newStac","oldStac","Collection","visible","url","_hoisted_1","_withDirectives","_openBlock","_createElementBlock","_createElementVNode","$options","_createBlock","_component_b_button","_createVNode","_component_b_icon_three_dots","$data","_component_b_icon_folder_minus","_component_b_icon_folder_plus","_component_b_icon_file_earmark_richtext","_normalizeClass","_Fragment","_hoisted_2","_component_b_spinner","_ctx","_hoisted_3","_renderList","child","i","_component_Tree","$props","Loading","Tree","BOffcanvas","value","_component_b_offcanvas","_component_Loading","_component_router_link","_component_b_icon_arrow_left_right","_createTextVNode"],"mappings":"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"}