import{ap as it,b9 as tt,aA as ut,as as $,ba as ft,aC as U,aB as F,a3 as rt,bb as dt,at,u as lt,bc as _t,ao as ht,x as gt,Z as mt,bd as Tt,be as Wt,bf as Et,bg as Mt,R as et,_ as vt,aq as Z,bh as z,A as xt}from"./GeoJSON-BoRJWQIG.js";let J;const H=[];function st(a,s,o,i,h){a.beginPath(),a.moveTo(0,0),a.lineTo(s,o),a.lineTo(i,h),a.closePath(),a.save(),a.clip(),a.fillRect(0,0,Math.max(s,i)+1,Math.max(o,h)),a.restore()}function K(a,s){return Math.abs(a[s*4]-210)>2||Math.abs(a[s*4+3]-.75*255)>2}function pt(){if(J===void 0){const a=$(6,6,H);a.globalCompositeOperation="lighter",a.fillStyle="rgba(210, 0, 0, 0.75)",st(a,4,5,4,0),st(a,4,5,0,5);const s=a.getImageData(0,0,3,3).data;J=K(s,0)||K(s,4)||K(s,8),at(a),H.push(a.canvas)}return J}function nt(a,s,o,i){const h=it(o,s,a);let t=tt(s,i,o);const l=s.getMetersPerUnit();l!==void 0&&(t*=l);const m=a.getMetersPerUnit();m!==void 0&&(t/=m);const f=a.getExtent();if(!f||ut(f,h)){const W=tt(a,t,h)/t;isFinite(W)&&W>0&&(t/=W)}return t}function Pt(a,s,o,i){const h=lt(o);let t=nt(a,s,h,i);return(!isFinite(t)||t<=0)&&_t(o,function(l){return t=nt(a,s,l,i),isFinite(t)&&t>0}),t}function Ct(a,s,o,i,h,t,l,m,f,W,v,T,P,X){const e=$(Math.round(o*a),Math.round(o*s),H);if(T||(e.imageSmoothingEnabled=!1),f.length===0)return e.canvas;e.scale(o,o);function _(n){return Math.round(n*o)/o}e.globalCompositeOperation="lighter";const g=ht();f.forEach(function(n,B,N){ft(g,n.extent)});let u;const c=o/i,d=(T?1:1+Math.pow(2,-24))/c;(!P||f.length!==1||W!==0)&&(u=$(Math.round(F(g)*c),Math.round(U(g)*c),H),T||(u.imageSmoothingEnabled=!1),f.forEach(function(n,B,N){if(n.image.width>0&&n.image.height>0){if(n.clipExtent){u.save();const x=(n.clipExtent[0]-g[0])*c,p=-(n.clipExtent[3]-g[3])*c,C=F(n.clipExtent)*c,L=U(n.clipExtent)*c;u.rect(T?x:Math.round(x),T?p:Math.round(p),T?C:Math.round(x+C)-Math.round(x),T?L:Math.round(p+L)-Math.round(p)),u.clip()}const E=(n.extent[0]-g[0])*c,M=-(n.extent[3]-g[3])*c,y=F(n.extent)*c,w=U(n.extent)*c;u.drawImage(n.image,W,W,n.image.width-2*W,n.image.height-2*W,T?E:Math.round(E),T?M:Math.round(M),T?y:Math.round(E+y)-Math.round(E),T?w:Math.round(M+w)-Math.round(M)),n.clipExtent&&u.restore()}}));const r=rt(l);return m.getTriangles().forEach(function(n,B,N){const E=n.source,M=n.target;let y=E[0][0],w=E[0][1],x=E[1][0],p=E[1][1],C=E[2][0],L=E[2][1];const Q=_((M[0][0]-r[0])/t),k=_(-(M[0][1]-r[1])/t),j=_((M[1][0]-r[0])/t),D=_(-(M[1][1]-r[1])/t),G=_((M[2][0]-r[0])/t),R=_(-(M[2][1]-r[1])/t),V=y,Y=w;y=0,w=0,x-=V,p-=Y,C-=V,L-=Y;const ct=[[x,p,0,0,j-Q],[C,L,0,0,G-Q],[0,0,x,p,D-k],[0,0,C,L,R-k]],A=dt(ct);if(!A)return;if(e.save(),e.beginPath(),pt()||!T){e.moveTo(j,D);const I=4,q=Q-j,S=k-D;for(let b=0;b<I;b++)e.lineTo(j+_((b+1)*q/I),D+_(b*S/(I-1))),b!=I-1&&e.lineTo(j+_((b+1)*q/I),D+_((b+1)*S/(I-1)));e.lineTo(G,R)}else e.moveTo(j,D),e.lineTo(Q,k),e.lineTo(G,R);e.clip(),e.transform(A[0],A[2],A[1],A[3],Q,k),e.translate(g[0]-V,g[3]-Y);let O;if(u)O=u.canvas,e.scale(d,-d);else{const I=f[0],q=I.extent;O=I.image,e.scale(F(q)/O.width,-U(q)/O.height)}e.drawImage(O,0,0),e.restore()}),u&&(at(u),H.push(u.canvas)),v&&(e.save(),e.globalCompositeOperation="source-over",e.strokeStyle="black",e.lineWidth=1,m.getTriangles().forEach(function(n,B,N){const E=n.target,M=(E[0][0]-r[0])/t,y=-(E[0][1]-r[1])/t,w=(E[1][0]-r[0])/t,x=-(E[1][1]-r[1])/t,p=(E[2][0]-r[0])/t,C=-(E[2][1]-r[1])/t;e.beginPath(),e.moveTo(w,x),e.lineTo(M,y),e.lineTo(p,C),e.closePath(),e.stroke()}),e.restore()),e.canvas}const Ft=10,ot=.25;class Xt{constructor(s,o,i,h,t,l,m){this.sourceProj_=s,this.targetProj_=o;let f={};const W=m?gt(d=>xt(m,it(d,this.targetProj_,this.sourceProj_))):mt(this.targetProj_,this.sourceProj_);this.transformInv_=function(d){const r=d[0]+"/"+d[1];return f[r]||(f[r]=W(d)),f[r]},this.maxSourceExtent_=h,this.errorThresholdSquared_=t*t,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!h&&!!this.sourceProj_.getExtent()&&F(h)>=F(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?F(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?F(this.targetProj_.getExtent()):null;const v=rt(i),T=Tt(i),P=Wt(i),X=Et(i),e=this.transformInv_(v),_=this.transformInv_(T),g=this.transformInv_(P),u=this.transformInv_(X),c=Ft+(l?Math.max(0,Math.ceil(Math.log2(Mt(i)/(l*l*256*256)))):0);if(this.addQuad_(v,T,P,X,e,_,g,u,c),this.wrapsXInSource_){let d=1/0;this.triangles_.forEach(function(r,n,B){d=Math.min(d,r.source[0][0],r.source[1][0],r.source[2][0])}),this.triangles_.forEach(r=>{if(Math.max(r.source[0][0],r.source[1][0],r.source[2][0])-d>this.sourceWorldWidth_/2){const n=[[r.source[0][0],r.source[0][1]],[r.source[1][0],r.source[1][1]],[r.source[2][0],r.source[2][1]]];n[0][0]-d>this.sourceWorldWidth_/2&&(n[0][0]-=this.sourceWorldWidth_),n[1][0]-d>this.sourceWorldWidth_/2&&(n[1][0]-=this.sourceWorldWidth_),n[2][0]-d>this.sourceWorldWidth_/2&&(n[2][0]-=this.sourceWorldWidth_);const B=Math.min(n[0][0],n[1][0],n[2][0]);Math.max(n[0][0],n[1][0],n[2][0])-B<this.sourceWorldWidth_/2&&(r.source=n)}})}f={}}addTriangle_(s,o,i,h,t,l){this.triangles_.push({source:[h,t,l],target:[s,o,i]})}addQuad_(s,o,i,h,t,l,m,f,W){const v=et([t,l,m,f]),T=this.sourceWorldWidth_?F(v)/this.sourceWorldWidth_:null,P=this.sourceWorldWidth_,X=this.sourceProj_.canWrapX()&&T>.5&&T<1;let e=!1;if(W>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const g=et([s,o,i,h]);e=F(g)/this.targetWorldWidth_>ot||e}!X&&this.sourceProj_.isGlobal()&&T&&(e=T>ot||e)}if(!e&&this.maxSourceExtent_&&isFinite(v[0])&&isFinite(v[1])&&isFinite(v[2])&&isFinite(v[3])&&!vt(v,this.maxSourceExtent_))return;let _=0;if(!e&&(!isFinite(t[0])||!isFinite(t[1])||!isFinite(l[0])||!isFinite(l[1])||!isFinite(m[0])||!isFinite(m[1])||!isFinite(f[0])||!isFinite(f[1]))){if(W>0)e=!0;else if(_=(!isFinite(t[0])||!isFinite(t[1])?8:0)+(!isFinite(l[0])||!isFinite(l[1])?4:0)+(!isFinite(m[0])||!isFinite(m[1])?2:0)+(!isFinite(f[0])||!isFinite(f[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(W>0){if(!e){const g=[(s[0]+i[0])/2,(s[1]+i[1])/2],u=this.transformInv_(g);let c;X?c=(Z(t[0],P)+Z(m[0],P))/2-Z(u[0],P):c=(t[0]+m[0])/2-u[0];const d=(t[1]+m[1])/2-u[1];e=c*c+d*d>this.errorThresholdSquared_}if(e){if(Math.abs(s[0]-i[0])<=Math.abs(s[1]-i[1])){const g=[(o[0]+i[0])/2,(o[1]+i[1])/2],u=this.transformInv_(g),c=[(h[0]+s[0])/2,(h[1]+s[1])/2],d=this.transformInv_(c);this.addQuad_(s,o,g,c,t,l,u,d,W-1),this.addQuad_(c,g,i,h,d,u,m,f,W-1)}else{const g=[(s[0]+o[0])/2,(s[1]+o[1])/2],u=this.transformInv_(g),c=[(i[0]+h[0])/2,(i[1]+h[1])/2],d=this.transformInv_(c);this.addQuad_(s,g,c,h,t,u,d,f,W-1),this.addQuad_(g,o,i,c,u,l,m,d,W-1)}return}}if(X){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(_&11)==0&&this.addTriangle_(s,i,h,t,m,f),(_&14)==0&&this.addTriangle_(s,i,o,t,m,l),_&&((_&13)==0&&this.addTriangle_(o,h,s,l,f,t),(_&7)==0&&this.addTriangle_(o,h,i,l,f,m))}calculateSourceExtent(){const s=ht();return this.triangles_.forEach(function(o,i,h){const t=o.source;z(s,t[0]),z(s,t[1]),z(s,t[2])}),s}getTriangles(){return this.triangles_}}const yt=.5;export{yt as E,Xt as T,Pt as a,H as b,nt as c,Ct as r};
//# sourceMappingURL=common-CLWpeXJR.js.map
