import{bn as Zt,g as fo,f as jt,b8 as on,bM as po,S as Rt,h as qt,bN as wt,u as yi,bF as mo,i as it,bO as jr,j as yo,bP as ho,bp as go,V as an,L as hi,y as St,b3 as Vn,aE as gi,b9 as bo,bQ as vo,bB as Bn,H as Rr,J as Ut,bR as xo,W as wo,a$ as ko,a3 as zo,B as Mo,E as To}from"./GeoJSON-BlyzYhKz.js";import{a as Co,V as sn,d as Io}from"./VectorTile-DXttuOY-.js";import{M as rr}from"./MVT-gazGN73t.js";import bi from"./Image-C83KNzFT.js";import vi from"./Tile-CC6tm9EA.js";import Ge from"./VectorTile-UyqE-kwB.js";import xi from"./Raster-DtpUleKB.js";import wi from"./TileJSON-D4FoPpxN.js";import{T as Eo}from"./TileGrid-D2Qra4XP.js";import{c as So}from"./Tile-8IayXPne.js";import"./index-4V-ffF_e.js";import"./utils-BXWzvTjY.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-CVtNDUBO.js";import"./useStateClass-BGbSLWFN-lMazZNQ7.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--B1-KiooU.js";import"./Tile-lMrQctYw.js";import"./UrlTile-CxpuZoX4.js";import"./tileurlfunction-CsB_e4FB.js";import"./tilecoord-DYaQ6NdW.js";import"./uri-BxyrIhx_.js";import"./TileEventType-CTN_nmJ7.js";import"./TileRange-2Tc-Ry00.js";import"./ImageLayer-Bn5NP1Zc.js";import"./BaseImage-FD9vmS44.js";import"./TileLayer-D-h0laqG.js";import"./DataTile-uej8eNh4.js";import"./Tile-BrHfHitc.js";import"./common-0gNrjJbx.js";import"./LRUCache-CwUIRQIv.js";import"./BaseTile-UnyspG_X.js";import"./TileProperty-BF4LcWSy.js";import"./ImageCanvas-CGLoEptj.js";import"./Image-0ePVgDVk.js";import"./resolution-CU8ppKQ3.js";import"./common-9rOs42pz.js";import"./net-tq6Ez6OH.js";import"./TileImage-BzZFQQFS.js";var Ao=8,$o={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},Po={"*":{type:"source"}},Fo=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],jo={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},Ro={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},qo={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},No={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},_o={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},Do={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},Lo={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},Oo=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],Uo={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Vo={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Bo={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Zo={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Wo={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Jo={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Xo={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Go={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Ho={type:"array",value:"*"},Yo={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},Ko={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},Qo={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},ea={type:"array",value:"*",minimum:1},ta={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},na={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},ra={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},ia={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},oa=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],aa={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},sa={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},la={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},ua={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},ca={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},fa={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},pa={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},da={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},ma={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},ya={"*":{type:"string"}},ha={$version:Ao,$root:$o,sources:Po,source:Fo,source_vector:jo,source_raster:Ro,source_raster_dem:qo,source_geojson:No,source_video:_o,source_image:Do,layer:Lo,layout:Oo,layout_background:Uo,layout_fill:Vo,layout_circle:Bo,layout_heatmap:Zo,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:Wo,layout_symbol:Jo,layout_raster:Xo,layout_hillshade:Go,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:Ho,filter_operator:Yo,geometry_type:Ko,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:Qo,expression:ea,light:ta,sky:na,terrain:ra,projection:ia,paint:oa,paint_fill:aa,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:sa,paint_circle:la,paint_heatmap:ua,paint_symbol:ca,paint_raster:fa,paint_hillshade:pa,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:da,transition:ma,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:ya};const ga=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ba(t,e){const n={};for(const r in t)r!=="ref"&&(n[r]=t[r]);return ga.forEach(r=>{r in e&&(n[r]=e[r])}),n}function ki(t){t=t.slice();const e=Object.create(null);for(let n=0;n<t.length;n++)e[t[n].id]=t[n];for(let n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=ba(t[n],e[t[n].ref]));return t}class Ie extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class ir{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[r,i]of n)this.bindings[r]=i}concat(e){return new ir(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}const ln={kind:"null"},y={kind:"number"},$={kind:"string"},S={kind:"boolean"},Ee={kind:"color"},un={kind:"projectionDefinition"},He={kind:"object"},E={kind:"value"},va={kind:"error"},cn={kind:"collator"},fn={kind:"formatted"},pn={kind:"padding"},kt={kind:"colorArray"},dn={kind:"numberArray"},At={kind:"resolvedImage"},mn={kind:"variableAnchorOffsetCollection"};function me(t,e){return{kind:"array",itemType:t,N:e}}function W(t){if(t.kind==="array"){const e=W(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}else return t.kind}const xa=[ln,y,$,S,Ee,un,fn,He,me(E),pn,dn,kt,At,mn];function zt(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!zt(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const n of xa)if(!zt(n,e))return null}}return`Expected ${W(t)} but found ${W(e)} instead.`}function or(t,e){return e.some(n=>n.kind===t.kind)}function Ye(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}function Oe(t,e){return t.kind==="array"&&e.kind==="array"?t.itemType.kind===e.itemType.kind&&typeof t.N=="number":t.kind===e.kind}const zi=.96422,Mi=1,Ti=.82521,Ci=4/29,lt=6/29,Ii=3*lt*lt,wa=lt*lt*lt,ka=Math.PI/180,za=180/Math.PI;function Ei(t){return t=t%360,t<0&&(t+=360),t}function Si([t,e,n,r]){t=An(t),e=An(e),n=An(n);let i,o;const a=$n((.2225045*t+.7168786*e+.0606169*n)/Mi);t===e&&e===n?i=o=a:(i=$n((.4360747*t+.3850649*e+.1430804*n)/zi),o=$n((.0139322*t+.0971045*e+.7141733*n)/Ti));const s=116*a-16;return[s<0?0:s,500*(i-a),200*(a-o),r]}function An(t){return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function $n(t){return t>wa?Math.pow(t,1/3):t/Ii+Ci}function Ai([t,e,n,r]){let i=(t+16)/116,o=isNaN(e)?i:i+e/500,a=isNaN(n)?i:i-n/200;return i=Mi*Fn(i),o=zi*Fn(o),a=Ti*Fn(a),[Pn(3.1338561*o-1.6168667*i-.4906146*a),Pn(-.9787684*o+1.9161415*i+.033454*a),Pn(.0719453*o-.2289914*i+1.4052427*a),r]}function Pn(t){return t=t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055,t<0?0:t>1?1:t}function Fn(t){return t>lt?t*t*t:Ii*(t-Ci)}function Ma(t){const[e,n,r,i]=Si(t),o=Math.sqrt(n*n+r*r);return[Math.round(o*1e4)?Ei(Math.atan2(r,n)*za):NaN,o,e,i]}function Ta([t,e,n,r]){return t=isNaN(t)?0:t*ka,Ai([n,Math.cos(t)*e,Math.sin(t)*e,r])}function Ca([t,e,n,r]){t=Ei(t),e/=100,n/=100;function i(o){const a=(o+t/30)%12,s=e*Math.min(n,1-n);return n-s*Math.max(-1,Math.min(a-3,9-a,1))}return[i(0),i(8),i(4),r]}const Ia=Object.hasOwn||function(e,n){return Object.prototype.hasOwnProperty.call(e,n)};function $i(t,e){return Ia(t,e)?t[e]:void 0}function Ea(t){if(t=t.toLowerCase().trim(),t==="transparent")return[0,0,0,0];const e=$i(Sa,t);if(e){const[i,o,a]=e;return[i/255,o/255,a/255,1]}if(t.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(t)){const o=t.length<6?1:2;let a=1;return[Nt(t.slice(a,a+=o)),Nt(t.slice(a,a+=o)),Nt(t.slice(a,a+=o)),Nt(t.slice(a,a+o)||"ff")]}if(t.startsWith("rgb")){const i=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,o=t.match(i);if(o){const[a,s,l,u,c,f,d,m,p,v,C,R]=o,q=[u||" ",d||" ",v].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const N=[l,f,p].join(""),U=N==="%%%"?100:N===""?255:0;if(U){const T=[at(+s/U,0,1),at(+c/U,0,1),at(+m/U,0,1),C?qr(+C,R):1];if(Nr(T))return T}}return}}const n=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,r=t.match(n);if(r){const[i,o,a,s,l,u,c,f,d]=r,m=[a||" ",l||" ",c].join("");if(m==="  "||m==="  /"||m===",,"||m===",,,"){const p=[+o,at(+s,0,100),at(+u,0,100),f?qr(+f,d):1];if(Nr(p))return Ca(p)}}}function Nt(t){return parseInt(t.padEnd(2,t),16)/255}function qr(t,e){return at(e?t/100:t,0,1)}function at(t,e,n){return Math.min(Math.max(e,t),n)}function Nr(t){return!t.some(Number.isNaN)}const Sa={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ke(t,e,n){return t+n*(e-t)}function Mt(t,e,n){return t.map((r,i)=>Ke(r,e[i],n))}class L{constructor(e,n,r,i=1,o=!0){this.r=e,this.g=n,this.b=r,this.a=i,o||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[e,n,r,i]))}static parse(e){if(e instanceof L)return e;if(typeof e!="string")return;const n=Ea(e);if(n)return new L(...n,!1)}get rgb(){const{r:e,g:n,b:r,a:i}=this,o=i||1/0;return this.overwriteGetter("rgb",[e/o,n/o,r/o,i])}get hcl(){return this.overwriteGetter("hcl",Ma(this.rgb))}get lab(){return this.overwriteGetter("lab",Si(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,r,i]=this.rgb;return`rgba(${[e,n,r].map(o=>Math.round(o*255)).join(",")},${i})`}static interpolate(e,n,r,i="rgb"){switch(i){case"rgb":{const[o,a,s,l]=Mt(e.rgb,n.rgb,r);return new L(o,a,s,l,!1)}case"hcl":{const[o,a,s,l]=e.hcl,[u,c,f,d]=n.hcl;let m,p;if(!isNaN(o)&&!isNaN(u)){let N=u-o;u>o&&N>180?N-=360:u<o&&o-u>180&&(N+=360),m=o+r*N}else isNaN(o)?isNaN(u)?m=NaN:(m=u,(s===1||s===0)&&(p=c)):(m=o,(f===1||f===0)&&(p=a));const[v,C,R,q]=Ta([m,p??Ke(a,c,r),Ke(s,f,r),Ke(l,d,r)]);return new L(v,C,R,q,!1)}case"lab":{const[o,a,s,l]=Ai(Mt(e.lab,n.lab,r));return new L(o,a,s,l,!1)}}}}L.black=new L(0,0,0,1);L.white=new L(1,1,1,1);L.transparent=new L(0,0,0,0);L.red=new L(1,0,0,1);class ar{constructor(e,n,r){e?this.sensitivity=n?"variant":"case":this.sensitivity=n?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Aa=["bottom","center","top"];class Zn{constructor(e,n,r,i,o,a){this.text=e,this.image=n,this.scale=r,this.fontStack=i,this.textColor=o,this.verticalAlign=a}}class qe{constructor(e){this.sections=e}static fromString(e){return new qe([new Zn(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof qe?e:qe.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class ke{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ke)return e;if(typeof e=="number")return new ke([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]];break}return new ke(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,r){return new ke(Mt(e.values,n.values,r))}}class ze{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ze)return e;if(typeof e=="number")return new ze([e]);if(Array.isArray(e)){for(const n of e)if(typeof n!="number")return;return new ze(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,r){return new ze(Mt(e.values,n.values,r))}}class ye{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ye)return e;if(typeof e=="string"){const r=L.parse(e);return r?new ye([r]):void 0}if(!Array.isArray(e))return;const n=[];for(const r of e){if(typeof r!="string")return;const i=L.parse(r);if(!i)return;n.push(i)}return new ye(n)}toString(){return JSON.stringify(this.values)}static interpolate(e,n,r,i="rgb"){const o=[];if(e.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let a=0;a<e.values.length;a++)o.push(L.interpolate(e.values[a],n.values[a],r,i));return new ye(o)}}class G extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const $a=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Se{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Se)return e;if(!(!Array.isArray(e)||e.length<1||e.length%2!==0)){for(let n=0;n<e.length;n+=2){const r=e[n],i=e[n+1];if(typeof r!="string"||!$a.has(r)||!Array.isArray(i)||i.length!==2||typeof i[0]!="number"||typeof i[1]!="number")return}return new Se(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,r){const i=e.values,o=n.values;if(i.length!==o.length)throw new G(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${n.toString()}`);const a=[];for(let s=0;s<i.length;s+=2){if(i[s]!==o[s])throw new G(`Cannot interpolate values containing mismatched anchors. from[${s}]: ${i[s]}, to[${s}]: ${o[s]}`);a.push(i[s]);const[l,u]=i[s+1],[c,f]=o[s+1];a.push([Ke(l,c,r),Ke(u,f,r)])}return new Se(a)}}class Be{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Be({name:e,available:!1}):null}}class xe{constructor(e,n,r){this.from=e,this.to=n,this.transition=r}static interpolate(e,n,r){return new xe(e,n,r)}static parse(e){if(e instanceof xe)return e;if(Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number")return new xe(e[0],e[1],e[2]);if(typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number")return new xe(e.from,e.to,e.transition);if(typeof e=="string")return new xe(e,e,1)}}function Pi(t,e,n,r){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?typeof r>"u"||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,n,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[t,e,n,r]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Tt(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof xe||t instanceof L||t instanceof ar||t instanceof qe||t instanceof ke||t instanceof ze||t instanceof ye||t instanceof Se||t instanceof Be)return!0;if(Array.isArray(t)){for(const e of t)if(!Tt(e))return!1;return!0}else if(typeof t=="object"){for(const e in t)if(!Tt(t[e]))return!1;return!0}else return!1}function K(t){if(t===null)return ln;if(typeof t=="string")return $;if(typeof t=="boolean")return S;if(typeof t=="number")return y;if(t instanceof L)return Ee;if(t instanceof xe)return un;if(t instanceof ar)return cn;if(t instanceof qe)return fn;if(t instanceof ke)return pn;if(t instanceof ze)return dn;if(t instanceof ye)return kt;if(t instanceof Se)return mn;if(t instanceof Be)return At;if(Array.isArray(t)){const e=t.length;let n;for(const r of t){const i=K(r);if(!n)n=i;else{if(n===i)continue;n=E;break}}return me(n||E,e)}else return He}function xt(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof L||t instanceof xe||t instanceof qe||t instanceof ke||t instanceof ze||t instanceof ye||t instanceof Se||t instanceof Be?t.toString():JSON.stringify(t)}class ct{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Tt(e[1]))return n.error("invalid value");const r=e[1];let i=K(r);const o=n.expectedType;return i.kind==="array"&&i.N===0&&o&&o.kind==="array"&&(typeof o.N!="number"||o.N===0)&&(i=o),new ct(i,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const _t={string:$,number:y,boolean:S,object:He};class we{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let r=1,i;const o=e[0];if(o==="array"){let s;if(e.length>2){const u=e[1];if(typeof u!="string"||!(u in _t)||u==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);s=_t[u],r++}else s=E;let l;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);l=e[2],r++}i=me(s,l)}else{if(!_t[o])throw new Error(`Types doesn't contain name = ${o}`);i=_t[o]}const a=[];for(;r<e.length;r++){const s=n.parse(e[r],r,E);if(!s)return null;a.push(s)}return new we(i,a)}evaluate(e){for(let n=0;n<this.args.length;n++){const r=this.args[n].evaluate(e);if(zt(this.type,K(r))){if(n===this.args.length-1)throw new G(`Expected value to be of type ${W(this.type)}, but found ${W(K(r))} instead.`)}else return r}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const _r={"to-boolean":S,"to-color":Ee,"to-number":y,"to-string":$};class Ve{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const r=e[0];if(!_r[r])throw new Error(`Can't parse ${r} as it is not part of the known types`);if((r==="to-boolean"||r==="to-string")&&e.length!==2)return n.error("Expected one argument.");const i=_r[r],o=[];for(let a=1;a<e.length;a++){const s=n.parse(e[a],a,E);if(!s)return null;o.push(s)}return new Ve(i,o)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,r;for(const i of this.args){if(n=i.evaluate(e),r=null,n instanceof L)return n;if(typeof n=="string"){const o=e.parseColor(n);if(o)return o}else if(Array.isArray(n)&&(n.length<3||n.length>4?r=`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:r=Pi(n[0],n[1],n[2],n[3]),!r))return new L(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new G(r||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const r of this.args){n=r.evaluate(e);const i=ke.parse(n);if(i)return i}throw new G(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const r of this.args){n=r.evaluate(e);const i=ze.parse(n);if(i)return i}throw new G(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const r of this.args){n=r.evaluate(e);const i=ye.parse(n);if(i)return i}throw new G(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const r of this.args){n=r.evaluate(e);const i=Se.parse(n);if(i)return i}throw new G(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const r of this.args){if(n=r.evaluate(e),n===null)return 0;const i=Number(n);if(!isNaN(i))return i}throw new G(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return qe.fromString(xt(this.args[0].evaluate(e)));case"resolvedImage":return Be.fromString(xt(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return xt(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Pa=["Unknown","Point","LineString","Polygon"];class Fi{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Pa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache.get(e);return n||(n=L.parse(e),this._parseColorCache.set(e,n)),n}}class yn{constructor(e,n,r=[],i,o=new ir,a=[]){this.registry=e,this.path=r,this.key=r.map(s=>`[${s}]`).join(""),this.scope=o,this.errors=a,this.expectedType=i,this._isConstant=n}parse(e,n,r,i,o={}){return n?this.concat(n,r,i)._parse(e,o):this._parse(e,o)}_parse(e,n){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function r(i,o,a){return a==="assert"?new we(o,[i]):a==="coerce"?new Ve(o,[i]):i}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=e[0];if(typeof i!="string")return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const o=this.registry[i];if(o){let a=o.parse(e,this);if(!a)return null;if(this.expectedType){const s=this.expectedType,l=a.type;if((s.kind==="string"||s.kind==="number"||s.kind==="boolean"||s.kind==="object"||s.kind==="array")&&l.kind==="value")a=r(a,s,n.typeAnnotation||"assert");else if(s.kind==="projectionDefinition"&&["string","array"].includes(l.kind)||["color","formatted","resolvedImage"].includes(s.kind)&&["value","string"].includes(l.kind)||["padding","numberArray"].includes(s.kind)&&["value","number","array"].includes(l.kind)||s.kind==="colorArray"&&["value","string","array"].includes(l.kind)||s.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(l.kind))a=r(a,s,n.typeAnnotation||"coerce");else if(this.checkSubtype(s,l))return null}if(!(a instanceof ct)&&a.type.kind!=="resolvedImage"&&this._isConstant(a)){const s=new Fi;try{a=new ct(a.type,a.evaluate(s))}catch(l){return this.error(l.message),null}}return a}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,n,r){const i=typeof e=="number"?this.path.concat(e):this.path,o=r?this.scope.concat(r):this.scope;return new yn(this.registry,this._isConstant,i,n||null,o,this.errors)}error(e,...n){const r=`${this.key}${n.map(i=>`[${i}]`).join("")}`;this.errors.push(new Ie(r,e))}checkSubtype(e,n){const r=zt(e,n);return r&&this.error(r),r}}class hn{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let o=1;o<e.length-1;o+=2){const a=e[o];if(typeof a!="string")return n.error(`Expected string, but found ${typeof a} instead.`,o);if(/[^a-zA-Z0-9_]/.test(a))return n.error("Variable names must contain only alphanumeric characters or '_'.",o);const s=n.parse(e[o+1],o+1);if(!s)return null;r.push([a,s])}const i=n.parse(e[e.length-1],e.length-1,n.expectedType,r);return i?new hn(r,i):null}outputDefined(){return this.result.outputDefined()}}class gn{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const r=e[1];return n.scope.has(r)?new gn(r,n.scope.get(r)):n.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class sr{constructor(e,n,r){this.type=e,this.index=n,this.input=r}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,y),i=n.parse(e[2],2,me(n.expectedType||E));if(!r||!i)return null;const o=i.type;return new sr(o.itemType,r,i)}evaluate(e){const n=this.index.evaluate(e),r=this.input.evaluate(e);if(n<0)throw new G(`Array index out of bounds: ${n} < 0.`);if(n>=r.length)throw new G(`Array index out of bounds: ${n} > ${r.length-1}.`);if(n!==Math.floor(n))throw new G(`Array index must be an integer, but found ${n} instead.`);return r[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class lr{constructor(e,n){this.type=S,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,E),i=n.parse(e[2],2,E);return!r||!i?null:or(r.type,[S,$,y,ln,E])?new lr(r,i):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${W(r.type)} instead`)}evaluate(e){const n=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!Ye(n,["boolean","string","number","null"]))throw new G(`Expected first argument to be of type boolean, string, number or null, but found ${W(K(n))} instead.`);if(!Ye(r,["string","array"]))throw new G(`Expected second argument to be of type array or string, but found ${W(K(r))} instead.`);return r.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Wt{constructor(e,n,r){this.type=y,this.needle=e,this.haystack=n,this.fromIndex=r}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,E),i=n.parse(e[2],2,E);if(!r||!i)return null;if(!or(r.type,[S,$,y,ln,E]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${W(r.type)} instead`);if(e.length===4){const o=n.parse(e[3],3,y);return o?new Wt(r,i,o):null}else return new Wt(r,i)}evaluate(e){const n=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Ye(n,["boolean","string","number","null"]))throw new G(`Expected first argument to be of type boolean, string, number or null, but found ${W(K(n))} instead.`);let i;if(this.fromIndex&&(i=this.fromIndex.evaluate(e)),Ye(r,["string"])){const o=r.indexOf(n,i);return o===-1?-1:[...r.slice(0,o)].length}else{if(Ye(r,["array"]))return r.indexOf(n,i);throw new G(`Expected second argument to be of type array or string, but found ${W(K(r))} instead.`)}}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class ur{constructor(e,n,r,i,o,a){this.inputType=e,this.type=n,this.input=r,this.cases=i,this.outputs=o,this.otherwise=a}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return n.error("Expected an even number of arguments.");let r,i;n.expectedType&&n.expectedType.kind!=="value"&&(i=n.expectedType);const o={},a=[];for(let u=2;u<e.length-1;u+=2){let c=e[u];const f=e[u+1];Array.isArray(c)||(c=[c]);const d=n.concat(u);if(c.length===0)return d.error("Expected at least one branch label.");for(const p of c){if(typeof p!="number"&&typeof p!="string")return d.error("Branch labels must be numbers or strings.");if(typeof p=="number"&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return d.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof p=="number"&&Math.floor(p)!==p)return d.error("Numeric branch labels must be integer values.");if(!r)r=K(p);else if(d.checkSubtype(r,K(p)))return null;if(typeof o[String(p)]<"u")return d.error("Branch labels must be unique.");o[String(p)]=a.length}const m=n.parse(f,u,i);if(!m)return null;i=i||m.type,a.push(m)}const s=n.parse(e[1],1,E);if(!s)return null;const l=n.parse(e[e.length-1],e.length-1,i);return!l||s.type.kind!=="value"&&n.concat(1).checkSubtype(r,s.type)?null:new ur(r,i,s,o,a,l)}evaluate(e){const n=this.input.evaluate(e);return(K(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class cr{constructor(e,n,r){this.type=e,this.branches=n,this.otherwise=r}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return n.error("Expected an odd number of arguments.");let r;n.expectedType&&n.expectedType.kind!=="value"&&(r=n.expectedType);const i=[];for(let a=1;a<e.length-1;a+=2){const s=n.parse(e[a],a,S);if(!s)return null;const l=n.parse(e[a+1],a+1,r);if(!l)return null;i.push([s,l]),r=r||l.type}const o=n.parse(e[e.length-1],e.length-1,r);if(!o)return null;if(!r)throw new Error("Can't infer output type");return new cr(r,i,o)}evaluate(e){for(const[n,r]of this.branches)if(n.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,r]of this.branches)e(n),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Jt{constructor(e,n,r,i){this.type=e,this.input=n,this.beginIndex=r,this.endIndex=i}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,E),i=n.parse(e[2],2,y);if(!r||!i)return null;if(!or(r.type,[me(E),$,E]))return n.error(`Expected first argument to be of type array or string, but found ${W(r.type)} instead`);if(e.length===4){const o=n.parse(e[3],3,y);return o?new Jt(r.type,r,i,o):null}else return new Jt(r.type,r,i)}evaluate(e){const n=this.input.evaluate(e),r=this.beginIndex.evaluate(e);let i;if(this.endIndex&&(i=this.endIndex.evaluate(e)),Ye(n,["string"]))return[...n].slice(r,i).join("");if(Ye(n,["array"]))return n.slice(r,i);throw new G(`Expected first argument to be of type array or string, but found ${W(K(n))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function ji(t,e){const n=t.length-1;let r=0,i=n,o=0,a,s;for(;r<=i;)if(o=Math.floor((r+i)/2),a=t[o],s=t[o+1],a<=e){if(o===n||e<s)return o;r=o+1}else if(a>e)i=o-1;else throw new G("Input is not a number.");return 0}class bn{constructor(e,n,r){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[i,o]of r)this.labels.push(i),this.outputs.push(o)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return n.error("Expected an even number of arguments.");const r=n.parse(e[1],1,y);if(!r)return null;const i=[];let o=null;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);for(let a=1;a<e.length;a+=2){const s=a===1?-1/0:e[a],l=e[a+1],u=a,c=a+1;if(typeof s!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(i.length&&i[i.length-1][0]>=s)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);const f=n.parse(l,c,o);if(!f)return null;o=o||f.type,i.push([s,f])}return new bn(o,r,i)}evaluate(e){const n=this.labels,r=this.outputs;if(n.length===1)return r[0].evaluate(e);const i=this.input.evaluate(e);if(i<=n[0])return r[0].evaluate(e);const o=n.length;if(i>=n[o-1])return r[o-1].evaluate(e);const a=ji(n,i);return r[a].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Fa(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var jn,Dr;function ja(){if(Dr)return jn;Dr=1,jn=t;function t(e,n,r,i){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(i-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=r,this.p2y=i}return t.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,i=0;i<8;i++){var o=this.sampleCurveX(r)-e;if(Math.abs(o)<n)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r=r-o/a}var s=0,l=1;for(r=e,i=0;i<20&&(o=this.sampleCurveX(r),!(Math.abs(o-e)<n));i++)e>o?s=r:l=r,r=(l-s)*.5+s;return r},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},jn}var Ra=ja(),qa=Fa(Ra);class Ae{constructor(e,n,r,i,o){this.type=e,this.operator=n,this.interpolation=r,this.input=i,this.labels=[],this.outputs=[];for(const[a,s]of o)this.labels.push(a),this.outputs.push(s)}static interpolationFactor(e,n,r,i){let o=0;if(e.name==="exponential")o=Rn(n,e.base,r,i);else if(e.name==="linear")o=Rn(n,1,r,i);else if(e.name==="cubic-bezier"){const a=e.controlPoints;o=new qa(a[0],a[1],a[2],a[3]).solve(Rn(n,1,r,i))}return o}static parse(e,n){let[r,i,o,...a]=e;if(!Array.isArray(i)||i.length===0)return n.error("Expected an interpolation type expression.",1);if(i[0]==="linear")i={name:"linear"};else if(i[0]==="exponential"){const u=i[1];if(typeof u!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:u}}else if(i[0]==="cubic-bezier"){const u=i.slice(1);if(u.length!==4||u.some(c=>typeof c!="number"||c<0||c>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:u}}else return n.error(`Unknown interpolation type ${String(i[0])}`,1,0);if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return n.error("Expected an even number of arguments.");if(o=n.parse(o,2,y),!o)return null;const s=[];let l=null;(r==="interpolate-hcl"||r==="interpolate-lab")&&n.expectedType!=kt?l=Ee:n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);for(let u=0;u<a.length;u+=2){const c=a[u],f=a[u+1],d=u+3,m=u+4;if(typeof c!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',d);if(s.length&&s[s.length-1][0]>=c)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',d);const p=n.parse(f,m,l);if(!p)return null;l=l||p.type,s.push([c,p])}return!Oe(l,y)&&!Oe(l,un)&&!Oe(l,Ee)&&!Oe(l,pn)&&!Oe(l,dn)&&!Oe(l,kt)&&!Oe(l,mn)&&!Oe(l,me(y))?n.error(`Type ${W(l)} is not interpolatable.`):new Ae(l,r,i,o,s)}evaluate(e){const n=this.labels,r=this.outputs;if(n.length===1)return r[0].evaluate(e);const i=this.input.evaluate(e);if(i<=n[0])return r[0].evaluate(e);const o=n.length;if(i>=n[o-1])return r[o-1].evaluate(e);const a=ji(n,i),s=n[a],l=n[a+1],u=Ae.interpolationFactor(this.interpolation,i,s,l),c=r[a].evaluate(e),f=r[a+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Ke(c,f,u);case"color":return L.interpolate(c,f,u);case"padding":return ke.interpolate(c,f,u);case"colorArray":return ye.interpolate(c,f,u);case"numberArray":return ze.interpolate(c,f,u);case"variableAnchorOffsetCollection":return Se.interpolate(c,f,u);case"array":return Mt(c,f,u);case"projectionDefinition":return xe.interpolate(c,f,u)}case"interpolate-hcl":switch(this.type.kind){case"color":return L.interpolate(c,f,u,"hcl");case"colorArray":return ye.interpolate(c,f,u,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return L.interpolate(c,f,u,"lab");case"colorArray":return ye.interpolate(c,f,u,"lab")}}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Rn(t,e,n,r){const i=r-n,o=t-n;return i===0?0:e===1?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}class Ct{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let r=null;const i=n.expectedType;i&&i.kind!=="value"&&(r=i);const o=[];for(const s of e.slice(1)){const l=n.parse(s,1+o.length,r,void 0,{typeAnnotation:"omit"});if(!l)return null;r=r||l.type,o.push(l)}if(!r)throw new Error("No output type");return i&&o.some(s=>zt(i,s.type))?new Ct(E,o):new Ct(r,o)}evaluate(e){let n=null,r=0,i;for(const o of this.args)if(r++,n=o.evaluate(e),n&&n instanceof Be&&!n.available&&(i||(i=n.name),n=null,r===this.args.length&&(n=i)),n!==null)break;return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function Lr(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Na(t,e,n){return e===n}function _a(t,e,n){return e!==n}function Da(t,e,n){return e<n}function La(t,e,n){return e>n}function Oa(t,e,n){return e<=n}function Ua(t,e,n){return e>=n}function Ri(t,e,n,r){return r.compare(e,n)===0}function Va(t,e,n,r){return!Ri(t,e,n,r)}function Ba(t,e,n,r){return r.compare(e,n)<0}function Za(t,e,n,r){return r.compare(e,n)>0}function Wa(t,e,n,r){return r.compare(e,n)<=0}function Ja(t,e,n,r){return r.compare(e,n)>=0}function pt(t,e,n){const r=t!=="=="&&t!=="!=";return class qi{constructor(o,a,s){this.type=S,this.lhs=o,this.rhs=a,this.collator=s,this.hasUntypedArgument=o.type.kind==="value"||a.type.kind==="value"}static parse(o,a){if(o.length!==3&&o.length!==4)return a.error("Expected two or three arguments.");const s=o[0];let l=a.parse(o[1],1,E);if(!l)return null;if(!Lr(s,l.type))return a.concat(1).error(`"${s}" comparisons are not supported for type '${W(l.type)}'.`);let u=a.parse(o[2],2,E);if(!u)return null;if(!Lr(s,u.type))return a.concat(2).error(`"${s}" comparisons are not supported for type '${W(u.type)}'.`);if(l.type.kind!==u.type.kind&&l.type.kind!=="value"&&u.type.kind!=="value")return a.error(`Cannot compare types '${W(l.type)}' and '${W(u.type)}'.`);r&&(l.type.kind==="value"&&u.type.kind!=="value"?l=new we(u.type,[l]):l.type.kind!=="value"&&u.type.kind==="value"&&(u=new we(l.type,[u])));let c=null;if(o.length===4){if(l.type.kind!=="string"&&u.type.kind!=="string"&&l.type.kind!=="value"&&u.type.kind!=="value")return a.error("Cannot use collator to compare non-string types.");if(c=a.parse(o[3],3,cn),!c)return null}return new qi(l,u,c)}evaluate(o){const a=this.lhs.evaluate(o),s=this.rhs.evaluate(o);if(r&&this.hasUntypedArgument){const l=K(a),u=K(s);if(l.kind!==u.kind||!(l.kind==="string"||l.kind==="number"))throw new G(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${l.kind}, ${u.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const l=K(a),u=K(s);if(l.kind!=="string"||u.kind!=="string")return e(o,a,s)}return this.collator?n(o,a,s,this.collator.evaluate(o)):e(o,a,s)}eachChild(o){o(this.lhs),o(this.rhs),this.collator&&o(this.collator)}outputDefined(){return!0}}}const Xa=pt("==",Na,Ri),Ga=pt("!=",_a,Va),Ha=pt("<",Da,Ba),Ya=pt(">",La,Za),Ka=pt("<=",Oa,Wa),Qa=pt(">=",Ua,Ja);class vn{constructor(e,n,r){this.type=cn,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return n.error("Collator options argument must be an object.");const i=n.parse(r["case-sensitive"]===void 0?!1:r["case-sensitive"],1,S);if(!i)return null;const o=n.parse(r["diacritic-sensitive"]===void 0?!1:r["diacritic-sensitive"],1,S);if(!o)return null;let a=null;return r.locale&&(a=n.parse(r.locale,1,$),!a)?null:new vn(i,o,a)}evaluate(e){return new ar(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class fr{constructor(e,n,r,i,o){this.type=$,this.number=e,this.locale=n,this.currency=r,this.minFractionDigits=i,this.maxFractionDigits=o}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const r=n.parse(e[1],1,y);if(!r)return null;const i=e[2];if(typeof i!="object"||Array.isArray(i))return n.error("NumberFormat options argument must be an object.");let o=null;if(i.locale&&(o=n.parse(i.locale,1,$),!o))return null;let a=null;if(i.currency&&(a=n.parse(i.currency,1,$),!a))return null;let s=null;if(i["min-fraction-digits"]&&(s=n.parse(i["min-fraction-digits"],1,y),!s))return null;let l=null;return i["max-fraction-digits"]&&(l=n.parse(i["max-fraction-digits"],1,y),!l)?null:new fr(r,o,a,s,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class pr{constructor(e){this.type=fn,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return n.error("First argument must be an image or text section.");const i=[];let o=!1;for(let a=1;a<=e.length-1;++a){const s=e[a];if(o&&typeof s=="object"&&!Array.isArray(s)){o=!1;let l=null;if(s["font-scale"]&&(l=n.parse(s["font-scale"],1,y),!l))return null;let u=null;if(s["text-font"]&&(u=n.parse(s["text-font"],1,me($)),!u))return null;let c=null;if(s["text-color"]&&(c=n.parse(s["text-color"],1,Ee),!c))return null;let f=null;if(s["vertical-align"]){if(typeof s["vertical-align"]=="string"&&!Aa.includes(s["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${s["vertical-align"]}' instead.`);if(f=n.parse(s["vertical-align"],1,$),!f)return null}const d=i[i.length-1];d.scale=l,d.font=u,d.textColor=c,d.verticalAlign=f}else{const l=n.parse(e[a],1,E);if(!l)return null;const u=l.type.kind;if(u!=="string"&&u!=="value"&&u!=="null"&&u!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");o=!0,i.push({content:l,scale:null,font:null,textColor:null,verticalAlign:null})}}return new pr(i)}evaluate(e){const n=r=>{const i=r.content.evaluate(e);return K(i)===At?new Zn("",i,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(e):null):new Zn(xt(i),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null,r.verticalAlign?r.verticalAlign.evaluate(e):null)};return new qe(this.sections.map(n))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor),n.verticalAlign&&e(n.verticalAlign)}outputDefined(){return!1}}class dr{constructor(e){this.type=At,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const r=n.parse(e[1],1,$);return r?new dr(r):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),r=Be.fromString(n);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(n)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}}class mr{constructor(e){this.type=y,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=n.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${W(r.type)} instead.`):new mr(r):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new G(`Expected value to be of type string or array, but found ${W(K(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const $e=8192;function es(t,e){const n=ts(t[0]),r=rs(t[1]),i=Math.pow(2,e.z);return[Math.round(n*i*$e),Math.round(r*i*$e)]}function yr(t,e){const n=Math.pow(2,e.z),r=(t[0]/$e+e.x)/n,i=(t[1]/$e+e.y)/n;return[ns(r),is(i)]}function ts(t){return(180+t)/360}function ns(t){return t*360-180}function rs(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function is(t){return 360/Math.PI*Math.atan(Math.exp((180-t*360)*Math.PI/180))-90}function $t(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function It(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function os(t,e,n){return e[1]>t[1]!=n[1]>t[1]&&t[0]<(n[0]-e[0])*(t[1]-e[1])/(n[1]-e[1])+e[0]}function as(t,e,n){const r=t[0]-e[0],i=t[1]-e[1],o=t[0]-n[0],a=t[1]-n[1];return r*a-o*i===0&&r*o<=0&&i*a<=0}function xn(t,e,n,r){const i=[e[0]-t[0],e[1]-t[1]],o=[r[0]-n[0],r[1]-n[1]];return cs(o,i)===0?!1:!!(Or(t,e,n,r)&&Or(n,r,t,e))}function ss(t,e,n){for(const r of n)for(let i=0;i<r.length-1;++i)if(xn(t,e,r[i],r[i+1]))return!0;return!1}function dt(t,e,n=!1){let r=!1;for(const i of e)for(let o=0;o<i.length-1;o++){if(as(t,i[o],i[o+1]))return n;os(t,i[o],i[o+1])&&(r=!r)}return r}function ls(t,e){for(const n of e)if(dt(t,n))return!0;return!1}function Ni(t,e){for(const n of t)if(!dt(n,e))return!1;for(let n=0;n<t.length-1;++n)if(ss(t[n],t[n+1],e))return!1;return!0}function us(t,e){for(const n of e)if(Ni(t,n))return!0;return!1}function cs(t,e){return t[0]*e[1]-t[1]*e[0]}function Or(t,e,n,r){const i=t[0]-n[0],o=t[1]-n[1],a=e[0]-n[0],s=e[1]-n[1],l=r[0]-n[0],u=r[1]-n[1],c=i*u-l*o,f=a*u-l*s;return c>0&&f<0||c<0&&f>0}function hr(t,e,n){const r=[];for(let i=0;i<t.length;i++){const o=[];for(let a=0;a<t[i].length;a++){const s=es(t[i][a],n);$t(e,s),o.push(s)}r.push(o)}return r}function _i(t,e,n){const r=[];for(let i=0;i<t.length;i++){const o=hr(t[i],e,n);r.push(o)}return r}function Di(t,e,n,r){if(t[0]<n[0]||t[0]>n[2]){const i=r*.5;let o=t[0]-n[0]>i?-r:n[0]-t[0]>i?r:0;o===0&&(o=t[0]-n[2]>i?-r:n[2]-t[0]>i?r:0),t[0]+=o}$t(e,t)}function fs(t){t[0]=t[1]=1/0,t[2]=t[3]=-1/0}function Ur(t,e,n,r){const i=Math.pow(2,r.z)*$e,o=[r.x*$e,r.y*$e],a=[];for(const s of t)for(const l of s){const u=[l.x+o[0],l.y+o[1]];Di(u,e,n,i),a.push(u)}return a}function Vr(t,e,n,r){const i=Math.pow(2,r.z)*$e,o=[r.x*$e,r.y*$e],a=[];for(const s of t){const l=[];for(const u of s){const c=[u.x+o[0],u.y+o[1]];$t(e,c),l.push(c)}a.push(l)}if(e[2]-e[0]<=i/2){fs(e);for(const s of a)for(const l of s)Di(l,e,n,i)}return a}function ps(t,e){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(e.type==="Polygon"){const o=hr(e.coordinates,r,i),a=Ur(t.geometry(),n,r,i);if(!It(n,r))return!1;for(const s of a)if(!dt(s,o))return!1}if(e.type==="MultiPolygon"){const o=_i(e.coordinates,r,i),a=Ur(t.geometry(),n,r,i);if(!It(n,r))return!1;for(const s of a)if(!ls(s,o))return!1}return!0}function ds(t,e){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(e.type==="Polygon"){const o=hr(e.coordinates,r,i),a=Vr(t.geometry(),n,r,i);if(!It(n,r))return!1;for(const s of a)if(!Ni(s,o))return!1}if(e.type==="MultiPolygon"){const o=_i(e.coordinates,r,i),a=Vr(t.geometry(),n,r,i);if(!It(n,r))return!1;for(const s of a)if(!us(s,o))return!1}return!0}class Qe{constructor(e,n){this.type=S,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Tt(e[1])){const r=e[1];if(r.type==="FeatureCollection"){const i=[];for(const o of r.features){const{type:a,coordinates:s}=o.geometry;a==="Polygon"&&i.push(s),a==="MultiPolygon"&&i.push(...s)}if(i.length){const o={type:"MultiPolygon",coordinates:i};return new Qe(r,o)}}else if(r.type==="Feature"){const i=r.geometry.type;if(i==="Polygon"||i==="MultiPolygon")return new Qe(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Qe(r,r)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return ps(e,this.geometries);if(e.geometryType()==="LineString")return ds(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Li{constructor(e=[],n=(r,i)=>r<i?-1:r>i?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:r}=this,i=n[e];for(;e>0;){const o=e-1>>1,a=n[o];if(r(i,a)>=0)break;n[e]=a,e=o}n[e]=i}_down(e){const{data:n,compare:r}=this,i=this.length>>1,o=n[e];for(;e<i;){let a=(e<<1)+1;const s=a+1;if(s<this.length&&r(n[s],n[a])<0&&(a=s),r(n[a],o)>=0)break;n[e]=n[a],e=a}n[e]=o}}function ms(t,e){if(t.length<=1)return[t];const r=[];let i,o;for(const a of t){const s=ys(a);s!==0&&(a.area=Math.abs(s),o===void 0&&(o=s<0),o===s<0?(i&&r.push(i),i=[a]):i.push(a))}return i&&r.push(i),r}function ys(t){let e=0;for(let n=0,r=t.length,i=r-1,o,a;n<r;i=n++)o=t[n],a=t[i],e+=(a.x-o.x)*(o.y+a.y);return e}const hs=6378.137,Br=1/298.257223563,Zr=Br*(2-Br),Wr=Math.PI/180;class gr{constructor(e){const n=Wr*hs*1e3,r=Math.cos(e*Wr),i=1/(1-Zr*(1-r*r)),o=Math.sqrt(i);this.kx=n*o*r,this.ky=n*o*i*(1-Zr)}distance(e,n){const r=this.wrap(e[0]-n[0])*this.kx,i=(e[1]-n[1])*this.ky;return Math.sqrt(r*r+i*i)}pointOnLine(e,n){let r=1/0,i,o,a,s;for(let l=0;l<e.length-1;l++){let u=e[l][0],c=e[l][1],f=this.wrap(e[l+1][0]-u)*this.kx,d=(e[l+1][1]-c)*this.ky,m=0;(f!==0||d!==0)&&(m=(this.wrap(n[0]-u)*this.kx*f+(n[1]-c)*this.ky*d)/(f*f+d*d),m>1?(u=e[l+1][0],c=e[l+1][1]):m>0&&(u+=f/this.kx*m,c+=d/this.ky*m)),f=this.wrap(n[0]-u)*this.kx,d=(n[1]-c)*this.ky;const p=f*f+d*d;p<r&&(r=p,i=u,o=c,a=l,s=m)}return{point:[i,o],index:a,t:Math.max(0,Math.min(1,s))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}const Wn=100,Jn=50;function Oi(t,e){return e[0]-t[0]}function Xt(t){return t[1]-t[0]+1}function Ne(t,e){return t[1]>=t[0]&&t[1]<e}function Xn(t,e){if(t[0]>t[1])return[null,null];const n=Xt(t);if(e){if(n===2)return[t,null];const i=Math.floor(n/2);return[[t[0],t[0]+i],[t[0]+i,t[1]]]}if(n===1)return[t,null];const r=Math.floor(n/2)-1;return[[t[0],t[0]+r],[t[0]+r+1,t[1]]]}function Gn(t,e){if(!Ne(e,t.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let r=e[0];r<=e[1];++r)$t(n,t[r]);return n}function Hn(t){const e=[1/0,1/0,-1/0,-1/0];for(const n of t)for(const r of n)$t(e,r);return e}function Jr(t){return t[0]!==-1/0&&t[1]!==-1/0&&t[2]!==1/0&&t[3]!==1/0}function br(t,e,n){if(!Jr(t)||!Jr(e))return NaN;let r=0,i=0;return t[2]<e[0]&&(r=e[0]-t[2]),t[0]>e[2]&&(r=t[0]-e[2]),t[1]>e[3]&&(i=t[1]-e[3]),t[3]<e[1]&&(i=e[1]-t[3]),n.distance([0,0],[r,i])}function Xe(t,e,n){const r=n.pointOnLine(e,t);return n.distance(t,r.point)}function vr(t,e,n,r,i){const o=Math.min(Xe(t,[n,r],i),Xe(e,[n,r],i)),a=Math.min(Xe(n,[t,e],i),Xe(r,[t,e],i));return Math.min(o,a)}function gs(t,e,n,r,i){if(!(Ne(e,t.length)&&Ne(r,n.length)))return 1/0;let a=1/0;for(let s=e[0];s<e[1];++s){const l=t[s],u=t[s+1];for(let c=r[0];c<r[1];++c){const f=n[c],d=n[c+1];if(xn(l,u,f,d))return 0;a=Math.min(a,vr(l,u,f,d,i))}}return a}function bs(t,e,n,r,i){if(!(Ne(e,t.length)&&Ne(r,n.length)))return NaN;let a=1/0;for(let s=e[0];s<=e[1];++s)for(let l=r[0];l<=r[1];++l)if(a=Math.min(a,i.distance(t[s],n[l])),a===0)return a;return a}function vs(t,e,n){if(dt(t,e,!0))return 0;let r=1/0;for(const i of e){const o=i[0],a=i[i.length-1];if(o!==a&&(r=Math.min(r,Xe(t,[a,o],n)),r===0))return r;const s=n.pointOnLine(i,t);if(r=Math.min(r,n.distance(t,s.point)),r===0)return r}return r}function xs(t,e,n,r){if(!Ne(e,t.length))return NaN;for(let o=e[0];o<=e[1];++o)if(dt(t[o],n,!0))return 0;let i=1/0;for(let o=e[0];o<e[1];++o){const a=t[o],s=t[o+1];for(const l of n)for(let u=0,c=l.length,f=c-1;u<c;f=u++){const d=l[f],m=l[u];if(xn(a,s,d,m))return 0;i=Math.min(i,vr(a,s,d,m,r))}}return i}function Xr(t,e){for(const n of t)for(const r of n)if(dt(r,e,!0))return!0;return!1}function ws(t,e,n,r=1/0){const i=Hn(t),o=Hn(e);if(r!==1/0&&br(i,o,n)>=r)return r;if(It(i,o)){if(Xr(t,e))return 0}else if(Xr(e,t))return 0;let a=1/0;for(const s of t)for(let l=0,u=s.length,c=u-1;l<u;c=l++){const f=s[c],d=s[l];for(const m of e)for(let p=0,v=m.length,C=v-1;p<v;C=p++){const R=m[C],q=m[p];if(xn(f,d,R,q))return 0;a=Math.min(a,vr(f,d,R,q,n))}}return a}function Gr(t,e,n,r,i,o){if(!o)return;const a=br(Gn(r,o),i,n);a<e&&t.push([a,o,[0,0]])}function Dt(t,e,n,r,i,o,a){if(!o||!a)return;const s=br(Gn(r,o),Gn(i,a),n);s<e&&t.push([s,o,a])}function Gt(t,e,n,r,i=1/0){let o=Math.min(r.distance(t[0],n[0][0]),i);if(o===0)return o;const a=new Li([[0,[0,t.length-1],[0,0]]],Oi),s=Hn(n);for(;a.length>0;){const l=a.pop();if(l[0]>=o)continue;const u=l[1],c=e?Jn:Wn;if(Xt(u)<=c){if(!Ne(u,t.length))return NaN;if(e){const f=xs(t,u,n,r);if(isNaN(f)||f===0)return f;o=Math.min(o,f)}else for(let f=u[0];f<=u[1];++f){const d=vs(t[f],n,r);if(o=Math.min(o,d),o===0)return 0}}else{const f=Xn(u,e);Gr(a,o,r,t,s,f[0]),Gr(a,o,r,t,s,f[1])}}return o}function Ht(t,e,n,r,i,o=1/0){let a=Math.min(o,i.distance(t[0],n[0]));if(a===0)return a;const s=new Li([[0,[0,t.length-1],[0,n.length-1]]],Oi);for(;s.length>0;){const l=s.pop();if(l[0]>=a)continue;const u=l[1],c=l[2],f=e?Jn:Wn,d=r?Jn:Wn;if(Xt(u)<=f&&Xt(c)<=d){if(!Ne(u,t.length)&&Ne(c,n.length))return NaN;let m;if(e&&r)m=gs(t,u,n,c,i),a=Math.min(a,m);else if(e&&!r){const p=t.slice(u[0],u[1]+1);for(let v=c[0];v<=c[1];++v)if(m=Xe(n[v],p,i),a=Math.min(a,m),a===0)return a}else if(!e&&r){const p=n.slice(c[0],c[1]+1);for(let v=u[0];v<=u[1];++v)if(m=Xe(t[v],p,i),a=Math.min(a,m),a===0)return a}else m=bs(t,u,n,c,i),a=Math.min(a,m)}else{const m=Xn(u,e),p=Xn(c,r);Dt(s,a,i,t,n,m[0],p[0]),Dt(s,a,i,t,n,m[0],p[1]),Dt(s,a,i,t,n,m[1],p[0]),Dt(s,a,i,t,n,m[1],p[1])}}return a}function ks(t,e){const n=t.geometry(),r=n.flat().map(a=>yr([a.x,a.y],t.canonical));if(n.length===0)return NaN;const i=new gr(r[0][1]);let o=1/0;for(const a of e){switch(a.type){case"Point":o=Math.min(o,Ht(r,!1,[a.coordinates],!1,i,o));break;case"LineString":o=Math.min(o,Ht(r,!1,a.coordinates,!0,i,o));break;case"Polygon":o=Math.min(o,Gt(r,!1,a.coordinates,i,o));break}if(o===0)return o}return o}function zs(t,e){const n=t.geometry(),r=n.flat().map(a=>yr([a.x,a.y],t.canonical));if(n.length===0)return NaN;const i=new gr(r[0][1]);let o=1/0;for(const a of e){switch(a.type){case"Point":o=Math.min(o,Ht(r,!0,[a.coordinates],!1,i,o));break;case"LineString":o=Math.min(o,Ht(r,!0,a.coordinates,!0,i,o));break;case"Polygon":o=Math.min(o,Gt(r,!0,a.coordinates,i,o));break}if(o===0)return o}return o}function Ms(t,e){const n=t.geometry();if(n.length===0||n[0].length===0)return NaN;const r=ms(n).map(a=>a.map(s=>s.map(l=>yr([l.x,l.y],t.canonical)))),i=new gr(r[0][0][0][1]);let o=1/0;for(const a of e)for(const s of r){switch(a.type){case"Point":o=Math.min(o,Gt([a.coordinates],!1,s,i,o));break;case"LineString":o=Math.min(o,Gt(a.coordinates,!0,s,i,o));break;case"Polygon":o=Math.min(o,ws(s,a.coordinates,i,o));break}if(o===0)return o}return o}function qn(t){return t.type==="MultiPolygon"?t.coordinates.map(e=>({type:"Polygon",coordinates:e})):t.type==="MultiLineString"?t.coordinates.map(e=>({type:"LineString",coordinates:e})):t.type==="MultiPoint"?t.coordinates.map(e=>({type:"Point",coordinates:e})):[t]}class et{constructor(e,n){this.type=y,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Tt(e[1])){const r=e[1];if(r.type==="FeatureCollection")return new et(r,r.features.map(i=>qn(i.geometry)).flat());if(r.type==="Feature")return new et(r,qn(r.geometry));if("type"in r&&"coordinates"in r)return new et(r,qn(r))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return ks(e,this.geometries);if(e.geometryType()==="LineString")return zs(e,this.geometries);if(e.geometryType()==="Polygon")return Ms(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Pt{constructor(e){this.type=E,this.key=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=e[1];return r==null?n.error("Global state property must be defined."):typeof r!="string"?n.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Pt(r)}evaluate(e){var n;const r=(n=e.globals)===null||n===void 0?void 0:n.globalState;return!r||Object.keys(r).length===0?null:$i(r,this.key)}eachChild(){}outputDefined(){return!1}}const wn={"==":Xa,"!=":Ga,">":Ya,"<":Ha,">=":Qa,"<=":Ka,array:we,at:sr,boolean:we,case:cr,coalesce:Ct,collator:vn,format:pr,image:dr,in:lr,"index-of":Wt,interpolate:Ae,"interpolate-hcl":Ae,"interpolate-lab":Ae,length:mr,let:hn,literal:ct,match:ur,number:we,"number-format":fr,object:we,slice:Jt,step:bn,string:we,"to-boolean":Ve,"to-color":Ve,"to-number":Ve,"to-string":Ve,var:gn,within:Qe,distance:et,"global-state":Pt};class he{constructor(e,n,r,i){this.name=e,this.type=n,this._evaluate=r,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const r=e[0],i=he.definitions[r];if(!i)return n.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const o=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=a.filter(([u])=>!Array.isArray(u)||u.length===e.length-1);let l=null;for(const[u,c]of s){l=new yn(n.registry,Yt,n.path,null,n.scope);const f=[];let d=!1;for(let m=1;m<e.length;m++){const p=e[m],v=Array.isArray(u)?u[m-1]:u.type,C=l.parse(p,1+f.length,v);if(!C){d=!0;break}f.push(C)}if(!d){if(Array.isArray(u)&&u.length!==f.length){l.error(`Expected ${u.length} arguments, but found ${f.length} instead.`);continue}for(let m=0;m<f.length;m++){const p=Array.isArray(u)?u[m]:u.type,v=f[m];l.concat(m+1).checkSubtype(p,v.type)}if(l.errors.length===0)return new he(r,o,c,f)}}if(s.length===1)n.errors.push(...l.errors);else{const c=(s.length?s:a).map(([d])=>Cs(d)).join(" | "),f=[];for(let d=1;d<e.length;d++){const m=n.parse(e[d],1+f.length);if(!m)return null;f.push(W(m.type))}n.error(`Expected arguments of type ${c}, but found (${f.join(", ")}) instead.`)}return null}static register(e,n){he.definitions=n;for(const r in n)e[r]=he}}function Hr(t,[e,n,r,i]){e=e.evaluate(t),n=n.evaluate(t),r=r.evaluate(t);const o=i?i.evaluate(t):1,a=Pi(e,n,r,o);if(a)throw new G(a);return new L(e/255,n/255,r/255,o,!1)}function Yr(t,e){return t in e}function Nn(t,e){const n=e[t];return typeof n>"u"?null:n}function Ts(t,e,n,r){for(;n<=r;){const i=n+r>>1;if(e[i]===t)return!0;e[i]>t?r=i-1:n=i+1}return!1}function We(t){return{type:t}}he.register(wn,{error:[va,[$],(t,[e])=>{throw new G(e.evaluate(t))}],typeof:[$,[E],(t,[e])=>W(K(e.evaluate(t)))],"to-rgba":[me(y,4),[Ee],(t,[e])=>{const[n,r,i,o]=e.evaluate(t).rgb;return[n*255,r*255,i*255,o]}],rgb:[Ee,[y,y,y],Hr],rgba:[Ee,[y,y,y,y],Hr],has:{type:S,overloads:[[[$],(t,[e])=>Yr(e.evaluate(t),t.properties())],[[$,He],(t,[e,n])=>Yr(e.evaluate(t),n.evaluate(t))]]},get:{type:E,overloads:[[[$],(t,[e])=>Nn(e.evaluate(t),t.properties())],[[$,He],(t,[e,n])=>Nn(e.evaluate(t),n.evaluate(t))]]},"feature-state":[E,[$],(t,[e])=>Nn(e.evaluate(t),t.featureState||{})],properties:[He,[],t=>t.properties()],"geometry-type":[$,[],t=>t.geometryType()],id:[E,[],t=>t.id()],zoom:[y,[],t=>t.globals.zoom],"heatmap-density":[y,[],t=>t.globals.heatmapDensity||0],elevation:[y,[],t=>t.globals.elevation||0],"line-progress":[y,[],t=>t.globals.lineProgress||0],accumulated:[E,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[y,We(y),(t,e)=>{let n=0;for(const r of e)n+=r.evaluate(t);return n}],"*":[y,We(y),(t,e)=>{let n=1;for(const r of e)n*=r.evaluate(t);return n}],"-":{type:y,overloads:[[[y,y],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[y],(t,[e])=>-e.evaluate(t)]]},"/":[y,[y,y],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[y,[y,y],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[y,[],()=>Math.LN2],pi:[y,[],()=>Math.PI],e:[y,[],()=>Math.E],"^":[y,[y,y],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[y,[y],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[y,[y],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[y,[y],(t,[e])=>Math.log(e.evaluate(t))],log2:[y,[y],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[y,[y],(t,[e])=>Math.sin(e.evaluate(t))],cos:[y,[y],(t,[e])=>Math.cos(e.evaluate(t))],tan:[y,[y],(t,[e])=>Math.tan(e.evaluate(t))],asin:[y,[y],(t,[e])=>Math.asin(e.evaluate(t))],acos:[y,[y],(t,[e])=>Math.acos(e.evaluate(t))],atan:[y,[y],(t,[e])=>Math.atan(e.evaluate(t))],min:[y,We(y),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[y,We(y),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[y,[y],(t,[e])=>Math.abs(e.evaluate(t))],round:[y,[y],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[y,[y],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[y,[y],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[S,[$,E],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[S,[E],(t,[e])=>t.id()===e.value],"filter-type-==":[S,[$],(t,[e])=>t.geometryType()===e.value],"filter-<":[S,[$,E],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r<i}],"filter-id-<":[S,[E],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n<r}],"filter->":[S,[$,E],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r>i}],"filter-id->":[S,[E],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n>r}],"filter-<=":[S,[$,E],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[S,[E],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n<=r}],"filter->=":[S,[$,E],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[S,[E],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n>=r}],"filter-has":[S,[E],(t,[e])=>e.value in t.properties()],"filter-has-id":[S,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[S,[me($)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[S,[me(E)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[S,[$,me(E)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[S,[$,me(E)],(t,[e,n])=>Ts(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:S,overloads:[[[S,S],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[We(S),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:S,overloads:[[[S,S],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[We(S),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[S,[S],(t,[e])=>!e.evaluate(t)],"is-supported-script":[S,[$],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return n?n(e.evaluate(t)):!0}],upcase:[$,[$],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[$,[$],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[$,We(E),(t,e)=>e.map(n=>xt(n.evaluate(t))).join("")],"resolved-locale":[$,[cn],(t,[e])=>e.evaluate(t).resolvedLocale()]});function Cs(t){return Array.isArray(t)?`(${t.map(W).join(", ")})`:`(${W(t.type)}...)`}function Yt(t){if(t instanceof gn)return Yt(t.boundExpression);if(t instanceof he&&t.name==="error")return!1;if(t instanceof vn)return!1;if(t instanceof Qe)return!1;if(t instanceof et)return!1;if(t instanceof Pt)return!1;const e=t instanceof Ve||t instanceof we;let n=!0;return t.eachChild(r=>{e?n=n&&Yt(r):n=n&&r instanceof ct}),n?xr(t)&&kr(t,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function xr(t){if(t instanceof he){if(t.name==="get"&&t.args.length===1)return!1;if(t.name==="feature-state")return!1;if(t.name==="has"&&t.args.length===1)return!1;if(t.name==="properties"||t.name==="geometry-type"||t.name==="id")return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Qe||t instanceof et)return!1;let e=!0;return t.eachChild(n=>{e&&!xr(n)&&(e=!1)}),e}function wr(t){if(t instanceof he&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!wr(n)&&(e=!1)}),e}function kr(t,e){if(t instanceof he&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(r=>{n&&!kr(r,e)&&(n=!1)}),n}function Yn(t){return{result:"success",value:t}}function st(t){return{result:"error",value:t}}function Is(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Es(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Ss(t){return!!t.expression&&t.expression.interpolated}function Ui(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&K(t)===He}class As{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new Fi,this._defaultValue=n?js(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,r,i,o,a){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=r,this._evaluator.canonical=i,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)}evaluate(e,n,r,i,o,a){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=r||null,this._evaluator.canonical=i,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=a||null;try{const s=this.expression.evaluate(this._evaluator);if(s==null||typeof s=="number"&&s!==s)return this._defaultValue;if(this._enumValues&&!(s in this._enumValues))throw new G(`Expected value to be one of ${Object.keys(this._enumValues).map(l=>JSON.stringify(l)).join(", ")}, but found ${JSON.stringify(s)} instead.`);return s}catch(s){return this._warningHistory[s.message]||(this._warningHistory[s.message]=!0,typeof console<"u"&&console.warn(s.message)),this._defaultValue}}}function $s(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in wn}function Vi(t,e){const n=new yn(wn,Yt,[],e?Fs(e):void 0),r=n.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return r?Yn(new As(r,e)):st(n.errors)}class Kr{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!wr(n.expression),this.globalStateRefs=kn(n.expression)}evaluateWithoutErrorHandling(e,n,r,i,o,a){return this._styleExpression.evaluateWithoutErrorHandling(e,n,r,i,o,a)}evaluate(e,n,r,i,o,a){return this._styleExpression.evaluate(e,n,r,i,o,a)}}class Qr{constructor(e,n,r,i){this.kind=e,this.zoomStops=r,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!wr(n.expression),this.globalStateRefs=kn(n.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,n,r,i,o,a){return this._styleExpression.evaluateWithoutErrorHandling(e,n,r,i,o,a)}evaluate(e,n,r,i,o,a){return this._styleExpression.evaluate(e,n,r,i,o,a)}interpolationFactor(e,n,r){return this.interpolationType?Ae.interpolationFactor(this.interpolationType,e,n,r):0}}function Ps(t,e){const n=Vi(t,e);if(n.result==="error")return n;const r=n.value.expression,i=xr(r);if(!i&&!Is(e))return st([new Ie("","data expressions not supported")]);const o=kr(r,["zoom"]);if(!o&&!Es(e))return st([new Ie("","zoom expressions not supported")]);const a=Vt(r);if(!a&&!o)return st([new Ie("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(a instanceof Ie)return st([a]);if(a instanceof Ae&&!Ss(e))return st([new Ie("",'"interpolate" expressions cannot be used with this property')]);if(!a)return Yn(i?new Kr("constant",n.value):new Kr("source",n.value));const s=a instanceof Ae?a.interpolation:void 0;return Yn(i?new Qr("camera",n.value,a.labels,s):new Qr("composite",n.value,a.labels,s))}function Vt(t){let e=null;if(t instanceof hn)e=Vt(t.result);else if(t instanceof Ct){for(const n of t.args)if(e=Vt(n),e)break}else(t instanceof bn||t instanceof Ae)&&t.input instanceof he&&t.input.name==="zoom"&&(e=t);return e instanceof Ie||t.eachChild(n=>{const r=Vt(n);r instanceof Ie?e=r:!e&&r?e=new Ie("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new Ie("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function kn(t,e=new Set){return t instanceof Pt&&e.add(t.key),t.eachChild(n=>{kn(n,e)}),e}function Fs(t){const e={color:Ee,string:$,number:y,enum:$,boolean:S,formatted:fn,padding:pn,numberArray:dn,colorArray:kt,projectionDefinition:un,resolvedImage:At,variableAnchorOffsetCollection:mn};return t.type==="array"?me(e[t.value]||E,t.length):e[t.type]}function js(t){if(t.type==="color"&&Ui(t.default))return new L(0,0,0,0);switch(t.type){case"color":return L.parse(t.default)||null;case"padding":return ke.parse(t.default)||null;case"numberArray":return ze.parse(t.default)||null;case"colorArray":return ye.parse(t.default)||null;case"variableAnchorOffsetCollection":return Se.parse(t.default)||null;case"projectionDefinition":return xe.parse(t.default)||null;default:return t.default===void 0?null:t.default}}function Bi(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Bi(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Rs={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function qs(t){if(t==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Bi(t)||(t=Kt(t));const e=Vi(t,Rs);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));{const n=Zi(t);return{filter:(r,i,o)=>e.value.evaluate(r,i,{},o),needGeometry:n,getGlobalStateRefs:()=>kn(e.value.expression)}}}function Ns(t,e){return t<e?-1:t>e?1:0}function Zi(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Zi(t[e]))return!0;return!1}function Kt(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?_n(t[1],t[2],"=="):e==="!="?Lt(_n(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?_n(t[1],t[2],e):e==="any"?_s(t.slice(1)):e==="all"?["all"].concat(t.slice(1).map(Kt)):e==="none"?["all"].concat(t.slice(1).map(Kt).map(Lt)):e==="in"?ei(t[1],t.slice(2)):e==="!in"?Lt(ei(t[1],t.slice(2))):e==="has"?ti(t[1]):e==="!has"?Lt(ti(t[1])):!0}function _n(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function _s(t){return["any"].concat(t.map(Kt))}function ei(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Ns)]]:["filter-in-small",t,["literal",e]]}}function ti(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Lt(t){return["!",t]}function Et(t){return typeof t=="object"?["literal",t]:t}function Ds(t,e){let n=t.stops;if(!n)return Ls(t,e);const r=n&&typeof n[0][0]=="object",i=r||t.property!==void 0,o=r||!i;return n=n.map(a=>!i&&e.tokens&&typeof a[1]=="string"?[a[0],Bs(a[1])]:[a[0],Et(a[1])]),r?Os(t,e,n):o?Vs(t,e,n):Kn(t,e,n)}function Ls(t,e){const n=["get",t.property];if(t.default===void 0)return e.type==="string"?["string",n]:n;if(e.type==="enum")return["match",n,Object.keys(e.values),n,t.default];{const r=[e.type==="color"?"to-color":e.type,n,Et(t.default)];return e.type==="array"&&r.splice(1,0,e.value,e.length||null),r}}function zr(t){switch(t.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function Os(t,e,n){const r={},i={},o=[];for(let s=0;s<n.length;s++){const l=n[s],u=l[0].zoom;r[u]===void 0&&(r[u]={zoom:u,type:t.type,property:t.property,default:t.default},i[u]=[],o.push(u)),i[u].push([l[0].value,l[1]])}if(Tr({},e)==="exponential"){const s=[zr(t),["linear"],["zoom"]];for(const l of o){const u=Kn(r[l],e,i[l]);ut(s,l,u,!1)}return s}else{const s=["step",["zoom"]];for(const l of o){const u=Kn(r[l],e,i[l]);ut(s,l,u,!0)}return Mr(s),s}}function Us(t,e){if(t!==void 0)return t;if(e!==void 0)return e}function ni(t,e){const n=Et(Us(t.default,e.default));return n===void 0&&e.type==="resolvedImage"?"":n}function Kn(t,e,n){const r=Tr(t,e),i=["get",t.property];if(r==="categorical"&&typeof n[0][0]=="boolean"){const o=["case"];for(const a of n)o.push(["==",i,a[0]],a[1]);return o.push(ni(t,e)),o}else if(r==="categorical"){const o=["match",i];for(const a of n)ut(o,a[0],a[1],!1);return o.push(ni(t,e)),o}else if(r==="interval"){const o=["step",["number",i]];for(const a of n)ut(o,a[0],a[1],!0);return Mr(o),t.default===void 0?o:["case",["==",["typeof",i],"number"],o,Et(t.default)]}else if(r==="exponential"){const o=t.base!==void 0?t.base:1,a=[zr(t),o===1?["linear"]:["exponential",o],["number",i]];for(const s of n)ut(a,s[0],s[1],!1);return t.default===void 0?a:["case",["==",["typeof",i],"number"],a,Et(t.default)]}else throw new Error(`Unknown property function type ${r}`)}function Vs(t,e,n,r=["zoom"]){const i=Tr(t,e);let o,a=!1;if(i==="interval")o=["step",r],a=!0;else if(i==="exponential"){const s=t.base!==void 0?t.base:1;o=[zr(t),s===1?["linear"]:["exponential",s],r]}else throw new Error(`Unknown zoom function type "${i}"`);for(const s of n)ut(o,s[0],s[1],a);return Mr(o),o}function Mr(t){t[0]==="step"&&t.length===3&&(t.push(0),t.push(t[3]))}function ut(t,e,n,r){t.length>3&&e===t[t.length-2]||(r&&t.length===2||t.push(e),t.push(n))}function Tr(t,e){return t.type?t.type:e.expression.interpolated?"exponential":"interval"}function Bs(t){const e=["concat"],n=/{([^{}]+)}/g;let r=0;for(let i=n.exec(t);i!==null;i=n.exec(t)){const o=t.slice(r,n.lastIndex-i[0].length);r=n.lastIndex,o.length>0&&e.push(o),e.push(["get",i[1]])}if(e.length===1)return t;if(r<t.length)e.push(t.slice(r));else if(e.length===2)return["to-string",e[1]];return e}const Zs=ha;var ri={thin:100,hairline:100,"ultra-light":200,"extra-light":200,light:300,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,"extra-bold":800,"ultra-bold":800,heavy:900,black:900,"heavy-black":900,fat:900,poster:900,"ultra-black":950,"extra-black":950},bt=" ",ii=/(italic|oblique)$/i,oi={};function Qn(t,e,n){var r=oi[t];if(!r){Array.isArray(t)||(t=[t]);for(var i=400,o="normal",a=[],s,l,u=0,c=t.length;u<c;++u){var f=t[u],d=f.split(" "),m=d[d.length-1].toLowerCase();m=="normal"||m=="italic"||m=="oblique"?(o=l?o:m,l=!0,d.pop(),m=d[d.length-1].toLowerCase()):ii.test(m)&&(m=m.replace(ii,""),o=l?o:d[d.length-1].replace(m,""),l=!0);for(var p in ri){var v=d.length>1?d[d.length-2].toLowerCase():"";if(m==p||m==p.replace("-","")||v+"-"+m==p){i=s?i:ri[p],d.pop(),v&&p.startsWith(v)&&d.pop();break}}!s&&typeof m=="number"&&(i=m,s=!0);var C=d.join(bt).replace("Klokantech Noto Sans","Noto Sans").replace("DIN Pro","Barlow").replace("Arial Unicode MS","Arial");C.indexOf(bt)!==-1&&(C='"'+C+'"'),a.push(C)}r=oi[t]=[o,i,a]}return r[0]+bt+r[1]+bt+e+"px"+(n?"/"+n:"")+bt+r[2]}const Wi="https://api.mapbox.com";function Cr(t){const e="mapbox://";return t.indexOf(e)!==0?"":t.slice(e.length)}function Ws(t,e,n){if(typeof t=="string")return[{id:"default",url:ai(t,e,n)}];for(const r of t)r.url=ai(r.url,e,n);return t}function ai(t,e,n){const r=Cr(t);if(!r)return decodeURI(new URL(t,n).href);const i="sprites/";if(r.indexOf(i)!==0)throw new Error(`unexpected sprites url: ${t}`);const o=r.slice(i.length);return`${Wi}/styles/v1/${o}/sprite?access_token=${e}`}function Qt(t,e){const n=Cr(t);if(!n)return decodeURI(new URL(t,location.href).href);const r="styles/";if(n.indexOf(r)!==0)throw new Error(`unexpected style url: ${t}`);const i=n.slice(r.length);return`${Wi}/styles/v1/${i}?&access_token=${e}`}const Js=["a","b","c","d"];function Bt(t,e,n,r){const i=new URL(t,r||location.href),o=Cr(t);if(!o)return e?(i.searchParams.has(n)||i.searchParams.set(n,e),[decodeURI(i.href)]):[decodeURI(i.href)];if(o==="mapbox.satellite"){const a=window.devicePixelRatio>=1.5?"@2x":"";return[`https://api.mapbox.com/v4/${o}/{z}/{x}/{y}${a}.webp?access_token=${e}`]}return Js.map(a=>`https://${a}.tiles.mapbox.com/v4/${o}/{z}/{x}/{y}.vector.pbf?access_token=${e}`)}const ue=Object.freeze({}),en={},si={};let Xs=0;function Ir(t){return t.id||(t.id=Xs++),t.id}function zn(t,e){return Ir(t)+"."+fo(e)}function Er(t){let e=en[t.id];return e||(e={},en[Ir(t)]=e),e}function Gs(){for(const t in en)delete en[t]}function Ji(t){let e=si[t.id];return e||(e={},si[Ir(t)]=e),e}function Dn(t){return t*Math.PI/180}const Me=(function(){const t=[];for(let e=78271.51696402048;t.length<=24;e/=2)t.push(e);return t})();function Mn(t,e){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(t,e);const n=document.createElement("canvas");return n.width=t,n.height=e,n}function tn(t,e){let n=0;const r=e.length;for(;n<r;++n)if(e[n]<t&&n+1<r){const o=e[n]/e[n+1];return n+Math.log(e[n]/t)/Math.log(o)}return r-1}function vt(t,e){const n=Math.floor(t),r=Math.pow(2,t-n);return e[n]/r}const ot={};function ft(t,e,n={},r){if(e in ot)return r&&(r.url=ot[e][0].url),ot[e][1];const i=n.transformRequest&&n.transformRequest(e,t)||e,o=function(l){return delete ot[e],Promise.reject(new Error("Error fetching source "+e))},a=function(l){return delete ot[e],l.ok?l.json():Promise.reject(new Error("Error fetching source "+e))},s=Zt(()=>i).then(l=>l instanceof Response?(r&&(r.url=l.url),a(l)):(l instanceof Request||(l=new Request(l)),l.headers.get("Accept")||l.headers.set("Accept","application/json"),r&&(r.url=l.url),fetch(l).then(a).catch(o))).catch(o);return ot[e]=[i,s],s}function Sr(t,e){if(typeof t=="string")if(t.trim().startsWith("{"))try{const n=JSON.parse(t);return Promise.resolve(n)}catch(n){return Promise.reject(n)}else return t=Qt(t,e.accessToken),ft("Style",t,e);else return Promise.resolve(t)}const li={};function Xi(t,e,n={}){const r=[e,JSON.stringify(t)].toString();let i=li[r];if(!i||n.transformRequest){let o;n.transformRequest&&(o=(s,l)=>{const u=n.transformRequest&&n.transformRequest(l,"Tiles")||l;if(s instanceof Co)s.setLoader((c,f,d)=>{const m=function(p){p.arrayBuffer().then(v=>{const R=s.getFormat().readFeatures(v,{extent:c,featureProjection:d});s.setFeatures(R)})};Zt(()=>u).then(p=>{if(p instanceof Response)return m(p);fetch(p).then(m).catch(v=>s.setState(jt.ERROR))}).catch(p=>s.setState(jt.ERROR))});else{const c=s.getImage();Zt(()=>u).then(f=>{if(typeof f=="string"){c.src=f;return}const d=m=>m.blob().then(p=>{const v=URL.createObjectURL(p);c.addEventListener("load",()=>URL.revokeObjectURL(v)),c.addEventListener("error",()=>URL.revokeObjectURL(v)),c.src=v});if(f instanceof Response)return d(f);fetch(f).then(d).catch(m=>s.setState(jt.ERROR))}).catch(f=>s.setState(jt.ERROR))}});const a=t.url;if(a&&!t.tiles){const s=Bt(a,n.accessToken,n.accessTokenParam||"access_token",e||location.href);if(a.startsWith("mapbox://"))i=Promise.resolve({tileJson:Object.assign({},t,{url:void 0,tiles:s}),tileLoadFunction:o});else{const l={};i=ft("Source",s[0],n,l).then(function(u){return u.tiles=u.tiles.map(function(c){return u.scheme==="tms"&&(c=c.replace("{y}","{-y}")),Bt(c,n.accessToken,n.accessTokenParam||"access_token",l.url)[0]}),Promise.resolve({tileJson:u,tileLoadFunction:o})})}}else t.tiles?(t=Object.assign({},t,{tiles:t.tiles.map(function(s){return t.scheme==="tms"&&(s=s.replace("{y}","{-y}")),Bt(s,n.accessToken,n.accessTokenParam||"access_token",e||location.href)[0]})}),i=Promise.resolve({tileJson:Object.assign({},t),tileLoadFunction:o})):i=Promise.reject(new Error("source has no `tiles` nor `url`"));li[r]=i}return i}function ui(t,e,n,r){const i=[2*n*e.pixelRatio+e.width,2*n*e.pixelRatio+e.height],o=Mn(i[0],i[1]),a=o.getContext("2d");a.drawImage(t,e.x,e.y,e.width,e.height,n*e.pixelRatio,n*e.pixelRatio,e.width,e.height);const s=a.getImageData(0,0,i[0],i[1]);a.globalCompositeOperation="destination-over",a.fillStyle=`rgba(${r.r*255},${r.g*255},${r.b*255},${r.a})`;const l=s.data;for(let u=0,c=s.width;u<c;++u)for(let f=0,d=s.height;f<d;++f){const m=(f*c+u)*4;l[m+3]>0&&a.arc(u,f,n*e.pixelRatio,0,2*Math.PI)}return a.fill(),o}function Hs(t,e,n){const r=Math.max(0,Math.min(1,(n-t)/(e-t)));return r*r*(3-2*r)}function ci(t,e,n){const r=Mn(e.width,e.height),i=r.getContext("2d");i.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const o=i.getImageData(0,0,e.width,e.height),a=o.data;for(let s=0,l=o.width;s<l;++s)for(let u=0,c=o.height;u<c;++u){const f=(u*l+s)*4,d=a[f+3]/255,m=.75,p=.1,v=Hs(m-p,m+p,d);v>0?(a[f+0]=Math.round(255*n.r*v),a[f+1]=Math.round(255*n.g*v),a[f+2]=Math.round(255*n.b*v),a[f+3]=Math.round(255*v)):a[f+3]=0}return i.putImageData(o,0,0),r}const Ys=Array(256).join("");function er(t,e){if(e>=.05){let n="";const r=t.split(`
`),i=Ys.slice(0,Math.round(e/.1));for(let o=0,a=r.length;o<a;++o)o>0&&(n+=`
`),n+=r[o].split("").join(i);return n}return t}let Ln;function Gi(){return Ln||(Ln=Mn(1,1).getContext("2d")),Ln}function Je(t,e){return Gi().measureText(t).width+(t.length-1)*e}const nn={};po.on("propertychange",()=>{for(const t in nn)delete nn[t]});function tr(t,e,n,r){if(t.indexOf(`
`)!==-1){const a=t.split(`
`),s=[];for(let l=0,u=a.length;l<u;++l)s.push(tr(a[l],e,n,r));return s.join(`
`)}const i=n+","+e+","+t+","+r;let o=nn[i];if(!o){const a=t.split(" ");if(a.length>1){const s=Gi();s.font=e;const u=s.measureText("M").width*n;let c="";const f=[];for(let d=0,m=a.length;d<m;++d){const p=a[d],v=c+(c?" ":"")+p;Je(v,r)<=u?c=v:(c&&f.push(c),c=p)}c&&f.push(c);for(let d=0,m=f.length;d<m&&m>1;++d){const p=f[d];if(Je(p,r)<u*.35){const v=d>0?Je(f[d-1],r):1/0,C=d<m-1?Je(f[d+1],r):1/0;f.splice(d,1),m-=1,v<C?(f[d-1]+=" "+p,d-=1):f[d]=p+" "+f[d]}}for(let d=0,m=f.length-1;d<m;++d){const p=f[d],v=f[d+1];if(Je(p,r)>u*.7&&Je(v,r)<u*.6){const C=p.split(" "),R=C.pop();Je(R,r)<u*.2&&(f[d]=C.join(" "),f[d+1]=R+" "+v),m-=1}}o=f.join(`
`)}else o=t;o=er(o,r),nn[i]=o}return o}const Ks=["Arial","Courier New","Times New Roman","Verdana","sans-serif","serif","monospace","cursive","fantasy"],fi={};function Qs(t,e="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){if(on)return t;let n;for(let r=0,i=t.length;r<i;++r){const o=t[r];if(o in fi)continue;fi[o]=!0;const s=Qn(o,16).split(" ");n||(n=[]),n.push([s.slice(3).join(" ").replace(/"/g,""),s[1],s[0]])}return n&&(async()=>{await document.fonts.ready;for(let r=0,i=n.length;r<i;++r){const o=n[r],a=o[0];if(Ks.includes(a))continue;const s=o[1],l=o[2];if(!(await document.fonts.load(`${l} ${s} 16px "${a}"`)).some(c=>c.family.replace(/^['"]|['"]$/g,"").toLowerCase()===a.toLowerCase()&&c.weight==s&&c.style===l)){const c=e.replace("{font-family}",a.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",a.replace(/ /g,"+")).replace("{fontweight}",s).replace("{-fontstyle}",l.replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",l);if(!document.querySelector('link[href="'+c+'"]')){const f=document.createElement("link");f.href=c,f.rel="stylesheet",document.head.appendChild(f)}}}})(),t}const el={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},tl={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},nl=function(t,e){const n=Ps(t,e);if(n.result==="error")throw new Error(n.value.map(r=>`${r.key}: ${r.message}`).join(", "));return n.value},pe={zoom:0,distanceFromCenter:0};he.register(wn,{...he.definitions,pitch:[{kind:"number"},[],t=>pe.pitch||90],"distance-from-center":[{kind:"number"},[],t=>pe.distanceFromCenter||0]});let Ot,On;function b(t,e,n,r,i,o){const a=t.id;i||(i={},console.warn("No functionCache provided to getValue()")),i[a]||(i[a]={});const s=i[a];if(!s[n]){let l=(t[e]||ue)[n];const u=Zs[`${e}_${t.type}`][n];l===void 0&&(l=u.default);let c=$s(l);if(!c&&Ui(l)&&(l=Ds(l,u),c=!0),c){const f=nl(l,u);s[n]=f.evaluate.bind(f)}else{const f=u.type;(f==="color"||f==="colorArray")&&(l=L.parse(l)),s[n]=function(){return l}}}return s[n](pe,r,o)}function pi(t,e,n,r){return b(t,"layout",`${n}-allow-overlap`,e,r)?b(t,"layout",`${n}-ignore-placement`,e,r)?"none":"obstacle":"declutter"}function rl(t,e,n,r){if(r||console.warn("No filterCache provided to evaluateFilter()"),!(t in r))try{r[t]=qs(e).filter}catch(i){console.warn("Filter will evaluate to false: "+i.message),r[t]=function(){return!1}}return r[t](pe,n)}let nr=!1;function au(t){t!==nr&&(Gs(),nr=t)}function Ue(t,e){if(t){if(!nr&&(t.a===0||e===0))return;const n=t.a;return e=e===void 0?1:e,n===0?"transparent":"rgba("+Math.round(t.r*255/n)+","+Math.round(t.g*255/n)+","+Math.round(t.b*255/n)+","+n*e+")"}return t}const il=/\{[^{}}]*\}/g;function Un(t,e){return t.replace(il,function(n){return e[n.slice(1,-1)]||""})}function di(t,e){let n=t.split(":")[0];return n===t&&(n="default"),e[n]}let Hi=!1;function su(t=!1){Hi=t}const Tn={};function Cn(t,e,n,r=Me,i=void 0,o=void 0,a=void 0,s=void 0){if(typeof e=="string"&&(e=JSON.parse(e)),e.version!=8)throw new Error("glStyle version 8 required.");Tn[zn(e,t)]=Array.from(arguments);const l={};(typeof o=="string"||o instanceof Request||o instanceof Response||o instanceof Promise)&&(o={default:o});for(const T in o){const A=o[T];Zt(()=>A).then(async z=>{let M;if(typeof Image<"u"){const I=new Image;if(typeof z=="string")I.crossOrigin="anonymous",I.src=z;else{let P;z instanceof Request?P=await fetch(z):z instanceof Response&&(P=z);const k=await P.blob();M=URL.createObjectURL(k),I.src=M}I.addEventListener("load",function P(){I.removeEventListener("load",P),l[T]={image:I,size:[I.width,I.height]},t.changed(),M&&URL.revokeObjectURL(M)}),I.addEventListener("error",function P(){URL.revokeObjectURL(M),I.removeEventListener("error",P)})}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){const I=self;I.postMessage({action:"loadImage",src:z}),I.addEventListener("message",function(k){k.data.action==="imageLoaded"&&k.data.src===z&&(l[T]={image:k.data.image,size:[k.data.image.width,k.data.image.height]})})}})}const u=ki(e.layers),c={},f=[],d={},m={},p=Er(e),v=Ji(e);let C;for(let T=0,A=u.length;T<A;++T){const z=u[T],M=z.id;if(typeof n=="string"&&z.source==n||Array.isArray(n)&&n.indexOf(M)!==-1){const I=z["source-layer"];if(C){if(z.source!==C)throw new Error(`Layer "${M}" does not use source "${C}`)}else{C=z.source;const k=e.sources[C];if(!k)throw new Error(`Source "${C}" is not defined`);const J=k.type;if(J!=="vector"&&J!=="geojson")throw new Error(`Source "${C}" is not of type "vector" or "geojson", but "${J}"`)}let P=c[I];P||(P=[],c[I]=P),P.push({layer:z,index:T}),f.push(M)}}const R=new Rt,q=new qt,N=[],U=function(T,A,z){const M=t.getSource?.()?.format_?.layerName_??"mvt:layer",I=T.getProperties(),P=c[I[M]];if(!P)return;let k=r.indexOf(A);k==-1&&(k=tn(A,r)),pe.zoom=k,pe.distanceFromCenter=0;const J=T.getGeometry(),V=el[J.getType()],Q=t.get("map");if(Q&&Q instanceof wt&&V===1){const ne=Q.getSize();if(ne){const ae=Q.getView().getCenter(),Pe=yi(J.getExtent());pe.distanceFromCenter=mo(ae,Pe)/A/ne[1]}}const x={id:T.getId(),properties:I,type:V},w=t.get("mapbox-featurestate")[T.getId()];let j=-1,ge;for(let ne=0,ae=P.length;ne<ae;++ne){const Pe=P[ne],h=Pe.layer,Fe=h.id;if(z!==void 0&&z!==Fe)continue;const _e=h.layout||ue,je=h.paint||ue;if(_e.visibility==="none"||"minzoom"in h&&k<h.minzoom||"maxzoom"in h&&k>=h.maxzoom)continue;const mt=h.filter;if(!mt||rl(Fe,mt,x,v)){ge=h;let re,se,Ze,Te,Re,g;const nt=Pe.index;if(V==3&&(h.type=="fill"||h.type=="fill-extrusion"))if(se=b(h,"paint",h.type+"-opacity",x,p,w),h.type+"-pattern"in je){const X=b(h,"paint",h.type+"-pattern",x,p,w);if(X){const Z=typeof X=="string"?Un(X,I):X.toString(),B=di(Z,l);if(i&&i[Z]&&B){++j,g=N[j],(!g||!g.getFill()||g.getStroke()||g.getText())&&(g=new it({fill:new qt}),N[j]=g),Ze=g.getFill(),g.setZIndex(nt);const O=Z+"."+se;let ee=m[O];if(!ee){const F=i[Z],D=Mn(F.width,F.height),te=D.getContext("2d");te.globalAlpha=se,te.drawImage(B.image,F.x,F.y,F.width,F.height,0,0,F.width,F.height),ee=te.createPattern(D,"repeat"),m[O]=ee}Ze.setColor(ee)}}}else re=Ue(b(h,"paint",h.type+"-color",x,p,w),se),h.type+"-outline-color"in je&&(Re=Ue(b(h,"paint",h.type+"-outline-color",x,p,w),se)),Re||(Re=re),(re||Re)&&(++j,g=N[j],(!g||re&&!g.getFill()||!re&&g.getFill()||Re&&!g.getStroke()||!Re&&g.getStroke()||g.getText())&&(g=new it({fill:re?new qt:void 0,stroke:Re?new Rt:void 0}),N[j]=g),re&&(Ze=g.getFill(),Ze.setColor(re)),Re&&(Te=g.getStroke(),Te.setColor(Re),Te.setWidth(.5)),g.setZIndex(nt));if(V!=1&&h.type=="line"){"line-pattern"in je?re=void 0:re=Ue(b(h,"paint","line-color",x,p,w),b(h,"paint","line-opacity",x,p,w));const X=b(h,"paint","line-width",x,p,w);re&&X>0&&(++j,g=N[j],(!g||!g.getStroke()||g.getFill()||g.getText())&&(g=new it({stroke:new Rt}),N[j]=g),Te=g.getStroke(),Te.setLineCap(b(h,"layout","line-cap",x,p,w)),Te.setLineJoin(b(h,"layout","line-join",x,p,w)),Te.setMiterLimit(b(h,"layout","line-miter-limit",x,p,w)),Te.setColor(re),Te.setWidth(X),Te.setLineDash(je["line-dasharray"]?b(h,"paint","line-dasharray",x,p,w).map(function(Z){return Z*X}):null),g.setZIndex(nt))}let Ft=!1,_=null,Fr=0,rt,ce,In;if((V==1||V==2)&&"icon-image"in _e){const X=b(h,"layout","icon-image",x,p,w);if(X){rt=typeof X=="string"?Un(X,I):X.toString();let Z;const B=s?s(t,rt):void 0,O=di(rt,l);if(i&&i[rt]&&O||B){const ee=b(h,"layout","icon-rotation-alignment",x,p,w);if(V==2){const F=T.getGeometry();if(F.getFlatMidpoint||F.getFlatMidpoints){const D=F.getExtent();if(Math.sqrt(Math.max(Math.pow((D[2]-D[0])/A,2),Math.pow((D[3]-D[1])/A,2)))>150){const oe=F.getType()==="MultiLineString"?F.getFlatMidpoints():F.getFlatMidpoint();if(On||(Ot=[NaN,NaN],On=new go("Point",Ot,[],2,{},void 0)),Z=On,Ot[0]=oe[0],Ot[1]=oe[1],b(h,"layout","symbol-placement",x,p,w)==="line"&&ee==="map"){const ve=F.getStride(),fe=F.getFlatCoordinates();for(let de=0,H=fe.length-ve;de<H;de+=ve){const le=fe[de],be=fe[de+1],Y=fe[de+ve],Le=fe[de+ve+1],so=Math.min(le,Y),lo=Math.max(le,Y),Sn=oe[0],uo=oe[1],co=(Le-be)*(Sn-le)-(Y-le)*(uo-be);if(Math.abs(co)<.001&&Sn<=lo&&Sn>=so){Fr=Math.atan2(be-Le,Y-le);break}}}}}}if(V!==2||Z){const F=b(h,"layout","icon-size",x,p,w),D=je["icon-color"]!==void 0?b(h,"paint","icon-color",x,p,w):null;if(!D||D.a!==0){const te=b(h,"paint","icon-halo-color",x,p,w),oe=b(h,"paint","icon-halo-width",x,p,w);let Ce=`${rt}.${F}.${oe}.${te}`;if(D!==null&&(Ce+=`.${D}`),ce=d[Ce],!ce){const ve=pi(h,x,"icon",p);let fe;"icon-offset"in _e&&(fe=b(h,"layout","icon-offset",x,p,w).slice(0),fe[0]*=F,fe[1]*=-F);let de=D?[D.r*255,D.g*255,D.b*255,D.a]:void 0;if(B){const H={color:de,rotateWithView:ee==="map",displacement:fe,declutterMode:ve,scale:F};typeof B=="string"?H.src=B:(H.img=B,H.imgSize=[B.width,B.height]),ce=new jr(H)}else{const H=i[rt];let le,be,Y;if(oe)H.sdf?(le=ui(ci(O.image,H,D||[0,0,0,1]),{x:0,y:0,width:H.width,height:H.height,pixelRatio:H.pixelRatio},oe,te),de=void 0):le=ui(O.image,H,oe,te);else{if(H.sdf&&!O.unSDFed){const Le=ci(O.image,{x:0,y:0,width:O.size[0],height:O.size[1]},{r:1,g:1,b:1});O.image=Le,O.unSDFed=!0}le=O.image,be=[H.width,H.height],Y=[H.x,H.y]}ce=new jr({color:de,img:le,imgSize:O.size,size:be,offset:Y,rotateWithView:ee==="map",scale:F/H.pixelRatio,displacement:fe,declutterMode:ve})}d[Ce]=ce}}ce&&(++j,g=N[j],(!g||!g.getImage()||g.getFill()||g.getStroke())&&(g=new it,N[j]=g),g.setGeometry(Z),ce.setRotation(Fr+Dn(b(h,"layout","icon-rotate",x,p,w))),ce.setOpacity(b(h,"paint","icon-opacity",x,p,w)),ce.setAnchor(tl[b(h,"layout","icon-anchor",x,p,w)]),g.setImage(ce),_=g.getText(),g.setText(void 0),g.setZIndex(nt),Ft=!0,In=!1)}else In=!0}}}if(V==1&&h.type==="circle"){++j,g=N[j],(!g||!g.getImage()||g.getFill()||g.getStroke())&&(g=new it,N[j]=g);const X="circle-radius"in je?b(h,"paint","circle-radius",x,p,w):5,Z=Ue(b(h,"paint","circle-stroke-color",x,p,w),b(h,"paint","circle-stroke-opacity",x,p,w)),B=b(h,"paint","circle-translate",x,p,w),O=Ue(b(h,"paint","circle-color",x,p,w),b(h,"paint","circle-opacity",x,p,w)),ee=b(h,"paint","circle-stroke-width",x,p,w),F=X+"."+Z+"."+O+"."+ee+"."+B[0]+"."+B[1];ce=d[F],ce||(ce=new yo({radius:X,displacement:[B[0],-B[1]],stroke:Z&&ee>0?new Rt({width:ee,color:Z}):void 0,fill:O?new qt({color:O}):void 0,declutterMode:"none"}),d[F]=ce),g.setImage(ce),_=g.getText(),g.setText(void 0),g.setGeometry(void 0),g.setZIndex(nt),Ft=!0}let ie,yt,ht,De,gt,En;if("text-field"in _e){De=Math.round(b(h,"layout","text-size",x,p,w));const X=b(h,"layout","text-font",x,p,w);ht=b(h,"layout","text-line-height",x,p,w),yt=Qn(a?a(X,e.metadata?e.metadata["ol:webfonts"]:void 0):X,De,ht),yt.includes("sans-serif")||(yt+=",sans-serif"),gt=b(h,"layout","text-letter-spacing",x,p,w),En=b(h,"layout","text-max-width",x,p,w);const Z=b(h,"layout","text-field",x,p,w);typeof Z=="object"&&Z.sections?Z.sections.length===1?ie=Z.toString():ie=Z.sections.reduce((B,O,ee)=>{const F=O.fontStack?O.fontStack.split(","):X,D=Qn(a?a(F):F,De*(O.scale||1),ht);let te=O.text;if(te===`
`)return B.push(`
`,""),B;if(V==2)return B.push(er(te,gt),D),B;te=tr(te,D,En,gt).split(`
`);for(let oe=0,Ce=te.length;oe<Ce;++oe)oe>0&&B.push(`
`,""),B.push(te[oe],D);return B},[]):ie=Un(Z,I).trim(),se=b(h,"paint","text-opacity",x,p,w)}if(ie&&se&&!In){Ft||(++j,g=N[j],(!g||!g.getText()||g.getFill()||g.getStroke())&&(g=new it,N[j]=g),g.setImage(void 0),g.setGeometry(void 0));const X=pi(h,x,"text",p);g.getText()||g.setText(_),_=g.getText(),(!_||"getDeclutterMode"in _&&_.getDeclutterMode()!==X)&&(_=new ho({padding:[2,2,2,2],declutterMode:X}),g.setText(_));const Z=b(h,"layout","text-transform",x,p,w);Z=="uppercase"?ie=Array.isArray(ie)?ie.map((Y,Le)=>Le%2?Y:Y.toUpperCase()):ie.toUpperCase():Z=="lowercase"&&(ie=Array.isArray(ie)?ie.map((Y,Le)=>Le%2?Y:Y.toLowerCase()):ie.toLowerCase());const B=Array.isArray(ie)?ie:V==2?er(ie,gt):tr(ie,yt,En,gt);if(_.setText(B),_.setFont(yt),_.setRotation(Dn(b(h,"layout","text-rotate",x,p,w))),typeof _.setKeepUpright=="function"){const Y=b(h,"layout","text-keep-upright",x,p,w);_.setKeepUpright(Y)}const O=b(h,"layout","text-anchor",x,p,w),ee=Ft||V==1?"point":b(h,"layout","symbol-placement",x,p,w);let F;if(ee==="line-center"?(_.setPlacement("line"),F="center"):_.setPlacement(ee),ee==="line"&&typeof _.setRepeat=="function"){const Y=b(h,"layout","symbol-spacing",x,p,w);_.setRepeat(Y*2)}_.setOverflow(ee==="point");let D=b(h,"paint","text-halo-width",x,p,w);const te=b(h,"layout","text-offset",x,p,w),oe=b(h,"paint","text-translate",x,p,w);let Ce=0,ve=0;if(ee=="point"){F="center",O.indexOf("left")!==-1?(F="left",ve=D):O.indexOf("right")!==-1&&(F="right",ve=-D);const Y=b(h,"layout","text-rotation-alignment",x,p,w);_.setRotateWithView(Y=="map")}else _.setMaxAngle(Dn(b(h,"layout","text-max-angle",x,p,w))*ie.length/B.length),_.setRotateWithView(!1);_.setTextAlign(F);let fe="middle";O.indexOf("bottom")==0?(fe="bottom",Ce=-D-.5*(ht-1)*De):O.indexOf("top")==0&&(fe="top",Ce=D+.5*(ht-1)*De),_.setTextBaseline(fe);const de=b(h,"layout","text-justify",x,p,w);_.setJustify(de==="auto"?void 0:de),_.setOffsetX(te[0]*De+ve+oe[0]),_.setOffsetY(te[1]*De+Ce+oe[1]),q.setColor(Ue(b(h,"paint","text-color",x,p,w),se)),_.setFill(q);const H=Ue(b(h,"paint","text-halo-color",x,p,w),se);if(H&&D>0){R.setColor(H),D*=2;const Y=.5*De;R.setWidth(D<=Y?D:Y),_.setStroke(R)}else _.setStroke(void 0);const le=b(h,"layout","text-padding",x,p,w),be=_.getPadding();le!==be[0]&&(be[0]=le,be[1]=le,be[2]=le,be[3]=le),g.setZIndex(nt)}}}if(j>-1)return N.length=j+1,Hi&&("set"in T?T.set("mapbox-layer",ge):T.getProperties()["mapbox-layer"]=ge),N};return t.setStyle(U),t.set("mapbox-layers",f),t.set("mapbox-source",C),t.set("mapbox-featurestate",t.get("mapbox-featurestate")||{}),U}function lu(t,e,n,r){const i=n.getStyleFunction();if(i.length===3)return i(t,e,r)}function ol(t,e){const n=t[0],r=n.width,i=n.height,o=n.data,a=new Uint8ClampedArray(o.length),s=e.resolution*2,l=r-1,u=i-1,c=[0,0,0,0],f=2*Math.PI,d=Math.PI/2,m=Math.PI*e.sunEl/180,p=Math.PI*e.sunAz/180,v=Math.cos(m),C=Math.sin(m),R=e.highlightColor,q=e.shadowColor,N=e.accentColor,U=e.encoding;let T,A,z,M,I,P,k,J,V,Q,x,w,j,ge,ne,ae,Pe,h,Fe,_e,je,mt;function re(se,Ze="mapbox"){if(Ze==="mapbox")return(se[0]*256*256+se[1]*256+se[2])*.1-1e4;if(Ze==="terrarium")return se[0]*256+se[1]+se[2]/256-32768}for(A=0;A<=u;++A)for(I=A===0?0:A-1,P=A===u?u:A+1,T=0;T<=l;++T)z=T===0?0:T-1,M=T===l?l:T+1,k=(A*r+z)*4,c[0]=o[k],c[1]=o[k+1],c[2]=o[k+2],c[3]=o[k+3],J=e.vert*re(c,U),k=(A*r+M)*4,c[0]=o[k],c[1]=o[k+1],c[2]=o[k+2],c[3]=o[k+3],V=e.vert*re(c,U),Q=(V-J)/s,k=(I*r+T)*4,c[0]=o[k],c[1]=o[k+1],c[2]=o[k+2],c[3]=o[k+3],J=e.vert*re(c,U),k=(P*r+T)*4,c[0]=o[k],c[1]=o[k+1],c[2]=o[k+2],c[3]=o[k+3],V=e.vert*re(c,U),x=(V-J)/s,j=Math.atan2(x,-Q),j<0?j=d-j:j>d?j=f-j+d:j=d-j,w=Math.atan(Math.sqrt(Q*Q+x*x)),mt=C*Math.cos(w)+v*Math.sin(w)*Math.cos(p-j),ge=Math.cos(w),ne=255*mt,Fe=Math.min(Math.max(2*e.sunEl,0),1),_e=1.875-e.opacity*1.75,je=e.opacity!==.5?d*((Math.pow(_e,w)-1)/(Math.pow(_e,d)-1)):w,Pe={r:(1-ge)*N.r*Fe*255,g:(1-ge)*N.g*Fe*255,b:(1-ge)*N.b*Fe*255,a:(1-ge)*N.a*Fe*255},ae=Math.abs(((j+p)/Math.PI+.5)%2-1),h={r:(R.r*(1-ae)+q.r*ae)*ne,g:(R.g*(1-ae)+q.g*ae)*ne,b:(R.b*(1-ae)+q.b*ae)*ne,a:(R.a*(1-ae)+q.a*ae)*ne},k=(A*r+T)*4,a[k]=Pe.r*(1-ae)+h.r,a[k+1]=Pe.g*(1-ae)+h.g,a[k+2]=Pe.b*(1-ae)+h.b,a[k+3]=o[k+3]*e.opacity*Fe*Math.sin(je);return new ImageData(a,r,i)}function al(t,e){const n=t[0],r=n.width,i=n.height,o=n.data,a=new Uint8ClampedArray(o.length),s=r-1,l=i-1,u=[0,0,0,0];let c,f,d;function m(M){return M>0?1/(1-M):1+M}function p(M){return M>0?1-1/(1.001-M):-M}function v(M){M*=Math.PI/180;const I=Math.sin(M),P=Math.cos(M);return[(2*P+1)/3,(-Math.sqrt(3)*I-P+1)/3,(Math.sqrt(3)*I-P+1)/3]}const C=p(e.saturation),R=m(e.contrast),q=v(e.hueRotate),N=q,U=[q[2],q[0],q[1]],T=[q[1],q[2],q[0]],A=e.brightnessLow,z=e.brightnessHigh;for(f=0;f<=l;++f)for(c=0;c<=s;++c){d=(f*r+c)*4,u[0]=o[d],u[1]=o[d+1],u[2]=o[d+2],u[3]=o[d+3];const M=u[0],I=u[1],P=u[2],k=(w,j)=>{let ge=0;for(let ne=0;ne<w.length;ne++)ge+=w[ne]*j[ne];return ge};let J=k([M,I,P],N),V=k([M,I,P],U),Q=k([M,I,P],T);const x=(J+V+Q)/3;J+=(x-J)*C,V+=(x-V)*C,Q+=(x-Q)*C,J=(J-.5)*R+.5,V=(V-.5)*R+.5,Q=(Q-.5)*R+.5,J=A*(255-J)+z*J,V=A*(255-V)+z*V,Q=A*(255-Q)+z*Q,a[d]=J,a[d+1]=V,a[d+2]=Q,a[d+3]=u[3]}return new ImageData(a,r,i)}function sl(t,e=512){return t.getExtent()?So({extent:t.getExtent(),tileSize:e,maxZoom:22}).getResolutions():Me}function Yi(t,e){return e.accessToken||(e=Object.assign({},e),new URL(t).searchParams.forEach((r,i)=>{e.accessToken=r,e.accessTokenParam=i})),e}function Ki(t,e,n="",r={},i=void 0){let o,a,s,l,u=!0;return typeof n!="string"&&!Array.isArray(n)?(s=n,l=s.source||s.layers,r=s):l=n,typeof r=="string"?(o=r,s={}):(o=r.styleUrl,s=r),s.updateSource===!1&&(u=!1),i||(i=s.resolutions),!o&&typeof e=="string"&&!e.trim().startsWith("{")&&(o=e),o&&(o=o.startsWith("data:")?location.href:Qt(o,s.accessToken),s=Yi(o,s)),new Promise(function(c,f){Sr(e,s).then(function(d){if(d.version!=8)return f(new Error("glStyle version 8 required."));if(!(t instanceof an||t instanceof Ge))return f(new Error("Can only apply to VectorLayer or VectorTileLayer"));const m=t instanceof Ge?"vector":"geojson";if(l?Array.isArray(l)?a=d.layers.find(function(U){return U.id===l[0]}).source:a=l:(a=d.layers.find(function(U){return U.source&&d.sources[U.source].type===m}).source,l=a),!a)return f(new Error(`No ${m} source found in the glStyle.`));function p(){if(!u)return Promise.resolve();if(t instanceof Ge)return Ar(d.sources[a],o,s).then(function(z){const M=t.getSource();M?z!==M&&(M.setTileUrlFunction(z.getTileUrlFunction()),typeof M.setUrls=="function"&&typeof z.getUrls=="function"&&M.setUrls(z.getUrls()),M.format_||(M.format_=z.format_),M.getAttributions()||M.setAttributions(z.getAttributions()),M.getTileLoadFunction()===Io&&M.setTileLoadFunction(z.getTileLoadFunction()),wo(M.getProjection(),z.getProjection())&&(M.tileGrid=z.getTileGrid())):t.setSource(z);const I=t.getSource().getTileGrid();!isFinite(t.getMaxResolution())&&!isFinite(t.getMinZoom())&&I.getMinZoom()>0&&t.setMaxResolution(vt(Math.max(0,I.getMinZoom()-1e-12),I.getResolutions()))});const U=d.sources[a];let T=t.getSource();(!T||T.get("mapbox-source")!==U)&&(T=Pr(U,o,s));const A=t.getSource();return A?T!==A&&(A.getAttributions()||A.setAttributions(T.getAttributions()),A.format_||(A.format_=T.getFormat()),A.url_=T.getUrl()):t.setSource(T),Promise.resolve()}let v,C;const R={},q={};function N(){if(!C&&(!d.sprite||R)){if(s.projection&&!i){const z=St(s.projection).getUnits();z!=="m"&&(i=Me.map(M=>M/Vn[z]))}let U;const T=t.getSource();T instanceof sn&&T.format_ instanceof rr&&(U=T.format_.layerName_),C=Cn(t,d,l,i,R,q,(A,z=s.webfonts)=>Qs(A,z),s.getImage,U),t.getStyle()?p().then(c).catch(f):f(new Error(`Nothing to show for source [${a}]`))}else C?(t.setStyle(C),p().then(c).catch(f)):f(new Error("Something went wrong trying to apply style."))}if(d.sprite){const U=Ws(d.sprite,s.accessToken,o||location.href);v=on?1:window.devicePixelRatio>=1.5?.5:1;const T=v==.5?"@2x":"";Promise.all(U.map(function(A){const z=new URL(A.url);let M=z.origin+z.pathname+T+".json"+z.search;return new Promise(function(I,P){ft("Sprite",M,s).then(I).catch(function(k){M=z.origin+z.pathname+".json"+z.search,ft("Sprite",M,s).then(I).catch(P)})}).then(function(I){I===void 0&&f(new Error("No sprites found."));let P;if(P=z.origin+z.pathname+T+".png"+z.search,s.transformRequest){const k=s.transformRequest(P,"SpriteImage")||P;(k instanceof Request||k instanceof Promise)&&(P=k)}q[A.id]=P;for(const k in I){const J=A.id=="default"?k:`${A.id}:${k}`;R[J]=I[k]}}).catch(function(I){f(new Error(`Sprites cannot be loaded: ${M}: ${I.message}`))})})).then(N).catch(f)}else N()}).catch(f)})}function ll(t,e,n){e.layers.some(function(r){if(r.type==="background"){if(t instanceof gi)return t.setBackground(function(i){return to(r,i,n,{})}),!0;if(t instanceof wt||t instanceof hi)return t.getLayers().insertAt(0,no(r,n,{})),!0}})}function ul(t,e,n={}){return Sr(e,n).then(function(r){ll(t,r,n)})}function Qi(t,e){let n;return t.some(function(r){if(r.id==e)return n=r.source,!0}),n}function cl(t,e){const n=t.bounds;if(n){const r=Bn([n[0],n[1]],e),i=Bn([n[2],n[3]],e);return[r[0],r[1],i[0],i[1]]}return St(e).getExtent()}function eo(t,e,n){const r=new wi({tileJSON:e,tileSize:t.tileSize||e.tileSize||512}),i=r.getTileJSON(),o=r.getTileGrid(),a=St(n.projection||"EPSG:3857"),s=cl(i,a),l=a.getExtent(),u=i.minzoom||0,c=i.maxzoom||22,f={attributions:r.getAttributions(),projection:a,tileGrid:new Eo({origin:l?zo(l):o.getOrigin(0),extent:s||o.getExtent(),minZoom:u,resolutions:sl(a,e.tileSize).slice(0,c+1),tileSize:o.getTileSize(0)})};return Array.isArray(i.tiles)?f.urls=i.tiles:f.url=i.tiles,f}function to(t,e,n,r){const i={id:t.id,type:t.type},o=t.layout||{},a=t.paint||{};i.paint=a,pe.zoom=tn(e,n.resolutions||Me),pe.distanceFromCenter=0;let s;const l=b(i,"paint","background-color",ue,r);return a["background-opacity"]!==void 0&&(s=b(i,"paint","background-opacity",ue,r)),o.visibility=="none"?void 0:Ue(l,s)}function no(t,e,n){const r=on?{style:{}}:document.createElement("div");return r.className="ol-mapbox-style-background",r.style.position="absolute",r.style.width="100%",r.style.height="100%",new gi({source:new ko({}),render(i){const o=to(t,i.viewState.resolution,e,n);return r.style.backgroundColor=o,r}})}function Ar(t,e,n){return new Promise(function(r,i){Xi(t,e,n).then(function({tileJson:o,tileLoadFunction:a}){const s=eo(t,o,n);s.tileLoadFunction=a,s.format=new rr({layerName:"mvt:layer"});const l=new sn(s);l.set("mapbox-source",t),r(l)}).catch(i)})}function fl(t,e,n){const r=new Ge({declutter:!0,visible:!1});return Ar(t,e,n).then(function(i){r.setSource(i)}).catch(function(i){r.setSource(void 0)}),r}function ro(t){return`{bbox-${(t?t.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function io(t,e,n){return new Promise(function(r,i){Xi(t,e,n).then(function({tileJson:o,tileLoadFunction:a}){const s=new wi({interpolate:n.interpolate===void 0?!0:n.interpolate,transition:0,crossOrigin:"anonymous",tileJSON:o});s.tileGrid=eo(t,o,n).tileGrid,n.projection&&(s.projection=St(n.projection));const l=s.getTileUrlFunction();a&&s.setTileLoadFunction(a),s.setTileUrlFunction(function(u,c,f){const d=ro(f);let m=l(u,c,f);if(m.indexOf(d)!=-1){const p=s.getTileGrid().getTileCoordExtent(u);m=m.replace(d,p.toString())}return m}),s.set("mapbox-source",t),r(s)}).catch(function(o){i(o)})})}function $r(t,e,n){const r=new vi;return io(t,e,n).then(function(i){r.setSource(i)}).catch(function(){r.setSource(void 0)}),r}function pl(t,e,n){const r=$r(t,e,n);return new bi({source:new xi({operationType:"image",operation:al,sources:[r]})})}function dl(t,e,n){const r=$r(t,e,n);return new bi({source:new xi({operationType:"image",operation:ol,sources:[r]})})}function Pr(t,e,n){const r=n.projection?new Rr({dataProjection:n.projection}):new Rr,i=t.data,o={};if(typeof i=="string"){const[s]=Bt(i,n.accessToken,n.accessTokenParam||"access_token",e||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(s)){const u=(f,d,m)=>{const p=ro(m);return s.replace(p,`${f.join(",")}`)},c=new Ut({attributions:t.attribution,format:r,loader:(f,d,m,p,v)=>{const C=typeof u=="function"?u(f,d,m):u;ft("GeoJSON",C,n).then(R=>{const q=c.getFormat().readFeatures(R,{featureProjection:m});c.addFeatures(q),p(q)}).catch(R=>{c.removeLoadedExtent(f),v()})},strategy:xo});return c.set("mapbox-source",t),c}const l=new Ut({attributions:t.attribution,format:r,url:s,loader:(u,c,f,d,m)=>{ft("GeoJSON",s,n).then(p=>{const v=l.getFormat().readFeatures(p,{featureProjection:f});l.addFeatures(v),d(v)}).catch(p=>{l.removeLoadedExtent(u),m()})}});return l}o.features=r.readFeatures(i,{featureProjection:"EPSG:3857"});const a=new Ut(Object.assign({attributions:t.attribution,format:r},o));return a.set("mapbox-source",t),a}function ml(t,e,n){return new an({declutter:!0,source:Pr(t,e,n),visible:!1})}function yl(t,e,n){let r=null;return function(i){t.paint&&"raster-opacity"in t.paint&&i.frameState.viewState.zoom!==r&&(r=i.frameState.viewState.zoom,delete n[t.id],hl(t,e,r,n))}}function hl(t,e,n,r){pe.zoom=n,pe.distanceFromCenter=0;const i=b(t,"paint","raster-opacity",ue,r);e.setOpacity(i)}function gl(t,e){function n(){const r=e.get("mapbox-style");if(!r)return;const i=ki(r.layers),o=t.get("mapbox-layers"),a=i.filter(function(s){return o.includes(s.id)}).some(function(s){return!s.layout||!s.layout.visibility||s.layout.visibility==="visible"});t.get("visible")!==a&&t.setVisible(a)}t.on("change",n),n()}function oo(t,e,n,r){const i=Er(t),o=t.layers,a=n.type,s=n.source||Qi(o,n.ref),l=t.sources[s];let u;if(a=="background")u=no(n,r,i);else if(l.type=="vector")u=fl(l,e,r);else if(l.type=="raster"){const f=["raster-saturation","raster-contrast","raster-brightness-max","raster-brightness-min","raster-hue-rotate"];!!Object.keys(n.paint||{}).find(m=>f.includes(m))?(u=pl(l,e,r),u.getSource().on("beforeoperations",function(m){pe.zoom=tn(m.resolution,r.resolutions||Me),pe.distanceFromCenter=0;const p=m.data;p.saturation=b(n,"paint","raster-saturation",ue,i),p.contrast=b(n,"paint","raster-contrast",ue,i),p.brightnessHigh=b(n,"paint","raster-brightness-max",ue,i),p.brightnessLow=b(n,"paint","raster-brightness-min",ue,i),p.hueRotate=b(n,"paint","raster-hue-rotate",ue,i)})):u=$r(l,e,r),u.setVisible(n.layout?n.layout.visibility!=="none":!0),u.on("prerender",yl(n,u,i))}else if(l.type=="geojson")u=ml(l,e,r);else if(l.type=="raster-dem"&&n.type=="hillshade"){const f=dl(l,e,r);u=f,f.getSource().on("beforeoperations",function(d){const m=d.data;m.resolution=bo(r.projection||"EPSG:3857",d.resolution,yi(d.extent),"m"),pe.zoom=tn(d.resolution,r.resolutions||Me),pe.distanceFromCenter=0,m.encoding=l.encoding,m.vert=5*b(n,"paint","hillshade-exaggeration",ue,i),m.sunAz=b(n,"paint","hillshade-illumination-direction",ue,i),m.sunEl=35,m.opacity=.3,m.highlightColor=b(n,"paint","hillshade-highlight-color",ue,i),m.shadowColor=b(n,"paint","hillshade-shadow-color",ue,i),m.accentColor=b(n,"paint","hillshade-accent-color",ue,i)}),u.setVisible(n.layout?n.layout.visibility!=="none":!0)}const c=s;return u&&u.set("mapbox-source",c),u}function mi(t,e,n,r){const i=[];let o=null;if(e instanceof wt){if(o=e.getView(),!o.isDef()&&!o.getRotation()&&!o.getResolutions()){const f=r.projection?St(r.projection):o.getProjection();o=new vo(Object.assign(o.getProperties(),{maxResolution:Me[0]/Vn[f.getUnits()],projection:r.projection||o.getProjection()})),e.setView(o)}"center"in t&&!o.getCenter()&&o.setCenter(Bn(t.center,o.getProjection())),"zoom"in t&&o.getZoom()===void 0&&o.setResolution(Me[0]/Vn[o.getProjection().getUnits()]/Math.pow(2,t.zoom)),(!o.getCenter()||o.getZoom()===void 0)&&o.fit(o.getProjection().getExtent(),{nearest:!0,size:e.getSize()})}e.set("mapbox-style",t),e.set("mapbox-metadata",{styleUrl:n,options:r});const a=t.layers;let s=[],l,u,c;for(let f=0,d=a.length;f<d;++f){const m=a[f],p=m.type;if(p=="heatmap"){console.debug(`layers[${f}].type "${p}" not supported`);continue}else c=m.source||Qi(a,m.ref),(!c||c!=u)&&(s.length&&(i.push(rn(l,s,t,n,e,r)),s=[]),l=oo(t,n,m,r),l instanceof an||l instanceof Ge||(s=[]),u=l.get("mapbox-source")),s.push(m.id)}return i.push(rn(l,s,t,n,e,r)),Promise.all(i)}function uu(t,e,n={}){let r,i;if(on){if(!(t instanceof wt)&&!(t instanceof hi))throw new Error("ol-mapbox-style in a web worker requires a Map or a LayerGroup as first argument");i=t}else typeof t=="string"||t instanceof HTMLElement?i=new wt({target:t}):i=t;if(typeof e=="string"){const o=e.startsWith("data:")?location.href:Qt(e,n.accessToken);n=Yi(o,n),r=new Promise(function(a,s){Sr(e,n).then(function(l){mi(l,i,o,n).then(function(){a(i)}).catch(s)}).catch(function(l){s(new Error(`Could not load ${e}: ${l.message}`))})})}else r=new Promise(function(o,a){mi(e,i,!n.styleUrl||n.styleUrl.startsWith("data:")?location.href:Qt(n.styleUrl,n.accessToken),n).then(function(){o(i)}).catch(a)});return r}function rn(t,e,n,r,i,o={}){let a=24,s=0;const l=n.layers;for(let u=0,c=l.length;u<c;++u){const f=l[u];e.indexOf(f.id)!==-1&&(a=Math.min("minzoom"in f?f.minzoom:0,a),s=Math.max("maxzoom"in f?f.maxzoom:24,s))}return new Promise(function(u,c){const f=function(){const m=t.getSource();if(!m||m.getState()==="error"){c(new Error("Error accessing data for source "+t.get("mapbox-source")));return}if("getTileGrid"in m){const p=m.getTileGrid();if(p){const v=p.getMinZoom();(a>0||v>0)&&t.setMaxResolution(Math.min(vt(Math.max(0,a-1e-12),Me),vt(Math.max(0,v-1e-12),p.getResolutions()))),s<24&&t.setMinResolution(vt(s,Me))}}else a>0&&t.setMaxResolution(vt(Math.max(0,a-1e-12),Me));m instanceof Ut||m instanceof sn?Ki(t,n,e,Object.assign({styleUrl:r},o)).then(function(){gl(t,i),u()}).catch(c):u()};t.set("mapbox-layers",e);const d=i.getLayers();d.getArray().indexOf(t)===-1&&d.push(t),t.getSource()?f():t.once("change:source",f)})}function bl(t,e){return t.get("mapbox-style").layers.find(function(i){return i.id===e})}function cu(t,e,n){const r=t.get("mapbox-style"),i=r.layers;let o,a=-1;if(n!==void 0){const c=bl(t,n);if(c===void 0)throw new Error(`Layer with id "${n}" not found.`);o=i.indexOf(c)}else o=i.length;let s;if(o>0&&i[o-1].source===e.source?(a=o-1,s=-1):o<i.length&&i[o].source===e.source&&(a=o,s=0),a===-1){const{options:c,styleUrl:f}=t.get("mapbox-metadata"),d=oo(r,f,e,c);if(n){const m=tt(t,n),p=t.getLayers().getArray().indexOf(m);t.getLayers().insertAt(p,d)}return i.splice(o,0,e),rn(d,[e.id],r,f,t,c)}if(i.some(c=>c.id===e.id))throw new Error(`Layer with id "${e.id}" already exists.`);const l=i[a].id,u=Tn[zn(t.get("mapbox-style"),tt(t,l))];if(i.splice(o,0,e),u){const[c,f,d,m,p,v,C,R]=u;if(Array.isArray(d)){const q=d.indexOf(l)+s;d.splice(q,0,e.id)}Cn(c,f,d,m,p,v,C,R)}else tt(t,i[a].id).changed();return Promise.resolve()}function fu(t,e){const n=t.get("mapbox-style"),r=n.layers,i=r.findIndex(function(c){return c.id===e.id});if(i===-1)throw new Error(`Layer with id "${e.id}" not found.`);if(r[i].source!==e.source)throw new Error("Updated layer and previous version must use the same source.");delete Er(n)[e.id],delete Ji(n)[e.id],r[i]=e;const a=Tn[zn(t.get("mapbox-style"),tt(t,e.id))];if(a)return Cn.apply(void 0,a),Promise.resolve();const s=tt(t,e.id),{options:l,styleUrl:u}=t.get("mapbox-metadata");return rn(s,[e.id],n,u,t,l)}function pu(t,e,n){const r=vl(t,e),i=t.getLayers().getArray().filter(function(s){return(s instanceof an||s instanceof vi||s instanceof Ge)&&s.getSource()===r}),o=t.get("mapbox-metadata");let a;switch(n.type){case"vector":a=Ar(n,o.styleUrl,o.options);break;case"geojson":a=Promise.resolve(Pr(n,o.styleUrl,o.options));break;case"raster":case"raster-dem":a=io(n,o.styleUrl,o.options);break;default:return Promise.reject(new Error("Unsupported source type "+n.type))}return a.then(function(s){i.forEach(function(l){l.setSource(s)})}),a}function du(t,e){const n=typeof e=="string"?e:e.id,r=tt(t,n),i=r.get("mapbox-layers");if(i.length===1)throw new Error("Cannot remove last Mapbox layer from an OpenLayers layer.");i.splice(i.indexOf(n),1);const o=t.get("mapbox-style"),a=o.layers;a.splice(a.findIndex(l=>l.id===n),1);const s=Tn[zn(o,r)];if(s){const[l,u,c,f,d,m,p,v]=s;Array.isArray(c)&&c.splice(c.findIndex(C=>C===n),1),Cn(l,u,c,f,d,m,p,v)}else tt(t,n).changed()}function tt(t,e){const n=t.getLayers().getArray();for(let r=0,i=n.length;r<i;++r){const o=n[r].get("mapbox-layers");if(o&&o.indexOf(e)!==-1)return n[r]}}function ao(t,e){const n=[],r=t.getLayers().getArray();for(let i=0,o=r.length;i<o;++i)r[i].get("mapbox-source")===e&&n.push(r[i]);return n}function vl(t,e){const n=t.getLayers().getArray();for(let r=0,i=n.length;r<i;++r){const o=n[r].getSource();if(n[r].get("mapbox-source")===e)return o}}function mu(t,e,n){const r="getLayers"in t?ao(t,e.source):[t];for(let i=0,o=r.length;i<o;++i){const a=r[i].get("mapbox-featurestate");if(a)n?a[e.id]=n:delete a[e.id],r[i].changed();else throw new Error(`Map or layer for source "${e.source}" not found.`)}}function yu(t,e){const n="getLayers"in t?ao(t,e.source):[t];for(let r=0,i=n.length;r<i;++r){const o=n[r].get("mapbox-featurestate");if(o&&o[e.id])return o[e.id]}}class xl extends Mo{constructor(e){super(To.ERROR),this.error=e}}class hu extends Ge{constructor(e){const n="declutter"in e?e.declutter:!0,r=new sn({state:"loading",format:new rr({layerName:"mvt:layer"})});super({source:r,background:e.background===!1?null:e.background,declutter:n,className:e.className,opacity:e.opacity,visible:e.visible,zIndex:e.zIndex,minResolution:e.minResolution,maxResolution:e.maxResolution,minZoom:e.minZoom,maxZoom:e.maxZoom,renderOrder:e.renderOrder,renderBuffer:e.renderBuffer,renderMode:e.renderMode,map:e.map,updateWhileAnimating:e.updateWhileAnimating,updateWhileInteracting:e.updateWhileInteracting,preload:e.preload,useInterimTilesOnError:e.useInterimTilesOnError,properties:e.properties}),e.accessToken&&(this.accessToken=e.accessToken);const i=e.styleUrl,o=[Ki(this,i,e.layers||e.source,{accessToken:this.accessToken})];this.getBackground()===void 0&&o.push(ul(this,e.styleUrl,{accessToken:this.accessToken})),Promise.all(o).then(()=>{r.setState("ready")}).catch(a=>{this.dispatchEvent(new xl(a)),this.getSource().setState("error")})}}export{hu as MapboxVectorLayer,cu as addMapboxLayer,uu as apply,ul as applyBackground,Ki as applyStyle,uu as default,yu as getFeatureState,tt as getLayer,ao as getLayers,bl as getMapboxLayer,vl as getSource,lu as getStyleForLayer,su as recordStyleLayer,du as removeMapboxLayer,au as renderTransparent,mu as setFeatureState,Cn as stylefunction,fu as updateMapboxLayer,pu as updateMapboxSource};
//# sourceMappingURL=index-D8eN56zu.js.map
