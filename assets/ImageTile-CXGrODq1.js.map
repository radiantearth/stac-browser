{"version":3,"file":"ImageTile-CXGrODq1.js","sources":["../../node_modules/ol/source/ImageTile.js"],"sourcesContent":["/**\n * @module ol/source/ImageTile\n */\nimport {expandUrl, pickUrl, renderXYZTemplate} from '../uri.js';\nimport DataTileSource from './DataTile.js';\n\n/**\n * Image tile loading function.  The function is called with z, x, and y tile coordinates and\n * returns an {@link import(\"../DataTile.js\").ImageLike image} or a promise for the same.\n *\n * @typedef {function(number, number, number, import(\"./DataTile.js\").LoaderOptions):(import(\"../DataTile.js\").ImageLike|Promise<import(\"../DataTile.js\").ImageLike>)} Loader\n */\n\n/**\n * @typedef {function(number, number, number, import(\"./DataTile.js\").LoaderOptions):string} UrlGetter\n */\n\n/**\n * @typedef {string | Array<string> | UrlGetter} UrlLike\n */\n\n/**\n * @typedef {Object} Options\n * @property {UrlLike} [url] The image URL template.  In addition to a single URL template, an array of URL templates or a function\n * can be provided.  If a function is provided, it will be called with z, x, y tile coordinates and loader options and should\n * return a URL.\n * @property {Loader} [loader] Data loader.  Called with z, x, and y tile coordinates.\n * Returns an {@link import(\"../DataTile.js\").ImageLike image} for a tile or a promise for the same.\n * The promise should not resolve until the image is loaded.  If the `url` option is provided, a loader will be created.\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {number} [maxZoom=42] Optional max zoom level. Not used if `tileGrid` is provided.\n * @property {number} [minZoom=0] Optional min zoom level. Not used if `tileGrid` is provided.\n * @property {number|import(\"../size.js\").Size} [tileSize=[256, 256]] The pixel width and height of the source tiles.\n * This may be different than the rendered pixel size if a `tileGrid` is provided.\n * @property {number} [gutter=0] The size in pixels of the gutter around data tiles to ignore.\n * This allows artifacts of rendering at tile edges to be ignored.\n * Supported data should be wider and taller than the tile size by a value of `2 x gutter`.\n * @property {number} [maxResolution] Optional tile grid resolution at level zero. Not used if `tileGrid` is provided.\n * @property {import(\"../proj.js\").ProjectionLike} [projection='EPSG:3857'] Tile projection.\n * @property {import(\"../tilegrid/TileGrid.js\").default} [tileGrid] Tile grid.\n * @property {import(\"./Source.js\").State} [state] The source state.\n * @property {boolean} [wrapX=true] Render tiles beyond the antimeridian.\n * @property {number} [transition] Transition time when fading in new tiles (in miliseconds).\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.\n * @property {import('./DataTile.js').CrossOriginAttribute} [crossOrigin='anonymous'] The crossOrigin property to pass to loaders for image data.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\nconst loadError = new Error('Image failed to load');\n\n/**\n * @param {string} template The image url template.\n * @param {number} z The tile z coordinate.\n * @param {number} x The tile x coordinate.\n * @param {number} y The tile y coordinate.\n * @param {import('./DataTile.js').LoaderOptions} options The loader options.\n * @return {Promise<HTMLImageElement>} Resolves with a loaded image.\n */\nfunction loadImage(template, z, x, y, options) {\n  return new Promise((resolve, reject) => {\n    const image = new Image();\n    image.crossOrigin = options.crossOrigin ?? null;\n    image.addEventListener('load', () => resolve(image));\n    image.addEventListener('error', () => reject(loadError));\n    image.src = renderXYZTemplate(template, z, x, y, options.maxY);\n  });\n}\n\n/**\n * @param {Array<string>} templates The url templates.\n * @return {Loader} The image loader.\n */\nfunction makeLoaderFromTemplates(templates) {\n  return function (z, x, y, options) {\n    const template = pickUrl(templates, z, x, y);\n    return loadImage(template, z, x, y, options);\n  };\n}\n\n/**\n * @param {UrlGetter} getter The url getter.\n * @return {Loader} The image loader.\n */\nfunction makeLoaderFromGetter(getter) {\n  return function (z, x, y, options) {\n    const url = getter(z, x, y, options);\n    return loadImage(url, z, x, y, options);\n  };\n}\n\n/**\n * @param {UrlLike} url The URL-like option.\n * @return {Loader} The tile loader.\n */\nfunction makeLoaderFromUrlLike(url) {\n  /**\n   * @type {Loader}\n   */\n  let loader;\n\n  if (Array.isArray(url)) {\n    loader = makeLoaderFromTemplates(url);\n  } else if (typeof url === 'string') {\n    const urls = expandUrl(url);\n    loader = makeLoaderFromTemplates(urls);\n  } else if (typeof url === 'function') {\n    loader = makeLoaderFromGetter(url);\n  } else {\n    throw new Error(\n      'The url option must be a single template, an array of templates, or a function for getting a URL',\n    );\n  }\n  return loader;\n}\n\nlet keyCount = 0;\n\n/**\n * @param {UrlLike} url The URL-like option.\n * @return {string} A key for the URL.\n */\nfunction keyFromUrlLike(url) {\n  if (Array.isArray(url)) {\n    return url.join('\\n');\n  }\n\n  if (typeof url === 'string') {\n    return url;\n  }\n\n  ++keyCount;\n  return 'url-function-key-' + keyCount;\n}\n\n/**\n * @classdesc\n * A source for typed array data tiles.\n *\n * @extends DataTileSource<import(\"../ImageTile.js\").default>\n * @fires import(\"./Tile.js\").TileSourceEvent\n * @api\n */\nclass ImageTileSource extends DataTileSource {\n  /**\n   * @param {Options} [options] DataTile source options.\n   */\n  constructor(options) {\n    options = options || {};\n\n    /**\n     * @type {Loader}\n     */\n    let loader = options.loader;\n\n    /**\n     * @type {string}\n     */\n    let key;\n\n    if (options.url) {\n      loader = makeLoaderFromUrlLike(options.url);\n      key = keyFromUrlLike(options.url);\n    }\n\n    /**\n     * @type {import('./Source.js').State}\n     */\n    const state = !loader ? 'loading' : options.state;\n\n    const wrapX = options.wrapX === undefined ? true : options.wrapX;\n\n    super({\n      loader: loader,\n      key: key,\n      attributions: options.attributions,\n      attributionsCollapsible: options.attributionsCollapsible,\n      maxZoom: options.maxZoom,\n      minZoom: options.minZoom,\n      tileSize: options.tileSize,\n      gutter: options.gutter,\n      maxResolution: options.maxResolution,\n      projection: options.projection,\n      tileGrid: options.tileGrid,\n      state: state,\n      wrapX: wrapX,\n      transition: options.transition,\n      interpolate: options.interpolate !== false,\n      crossOrigin: options.crossOrigin,\n      zDirection: options.zDirection,\n    });\n  }\n\n  /**\n   * @param {UrlLike} url The new URL.\n   * @api\n   */\n  setUrl(url) {\n    const loader = makeLoaderFromUrlLike(url);\n    this.setLoader(loader);\n    this.setKey(keyFromUrlLike(url));\n    if (this.getState() !== 'ready') {\n      this.setState('ready');\n    }\n  }\n}\n\nexport default ImageTileSource;\n"],"names":["loadError","loadImage","template","z","x","y","options","resolve","reject","image","renderXYZTemplate","makeLoaderFromTemplates","templates","pickUrl","makeLoaderFromGetter","getter","url","makeLoaderFromUrlLike","loader","urls","expandUrl","keyCount","keyFromUrlLike","ImageTileSource","DataTileSource","key","state","wrapX"],"mappings":"wsBAmDA,MAAMA,EAAY,IAAI,MAAM,sBAAsB,EAUlD,SAASC,EAAUC,EAAUC,EAAGC,EAAGC,EAAGC,EAAS,CAC7C,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtC,MAAMC,EAAQ,IAAI,MAClBA,EAAM,YAAcH,EAAQ,aAAe,KAC3CG,EAAM,iBAAiB,OAAQ,IAAMF,EAAQE,CAAK,CAAC,EACnDA,EAAM,iBAAiB,QAAS,IAAMD,EAAOR,CAAS,CAAC,EACvDS,EAAM,IAAMC,EAAkBR,EAAUC,EAAGC,EAAGC,EAAGC,EAAQ,IAAI,CAC/D,CAAC,CACH,CAMA,SAASK,EAAwBC,EAAW,CAC1C,OAAO,SAAUT,EAAGC,EAAGC,EAAGC,EAAS,CACjC,MAAMJ,EAAWW,EAAQD,EAAWT,EAAGC,EAAGC,CAAC,EAC3C,OAAOJ,EAAUC,EAAUC,EAAGC,EAAGC,EAAGC,CAAO,CAC7C,CACF,CAMA,SAASQ,EAAqBC,EAAQ,CACpC,OAAO,SAAUZ,EAAGC,EAAGC,EAAGC,EAAS,CACjC,MAAMU,EAAMD,EAAOZ,EAAGC,EAAGC,EAAGC,CAAO,EACnC,OAAOL,EAAUe,EAAKb,EAAGC,EAAGC,EAAGC,CAAO,CACxC,CACF,CAMA,SAASW,EAAsBD,EAAK,CAIlC,IAAIE,EAEJ,GAAI,MAAM,QAAQF,CAAG,EACnBE,EAASP,EAAwBK,CAAG,UAC3B,OAAOA,GAAQ,SAAU,CAClC,MAAMG,EAAOC,EAAUJ,CAAG,EAC1BE,EAASP,EAAwBQ,CAAI,CACvC,SAAW,OAAOH,GAAQ,WACxBE,EAASJ,EAAqBE,CAAG,MAEjC,OAAM,IAAI,MACR,kGACN,EAEE,OAAOE,CACT,CAEA,IAAIG,EAAW,EAMf,SAASC,EAAeN,EAAK,CAC3B,OAAI,MAAM,QAAQA,CAAG,EACZA,EAAI,KAAK;AAAA,CAAI,EAGlB,OAAOA,GAAQ,SACVA,GAGT,EAAEK,EACK,oBAAsBA,EAC/B,CAUA,MAAME,UAAwBC,CAAe,CAI3C,YAAYlB,EAAS,CACnBA,EAAUA,GAAW,CAAA,EAKrB,IAAIY,EAASZ,EAAQ,OAKjBmB,EAEAnB,EAAQ,MACVY,EAASD,EAAsBX,EAAQ,GAAG,EAC1CmB,EAAMH,EAAehB,EAAQ,GAAG,GAMlC,MAAMoB,EAASR,EAAqBZ,EAAQ,MAApB,UAElBqB,EAAQrB,EAAQ,QAAU,OAAY,GAAOA,EAAQ,MAE3D,MAAM,CACJ,OAAQY,EACR,IAAKO,EACL,aAAcnB,EAAQ,aACtB,wBAAyBA,EAAQ,wBACjC,QAASA,EAAQ,QACjB,QAASA,EAAQ,QACjB,SAAUA,EAAQ,SAClB,OAAQA,EAAQ,OAChB,cAAeA,EAAQ,cACvB,WAAYA,EAAQ,WACpB,SAAUA,EAAQ,SAClB,MAAOoB,EACP,MAAOC,EACP,WAAYrB,EAAQ,WACpB,YAAaA,EAAQ,cAAgB,GACrC,YAAaA,EAAQ,YACrB,WAAYA,EAAQ,UAC1B,CAAK,CACH,CAMA,OAAOU,EAAK,CACV,MAAME,EAASD,EAAsBD,CAAG,EACxC,KAAK,UAAUE,CAAM,EACrB,KAAK,OAAOI,EAAeN,CAAG,CAAC,EAC3B,KAAK,SAAQ,IAAO,SACtB,KAAK,SAAS,OAAO,CAEzB,CACF","x_google_ignoreList":[0]}