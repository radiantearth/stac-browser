{"version":3,"file":"compileUtil-l9W4qAYP.js","sources":["../../node_modules/ol/webgl.js","../../node_modules/ol/webgl/Buffer.js","../../node_modules/ol/webgl/ContextEventType.js","../../node_modules/ol/webgl/PostProcessingPass.js","../../node_modules/ol/webgl/Helper.js","../../node_modules/ol/webgl/BaseTileRepresentation.js","../../node_modules/ol/webgl/TileTexture.js","../../node_modules/ol/renderer/webgl/Layer.js","../../node_modules/ol/renderer/webgl/TileLayerBase.js","../../node_modules/ol/renderer/webgl/TileLayer.js","../../node_modules/ol/webgl/PaletteTexture.js","../../node_modules/ol/expr/gpu.js","../../node_modules/ol/render/webgl/compileUtil.js"],"sourcesContent":["/**\n * @module ol/webgl\n */\n\nimport {SAFARI_BUG_237906} from './has.js';\n\n/**\n * Constants taken from goog.webgl\n */\n\n/**\n * Used by {@link module:ol/webgl/Helper~WebGLHelper} for buffers containing vertices data, such as\n * position, color, texture coordinate, etc. These vertices are then referenced by an index buffer\n * to be drawn on screen (see {@link module:ol/webgl.ELEMENT_ARRAY_BUFFER}).\n * @const\n * @type {number}\n * @api\n */\nexport const ARRAY_BUFFER = 0x8892;\n\n/**\n * Used by {@link module:ol/webgl/Helper~WebGLHelper} for buffers containing indices data.\n * Index buffers are essentially lists of references to vertices defined in a vertex buffer\n * (see {@link module:ol/webgl.ARRAY_BUFFER}), and define the primitives (triangles) to be drawn.\n * @const\n * @type {number}\n * @api\n */\nexport const ELEMENT_ARRAY_BUFFER = 0x8893;\n\n/**\n * Used by {link module:ol/webgl/Buffer~WebGLArrayBuffer}.\n * @const\n * @type {number}\n * @api\n */\nexport const STREAM_DRAW = 0x88e0;\n\n/**\n * Used by {link module:ol/webgl/Buffer~WebGLArrayBuffer}.\n * @const\n * @type {number}\n * @api\n */\nexport const STATIC_DRAW = 0x88e4;\n\n/**\n * Used by {link module:ol/webgl/Buffer~WebGLArrayBuffer}.\n * @const\n * @type {number}\n * @api\n */\nexport const DYNAMIC_DRAW = 0x88e8;\n\n/**\n * @const\n * @type {number}\n */\nexport const UNSIGNED_BYTE = 0x1401;\n\n/**\n * @const\n * @type {number}\n */\nexport const UNSIGNED_SHORT = 0x1403;\n\n/**\n * @const\n * @type {number}\n */\nexport const UNSIGNED_INT = 0x1405;\n\n/**\n * @const\n * @type {number}\n */\nexport const FLOAT = 0x1406;\n\n/**\n  end of goog.webgl constants\n */\n\n/**\n * @const\n * @type {Array<string>}\n */\nconst CONTEXT_IDS = ['experimental-webgl', 'webgl', 'webkit-3d', 'moz-webgl'];\n\n/**\n * @param {HTMLCanvasElement} canvas Canvas.\n * @param {Object} [attributes] Attributes.\n * @return {WebGLRenderingContext|null} WebGL rendering context.\n */\nexport function getContext(canvas, attributes) {\n  attributes = Object.assign(\n    {\n      preserveDrawingBuffer: true,\n      antialias: SAFARI_BUG_237906 ? false : true, // https://bugs.webkit.org/show_bug.cgi?id=237906\n    },\n    attributes,\n  );\n  const ii = CONTEXT_IDS.length;\n  for (let i = 0; i < ii; ++i) {\n    try {\n      const context = canvas.getContext(CONTEXT_IDS[i], attributes);\n      if (context) {\n        return /** @type {!WebGLRenderingContext} */ (context);\n      }\n    } catch {\n      // pass\n    }\n  }\n  return null;\n}\n\n/**\n * @type {Array<string>|null}\n */\nlet supportedExtensions = null;\n\n/**\n * @return {Array<string>|null} List of supported WebGL extensions.\n */\nexport function getSupportedExtensions() {\n  if (!supportedExtensions) {\n    const canvas = document.createElement('canvas');\n    const gl = getContext(canvas);\n    if (gl) {\n      supportedExtensions = gl.getSupportedExtensions();\n    }\n  }\n  return supportedExtensions;\n}\n","/**\n * @module ol/webgl/Buffer\n */\nimport {assert} from '../asserts.js';\nimport {\n  ARRAY_BUFFER,\n  DYNAMIC_DRAW,\n  ELEMENT_ARRAY_BUFFER,\n  STATIC_DRAW,\n  STREAM_DRAW,\n} from '../webgl.js';\n\n/**\n * Used to describe the intended usage for the data: `STATIC_DRAW`, `STREAM_DRAW`\n * or `DYNAMIC_DRAW`.\n * @enum {number}\n */\nexport const BufferUsage = {\n  STATIC_DRAW: STATIC_DRAW,\n  STREAM_DRAW: STREAM_DRAW,\n  DYNAMIC_DRAW: DYNAMIC_DRAW,\n};\n\n/**\n * @classdesc\n * Object used to store an array of data as well as usage information for that data.\n * Stores typed arrays internally, either Float32Array or Uint16/32Array depending on\n * the buffer type (ARRAY_BUFFER or ELEMENT_ARRAY_BUFFER) and available extensions.\n *\n * To populate the array, you can either use:\n * A size using `#ofSize(buffer)`\n * An `ArrayBuffer` object using `#fromArrayBuffer(buffer)`\n * A plain array using `#fromArray(array)`\n *\n * Note:\n * See the documentation of [WebGLRenderingContext.bufferData](https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/bufferData)\n * for more info on buffer usage.\n */\nclass WebGLArrayBuffer {\n  /**\n   * @param {number} type Buffer type, either ARRAY_BUFFER or ELEMENT_ARRAY_BUFFER.\n   * @param {number} [usage] Intended usage, either `STATIC_DRAW`, `STREAM_DRAW` or `DYNAMIC_DRAW`.\n   * Default is `STATIC_DRAW`.\n   */\n  constructor(type, usage) {\n    /**\n     * @private\n     * @type {Float32Array|Uint32Array|null}\n     */\n    this.array_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.type_ = type;\n\n    assert(\n      type === ARRAY_BUFFER || type === ELEMENT_ARRAY_BUFFER,\n      'A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`',\n    );\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.usage_ = usage !== undefined ? usage : BufferUsage.STATIC_DRAW;\n  }\n\n  /**\n   * Populates the buffer with an array of the given size (all values will be zeroes).\n   * @param {number} size Array size\n   * @return {WebGLArrayBuffer} This\n   */\n  ofSize(size) {\n    this.array_ = new (getArrayClassForType(this.type_))(size);\n    return this;\n  }\n\n  /**\n   * Populates the buffer with an array of the given size.\n   * @param {Array<number>} array Numerical array\n   * @return {WebGLArrayBuffer} This\n   */\n  fromArray(array) {\n    this.array_ = getArrayClassForType(this.type_).from(array);\n    return this;\n  }\n\n  /**\n   * Populates the buffer with a raw binary array buffer.\n   * @param {ArrayBuffer} buffer Raw binary buffer to populate the array with. Note that this buffer must have been\n   * initialized for the same typed array class.\n   * @return {WebGLArrayBuffer} This\n   */\n  fromArrayBuffer(buffer) {\n    this.array_ = new (getArrayClassForType(this.type_))(buffer);\n    return this;\n  }\n\n  /**\n   * @return {number} Buffer type.\n   */\n  getType() {\n    return this.type_;\n  }\n\n  /**\n   * Will return null if the buffer was not initialized\n   * @return {Float32Array|Uint32Array|null} Array.\n   */\n  getArray() {\n    return this.array_;\n  }\n\n  /**\n   * @param {Float32Array|Uint32Array} array Array.\n   */\n  setArray(array) {\n    const ArrayType = getArrayClassForType(this.type_);\n    if (!(array instanceof ArrayType)) {\n      throw new Error(`Expected ${ArrayType}`);\n    }\n    this.array_ = array;\n  }\n\n  /**\n   * @return {number} Usage.\n   */\n  getUsage() {\n    return this.usage_;\n  }\n\n  /**\n   * Will return 0 if the buffer is not initialized\n   * @return {number} Array size\n   */\n  getSize() {\n    return this.array_ ? this.array_.length : 0;\n  }\n}\n\n/**\n * Returns a typed array constructor based on the given buffer type\n * @param {number} type Buffer type, either ARRAY_BUFFER or ELEMENT_ARRAY_BUFFER.\n * @return {Float32ArrayConstructor|Uint32ArrayConstructor} The typed array class to use for this buffer.\n */\nexport function getArrayClassForType(type) {\n  switch (type) {\n    case ARRAY_BUFFER:\n      return Float32Array;\n    case ELEMENT_ARRAY_BUFFER:\n      return Uint32Array;\n    default:\n      return Float32Array;\n  }\n}\n\nexport default WebGLArrayBuffer;\n","/**\n * @module ol/webgl/ContextEventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  LOST: 'webglcontextlost',\n  RESTORED: 'webglcontextrestored',\n};\n","/**\n * @module ol/webgl/PostProcessingPass\n */\n\nimport {getUid} from '../util.js';\n\nconst DEFAULT_VERTEX_SHADER = `\n  precision mediump float;\n\n  attribute vec2 a_position;\n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n\n  uniform vec2 u_screenSize;\n\n  void main() {\n    v_texCoord = a_position * 0.5 + 0.5;\n    v_screenCoord = v_texCoord * u_screenSize;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n  }\n`;\n\nconst DEFAULT_FRAGMENT_SHADER = `\n  precision mediump float;\n\n  uniform sampler2D u_image;\n  uniform float u_opacity;\n\n  varying vec2 v_texCoord;\n\n  void main() {\n    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n  }\n`;\n\n/**\n * @typedef {Object} Options\n * @property {WebGLRenderingContext} webGlContext WebGL context; mandatory.\n * @property {number} [scaleRatio] Scale ratio; if < 1, the post process will render to a texture smaller than\n * the main canvas that will then be sampled up (useful for saving resource on blur steps).\n * @property {string} [vertexShader] Vertex shader source\n * @property {string} [fragmentShader] Fragment shader source\n * @property {Object<string,import(\"./Helper\").UniformValue>} [uniforms] Uniform definitions for the post process step\n */\n\n/**\n * @typedef {Object} UniformInternalDescription\n * @property {import(\"./Helper\").UniformValue} value Value\n * @property {WebGLUniformLocation} location Location\n * @property {WebGLTexture} [texture] Texture\n * @private\n */\n\n/**\n * @classdesc\n * This class is used to define Post Processing passes with custom shaders and uniforms.\n * This is used internally by {@link module:ol/webgl/Helper~WebGLHelper}.\n *\n * Please note that the final output on the DOM canvas is expected to have premultiplied alpha, which means that\n * a pixel which is 100% red with an opacity of 50% must have a color of (r=0.5, g=0, b=0, a=0.5).\n * Failing to provide pixel colors with premultiplied alpha will result in render anomalies.\n *\n * The default post-processing pass does *not* multiply color values with alpha value, it expects color values to be\n * premultiplied.\n *\n * Default shaders are shown hereafter:\n *\n * Vertex shader:\n *\n *   ```\n *   precision mediump float;\n *\n *   attribute vec2 a_position;\n *   varying vec2 v_texCoord;\n *   varying vec2 v_screenCoord;\n *\n *   uniform vec2 u_screenSize;\n *\n *   void main() {\n *     v_texCoord = a_position * 0.5 + 0.5;\n *     v_screenCoord = v_texCoord * u_screenSize;\n *     gl_Position = vec4(a_position, 0.0, 1.0);\n *   }\n *   ```\n *\n * Fragment shader:\n *\n *   ```\n *   precision mediump float;\n *\n *   uniform sampler2D u_image;\n *   uniform float u_opacity;\n *\n *   varying vec2 v_texCoord;\n *\n *   void main() {\n *     gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n *   }\n *   ```\n */\nclass WebGLPostProcessingPass {\n  /**\n   * @param {Options} options Options.\n   */\n  constructor(options) {\n    /**\n     * @private\n     */\n    this.gl_ = options.webGlContext;\n    const gl = this.gl_;\n\n    /**\n     * @private\n     */\n    this.scaleRatio_ = options.scaleRatio || 1;\n\n    /**\n     * @type {WebGLTexture}\n     * @private\n     */\n    this.renderTargetTexture_ = gl.createTexture();\n\n    /**\n     * @type {import('../size.js').Size|null}\n     * @private\n     */\n    this.renderTargetTextureSize_ = null;\n\n    /**\n     * @private\n     */\n    this.frameBuffer_ = gl.createFramebuffer();\n    /**\n     * @private\n     */\n    this.depthBuffer_ = gl.createRenderbuffer();\n\n    // compile the program for the frame buffer\n    // TODO: make compilation errors show up\n    const vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(\n      vertexShader,\n      options.vertexShader || DEFAULT_VERTEX_SHADER,\n    );\n    gl.compileShader(vertexShader);\n    const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(\n      fragmentShader,\n      options.fragmentShader || DEFAULT_FRAGMENT_SHADER,\n    );\n    gl.compileShader(fragmentShader);\n    /**\n     * @private\n     */\n    this.renderTargetProgram_ = gl.createProgram();\n    gl.attachShader(this.renderTargetProgram_, vertexShader);\n    gl.attachShader(this.renderTargetProgram_, fragmentShader);\n    gl.linkProgram(this.renderTargetProgram_);\n\n    // bind the vertices buffer for the frame buffer\n    /**\n     * @private\n     */\n    this.renderTargetVerticesBuffer_ = gl.createBuffer();\n    const verticesArray = [-1, -1, 1, -1, -1, 1, 1, -1, 1, 1, -1, 1];\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.renderTargetVerticesBuffer_);\n    gl.bufferData(\n      gl.ARRAY_BUFFER,\n      new Float32Array(verticesArray),\n      gl.STATIC_DRAW,\n    );\n\n    /**\n     * @private\n     */\n    this.renderTargetAttribLocation_ = gl.getAttribLocation(\n      this.renderTargetProgram_,\n      'a_position',\n    );\n    /**\n     * @private\n     */\n    this.renderTargetUniformLocation_ = gl.getUniformLocation(\n      this.renderTargetProgram_,\n      'u_screenSize',\n    );\n    /**\n     * @private\n     */\n    this.renderTargetOpacityLocation_ = gl.getUniformLocation(\n      this.renderTargetProgram_,\n      'u_opacity',\n    );\n    /**\n     * @private\n     */\n    this.renderTargetTextureLocation_ = gl.getUniformLocation(\n      this.renderTargetProgram_,\n      'u_image',\n    );\n\n    /**\n     * Holds info about custom uniforms used in the post processing pass\n     * @type {Array<UniformInternalDescription>}\n     * @private\n     */\n    this.uniforms_ = [];\n    options.uniforms &&\n      Object.keys(options.uniforms).forEach((name) => {\n        this.uniforms_.push({\n          value: options.uniforms[name],\n          location: gl.getUniformLocation(this.renderTargetProgram_, name),\n        });\n      });\n  }\n\n  getRenderTargetTexture() {\n    return this.renderTargetTexture_;\n  }\n\n  /**\n   * Get the WebGL rendering context\n   * @return {WebGLRenderingContext} The rendering context.\n   */\n  getGL() {\n    return this.gl_;\n  }\n\n  /**\n   * Initialize the render target texture of the post process, make sure it is at the\n   * right size and bind it as a render target for the next draw calls.\n   * The last step to be initialized will be the one where the primitives are rendered.\n   * @param {import(\"../Map.js\").FrameState} frameState current frame state\n   */\n  init(frameState) {\n    const gl = this.getGL();\n    const textureSize = [\n      gl.drawingBufferWidth * this.scaleRatio_,\n      gl.drawingBufferHeight * this.scaleRatio_,\n    ];\n\n    // rendering goes to my buffer\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.getFrameBuffer());\n    gl.bindRenderbuffer(gl.RENDERBUFFER, this.getDepthBuffer());\n    gl.viewport(0, 0, textureSize[0], textureSize[1]);\n\n    // if size has changed: adjust canvas & render target texture\n    if (\n      !this.renderTargetTextureSize_ ||\n      this.renderTargetTextureSize_[0] !== textureSize[0] ||\n      this.renderTargetTextureSize_[1] !== textureSize[1]\n    ) {\n      this.renderTargetTextureSize_ = textureSize;\n\n      // create a new texture\n      const level = 0;\n      const internalFormat = gl.RGBA;\n      const border = 0;\n      const format = gl.RGBA;\n      const type = gl.UNSIGNED_BYTE;\n      const data = null;\n      gl.bindTexture(gl.TEXTURE_2D, this.renderTargetTexture_);\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        level,\n        internalFormat,\n        textureSize[0],\n        textureSize[1],\n        border,\n        format,\n        type,\n        data,\n      );\n\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n      // bind the texture to the framebuffer\n      gl.framebufferTexture2D(\n        gl.FRAMEBUFFER,\n        gl.COLOR_ATTACHMENT0,\n        gl.TEXTURE_2D,\n        this.renderTargetTexture_,\n        0,\n      );\n\n      gl.renderbufferStorage(\n        gl.RENDERBUFFER,\n        gl.DEPTH_COMPONENT16,\n        textureSize[0],\n        textureSize[1],\n      );\n      gl.framebufferRenderbuffer(\n        gl.FRAMEBUFFER,\n        gl.DEPTH_ATTACHMENT,\n        gl.RENDERBUFFER,\n        this.depthBuffer_,\n      );\n    }\n  }\n\n  /**\n   * Render to the next postprocessing pass (or to the canvas if final pass).\n   * @param {import(\"../Map.js\").FrameState} frameState current frame state\n   * @param {WebGLPostProcessingPass} [nextPass] Next pass, optional\n   * @param {function(WebGLRenderingContext, import(\"../Map.js\").FrameState):void} [preCompose] Called before composing.\n   * @param {function(WebGLRenderingContext, import(\"../Map.js\").FrameState):void} [postCompose] Called before composing.\n   */\n  apply(frameState, nextPass, preCompose, postCompose) {\n    const gl = this.getGL();\n    const size = frameState.size;\n\n    gl.bindFramebuffer(\n      gl.FRAMEBUFFER,\n      nextPass ? nextPass.getFrameBuffer() : null,\n    );\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, this.renderTargetTexture_);\n\n    if (!nextPass) {\n      // clear the canvas if we are the first to render to it\n      // and preserveDrawingBuffer is true\n      const canvasId = getUid(gl.canvas);\n      if (!frameState.renderTargets[canvasId]) {\n        const attributes = gl.getContextAttributes();\n        if (attributes && attributes.preserveDrawingBuffer) {\n          gl.clearColor(0.0, 0.0, 0.0, 0.0);\n          gl.clearDepth(1.0);\n          gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        }\n\n        frameState.renderTargets[canvasId] = true;\n      }\n    }\n\n    gl.disable(gl.DEPTH_TEST);\n    gl.enable(gl.BLEND);\n    gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.renderTargetVerticesBuffer_);\n\n    gl.useProgram(this.renderTargetProgram_);\n    gl.enableVertexAttribArray(this.renderTargetAttribLocation_);\n    gl.vertexAttribPointer(\n      this.renderTargetAttribLocation_,\n      2,\n      gl.FLOAT,\n      false,\n      0,\n      0,\n    );\n    gl.uniform2f(this.renderTargetUniformLocation_, size[0], size[1]);\n    gl.uniform1i(this.renderTargetTextureLocation_, 0);\n\n    const opacity = frameState.layerStatesArray[frameState.layerIndex].opacity;\n    gl.uniform1f(this.renderTargetOpacityLocation_, opacity);\n\n    this.applyUniforms(frameState);\n\n    if (preCompose) {\n      preCompose(gl, frameState);\n    }\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n    if (postCompose) {\n      postCompose(gl, frameState);\n    }\n  }\n\n  /**\n   * @return {WebGLFramebuffer} Frame buffer\n   */\n  getFrameBuffer() {\n    return this.frameBuffer_;\n  }\n\n  /**\n   * @return {WebGLRenderbuffer} Depth buffer\n   */\n  getDepthBuffer() {\n    return this.depthBuffer_;\n  }\n\n  /**\n   * Sets the custom uniforms based on what was given in the constructor.\n   * @param {import(\"../Map.js\").FrameState} frameState Frame state.\n   * @private\n   */\n  applyUniforms(frameState) {\n    const gl = this.getGL();\n\n    let value;\n    let textureSlot = 1;\n    this.uniforms_.forEach(function (uniform) {\n      value =\n        typeof uniform.value === 'function'\n          ? uniform.value(frameState)\n          : uniform.value;\n\n      // apply value based on type\n      if (value instanceof HTMLCanvasElement || value instanceof ImageData) {\n        // create a texture & put data\n        if (!uniform.texture) {\n          uniform.texture = gl.createTexture();\n        }\n        gl.activeTexture(gl[`TEXTURE${textureSlot}`]);\n        gl.bindTexture(gl.TEXTURE_2D, uniform.texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n        if (value instanceof ImageData) {\n          gl.texImage2D(\n            gl.TEXTURE_2D,\n            0,\n            gl.RGBA,\n            gl.RGBA,\n            value.width,\n            value.height,\n            0,\n            gl.UNSIGNED_BYTE,\n            new Uint8Array(value.data),\n          );\n        } else {\n          gl.texImage2D(\n            gl.TEXTURE_2D,\n            0,\n            gl.RGBA,\n            gl.RGBA,\n            gl.UNSIGNED_BYTE,\n            value,\n          );\n        }\n\n        // fill texture slots\n        gl.uniform1i(uniform.location, textureSlot++);\n      } else if (Array.isArray(value)) {\n        switch (value.length) {\n          case 2:\n            gl.uniform2f(uniform.location, value[0], value[1]);\n            return;\n          case 3:\n            gl.uniform3f(uniform.location, value[0], value[1], value[2]);\n            return;\n          case 4:\n            gl.uniform4f(\n              uniform.location,\n              value[0],\n              value[1],\n              value[2],\n              value[3],\n            );\n            return;\n          default:\n            return;\n        }\n      } else if (typeof value === 'number') {\n        gl.uniform1f(uniform.location, value);\n      }\n    });\n  }\n}\n\nexport default WebGLPostProcessingPass;\n","/**\n * @module ol/webgl/Helper\n */\nimport Disposable from '../Disposable.js';\nimport {assert} from '../asserts.js';\nimport {clear} from '../obj.js';\nimport {\n  compose as composeTransform,\n  create as createTransform,\n} from '../transform.js';\nimport {getUid} from '../util.js';\nimport {create, fromTransform} from '../vec/mat4.js';\nimport ContextEventType from '../webgl/ContextEventType.js';\nimport {\n  FLOAT,\n  UNSIGNED_BYTE,\n  UNSIGNED_INT,\n  UNSIGNED_SHORT,\n  getContext,\n} from '../webgl.js';\nimport WebGLPostProcessingPass from './PostProcessingPass.js';\n\n/**\n * @typedef {Object} BufferCacheEntry\n * @property {import(\"./Buffer.js\").default} buffer Buffer.\n * @property {WebGLBuffer} webGlBuffer WebGlBuffer.\n */\n\n/**\n * Shader types, either `FRAGMENT_SHADER` or `VERTEX_SHADER`.\n * @enum {number}\n */\nexport const ShaderType = {\n  FRAGMENT_SHADER: 0x8b30,\n  VERTEX_SHADER: 0x8b31,\n};\n\n/**\n * Names of uniforms made available to all shaders.\n * Please note: changing these *will* break custom shaders!\n * @enum {string}\n */\nexport const DefaultUniform = {\n  PROJECTION_MATRIX: 'u_projectionMatrix',\n  SCREEN_TO_WORLD_MATRIX: 'u_screenToWorldMatrix',\n  TIME: 'u_time',\n  ZOOM: 'u_zoom',\n  RESOLUTION: 'u_resolution',\n  ROTATION: 'u_rotation',\n  VIEWPORT_SIZE_PX: 'u_viewportSizePx',\n  PIXEL_RATIO: 'u_pixelRatio',\n  HIT_DETECTION: 'u_hitDetection',\n};\n\n/**\n * Attribute types, either `UNSIGNED_BYTE`, `UNSIGNED_SHORT`, `UNSIGNED_INT` or `FLOAT`\n * Note: an attribute stored in a `Float32Array` should be of type `FLOAT`.\n * @enum {number}\n */\nexport const AttributeType = {\n  UNSIGNED_BYTE: UNSIGNED_BYTE,\n  UNSIGNED_SHORT: UNSIGNED_SHORT,\n  UNSIGNED_INT: UNSIGNED_INT,\n  FLOAT: FLOAT,\n};\n\n/**\n * Description of an attribute in a buffer\n * @typedef {Object} AttributeDescription\n * @property {string|null} name Attribute name to use in shaders; if null, this attribute will not be enabled and is simply used as padding in the buffers\n * @property {number} size Number of components per attributes\n * @property {AttributeType} [type] Attribute type, i.e. number of bytes used to store the value. This is\n * determined by the class of typed array which the buffer uses (eg. `Float32Array` for a `FLOAT` attribute).\n * Default is `FLOAT`.\n */\n\n/**\n * @typedef {number|Array<number>|HTMLCanvasElement|HTMLImageElement|ImageData|WebGLTexture|import(\"../transform\").Transform} UniformLiteralValue\n */\n\n/**\n * Uniform value can be a number, array of numbers (2 to 4), canvas element or a callback returning\n * one of the previous types.\n * @typedef {UniformLiteralValue|function(import(\"../Map.js\").FrameState):UniformLiteralValue} UniformValue\n */\n\n/**\n * @typedef {Object} PostProcessesOptions\n * @property {number} [scaleRatio] Scale ratio; if < 1, the post process will render to a texture smaller than\n * the main canvas which will then be sampled up (useful for saving resource on blur steps).\n * @property {string} [vertexShader] Vertex shader source\n * @property {string} [fragmentShader] Fragment shader source\n * @property {Object<string,UniformValue>} [uniforms] Uniform definitions for the post process step\n */\n\n/**\n * @typedef {Object} Options\n * @property {Object<string,UniformValue>} [uniforms] Uniform definitions; property names must match the uniform\n * names in the provided or default shaders.\n * @property {Array<PostProcessesOptions>} [postProcesses] Post-processes definitions\n * @property {string} [canvasCacheKey] The cache key for the canvas.\n */\n\n/**\n * @typedef {Object} UniformInternalDescription\n * @property {string} name Name\n * @property {UniformValue} [value] Value\n * @property {UniformValue} [prevValue] The previous value.\n * @property {WebGLTexture} [texture] Texture\n * @private\n */\n\n/**\n * @typedef {Object} CanvasCacheItem\n * @property {WebGLRenderingContext} context The context of this canvas.\n * @property {number} users The count of users of this canvas.\n */\n\n/**\n * @type {Object<string,CanvasCacheItem>}\n */\nconst canvasCache = {};\n\n/**\n * @param {string} key The cache key for the canvas.\n * @return {string} The shared cache key.\n */\nfunction getSharedCanvasCacheKey(key) {\n  return 'shared/' + key;\n}\n\nlet uniqueCanvasCacheKeyCount = 0;\n\n/**\n * @return {string} The unique cache key.\n */\nfunction getUniqueCanvasCacheKey() {\n  const key = 'unique/' + uniqueCanvasCacheKeyCount;\n  uniqueCanvasCacheKeyCount += 1;\n  return key;\n}\n\n/**\n * @param {string} key The cache key for the canvas.\n * @return {WebGLRenderingContext} The canvas.\n */\nfunction getOrCreateContext(key) {\n  let cacheItem = canvasCache[key];\n  if (!cacheItem) {\n    const canvas = document.createElement('canvas');\n    canvas.width = 1;\n    canvas.height = 1;\n    canvas.style.position = 'absolute';\n    canvas.style.left = '0';\n    const context = getContext(canvas);\n    cacheItem = {users: 0, context};\n    canvasCache[key] = cacheItem;\n  }\n\n  cacheItem.users += 1;\n  return cacheItem.context;\n}\n\n/**\n * @param {string} key The cache key for the canvas.\n */\nfunction releaseCanvas(key) {\n  const cacheItem = canvasCache[key];\n  if (!cacheItem) {\n    return;\n  }\n\n  cacheItem.users -= 1;\n  if (cacheItem.users > 0) {\n    return;\n  }\n\n  const gl = cacheItem.context;\n  const extension = gl.getExtension('WEBGL_lose_context');\n  if (extension) {\n    extension.loseContext();\n  }\n  const canvas = gl.canvas;\n  canvas.width = 1;\n  canvas.height = 1;\n\n  delete canvasCache[key];\n}\n\n/**\n * @classdesc\n * This class is intended to provide low-level functions related to WebGL rendering, so that accessing\n * directly the WebGL API should not be required anymore.\n *\n * Several operations are handled by the `WebGLHelper` class:\n *\n * ### Define custom shaders and uniforms\n *\n *   Shaders* are low-level programs executed on the GPU and written in GLSL. There are two types of shaders:\n *\n *   Vertex shaders are used to manipulate the position and attribute of *vertices* of rendered primitives (ie. corners of a square).\n *   Outputs are:\n *\n *   `gl_Position`: position of the vertex in screen space\n *\n *   Varyings usually prefixed with `v_` are passed on to the fragment shader\n *\n *   Fragment shaders are used to control the actual color of the pixels drawn on screen. Their only output is `gl_FragColor`.\n *\n *   Both shaders can take *uniforms* or *attributes* as input. Attributes are explained later. Uniforms are common, read-only values that\n *   can be changed at every frame and can be of type float, arrays of float or images.\n *\n *   Shaders must be compiled and assembled into a program like so:\n *   ```js\n *   // here we simply create two shaders and assemble them in a program which is then used\n *   // for subsequent rendering calls; note how a frameState is required to set up a program,\n *   // as several default uniforms are computed from it (projection matrix, zoom level, etc.)\n *   const vertexShader = new WebGLVertex(VERTEX_SHADER);\n *   const fragmentShader = new WebGLFragment(FRAGMENT_SHADER);\n *   const program = this.context.getProgram(fragmentShader, vertexShader);\n *   helper.useProgram(this.program, frameState);\n *   ```\n *\n *   Uniforms are defined using the `uniforms` option and can either be explicit values or callbacks taking the frame state as argument.\n *   You can also change their value along the way like so:\n *   ```js\n *   helper.setUniformFloatValue('u_value', valueAsNumber);\n *   ```\n *\n * ### Defining post processing passes\n *\n *   Post processing* describes the act of rendering primitives to a texture, and then rendering this texture to the final canvas\n *   while applying special effects in screen space.\n *   Typical uses are: blurring, color manipulation, depth of field, filtering...\n *\n *   The `WebGLHelper` class offers the possibility to define post processes at creation time using the `postProcesses` option.\n *   A post process step accepts the following options:\n *\n *   `fragmentShader` and `vertexShader`: text literals in GLSL language that will be compiled and used in the post processing step.\n *   `uniforms`: uniforms can be defined for the post processing steps just like for the main render.\n *   `scaleRatio`: allows using an intermediate texture smaller or higher than the final canvas in the post processing step.\n *     This is typically used in blur steps to reduce the performance overhead by using an already downsampled texture as input.\n *\n *   The {@link module:ol/webgl/PostProcessingPass~WebGLPostProcessingPass} class is used internally, refer to its documentation for more info.\n *\n * ### Binding WebGL buffers and flushing data into them\n *\n *   Data that must be passed to the GPU has to be transferred using {@link module:ol/webgl/Buffer~WebGLArrayBuffer} objects.\n *   A buffer has to be created only once, but must be bound every time the buffer content will be used for rendering.\n *   This is done using {@link bindBuffer}.\n *   When the buffer's array content has changed, the new data has to be flushed to the GPU memory; this is done using\n *   {@link flushBufferData}. Note: this operation is expensive and should be done as infrequently as possible.\n *\n *   When binding an array buffer, a `target` parameter must be given: it should be either {@link module:ol/webgl.ARRAY_BUFFER}\n *   (if the buffer contains vertices data) or {@link module:ol/webgl.ELEMENT_ARRAY_BUFFER} (if the buffer contains indices data).\n *\n *   Examples below:\n *   ```js\n *   // at initialization phase\n *   const verticesBuffer = new WebGLArrayBuffer([], DYNAMIC_DRAW);\n *   const indicesBuffer = new WebGLArrayBuffer([], DYNAMIC_DRAW);\n *\n *   // when array values have changed\n *   helper.flushBufferData(ARRAY_BUFFER, this.verticesBuffer);\n *   helper.flushBufferData(ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\n *\n *   // at rendering phase\n *   helper.bindBuffer(ARRAY_BUFFER, this.verticesBuffer);\n *   helper.bindBuffer(ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\n *   ```\n *\n * ### Specifying attributes\n *\n *   The GPU only receives the data as arrays of numbers. These numbers must be handled differently depending on what it describes (position, texture coordinate...).\n *   Attributes are used to specify these uses. Specify the attribute names with\n *   {@link module:ol/webgl/Helper~WebGLHelper#enableAttributes} (see code snippet below).\n *\n *   Please note that you will have to specify the type and offset of the attributes in the data array. You can refer to the documentation of [WebGLRenderingContext.vertexAttribPointer](https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer) for more explanation.\n *   ```js\n *   // here we indicate that the data array has the following structure:\n *   // [posX, posY, offsetX, offsetY, texCoordU, texCoordV, posX, posY, ...]\n *   helper.enableAttributes([\n *     {\n *        name: 'a_position',\n *        size: 2\n *     },\n *     {\n *       name: 'a_offset',\n *       size: 2\n *     },\n *     {\n *       name: 'a_texCoord',\n *       size: 2\n *     }\n *   ])\n *   ```\n *\n * ### Rendering primitives\n *\n *   Once all the steps above have been achieved, rendering primitives to the screen is done using {@link prepareDraw}, {@link drawElements} and {@link finalizeDraw}.\n *   ```js\n *   // frame preparation step\n *   helper.prepareDraw(frameState);\n *\n *   // call this for every data array that has to be rendered on screen\n *   helper.drawElements(0, this.indicesBuffer.getArray().length);\n *\n *   // finalize the rendering by applying post processes\n *   helper.finalizeDraw(frameState);\n *   ```\n *\n * For an example usage of this class, refer to {@link module:ol/renderer/webgl/PointsLayer~WebGLPointsLayerRenderer}.\n */\nclass WebGLHelper extends Disposable {\n  /**\n   * @param {Options} [options] Options.\n   */\n  constructor(options) {\n    super();\n    options = options || {};\n\n    /** @private */\n    this.boundHandleWebGLContextLost_ = this.handleWebGLContextLost.bind(this);\n\n    /** @private */\n    this.boundHandleWebGLContextRestored_ =\n      this.handleWebGLContextRestored.bind(this);\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.canvasCacheKey_ = options.canvasCacheKey\n      ? getSharedCanvasCacheKey(options.canvasCacheKey)\n      : getUniqueCanvasCacheKey();\n\n    /**\n     * @private\n     * @type {WebGLRenderingContext}\n     */\n    this.gl_ = getOrCreateContext(this.canvasCacheKey_);\n\n    /**\n     * @private\n     * @type {!Object<string, BufferCacheEntry>}\n     */\n    this.bufferCache_ = {};\n\n    /**\n     * @private\n     * @type {Object<string, Object>}\n     */\n    this.extensionCache_ = {};\n\n    /**\n     * @private\n     * @type {WebGLProgram}\n     */\n    this.currentProgram_ = null;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.needsToBeRecreated_ = false;\n\n    const canvas = this.gl_.canvas;\n\n    canvas.addEventListener(\n      ContextEventType.LOST,\n      this.boundHandleWebGLContextLost_,\n    );\n    canvas.addEventListener(\n      ContextEventType.RESTORED,\n      this.boundHandleWebGLContextRestored_,\n    );\n\n    /**\n     * @private\n     * @type {import(\"../transform.js\").Transform}\n     */\n    this.offsetRotateMatrix_ = createTransform();\n\n    /**\n     * @private\n     * @type {import(\"../transform.js\").Transform}\n     */\n    this.offsetScaleMatrix_ = createTransform();\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.tmpMat4_ = create();\n\n    /**\n     * @private\n     * @type {Object<string, Object<string, WebGLUniformLocation>>}\n     */\n    this.uniformLocationsByProgram_ = {};\n\n    /**\n     * @private\n     * @type {Object<string, Object<string, number>>}\n     */\n    this.attribLocationsByProgram_ = {};\n\n    /**\n     * Holds info about custom uniforms used in the post processing pass.\n     * If the uniform is a texture, the WebGL Texture object will be stored here.\n     * @type {Array<UniformInternalDescription>}\n     * @private\n     */\n    this.uniforms_ = [];\n    if (options.uniforms) {\n      this.setUniforms(options.uniforms);\n    }\n\n    /**\n     * An array of PostProcessingPass objects is kept in this variable, built from the steps provided in the\n     * options. If no post process was given, a default one is used (so as not to have to make an exception to\n     * the frame buffer logic).\n     * @type {Array<WebGLPostProcessingPass>}\n     * @private\n     */\n    this.postProcessPasses_ = options.postProcesses\n      ? options.postProcesses.map(\n          (options) =>\n            new WebGLPostProcessingPass({\n              webGlContext: this.gl_,\n              scaleRatio: options.scaleRatio,\n              vertexShader: options.vertexShader,\n              fragmentShader: options.fragmentShader,\n              uniforms: options.uniforms,\n            }),\n        )\n      : [new WebGLPostProcessingPass({webGlContext: this.gl_})];\n\n    /**\n     * @type {string|null}\n     * @private\n     */\n    this.shaderCompileErrors_ = null;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.startTime_ = Date.now();\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.maxAttributeCount_ = this.gl_.getParameter(\n      this.gl_.MAX_VERTEX_ATTRIBS,\n    );\n  }\n\n  /**\n   * @param {Object<string, UniformValue>} uniforms Uniform definitions.\n   */\n  setUniforms(uniforms) {\n    this.uniforms_ = [];\n    this.addUniforms(uniforms);\n  }\n\n  /**\n   * @param {Object<string, UniformValue>} uniforms Uniform definitions.\n   */\n  addUniforms(uniforms) {\n    for (const name in uniforms) {\n      this.uniforms_.push({\n        name: name,\n        value: uniforms[name],\n      });\n    }\n  }\n\n  /**\n   * @param {string} canvasCacheKey The canvas cache key.\n   * @return {boolean} The provided key matches the one this helper was constructed with.\n   */\n  canvasCacheKeyMatches(canvasCacheKey) {\n    return this.canvasCacheKey_ === getSharedCanvasCacheKey(canvasCacheKey);\n  }\n\n  /**\n   * Get a WebGL extension.  If the extension is not supported, null is returned.\n   * Extensions are cached after they are enabled for the first time.\n   * @param {string} name The extension name.\n   * @return {Object|null} The extension or null if not supported.\n   */\n  getExtension(name) {\n    if (name in this.extensionCache_) {\n      return this.extensionCache_[name];\n    }\n    const extension = this.gl_.getExtension(name);\n    this.extensionCache_[name] = extension;\n    return extension;\n  }\n\n  /**\n   * Will throw if the extension is not available\n   * @return {ANGLE_instanced_arrays} Extension\n   */\n  getInstancedRenderingExtension_() {\n    const ext = this.getExtension('ANGLE_instanced_arrays');\n    assert(\n      !!ext,\n      \"WebGL extension 'ANGLE_instanced_arrays' is required for vector rendering\",\n    );\n    return ext;\n  }\n\n  /**\n   * Just bind the buffer if it's in the cache. Otherwise create\n   * the WebGL buffer, bind it, populate it, and add an entry to\n   * the cache.\n   * @param {import(\"./Buffer\").default} buffer Buffer.\n   */\n  bindBuffer(buffer) {\n    const gl = this.gl_;\n    const bufferKey = getUid(buffer);\n    let bufferCache = this.bufferCache_[bufferKey];\n    if (!bufferCache) {\n      const webGlBuffer = gl.createBuffer();\n      bufferCache = {\n        buffer: buffer,\n        webGlBuffer: webGlBuffer,\n      };\n      this.bufferCache_[bufferKey] = bufferCache;\n    }\n    gl.bindBuffer(buffer.getType(), bufferCache.webGlBuffer);\n  }\n\n  /**\n   * Update the data contained in the buffer array; this is required for the\n   * new data to be rendered\n   * @param {import(\"./Buffer\").default} buffer Buffer.\n   */\n  flushBufferData(buffer) {\n    const gl = this.gl_;\n    this.bindBuffer(buffer);\n    gl.bufferData(buffer.getType(), buffer.getArray(), buffer.getUsage());\n  }\n\n  /**\n   * @param {import(\"./Buffer.js\").default} buf Buffer.\n   */\n  deleteBuffer(buf) {\n    const bufferKey = getUid(buf);\n    // Note: gl.deleteBuffer is not called here since we let WebGL garbage collect it automatically\n    delete this.bufferCache_[bufferKey];\n  }\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    const canvas = this.gl_.canvas;\n    canvas.removeEventListener(\n      ContextEventType.LOST,\n      this.boundHandleWebGLContextLost_,\n    );\n    canvas.removeEventListener(\n      ContextEventType.RESTORED,\n      this.boundHandleWebGLContextRestored_,\n    );\n\n    releaseCanvas(this.canvasCacheKey_);\n\n    delete this.gl_;\n  }\n\n  /**\n   * Clear the buffer & set the viewport to draw.\n   * Post process passes will be initialized here, the first one being bound as a render target for\n   * subsequent draw calls.\n   * @param {import(\"../Map.js\").FrameState} frameState current frame state\n   * @param {boolean} [disableAlphaBlend] If true, no alpha blending will happen.\n   * @param {boolean} [enableDepth] If true, enables depth testing.\n   */\n  prepareDraw(frameState, disableAlphaBlend, enableDepth) {\n    const gl = this.gl_;\n    const canvas = this.getCanvas();\n    const size = frameState.size;\n    const pixelRatio = frameState.pixelRatio;\n\n    if (\n      canvas.width !== size[0] * pixelRatio ||\n      canvas.height !== size[1] * pixelRatio\n    ) {\n      canvas.width = size[0] * pixelRatio;\n      canvas.height = size[1] * pixelRatio;\n      canvas.style.width = size[0] + 'px';\n      canvas.style.height = size[1] + 'px';\n    }\n\n    // loop backwards in post processes list\n    for (let i = this.postProcessPasses_.length - 1; i >= 0; i--) {\n      this.postProcessPasses_[i].init(frameState);\n    }\n\n    gl.bindTexture(gl.TEXTURE_2D, null);\n\n    gl.clearColor(0.0, 0.0, 0.0, 0.0);\n    gl.depthRange(0.0, 1.0);\n    gl.clearDepth(1.0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n    gl.enable(gl.BLEND);\n    gl.blendFunc(gl.ONE, disableAlphaBlend ? gl.ZERO : gl.ONE_MINUS_SRC_ALPHA);\n    if (enableDepth) {\n      gl.enable(gl.DEPTH_TEST);\n      gl.depthFunc(gl.LEQUAL);\n    } else {\n      gl.disable(gl.DEPTH_TEST);\n    }\n  }\n\n  /**\n   * @param {WebGLFramebuffer|null} frameBuffer The frame buffer.\n   * @param {WebGLTexture} [texture] The texture.\n   */\n  bindFrameBuffer(frameBuffer, texture) {\n    const gl = this.getGL();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, frameBuffer);\n    if (texture) {\n      gl.framebufferTexture2D(\n        gl.FRAMEBUFFER,\n        gl.COLOR_ATTACHMENT0,\n        gl.TEXTURE_2D,\n        texture,\n        0,\n      );\n    }\n  }\n\n  /**\n   * Bind the frame buffer from the initial render.\n   */\n  bindInitialFrameBuffer() {\n    const gl = this.getGL();\n    const frameBuffer = this.postProcessPasses_[0].getFrameBuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, frameBuffer);\n    const texture = this.postProcessPasses_[0].getRenderTargetTexture();\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER,\n      gl.COLOR_ATTACHMENT0,\n      gl.TEXTURE_2D,\n      texture,\n      0,\n    );\n  }\n\n  /**\n   * Prepare a program to use a texture.\n   * @param {WebGLTexture} texture The texture.\n   * @param {number} slot The texture slot.\n   * @param {string} uniformName The corresponding uniform name.\n   */\n  bindTexture(texture, slot, uniformName) {\n    const gl = this.gl_;\n    gl.activeTexture(gl.TEXTURE0 + slot);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.uniform1i(this.getUniformLocation(uniformName), slot);\n  }\n\n  /**\n   * Set up an attribute array buffer for use in the vertex shader.\n   * @param {import(\"./Buffer\").default} buffer The buffer.\n   * @param {string} attributeName The attribute name.\n   * @param {number} size The number of components per attribute vertex.\n   */\n  bindAttribute(buffer, attributeName, size) {\n    const gl = this.getGL();\n    this.bindBuffer(buffer);\n    const index = this.getAttributeLocation(attributeName);\n    gl.enableVertexAttribArray(index);\n    gl.vertexAttribPointer(index, size, gl.FLOAT, false, 0, 0);\n  }\n\n  /**\n   * Clear the render target & bind it for future draw operations.\n   * This is similar to `prepareDraw`, only post processes will not be applied.\n   * Note: the whole viewport will be drawn to the render target, regardless of its size.\n   * @param {import(\"../Map.js\").FrameState} frameState current frame state\n   * @param {import(\"./RenderTarget.js\").default} renderTarget Render target to draw to\n   * @param {boolean} [disableAlphaBlend] If true, no alpha blending will happen.\n   * @param {boolean} [enableDepth] If true, enables depth testing.\n   */\n  prepareDrawToRenderTarget(\n    frameState,\n    renderTarget,\n    disableAlphaBlend,\n    enableDepth,\n  ) {\n    const gl = this.gl_;\n    const size = renderTarget.getSize();\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, renderTarget.getFramebuffer());\n    gl.bindRenderbuffer(gl.RENDERBUFFER, renderTarget.getDepthbuffer());\n    gl.viewport(0, 0, size[0], size[1]);\n    gl.bindTexture(gl.TEXTURE_2D, renderTarget.getTexture());\n    gl.clearColor(0.0, 0.0, 0.0, 0.0);\n    gl.depthRange(0.0, 1.0);\n    gl.clearDepth(1.0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    gl.enable(gl.BLEND);\n    gl.blendFunc(gl.ONE, disableAlphaBlend ? gl.ZERO : gl.ONE_MINUS_SRC_ALPHA);\n    if (enableDepth) {\n      gl.enable(gl.DEPTH_TEST);\n      gl.depthFunc(gl.LEQUAL);\n    } else {\n      gl.disable(gl.DEPTH_TEST);\n    }\n  }\n\n  /**\n   * Execute a draw call based on the currently bound program, texture, buffers, attributes.\n   * @param {number} start Start index.\n   * @param {number} end End index.\n   */\n  drawElements(start, end) {\n    const gl = this.gl_;\n    this.getExtension('OES_element_index_uint');\n\n    const elementType = gl.UNSIGNED_INT;\n    const elementSize = 4;\n\n    const numItems = end - start;\n    const offsetInBytes = start * elementSize;\n    gl.drawElements(gl.TRIANGLES, numItems, elementType, offsetInBytes);\n  }\n\n  /**\n   * Execute a draw call similar to `drawElements`, but using instanced rendering.\n   * Will have no effect if `enableAttributesInstanced` was not called for this rendering pass.\n   * @param {number} start Start index.\n   * @param {number} end End index.\n   * @param {number} instanceCount The number of instances to render\n   */\n  drawElementsInstanced(start, end, instanceCount) {\n    const gl = this.gl_;\n    this.getExtension('OES_element_index_uint');\n    const ext = this.getInstancedRenderingExtension_();\n\n    const elementType = gl.UNSIGNED_INT;\n    const elementSize = 4;\n\n    const numItems = end - start;\n    const offsetInBytes = start * elementSize;\n    ext.drawElementsInstancedANGLE(\n      gl.TRIANGLES,\n      numItems,\n      elementType,\n      offsetInBytes,\n      instanceCount,\n    );\n\n    // reset divisor values to avoid side effects\n    for (let i = 0; i < this.maxAttributeCount_; i++) {\n      ext.vertexAttribDivisorANGLE(i, 0);\n    }\n  }\n\n  /**\n   * Apply the successive post process passes which will eventually render to the actual canvas.\n   * @param {import(\"../Map.js\").FrameState} frameState current frame state\n   * @param {function(WebGLRenderingContext, import(\"../Map.js\").FrameState):void} [preCompose] Called before composing.\n   * @param {function(WebGLRenderingContext, import(\"../Map.js\").FrameState):void} [postCompose] Called before composing.\n   */\n  finalizeDraw(frameState, preCompose, postCompose) {\n    // apply post processes using the next one as target\n    for (let i = 0, ii = this.postProcessPasses_.length; i < ii; i++) {\n      if (i === ii - 1) {\n        this.postProcessPasses_[i].apply(\n          frameState,\n          null,\n          preCompose,\n          postCompose,\n        );\n      } else {\n        this.postProcessPasses_[i].apply(\n          frameState,\n          this.postProcessPasses_[i + 1],\n        );\n      }\n    }\n  }\n\n  /**\n   * @return {HTMLCanvasElement} Canvas.\n   */\n  getCanvas() {\n    return /** @type {HTMLCanvasElement} */ (this.gl_.canvas);\n  }\n\n  /**\n   * Get the WebGL rendering context\n   * @return {WebGLRenderingContext} The rendering context.\n   */\n  getGL() {\n    return this.gl_;\n  }\n\n  /**\n   * Sets the default matrix uniforms for a given frame state. This is called internally in `prepareDraw`.\n   * @param {import(\"../Map.js\").FrameState} frameState Frame state.\n   */\n  applyFrameState(frameState) {\n    const size = frameState.size;\n    const rotation = frameState.viewState.rotation;\n    const pixelRatio = frameState.pixelRatio;\n\n    this.setUniformFloatValue(\n      DefaultUniform.TIME,\n      (Date.now() - this.startTime_) * 0.001,\n    );\n    this.setUniformFloatValue(DefaultUniform.ZOOM, frameState.viewState.zoom);\n    this.setUniformFloatValue(\n      DefaultUniform.RESOLUTION,\n      frameState.viewState.resolution,\n    );\n    this.setUniformFloatValue(DefaultUniform.PIXEL_RATIO, pixelRatio);\n    this.setUniformFloatVec2(DefaultUniform.VIEWPORT_SIZE_PX, [\n      size[0],\n      size[1],\n    ]);\n    this.setUniformFloatValue(DefaultUniform.ROTATION, rotation);\n  }\n\n  /**\n   * Sets the `u_hitDetection` uniform.\n   * @param {boolean} enabled Whether to enable the hit detection code path\n   */\n  applyHitDetectionUniform(enabled) {\n    const loc = this.getUniformLocation(DefaultUniform.HIT_DETECTION);\n    this.getGL().uniform1i(loc, enabled ? 1 : 0);\n\n    // hit detection uses a fixed pixel ratio\n    if (enabled) {\n      this.setUniformFloatValue(DefaultUniform.PIXEL_RATIO, 0.5);\n    }\n  }\n\n  /**\n   * Sets the custom uniforms based on what was given in the constructor. This is called internally in `prepareDraw`.\n   * @param {import(\"../Map.js\").FrameState} frameState Frame state.\n   */\n  applyUniforms(frameState) {\n    const gl = this.gl_;\n\n    let value;\n    let textureSlot = 0;\n    this.uniforms_.forEach((uniform) => {\n      value =\n        typeof uniform.value === 'function'\n          ? uniform.value(frameState)\n          : uniform.value;\n\n      // apply value based on type\n      if (\n        value instanceof HTMLCanvasElement ||\n        value instanceof HTMLImageElement ||\n        value instanceof ImageData ||\n        value instanceof WebGLTexture\n      ) {\n        // create a texture & put data\n        if (value instanceof WebGLTexture && !uniform.texture) {\n          uniform.prevValue = undefined;\n          uniform.texture = value;\n        } else if (!uniform.texture) {\n          uniform.prevValue = undefined;\n          uniform.texture = gl.createTexture();\n        }\n        this.bindTexture(uniform.texture, textureSlot, uniform.name);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n        const imageReady =\n          !(value instanceof HTMLImageElement) ||\n          /** @type {HTMLImageElement} */ (value).complete;\n        if (\n          !(value instanceof WebGLTexture) &&\n          imageReady &&\n          uniform.prevValue !== value\n        ) {\n          uniform.prevValue = value;\n          gl.texImage2D(\n            gl.TEXTURE_2D,\n            0,\n            gl.RGBA,\n            gl.RGBA,\n            gl.UNSIGNED_BYTE,\n            value,\n          );\n        }\n        textureSlot++;\n      } else if (Array.isArray(value) && value.length === 6) {\n        this.setUniformMatrixValue(\n          uniform.name,\n          fromTransform(this.tmpMat4_, value),\n        );\n      } else if (Array.isArray(value) && value.length <= 4) {\n        switch (value.length) {\n          case 2:\n            gl.uniform2f(\n              this.getUniformLocation(uniform.name),\n              value[0],\n              value[1],\n            );\n            return;\n          case 3:\n            gl.uniform3f(\n              this.getUniformLocation(uniform.name),\n              value[0],\n              value[1],\n              value[2],\n            );\n            return;\n          case 4:\n            gl.uniform4f(\n              this.getUniformLocation(uniform.name),\n              value[0],\n              value[1],\n              value[2],\n              value[3],\n            );\n            return;\n          default:\n            return;\n        }\n      } else if (typeof value === 'number') {\n        gl.uniform1f(this.getUniformLocation(uniform.name), value);\n      }\n    });\n  }\n\n  /**\n   * Set up a program for use. The program will be set as the current one. Then, the uniforms used\n   * in the program will be set based on the current frame state and the helper configuration.\n   * @param {WebGLProgram} program Program.\n   * @param {import(\"../Map.js\").FrameState} [frameState] Frame state.\n   */\n  useProgram(program, frameState) {\n    this.disableAllAttributes_();\n    const gl = this.gl_;\n    gl.useProgram(program);\n    this.currentProgram_ = program;\n    if (frameState) {\n      this.applyFrameState(frameState);\n      this.applyUniforms(frameState);\n    }\n  }\n\n  /**\n   * Will attempt to compile a vertex or fragment shader based on source\n   * On error, the shader will be returned but\n   * `gl.getShaderParameter(shader, gl.COMPILE_STATUS)` will return `true`\n   * Use `gl.getShaderInfoLog(shader)` to have details\n   * @param {string} source Shader source\n   * @param {ShaderType} type VERTEX_SHADER or FRAGMENT_SHADER\n   * @return {WebGLShader} Shader object\n   */\n  compileShader(source, type) {\n    const gl = this.gl_;\n    const shader = gl.createShader(type);\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n    return shader;\n  }\n\n  /**\n   * Create a program for a vertex and fragment shader.  Throws if shader compilation fails.\n   * @param {string} fragmentShaderSource Fragment shader source.\n   * @param {string} vertexShaderSource Vertex shader source.\n   * @return {WebGLProgram} Program\n   */\n  getProgram(fragmentShaderSource, vertexShaderSource) {\n    const gl = this.gl_;\n\n    const fragmentShader = this.compileShader(\n      fragmentShaderSource,\n      gl.FRAGMENT_SHADER,\n    );\n\n    const vertexShader = this.compileShader(\n      vertexShaderSource,\n      gl.VERTEX_SHADER,\n    );\n\n    const program = gl.createProgram();\n    gl.attachShader(program, fragmentShader);\n    gl.attachShader(program, vertexShader);\n    gl.linkProgram(program);\n\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n      const message = `Fragment shader compilation failed: ${gl.getShaderInfoLog(\n        fragmentShader,\n      )}`;\n      throw new Error(message);\n    }\n    gl.deleteShader(fragmentShader);\n\n    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n      const message = `Vertex shader compilation failed: ${gl.getShaderInfoLog(\n        vertexShader,\n      )}`;\n      throw new Error(message);\n    }\n    gl.deleteShader(vertexShader);\n\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      const message = `GL program linking failed: ${gl.getProgramInfoLog(\n        program,\n      )}`;\n      throw new Error(message);\n    }\n\n    return program;\n  }\n\n  /**\n   * Will get the location from the shader or the cache\n   * @param {string} name Uniform name\n   * @return {WebGLUniformLocation} uniformLocation\n   */\n  getUniformLocation(name) {\n    const programUid = getUid(this.currentProgram_);\n    if (this.uniformLocationsByProgram_[programUid] === undefined) {\n      this.uniformLocationsByProgram_[programUid] = {};\n    }\n    if (this.uniformLocationsByProgram_[programUid][name] === undefined) {\n      this.uniformLocationsByProgram_[programUid][name] =\n        this.gl_.getUniformLocation(this.currentProgram_, name);\n    }\n    return this.uniformLocationsByProgram_[programUid][name];\n  }\n\n  /**\n   * Will get the location from the shader or the cache\n   * @param {string} name Attribute name\n   * @return {number} attribLocation\n   */\n  getAttributeLocation(name) {\n    const programUid = getUid(this.currentProgram_);\n    if (this.attribLocationsByProgram_[programUid] === undefined) {\n      this.attribLocationsByProgram_[programUid] = {};\n    }\n    if (this.attribLocationsByProgram_[programUid][name] === undefined) {\n      this.attribLocationsByProgram_[programUid][name] =\n        this.gl_.getAttribLocation(this.currentProgram_, name);\n    }\n    return this.attribLocationsByProgram_[programUid][name];\n  }\n\n  /**\n   * Sets the given transform to apply the rotation/translation/scaling of the given frame state.\n   * The resulting transform can be used to convert world space coordinates to view coordinates in the [-1, 1] range.\n   * @param {import(\"../Map.js\").FrameState} frameState Frame state.\n   * @param {import(\"../transform\").Transform} transform Transform to update.\n   * @return {import(\"../transform\").Transform} The updated transform object.\n   */\n  makeProjectionTransform(frameState, transform) {\n    const size = frameState.size;\n    const rotation = frameState.viewState.rotation;\n    const resolution = frameState.viewState.resolution;\n    const center = frameState.viewState.center;\n    composeTransform(\n      transform,\n      0,\n      0,\n      2 / (resolution * size[0]),\n      2 / (resolution * size[1]),\n      -rotation,\n      -center[0],\n      -center[1],\n    );\n    return transform;\n  }\n\n  /**\n   * Give a value for a standard float uniform\n   * @param {string} uniform Uniform name\n   * @param {number} value Value\n   */\n  setUniformFloatValue(uniform, value) {\n    this.gl_.uniform1f(this.getUniformLocation(uniform), value);\n  }\n\n  /**\n   * Give a value for a vec2 uniform\n   * @param {string} uniform Uniform name\n   * @param {Array<number>} value Array of length 4.\n   */\n  setUniformFloatVec2(uniform, value) {\n    this.gl_.uniform2fv(this.getUniformLocation(uniform), value);\n  }\n\n  /**\n   * Give a value for a vec4 uniform\n   * @param {string} uniform Uniform name\n   * @param {Array<number>} value Array of length 4.\n   */\n  setUniformFloatVec4(uniform, value) {\n    this.gl_.uniform4fv(this.getUniformLocation(uniform), value);\n  }\n\n  /**\n   * Give a value for a standard matrix4 uniform\n   * @param {string} uniform Uniform name\n   * @param {Array<number>} value Matrix value\n   */\n  setUniformMatrixValue(uniform, value) {\n    this.gl_.uniformMatrix4fv(this.getUniformLocation(uniform), false, value);\n  }\n\n  /**\n   * Disable all vertex attributes.\n   * @private\n   */\n  disableAllAttributes_() {\n    for (let i = 0; i < this.maxAttributeCount_; i++) {\n      this.gl_.disableVertexAttribArray(i);\n    }\n  }\n\n  /**\n   * Will set the currently bound buffer to an attribute of the shader program. Used by `#enableAttributes`\n   * internally.\n   * @param {string} attribName Attribute name\n   * @param {number} size Number of components per attributes\n   * @param {number} type UNSIGNED_INT, UNSIGNED_BYTE, UNSIGNED_SHORT or FLOAT\n   * @param {number} stride Stride in bytes (0 means attribs are packed)\n   * @param {number} offset Offset in bytes\n   * @param {boolean} instanced Whether the attribute is used for instanced rendering\n   * @private\n   */\n  enableAttributeArray_(attribName, size, type, stride, offset, instanced) {\n    const location = this.getAttributeLocation(attribName);\n    // the attribute has not been found in the shaders or is not used; do not enable it\n    if (location < 0) {\n      return;\n    }\n    this.gl_.enableVertexAttribArray(location);\n    this.gl_.vertexAttribPointer(location, size, type, false, stride, offset);\n    if (instanced) {\n      // note: this is reset to 0 after drawElementsInstanced is called\n      this.getInstancedRenderingExtension_().vertexAttribDivisorANGLE(\n        location,\n        1,\n      );\n    }\n  }\n\n  /**\n   * @private\n   * @param {Array<AttributeDescription>} attributes Ordered list of attributes to read from the buffer\n   * @param {boolean} instanced Whether the attributes are instanced.\n   */\n  enableAttributes_(attributes, instanced) {\n    const stride = computeAttributesStride(attributes);\n    let offset = 0;\n    for (let i = 0; i < attributes.length; i++) {\n      const attr = attributes[i];\n      // if a name is not given, simply skip this slot in the buffer\n      if (attr.name) {\n        this.enableAttributeArray_(\n          attr.name,\n          attr.size,\n          attr.type || FLOAT,\n          stride,\n          offset,\n          instanced,\n        );\n      }\n      offset += attr.size * getByteSizeFromType(attr.type);\n    }\n  }\n\n  /**\n   * Will enable the following attributes to be read from the currently bound buffer,\n   * i.e. tell the GPU where to read the different attributes in the buffer. An error in the\n   * size/type/order of attributes will most likely break the rendering and throw a WebGL exception.\n   * @param {Array<AttributeDescription>} attributes Ordered list of attributes to read from the buffer\n   */\n  enableAttributes(attributes) {\n    this.enableAttributes_(attributes, false);\n  }\n\n  /**\n   * Will enable these attributes as instanced, meaning that they will only be read\n   * once per instance instead of per vertex.\n   * @param {Array<AttributeDescription>} attributes Ordered list of attributes to read from the buffer\n   */\n  enableAttributesInstanced(attributes) {\n    this.enableAttributes_(attributes, true);\n  }\n\n  /**\n   * WebGL context was lost\n   * @param {WebGLContextEvent} event The context loss event.\n   * @private\n   */\n  handleWebGLContextLost(event) {\n    clear(this.bufferCache_);\n    this.currentProgram_ = null;\n\n    event.preventDefault();\n  }\n\n  /**\n   * WebGL context was restored\n   * @private\n   */\n  handleWebGLContextRestored() {\n    this.needsToBeRecreated_ = true;\n  }\n\n  /**\n   * Returns whether this helper needs to be recreated, as the context was lost and then restored.\n   * @return {boolean} Whether this helper needs to be recreated.\n   */\n  needsToBeRecreated() {\n    return this.needsToBeRecreated_;\n  }\n\n  /**\n   * Will create or reuse a given webgl texture and apply the given size. If no image data\n   * specified, the texture will be empty, otherwise image data will be used and the `size`\n   * parameter will be ignored.  If a Uint8Array is provided for data, a size must also be provided.\n   * Note: wrap parameters are set to clamp to edge, min filter is set to linear.\n   * @param {Array<number>} size Expected size of the texture\n   * @param {ImageData|HTMLImageElement|HTMLCanvasElement|Uint8Array|null} data Image data/object to bind to the texture\n   * @param {WebGLTexture} [texture] Existing texture to reuse\n   * @param {boolean} [nearest] Use gl.NEAREST for min/mag filter.\n   * @return {WebGLTexture} The generated texture\n   */\n  createTexture(size, data, texture, nearest) {\n    const gl = this.gl_;\n    texture = texture || gl.createTexture();\n    const filter = nearest ? gl.NEAREST : gl.LINEAR;\n\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n    const level = 0;\n    const internalFormat = gl.RGBA;\n    const border = 0;\n    const format = gl.RGBA;\n    const type = gl.UNSIGNED_BYTE;\n\n    if (data instanceof Uint8Array) {\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        level,\n        internalFormat,\n        size[0],\n        size[1],\n        border,\n        format,\n        type,\n        data,\n      );\n    } else if (data) {\n      gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, format, type, data);\n    } else {\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        level,\n        internalFormat,\n        size[0],\n        size[1],\n        border,\n        format,\n        type,\n        null,\n      );\n    }\n    return texture;\n  }\n}\n\n/**\n * Compute a stride in bytes based on a list of attributes\n * @param {Array<AttributeDescription>} attributes Ordered list of attributes\n * @return {number} Stride, ie amount of values for each vertex in the vertex buffer\n */\nexport function computeAttributesStride(attributes) {\n  let stride = 0;\n  for (let i = 0; i < attributes.length; i++) {\n    const attr = attributes[i];\n    stride += attr.size * getByteSizeFromType(attr.type);\n  }\n  return stride;\n}\n\n/**\n * Computes the size in byte of an attribute type.\n * @param {AttributeType} type Attribute type\n * @return {number} The size in bytes\n */\nfunction getByteSizeFromType(type) {\n  switch (type) {\n    case AttributeType.UNSIGNED_BYTE:\n      return Uint8Array.BYTES_PER_ELEMENT;\n    case AttributeType.UNSIGNED_SHORT:\n      return Uint16Array.BYTES_PER_ELEMENT;\n    case AttributeType.UNSIGNED_INT:\n      return Uint32Array.BYTES_PER_ELEMENT;\n    case AttributeType.FLOAT:\n    default:\n      return Float32Array.BYTES_PER_ELEMENT;\n  }\n}\n\nexport default WebGLHelper;\n","/**\n * @module ol/webgl/BaseTileRepresentation\n */\n\nimport ImageTile from '../ImageTile.js';\nimport TileState from '../TileState.js';\nimport EventType from '../events/EventType.js';\nimport EventTarget from '../events/Target.js';\nimport {abstract} from '../util.js';\n\n/**\n * @typedef {import(\"../Tile.js\").default} BaseTileType\n */\n\n/**\n * @template {BaseTileType} TileType\n * @typedef {Object} TileRepresentationOptions\n * @property {TileType} tile The tile.\n * @property {import(\"../tilegrid/TileGrid.js\").default} grid Tile grid.\n * @property {import(\"../webgl/Helper.js\").default} helper WebGL helper.\n * @property {number} [gutter=0] The size in pixels of the gutter around image tiles to ignore.\n */\n\n/**\n * @classdesc\n * Base class for representing a tile in a webgl context\n * @template {import(\"../Tile.js\").default} TileType\n * @abstract\n */\nclass BaseTileRepresentation extends EventTarget {\n  /**\n   * @param {TileRepresentationOptions<TileType>} options The tile representation options.\n   */\n  constructor(options) {\n    super();\n\n    /**\n     * @type {TileType}\n     */\n    this.tile;\n\n    /**\n     * @private\n     */\n    this.handleTileChange_ = this.handleTileChange_.bind(this);\n\n    /**\n     * @type {number}\n     * @protected\n     */\n    this.gutter = options.gutter || 0;\n\n    /**\n     * @type {import(\"../webgl/Helper.js\").default}\n     * @protected\n     */\n    this.helper = options.helper;\n\n    this.loaded = false;\n    this.ready = false;\n  }\n\n  /**\n   * @param {TileType} tile Tile.\n   */\n  setTile(tile) {\n    if (tile !== this.tile) {\n      if (this.tile) {\n        this.tile.removeEventListener(EventType.CHANGE, this.handleTileChange_);\n      }\n      this.tile = tile;\n      this.loaded = tile.getState() === TileState.LOADED;\n      if (this.loaded) {\n        this.uploadTile();\n      } else {\n        if (tile instanceof ImageTile) {\n          const image = tile.getImage();\n          if (image instanceof Image && !image.crossOrigin) {\n            image.crossOrigin = 'anonymous';\n          }\n        }\n        tile.addEventListener(EventType.CHANGE, this.handleTileChange_);\n      }\n    }\n  }\n\n  /**\n   * @abstract\n   * @protected\n   */\n  uploadTile() {\n    abstract();\n  }\n\n  setReady() {\n    this.ready = true;\n    this.dispatchEvent(EventType.CHANGE);\n  }\n\n  handleTileChange_() {\n    if (this.tile.getState() === TileState.LOADED) {\n      this.loaded = true;\n      this.uploadTile();\n    }\n  }\n\n  /**\n   * @param {import(\"./Helper.js\").default} helper The WebGL helper.\n   */\n  setHelper(helper) {\n    this.helper = helper;\n    if (this.helper && this.loaded) {\n      this.uploadTile();\n    }\n  }\n\n  /**\n   * @override\n   */\n  disposeInternal() {\n    this.setHelper(null);\n    this.tile.removeEventListener(EventType.CHANGE, this.handleTileChange_);\n  }\n}\n\nexport default BaseTileRepresentation;\n","/**\n * @module ol/webgl/TileTexture\n */\n\nimport DataTile, {asArrayLike, asImageLike} from '../DataTile.js';\nimport ImageTile from '../ImageTile.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport ReprojTile from '../reproj/Tile.js';\nimport {toSize} from '../size.js';\nimport {ARRAY_BUFFER, STATIC_DRAW} from '../webgl.js';\nimport BaseTileRepresentation from './BaseTileRepresentation.js';\nimport WebGLArrayBuffer from './Buffer.js';\n\n/**\n * @param {WebGLRenderingContext} gl The WebGL context.\n * @param {WebGLTexture} texture The texture.\n * @param {boolean} interpolate Interpolate when resampling.\n */\nfunction bindAndConfigure(gl, texture, interpolate) {\n  const resampleFilter = interpolate ? gl.LINEAR : gl.NEAREST;\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, resampleFilter);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, resampleFilter);\n}\n\n/**\n * @param {WebGLRenderingContext} gl The WebGL context.\n * @param {WebGLTexture} texture The texture.\n * @param {import(\"../DataTile.js\").ImageLike} image The image.\n * @param {boolean} interpolate Interpolate when resampling.\n */\nfunction uploadImageTexture(gl, texture, image, interpolate) {\n  bindAndConfigure(gl, texture, interpolate);\n\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n}\n\n/**\n * @param {import(\"./Helper.js\").default} helper The WebGL helper.\n * @param {WebGLTexture} texture The texture.\n * @param {import(\"../DataTile.js\").ArrayLike} data The pixel data.\n * @param {import(\"../size.js\").Size} size The pixel size.\n * @param {number} bandCount The band count.\n * @param {boolean} interpolate Interpolate when resampling.\n */\nfunction uploadDataTexture(\n  helper,\n  texture,\n  data,\n  size,\n  bandCount,\n  interpolate,\n) {\n  const gl = helper.getGL();\n  let textureType;\n  let canInterpolate;\n  if (data instanceof Float32Array) {\n    textureType = gl.FLOAT;\n    helper.getExtension('OES_texture_float');\n    const extension = helper.getExtension('OES_texture_float_linear');\n    canInterpolate = extension !== null;\n  } else {\n    textureType = gl.UNSIGNED_BYTE;\n    canInterpolate = true;\n  }\n  bindAndConfigure(gl, texture, interpolate && canInterpolate);\n\n  const bytesPerRow = data.byteLength / size[1];\n  let unpackAlignment = 1;\n  if (bytesPerRow % 8 === 0) {\n    unpackAlignment = 8;\n  } else if (bytesPerRow % 4 === 0) {\n    unpackAlignment = 4;\n  } else if (bytesPerRow % 2 === 0) {\n    unpackAlignment = 2;\n  }\n\n  let format;\n  switch (bandCount) {\n    case 1: {\n      format = gl.LUMINANCE;\n      break;\n    }\n    case 2: {\n      format = gl.LUMINANCE_ALPHA;\n      break;\n    }\n    case 3: {\n      format = gl.RGB;\n      break;\n    }\n    case 4: {\n      format = gl.RGBA;\n      break;\n    }\n    default: {\n      throw new Error(`Unsupported number of bands: ${bandCount}`);\n    }\n  }\n\n  const oldUnpackAlignment = gl.getParameter(gl.UNPACK_ALIGNMENT);\n  gl.pixelStorei(gl.UNPACK_ALIGNMENT, unpackAlignment);\n  gl.texImage2D(\n    gl.TEXTURE_2D,\n    0,\n    format,\n    size[0],\n    size[1],\n    0,\n    format,\n    textureType,\n    data,\n  );\n  gl.pixelStorei(gl.UNPACK_ALIGNMENT, oldUnpackAlignment);\n}\n\n/**\n * @type {CanvasRenderingContext2D|OffscreenCanvasRenderingContext2D}\n */\nlet pixelContext = null;\n\nfunction createPixelContext() {\n  pixelContext = createCanvasContext2D(1, 1, undefined, {\n    willReadFrequently: true,\n  });\n}\n\n/**\n * @typedef {import(\"../DataTile.js\").default|ImageTile|ReprojTile} TileType\n */\n\n/**\n * @extends {BaseTileRepresentation<TileType>}\n */\nclass TileTexture extends BaseTileRepresentation {\n  /**\n   * @param {import(\"./BaseTileRepresentation.js\").TileRepresentationOptions<TileType>} options The tile texture options.\n   */\n  constructor(options) {\n    super(options);\n\n    /**\n     * @type {Array<WebGLTexture>}\n     */\n    this.textures = [];\n\n    /**\n     * @type {import(\"../size.js\").Size}\n     * @private\n     */\n    this.renderSize_ = toSize(\n      options.grid.getTileSize(options.tile.tileCoord[0]),\n    );\n\n    /**\n     * @type {number}\n     */\n    this.bandCount = NaN;\n\n    const coords = new WebGLArrayBuffer(ARRAY_BUFFER, STATIC_DRAW);\n    coords.fromArray([\n      0, // P0\n      1,\n      1, // P1\n      1,\n      1, // P2\n      0,\n      0, // P3\n      0,\n    ]);\n    this.helper.flushBufferData(coords);\n\n    /**\n     * @type {WebGLArrayBuffer}\n     */\n    this.coords = coords;\n\n    this.setTile(options.tile);\n  }\n\n  /**\n   * @override\n   * @param {import(\"./Helper.js\").default} helper The WebGL helper.\n   */\n  setHelper(helper) {\n    const gl = this.helper?.getGL();\n    if (gl) {\n      this.helper.deleteBuffer(this.coords);\n      for (let i = 0; i < this.textures.length; ++i) {\n        gl.deleteTexture(this.textures[i]);\n      }\n    }\n\n    super.setHelper(helper);\n\n    if (helper) {\n      helper.flushBufferData(this.coords);\n    }\n  }\n\n  /**\n   * @override\n   */\n  uploadTile() {\n    const helper = this.helper;\n    const gl = helper.getGL();\n    const tile = this.tile;\n\n    this.textures.length = 0;\n\n    /**\n     * @type {import(\"../DataTile.js\").Data}\n     */\n    let data;\n\n    if (tile instanceof ImageTile || tile instanceof ReprojTile) {\n      data = tile.getImage();\n    } else {\n      data = tile.getData();\n    }\n\n    const image = asImageLike(data);\n    if (image) {\n      const texture = gl.createTexture();\n      this.textures.push(texture);\n      this.bandCount = 4;\n      uploadImageTexture(gl, texture, image, tile.interpolate);\n      this.setReady();\n      return;\n    }\n\n    data = asArrayLike(data);\n\n    const sourceTileSize = /** @type {DataTile} */ (tile).getSize();\n    const pixelSize = [\n      sourceTileSize[0] + 2 * this.gutter,\n      sourceTileSize[1] + 2 * this.gutter,\n    ];\n    const isFloat = data instanceof Float32Array;\n    const pixelCount = pixelSize[0] * pixelSize[1];\n    const DataType = isFloat ? Float32Array : Uint8Array;\n    const bytesPerElement = DataType.BYTES_PER_ELEMENT;\n    const bytesPerRow = data.byteLength / pixelSize[1];\n\n    this.bandCount = Math.floor(bytesPerRow / bytesPerElement / pixelSize[0]);\n    const textureCount = Math.ceil(this.bandCount / 4);\n\n    if (textureCount === 1) {\n      const texture = gl.createTexture();\n      this.textures.push(texture);\n      uploadDataTexture(\n        helper,\n        texture,\n        data,\n        pixelSize,\n        this.bandCount,\n        tile.interpolate,\n      );\n      this.setReady();\n      return;\n    }\n\n    const textureDataArrays = new Array(textureCount);\n    for (let textureIndex = 0; textureIndex < textureCount; ++textureIndex) {\n      const texture = gl.createTexture();\n      this.textures.push(texture);\n\n      const bandCount =\n        textureIndex < textureCount - 1 ? 4 : ((this.bandCount - 1) % 4) + 1;\n      textureDataArrays[textureIndex] = new DataType(pixelCount * bandCount);\n    }\n\n    let dataIndex = 0;\n    let rowOffset = 0;\n    const colCount = pixelSize[0] * this.bandCount;\n    for (let rowIndex = 0; rowIndex < pixelSize[1]; ++rowIndex) {\n      for (let colIndex = 0; colIndex < colCount; ++colIndex) {\n        const dataValue = data[rowOffset + colIndex];\n\n        const pixelIndex = Math.floor(dataIndex / this.bandCount);\n        const bandIndex = colIndex % this.bandCount;\n        const textureIndex = Math.floor(bandIndex / 4);\n        const textureData = textureDataArrays[textureIndex];\n        const bandCount = textureData.length / pixelCount;\n        const textureBandIndex = bandIndex % 4;\n        textureData[pixelIndex * bandCount + textureBandIndex] = dataValue;\n\n        ++dataIndex;\n      }\n      rowOffset += bytesPerRow / bytesPerElement;\n    }\n\n    for (let textureIndex = 0; textureIndex < textureCount; ++textureIndex) {\n      const texture = this.textures[textureIndex];\n      const textureData = textureDataArrays[textureIndex];\n      const bandCount = textureData.length / pixelCount;\n      uploadDataTexture(\n        helper,\n        texture,\n        textureData,\n        pixelSize,\n        bandCount,\n        tile.interpolate,\n      );\n    }\n\n    this.setReady();\n  }\n\n  /**\n   * @param {import(\"../DataTile.js\").ImageLike} image The image.\n   * @param {number} renderCol The column index (in rendered tile space).\n   * @param {number} renderRow The row index (in rendered tile space).\n   * @return {Uint8ClampedArray|null} The data.\n   * @private\n   */\n  getImagePixelData_(image, renderCol, renderRow) {\n    const gutter = this.gutter;\n    const renderWidth = this.renderSize_[0];\n    const renderHeight = this.renderSize_[1];\n\n    if (!pixelContext) {\n      createPixelContext();\n    }\n    pixelContext.clearRect(0, 0, 1, 1);\n\n    const sourceWidth = image.width;\n    const sourceHeight = image.height;\n\n    const sourceWidthWithoutGutter = sourceWidth - 2 * gutter;\n    const sourceHeightWithoutGutter = sourceHeight - 2 * gutter;\n\n    const sourceCol =\n      gutter + Math.floor(sourceWidthWithoutGutter * (renderCol / renderWidth));\n\n    const sourceRow =\n      gutter +\n      Math.floor(sourceHeightWithoutGutter * (renderRow / renderHeight));\n\n    let data;\n    try {\n      pixelContext.drawImage(image, sourceCol, sourceRow, 1, 1, 0, 0, 1, 1);\n      data = pixelContext.getImageData(0, 0, 1, 1).data;\n    } catch {\n      pixelContext = null;\n      return null;\n    }\n    return data;\n  }\n\n  /**\n   * @param {import(\"../DataTile.js\").ArrayLike} data The data.\n   * @param {import(\"../size.js\").Size} sourceSize The size.\n   * @param {number} renderCol The column index (in rendered tile space).\n   * @param {number} renderRow The row index (in rendered tile space).\n   * @return {import(\"../DataTile.js\").ArrayLike|null} The data.\n   * @private\n   */\n  getArrayPixelData_(data, sourceSize, renderCol, renderRow) {\n    const gutter = this.gutter;\n    const renderWidth = this.renderSize_[0];\n    const renderHeight = this.renderSize_[1];\n\n    const sourceWidthWithoutGutter = sourceSize[0];\n    const sourceHeightWithoutGutter = sourceSize[1];\n    const sourceWidth = sourceWidthWithoutGutter + 2 * gutter;\n    const sourceHeight = sourceHeightWithoutGutter + 2 * gutter;\n\n    const sourceCol =\n      gutter + Math.floor(sourceWidthWithoutGutter * (renderCol / renderWidth));\n\n    const sourceRow =\n      gutter +\n      Math.floor(sourceHeightWithoutGutter * (renderRow / renderHeight));\n\n    if (data instanceof DataView) {\n      const bytesPerPixel = data.byteLength / (sourceWidth * sourceHeight);\n      const offset = bytesPerPixel * (sourceRow * sourceWidth + sourceCol);\n      const buffer = data.buffer.slice(offset, offset + bytesPerPixel);\n      return new DataView(buffer);\n    }\n\n    const offset = this.bandCount * (sourceRow * sourceWidth + sourceCol);\n    return data.slice(offset, offset + this.bandCount);\n  }\n\n  /**\n   * Get data for a pixel.  If the tile is not loaded, null is returned.\n   * @param {number} renderCol The column index (in rendered tile space).\n   * @param {number} renderRow The row index (in rendered tile space).\n   * @return {import(\"../DataTile.js\").ArrayLike|null} The data.\n   */\n  getPixelData(renderCol, renderRow) {\n    if (!this.loaded) {\n      return null;\n    }\n\n    if (this.tile instanceof DataTile) {\n      const data = this.tile.getData();\n      const arrayData = asArrayLike(data);\n      if (arrayData) {\n        const sourceSize = this.tile.getSize();\n        return this.getArrayPixelData_(\n          arrayData,\n          sourceSize,\n          renderCol,\n          renderRow,\n        );\n      }\n      return this.getImagePixelData_(asImageLike(data), renderCol, renderRow);\n    }\n\n    return this.getImagePixelData_(this.tile.getImage(), renderCol, renderRow);\n  }\n}\n\nexport default TileTexture;\n","/**\n * @module ol/renderer/webgl/Layer\n */\nimport LayerProperty from '../../layer/Property.js';\nimport RenderEvent from '../../render/Event.js';\nimport RenderEventType from '../../render/EventType.js';\nimport {\n  compose as composeTransform,\n  create as createTransform,\n} from '../../transform.js';\nimport WebGLHelper from '../../webgl/Helper.js';\nimport LayerRenderer from '../Layer.js';\n\n/**\n * @typedef {Object} PostProcessesOptions\n * @property {number} [scaleRatio] Scale ratio; if < 1, the post process will render to a texture smaller than\n * the main canvas that will then be sampled up (useful for saving resource on blur steps).\n * @property {string} [vertexShader] Vertex shader source\n * @property {string} [fragmentShader] Fragment shader source\n * @property {Object<string,import(\"../../webgl/Helper\").UniformValue>} [uniforms] Uniform definitions for the post process step\n */\n\n/**\n * @typedef {Object} Options\n * @property {Object<string,import(\"../../webgl/Helper\").UniformValue>} [uniforms] Uniform definitions for the post process steps\n * @property {Array<PostProcessesOptions>} [postProcesses] Post-processes definitions\n */\n\n/**\n * @classdesc\n * Base WebGL renderer class.\n * Holds all logic related to data manipulation & some common rendering logic\n * @template {import(\"../../layer/Layer.js\").default} LayerType\n * @extends {LayerRenderer<LayerType>}\n */\nclass WebGLLayerRenderer extends LayerRenderer {\n  /**\n   * @param {LayerType} layer Layer.\n   * @param {Options} [options] Options.\n   */\n  constructor(layer, options) {\n    super(layer);\n\n    options = options || {};\n\n    /**\n     * The transform for viewport CSS pixels to rendered pixels.  This transform is only\n     * set before dispatching rendering events.\n     * @private\n     * @type {import(\"../../transform.js\").Transform}\n     */\n    this.inversePixelTransform_ = createTransform();\n\n    /**\n     * @private\n     */\n    this.postProcesses_ = options.postProcesses;\n\n    /**\n     * @private\n     */\n    this.uniforms_ = options.uniforms;\n\n    /**\n     * @type {WebGLHelper}\n     * @protected\n     */\n    this.helper;\n\n    this.onMapChanged_ = () => {\n      this.clearCache();\n      this.removeHelper();\n    };\n\n    layer.addChangeListener(LayerProperty.MAP, this.onMapChanged_);\n\n    this.dispatchPreComposeEvent = this.dispatchPreComposeEvent.bind(this);\n    this.dispatchPostComposeEvent = this.dispatchPostComposeEvent.bind(this);\n  }\n\n  /**\n   * @param {WebGLRenderingContext} context The WebGL rendering context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @protected\n   */\n  dispatchPreComposeEvent(context, frameState) {\n    const layer = this.getLayer();\n    if (layer.hasListener(RenderEventType.PRECOMPOSE)) {\n      const event = new RenderEvent(\n        RenderEventType.PRECOMPOSE,\n        undefined,\n        frameState,\n        context,\n      );\n      layer.dispatchEvent(event);\n    }\n  }\n\n  /**\n   * @param {WebGLRenderingContext} context The WebGL rendering context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @protected\n   */\n  dispatchPostComposeEvent(context, frameState) {\n    const layer = this.getLayer();\n    if (layer.hasListener(RenderEventType.POSTCOMPOSE)) {\n      const event = new RenderEvent(\n        RenderEventType.POSTCOMPOSE,\n        undefined,\n        frameState,\n        context,\n      );\n      layer.dispatchEvent(event);\n    }\n  }\n\n  /**\n   * Reset options (only handles uniforms).\n   * @param {Options} options Options.\n   */\n  reset(options) {\n    this.uniforms_ = options.uniforms;\n    if (this.helper) {\n      this.helper.setUniforms(this.uniforms_);\n    }\n  }\n\n  /**\n   * @protected\n   */\n  removeHelper() {\n    if (this.helper) {\n      this.helper.dispose();\n      delete this.helper;\n    }\n  }\n\n  /**\n   * Determine whether renderFrame should be called.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {boolean} Layer is ready to be rendered.\n   * @override\n   */\n  prepareFrame(frameState) {\n    if (this.getLayer().getRenderSource()) {\n      let incrementGroup = true;\n      let groupNumber = -1;\n      let className;\n      for (let i = 0, ii = frameState.layerStatesArray.length; i < ii; i++) {\n        const layer = frameState.layerStatesArray[i].layer;\n        const renderer = layer.getRenderer();\n        if (!(renderer instanceof WebGLLayerRenderer)) {\n          incrementGroup = true;\n          continue;\n        }\n        const layerClassName = layer.getClassName();\n        if (incrementGroup || layerClassName !== className) {\n          groupNumber += 1;\n          incrementGroup = false;\n        }\n        className = layerClassName;\n        if (renderer === this) {\n          break;\n        }\n      }\n\n      const canvasCacheKey =\n        'map/' + frameState.mapId + '/group/' + groupNumber;\n\n      if (\n        !this.helper ||\n        !this.helper.canvasCacheKeyMatches(canvasCacheKey) ||\n        this.helper.needsToBeRecreated()\n      ) {\n        this.removeHelper();\n\n        this.helper = new WebGLHelper({\n          postProcesses: this.postProcesses_,\n          uniforms: this.uniforms_,\n          canvasCacheKey: canvasCacheKey,\n        });\n\n        if (className) {\n          this.helper.getCanvas().className = className;\n        }\n\n        this.afterHelperCreated();\n      }\n    }\n\n    return this.prepareFrameInternal(frameState);\n  }\n\n  /**\n   * @protected\n   */\n  afterHelperCreated() {}\n\n  /**\n   * Determine whether renderFrame should be called.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {boolean} Layer is ready to be rendered.\n   * @protected\n   */\n  prepareFrameInternal(frameState) {\n    return true;\n  }\n\n  /**\n   * @protected\n   */\n  clearCache() {}\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    this.clearCache();\n    this.removeHelper();\n    this.getLayer()?.removeChangeListener(\n      LayerProperty.MAP,\n      this.onMapChanged_,\n    );\n    super.disposeInternal();\n  }\n\n  /**\n   * @param {import(\"../../render/EventType.js\").default} type Event type.\n   * @param {WebGLRenderingContext} context The rendering context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @private\n   */\n  dispatchRenderEvent_(type, context, frameState) {\n    const layer = this.getLayer();\n    if (layer.hasListener(type)) {\n      composeTransform(\n        this.inversePixelTransform_,\n        0,\n        0,\n        frameState.pixelRatio,\n        -frameState.pixelRatio,\n        0,\n        0,\n        -frameState.size[1],\n      );\n\n      const event = new RenderEvent(\n        type,\n        this.inversePixelTransform_,\n        frameState,\n        context,\n      );\n      layer.dispatchEvent(event);\n    }\n  }\n\n  /**\n   * @param {WebGLRenderingContext} context The rendering context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @protected\n   */\n  preRender(context, frameState) {\n    this.dispatchRenderEvent_(RenderEventType.PRERENDER, context, frameState);\n  }\n\n  /**\n   * @param {WebGLRenderingContext} context The rendering context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @protected\n   */\n  postRender(context, frameState) {\n    this.dispatchRenderEvent_(RenderEventType.POSTRENDER, context, frameState);\n  }\n}\n\nexport default WebGLLayerRenderer;\n","/**\n * @module ol/renderer/webgl/TileLayerBase\n */\nimport TileRange from '../../TileRange.js';\nimport TileState from '../../TileState.js';\nimport {descending} from '../../array.js';\nimport {getIntersection, getRotatedViewport, isEmpty} from '../../extent.js';\nimport {fromUserExtent} from '../../proj.js';\nimport {toSize} from '../../size.js';\nimport LRUCache from '../../structs/LRUCache.js';\nimport {\n  createOrUpdate as createTileCoord,\n  getKey as getTileCoordKey,\n} from '../../tilecoord.js';\nimport {\n  create as createTransform,\n  reset as resetTransform,\n  rotate as rotateTransform,\n  scale as scaleTransform,\n  translate as translateTransform,\n} from '../../transform.js';\nimport {abstract, getUid} from '../../util.js';\nimport {create as createMat4} from '../../vec/mat4.js';\nimport WebGLLayerRenderer from './Layer.js';\n\nexport const Uniforms = {\n  TILE_TRANSFORM: 'u_tileTransform',\n  TRANSITION_ALPHA: 'u_transitionAlpha',\n  DEPTH: 'u_depth',\n  RENDER_EXTENT: 'u_renderExtent', // intersection of layer, source, and view extent\n  PATTERN_ORIGIN: 'u_patternOrigin',\n  RESOLUTION: 'u_resolution',\n  ZOOM: 'u_zoom',\n  GLOBAL_ALPHA: 'u_globalAlpha',\n  PROJECTION_MATRIX: 'u_projectionMatrix',\n  SCREEN_TO_WORLD_MATRIX: 'u_screenToWorldMatrix',\n};\n\n/**\n * Transform a zoom level into a depth value; zoom level zero has a depth value of 0.5, and increasing values\n * have a depth trending towards 0\n * @param {number} z A zoom level.\n * @return {number} A depth value.\n */\nfunction depthForZ(z) {\n  return 1 / (z + 2);\n}\n\n/**\n * @typedef {import(\"../../webgl/BaseTileRepresentation.js\").default<import(\"../../Tile.js\").default>} AbstractTileRepresentation\n */\n/**\n * @typedef {Object} TileRepresentationLookup\n * @property {Set<string>} tileIds The set of tile ids in the lookup.\n * @property {Object<number, Set<AbstractTileRepresentation>>} representationsByZ Tile representations by zoom level.\n */\n\n/**\n * @return {TileRepresentationLookup} A new tile representation lookup.\n */\nexport function newTileRepresentationLookup() {\n  return {tileIds: new Set(), representationsByZ: {}};\n}\n\n/**\n * Check if a tile is already in the tile representation lookup.\n * @param {TileRepresentationLookup} tileRepresentationLookup Lookup of tile representations by zoom level.\n * @param {import(\"../../Tile.js\").default} tile A tile.\n * @return {boolean} The tile is already in the lookup.\n */\nfunction lookupHasTile(tileRepresentationLookup, tile) {\n  return tileRepresentationLookup.tileIds.has(getUid(tile));\n}\n\n/**\n * Add a tile representation to the lookup.\n * @param {TileRepresentationLookup} tileRepresentationLookup Lookup of tile representations by zoom level.\n * @param {AbstractTileRepresentation} tileRepresentation A tile representation.\n * @param {number} z The zoom level.\n */\nfunction addTileRepresentationToLookup(\n  tileRepresentationLookup,\n  tileRepresentation,\n  z,\n) {\n  const representationsByZ = tileRepresentationLookup.representationsByZ;\n  if (!(z in representationsByZ)) {\n    representationsByZ[z] = new Set();\n  }\n  representationsByZ[z].add(tileRepresentation);\n  tileRepresentationLookup.tileIds.add(getUid(tileRepresentation.tile));\n}\n\n/**\n * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n * @param {import(\"../../extent.js\").Extent} extent The frame extent.\n * @return {import(\"../../extent.js\").Extent} Frame extent intersected with layer extents.\n */\nfunction getRenderExtent(frameState, extent) {\n  const layerState = frameState.layerStatesArray[frameState.layerIndex];\n  if (layerState.extent) {\n    extent = getIntersection(\n      extent,\n      fromUserExtent(layerState.extent, frameState.viewState.projection),\n    );\n  }\n  const source = /** @type {import(\"../../source/Tile.js\").default} */ (\n    layerState.layer.getRenderSource()\n  );\n  if (!source.getWrapX()) {\n    const gridExtent = source\n      .getTileGridForProjection(frameState.viewState.projection)\n      .getExtent();\n    if (gridExtent) {\n      extent = getIntersection(extent, gridExtent);\n    }\n  }\n  return extent;\n}\n\n/**\n * @param {import(\"../../source/Tile.js\").default} source The source.\n * @param {import('../../tilecoord.js').TileCoord} tileCoord The tile coordinate.\n * @return {string} The cache key.\n */\nexport function getCacheKey(source, tileCoord) {\n  return `${getUid(source)},${source.getKey()},${source.getRevision()},${getTileCoordKey(tileCoord)}`;\n}\n\n/**\n * @typedef {Object} Options\n * @property {Object<string, import(\"../../webgl/Helper\").UniformValue>} [uniforms] Additional uniforms\n * made available to shaders.\n * @property {number} [cacheSize=512] The tile representation cache size.\n * @property {Array<import('./Layer.js').PostProcessesOptions>} [postProcesses] Post-processes definitions.\n */\n\n/**\n * @typedef {import(\"../../layer/BaseTile.js\").default} BaseLayerType\n */\n\n/**\n * @classdesc\n * Base WebGL renderer for tile layers.\n * @template {BaseLayerType} LayerType\n * @template {import(\"../../Tile.js\").default} TileType\n * @template {import(\"../../webgl/BaseTileRepresentation.js\").default<TileType>} TileRepresentation\n * @extends {WebGLLayerRenderer<LayerType>}\n */\nclass WebGLBaseTileLayerRenderer extends WebGLLayerRenderer {\n  /**\n   * @param {LayerType} tileLayer Tile layer.\n   * @param {Options} options Options.\n   */\n  constructor(tileLayer, options) {\n    super(tileLayer, {\n      uniforms: options.uniforms,\n      postProcesses: options.postProcesses,\n    });\n\n    /**\n     * The last call to `renderFrame` was completed with all tiles loaded\n     * @type {boolean}\n     */\n    this.renderComplete = false;\n\n    /**\n     * This transform converts representation coordinates to screen coordinates.\n     * @type {import(\"../../transform.js\").Transform}\n     * @private\n     */\n    this.tileTransform_ = createTransform();\n\n    /**\n     * @type {Array<number>}\n     * @protected\n     */\n    this.tempMat4 = createMat4();\n\n    /**\n     * @type {import(\"../../TileRange.js\").default}\n     * @private\n     */\n    this.tempTileRange_ = new TileRange(0, 0, 0, 0);\n\n    /**\n     * @type {import(\"../../tilecoord.js\").TileCoord}\n     * @private\n     */\n    this.tempTileCoord_ = createTileCoord(0, 0, 0);\n\n    /**\n     * @type {import(\"../../size.js\").Size}\n     * @private\n     */\n    this.tempSize_ = [0, 0];\n\n    const cacheSize = options.cacheSize !== undefined ? options.cacheSize : 512;\n    /**\n     * @type {import(\"../../structs/LRUCache.js\").default<TileRepresentation>}\n     * @protected\n     */\n    this.tileRepresentationCache = new LRUCache(cacheSize);\n\n    /**\n     * @protected\n     * @type {import(\"../../Map.js\").FrameState|null}\n     */\n    this.frameState = null;\n\n    /**\n     * @private\n     * @type {import(\"../../proj/Projection.js\").default}\n     */\n    this.renderedProjection_ = undefined;\n  }\n\n  /**\n   * @param {Options} options Options.\n   * @override\n   */\n  reset(options) {\n    super.reset({\n      uniforms: options.uniforms,\n    });\n  }\n\n  /**\n   * Determine whether renderFrame should be called.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {boolean} Layer is ready to be rendered.\n   * @override\n   */\n  prepareFrameInternal(frameState) {\n    if (!this.renderedProjection_) {\n      this.renderedProjection_ = frameState.viewState.projection;\n    } else if (frameState.viewState.projection !== this.renderedProjection_) {\n      this.clearCache();\n      this.renderedProjection_ = frameState.viewState.projection;\n    }\n\n    const layer = this.getLayer();\n    const source = layer.getRenderSource();\n    if (!source) {\n      return false;\n    }\n\n    if (isEmpty(getRenderExtent(frameState, frameState.extent))) {\n      return false;\n    }\n    return source.getState() === 'ready';\n  }\n\n  /**\n   * @abstract\n   * @param {import(\"../../webgl/BaseTileRepresentation.js\").TileRepresentationOptions<TileType>} options tile representation options\n   * @return {TileRepresentation} A new tile representation\n   * @protected\n   */\n  createTileRepresentation(options) {\n    return abstract();\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {import(\"../../extent.js\").Extent} extent The extent to be rendered.\n   * @param {number} initialZ The zoom level.\n   * @param {TileRepresentationLookup} tileRepresentationLookup The zoom level.\n   * @param {number} preload Number of additional levels to load.\n   */\n  enqueueTiles(\n    frameState,\n    extent,\n    initialZ,\n    tileRepresentationLookup,\n    preload,\n  ) {\n    const viewState = frameState.viewState;\n    const tileLayer = this.getLayer();\n    const tileSource = tileLayer.getRenderSource();\n    const tileGrid = tileSource.getTileGridForProjection(viewState.projection);\n    const gutter = tileSource.getGutterForProjection(viewState.projection);\n\n    const tileSourceKey = getUid(tileSource);\n    if (!(tileSourceKey in frameState.wantedTiles)) {\n      frameState.wantedTiles[tileSourceKey] = {};\n    }\n\n    const wantedTiles = frameState.wantedTiles[tileSourceKey];\n    const tileRepresentationCache = this.tileRepresentationCache;\n\n    const map = tileLayer.getMapInternal();\n    const minZ = Math.max(\n      initialZ - preload,\n      tileGrid.getMinZoom(),\n      tileGrid.getZForResolution(\n        Math.min(\n          tileLayer.getMaxResolution(),\n          map\n            ? map\n                .getView()\n                .getResolutionForZoom(Math.max(tileLayer.getMinZoom(), 0))\n            : tileGrid.getResolution(0),\n        ),\n        tileSource.zDirection,\n      ),\n    );\n    const rotation = viewState.rotation;\n    const viewport = rotation\n      ? getRotatedViewport(\n          viewState.center,\n          viewState.resolution,\n          rotation,\n          frameState.size,\n        )\n      : undefined;\n    for (let z = initialZ; z >= minZ; --z) {\n      const tileRange = tileGrid.getTileRangeForExtentAndZ(\n        extent,\n        z,\n        this.tempTileRange_,\n      );\n\n      const tileResolution = tileGrid.getResolution(z);\n\n      for (let x = tileRange.minX; x <= tileRange.maxX; ++x) {\n        for (let y = tileRange.minY; y <= tileRange.maxY; ++y) {\n          if (\n            rotation &&\n            !tileGrid.tileCoordIntersectsViewport([z, x, y], viewport)\n          ) {\n            continue;\n          }\n          const tileCoord = createTileCoord(z, x, y, this.tempTileCoord_);\n          const cacheKey = getCacheKey(tileSource, tileCoord);\n\n          /** @type {TileRepresentation} */\n          let tileRepresentation;\n\n          /** @type {TileType} */\n          let tile;\n\n          if (tileRepresentationCache.containsKey(cacheKey)) {\n            tileRepresentation = tileRepresentationCache.get(cacheKey);\n            tile = tileRepresentation.tile;\n          }\n          if (\n            !tileRepresentation ||\n            tileRepresentation.tile.key !== tileSource.getKey()\n          ) {\n            tile = tileSource.getTile(\n              z,\n              x,\n              y,\n              frameState.pixelRatio,\n              viewState.projection,\n            );\n            if (!tile) {\n              continue;\n            }\n          }\n\n          if (lookupHasTile(tileRepresentationLookup, tile)) {\n            continue;\n          }\n\n          if (!tileRepresentation) {\n            tileRepresentation = this.createTileRepresentation({\n              tile: tile,\n              grid: tileGrid,\n              helper: this.helper,\n              gutter: gutter,\n            });\n            tileRepresentationCache.set(cacheKey, tileRepresentation);\n          } else {\n            tileRepresentation.setTile(tile);\n          }\n\n          addTileRepresentationToLookup(\n            tileRepresentationLookup,\n            tileRepresentation,\n            z,\n          );\n\n          const tileQueueKey = tile.getKey();\n          wantedTiles[tileQueueKey] = true;\n\n          if (tile.getState() === TileState.IDLE) {\n            if (!frameState.tileQueue.isKeyQueued(tileQueueKey)) {\n              frameState.tileQueue.enqueue([\n                tile,\n                tileSourceKey,\n                tileGrid.getTileCoordCenter(tileCoord),\n                tileResolution,\n              ]);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {boolean} tilesWithAlpha True if at least one of the rendered tiles has alpha\n   * @protected\n   */\n  beforeTilesRender(frameState, tilesWithAlpha) {\n    this.helper.prepareDraw(this.frameState, !tilesWithAlpha, true);\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {boolean} If returns false, tile mask rendering will be skipped\n   * @protected\n   */\n  beforeTilesMaskRender(frameState) {\n    return false;\n  }\n\n  /**\n   * @param {TileRepresentation} tileRepresentation Tile representation\n   * @param {import(\"../../transform.js\").Transform} tileTransform Tile transform\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state\n   * @param {import(\"../../extent.js\").Extent} renderExtent Render extent\n   * @param {number} tileResolution Tile resolution\n   * @param {import(\"../../size.js\").Size} tileSize Tile size\n   * @param {import(\"../../coordinate.js\").Coordinate} tileOrigin Tile origin\n   * @param {import(\"../../extent.js\").Extent} tileExtent tile Extent\n   * @param {number} depth Depth\n   * @param {number} gutter Gutter\n   * @param {number} alpha Alpha\n   * @protected\n   */\n  renderTile(\n    tileRepresentation,\n    tileTransform,\n    frameState,\n    renderExtent,\n    tileResolution,\n    tileSize,\n    tileOrigin,\n    tileExtent,\n    depth,\n    gutter,\n    alpha,\n  ) {}\n\n  /**\n   * @param {TileRepresentation} tileRepresentation Tile representation\n   * @param {number} tileZ Tile Z\n   * @param {import(\"../../extent.js\").Extent} extent Render extent\n   * @param {number} depth Depth\n   * @protected\n   */\n  renderTileMask(tileRepresentation, tileZ, extent, depth) {}\n\n  drawTile_(\n    frameState,\n    tileRepresentation,\n    tileZ,\n    gutter,\n    extent,\n    alphaLookup,\n    tileGrid,\n  ) {\n    if (!tileRepresentation.ready) {\n      return;\n    }\n    const tile = tileRepresentation.tile;\n    const tileCoord = tile.tileCoord;\n    const tileCoordKey = getTileCoordKey(tileCoord);\n    const alpha = tileCoordKey in alphaLookup ? alphaLookup[tileCoordKey] : 1;\n\n    const tileResolution = tileGrid.getResolution(tileZ);\n    const tileSize = toSize(tileGrid.getTileSize(tileZ), this.tempSize_);\n    const tileOrigin = tileGrid.getOrigin(tileZ);\n    const tileExtent = tileGrid.getTileCoordExtent(tileCoord);\n    // tiles with alpha are rendered last to allow blending\n    const depth = alpha < 1 ? -1 : depthForZ(tileZ);\n    if (alpha < 1) {\n      frameState.animate = true;\n    }\n\n    const viewState = frameState.viewState;\n    const centerX = viewState.center[0];\n    const centerY = viewState.center[1];\n\n    const tileWidthWithGutter = tileSize[0] + 2 * gutter;\n    const tileHeightWithGutter = tileSize[1] + 2 * gutter;\n\n    const aspectRatio = tileWidthWithGutter / tileHeightWithGutter;\n\n    const centerI = (centerX - tileOrigin[0]) / (tileSize[0] * tileResolution);\n    const centerJ = (tileOrigin[1] - centerY) / (tileSize[1] * tileResolution);\n\n    const tileScale = viewState.resolution / tileResolution;\n\n    const tileCenterI = tileCoord[1];\n    const tileCenterJ = tileCoord[2];\n\n    resetTransform(this.tileTransform_);\n    scaleTransform(\n      this.tileTransform_,\n      2 / ((frameState.size[0] * tileScale) / tileWidthWithGutter),\n      -2 / ((frameState.size[1] * tileScale) / tileWidthWithGutter),\n    );\n    rotateTransform(this.tileTransform_, viewState.rotation);\n    scaleTransform(this.tileTransform_, 1, 1 / aspectRatio);\n    translateTransform(\n      this.tileTransform_,\n      (tileSize[0] * (tileCenterI - centerI) - gutter) / tileWidthWithGutter,\n      (tileSize[1] * (tileCenterJ - centerJ) - gutter) / tileHeightWithGutter,\n    );\n\n    this.renderTile(\n      /** @type {TileRepresentation} */ (tileRepresentation),\n      this.tileTransform_,\n      frameState,\n      extent,\n      tileResolution,\n      tileSize,\n      tileOrigin,\n      tileExtent,\n      depth,\n      gutter,\n      alpha,\n    );\n  }\n\n  /**\n   * Render the layer.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {HTMLElement} The rendered element.\n   * @override\n   */\n  renderFrame(frameState) {\n    this.frameState = frameState;\n    this.renderComplete = true;\n    const gl = this.helper.getGL();\n    this.preRender(gl, frameState);\n\n    const viewState = frameState.viewState;\n    const tileLayer = this.getLayer();\n    const tileSource = tileLayer.getRenderSource();\n    const tileGrid = tileSource.getTileGridForProjection(viewState.projection);\n    const gutter = tileSource.getGutterForProjection(viewState.projection);\n    const extent = getRenderExtent(frameState, frameState.extent);\n    const z = tileGrid.getZForResolution(\n      viewState.resolution,\n      tileSource.zDirection,\n    );\n\n    /**\n     * @type {TileRepresentationLookup}\n     */\n    const tileRepresentationLookup = newTileRepresentationLookup();\n\n    const preload = tileLayer.getPreload();\n    if (frameState.nextExtent) {\n      const targetZ = tileGrid.getZForResolution(\n        viewState.nextResolution,\n        tileSource.zDirection,\n      );\n      const nextExtent = getRenderExtent(frameState, frameState.nextExtent);\n      this.enqueueTiles(\n        frameState,\n        nextExtent,\n        targetZ,\n        tileRepresentationLookup,\n        preload,\n      );\n    }\n\n    this.enqueueTiles(frameState, extent, z, tileRepresentationLookup, 0);\n    if (preload > 0) {\n      setTimeout(() => {\n        this.enqueueTiles(\n          frameState,\n          extent,\n          z - 1,\n          tileRepresentationLookup,\n          preload - 1,\n        );\n      }, 0);\n    }\n\n    /**\n     * A lookup of alpha values for tiles at the target rendering resolution\n     * for tiles that are in transition.  If a tile coord key is absent from\n     * this lookup, the tile should be rendered at alpha 1.\n     * @type {Object<string, number>}\n     */\n    const alphaLookup = {};\n\n    let blend = false;\n    const representationsByZ = tileRepresentationLookup.representationsByZ;\n\n    // look for cached tiles to use if a target tile is not ready\n    if (z in representationsByZ) {\n      const uid = getUid(this);\n      const time = frameState.time;\n      for (const tileRepresentation of representationsByZ[z]) {\n        const tile = tileRepresentation.tile;\n        if (tile.getState() === TileState.EMPTY) {\n          continue;\n        }\n        const tileCoord = tile.tileCoord;\n\n        if (tileRepresentation.ready) {\n          const alpha = tile.getAlpha(uid, time);\n          if (alpha === 1) {\n            // no need to look for alt tiles\n            tile.endTransition(uid);\n            continue;\n          }\n          blend = true;\n          const tileCoordKey = getTileCoordKey(tileCoord);\n          alphaLookup[tileCoordKey] = alpha;\n        }\n        this.renderComplete = false;\n\n        // first look for child tiles (at z + 1)\n        const coveredByChildren = this.findAltTiles_(\n          tileGrid,\n          tileCoord,\n          z + 1,\n          tileRepresentationLookup,\n        );\n\n        if (coveredByChildren) {\n          continue;\n        }\n\n        // next look for parent tiles\n        const minZoom = tileGrid.getMinZoom();\n        for (let parentZ = z - 1; parentZ >= minZoom; --parentZ) {\n          const coveredByParent = this.findAltTiles_(\n            tileGrid,\n            tileCoord,\n            parentZ,\n            tileRepresentationLookup,\n          );\n\n          if (coveredByParent) {\n            break;\n          }\n        }\n      }\n    }\n\n    const zs = Object.keys(representationsByZ).map(Number).sort(descending);\n\n    const renderTileMask = this.beforeTilesMaskRender(frameState);\n\n    if (renderTileMask) {\n      for (let j = 0, jj = zs.length; j < jj; ++j) {\n        const tileZ = zs[j];\n        for (const tileRepresentation of representationsByZ[tileZ]) {\n          const tileCoord = tileRepresentation.tile.tileCoord;\n          const tileCoordKey = getTileCoordKey(tileCoord);\n          // do not render the tile mask if alpha < 1\n          if (tileCoordKey in alphaLookup) {\n            continue;\n          }\n          const tileExtent = tileGrid.getTileCoordExtent(tileCoord);\n          this.renderTileMask(\n            /** @type {TileRepresentation} */ (tileRepresentation),\n            tileZ,\n            tileExtent,\n            depthForZ(tileZ),\n          );\n        }\n      }\n    }\n\n    this.beforeTilesRender(frameState, blend);\n\n    for (let j = 0, jj = zs.length; j < jj; ++j) {\n      const tileZ = zs[j];\n      for (const tileRepresentation of representationsByZ[tileZ]) {\n        const tileCoord = tileRepresentation.tile.tileCoord;\n        const tileCoordKey = getTileCoordKey(tileCoord);\n        if (tileCoordKey in alphaLookup) {\n          continue;\n        }\n\n        this.drawTile_(\n          frameState,\n          tileRepresentation,\n          tileZ,\n          gutter,\n          extent,\n          alphaLookup,\n          tileGrid,\n        );\n      }\n    }\n\n    if (z in representationsByZ) {\n      for (const tileRepresentation of representationsByZ[z]) {\n        const tileCoord = tileRepresentation.tile.tileCoord;\n        const tileCoordKey = getTileCoordKey(tileCoord);\n        if (tileCoordKey in alphaLookup) {\n          this.drawTile_(\n            frameState,\n            tileRepresentation,\n            z,\n            gutter,\n            extent,\n            alphaLookup,\n            tileGrid,\n          );\n        }\n      }\n    }\n\n    this.beforeFinalize(frameState);\n    this.helper.finalizeDraw(\n      frameState,\n      this.dispatchPreComposeEvent,\n      this.dispatchPostComposeEvent,\n    );\n\n    const canvas = this.helper.getCanvas();\n\n    const tileRepresentationCache = this.tileRepresentationCache;\n    tileRepresentationCache.expireCache();\n\n    this.postRender(gl, frameState);\n    return canvas;\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @protected\n   */\n  beforeFinalize(frameState) {\n    return;\n  }\n\n  /**\n   * Look for tiles covering the provided tile coordinate at an alternate\n   * zoom level.  Loaded tiles will be added to the provided tile representation lookup.\n   * @param {import(\"../../tilegrid/TileGrid.js\").default} tileGrid The tile grid.\n   * @param {import(\"../../tilecoord.js\").TileCoord} tileCoord The target tile coordinate.\n   * @param {number} altZ The alternate zoom level.\n   * @param {TileRepresentationLookup} tileRepresentationLookup Lookup of\n   * tile representations by zoom level.\n   * @return {boolean} The tile coordinate is covered by loaded tiles at the alternate zoom level.\n   * @private\n   */\n  findAltTiles_(tileGrid, tileCoord, altZ, tileRepresentationLookup) {\n    const tileRange = tileGrid.getTileRangeForTileCoordAndZ(\n      tileCoord,\n      altZ,\n      this.tempTileRange_,\n    );\n\n    if (!tileRange) {\n      return false;\n    }\n\n    let covered = true;\n    const tileRepresentationCache = this.tileRepresentationCache;\n    const source = this.getLayer().getRenderSource();\n    for (let x = tileRange.minX; x <= tileRange.maxX; ++x) {\n      for (let y = tileRange.minY; y <= tileRange.maxY; ++y) {\n        const cacheKey = getCacheKey(source, [altZ, x, y]);\n        let loaded = false;\n        if (tileRepresentationCache.containsKey(cacheKey)) {\n          const tileRepresentation = tileRepresentationCache.get(cacheKey);\n          if (\n            tileRepresentation.ready &&\n            !lookupHasTile(tileRepresentationLookup, tileRepresentation.tile)\n          ) {\n            addTileRepresentationToLookup(\n              tileRepresentationLookup,\n              tileRepresentation,\n              altZ,\n            );\n            loaded = true;\n          }\n        }\n        if (!loaded) {\n          covered = false;\n        }\n      }\n    }\n    return covered;\n  }\n\n  /**\n   * @override\n   */\n  clearCache() {\n    super.clearCache();\n\n    const tileRepresentationCache = this.tileRepresentationCache;\n    tileRepresentationCache.forEach((tileRepresentation) =>\n      tileRepresentation.dispose(),\n    );\n    tileRepresentationCache.clear();\n  }\n\n  /**\n   * @override\n   */\n  afterHelperCreated() {\n    super.afterHelperCreated();\n\n    this.tileRepresentationCache.forEach((tileRepresentation) =>\n      tileRepresentation.setHelper(this.helper),\n    );\n  }\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    super.disposeInternal();\n    delete this.frameState;\n  }\n}\n\nexport default WebGLBaseTileLayerRenderer;\n","/**\n * @module ol/renderer/webgl/TileLayer\n */\nimport TileState from '../../TileState.js';\nimport {\n  boundingExtent,\n  containsCoordinate,\n  getIntersection,\n} from '../../extent.js';\nimport {fromUserExtent} from '../../proj.js';\nimport {toSize} from '../../size.js';\nimport {apply as applyTransform} from '../../transform.js';\nimport {fromTransform as mat4FromTransform} from '../../vec/mat4.js';\nimport WebGLArrayBuffer from '../../webgl/Buffer.js';\nimport {AttributeType} from '../../webgl/Helper.js';\nimport TileTexture from '../../webgl/TileTexture.js';\nimport {ELEMENT_ARRAY_BUFFER, STATIC_DRAW} from '../../webgl.js';\nimport WebGLBaseTileLayerRenderer, {\n  Uniforms as BaseUniforms,\n  getCacheKey,\n} from './TileLayerBase.js';\n\nexport const Uniforms = {\n  ...BaseUniforms,\n  TILE_TEXTURE_ARRAY: 'u_tileTextures',\n  TEXTURE_PIXEL_WIDTH: 'u_texturePixelWidth',\n  TEXTURE_PIXEL_HEIGHT: 'u_texturePixelHeight',\n  TEXTURE_RESOLUTION: 'u_textureResolution', // map units per texture pixel\n  TEXTURE_ORIGIN_X: 'u_textureOriginX', // map x coordinate of left edge of texture\n  TEXTURE_ORIGIN_Y: 'u_textureOriginY', // map y coordinate of top edge of texture\n};\n\nexport const Attributes = {\n  TEXTURE_COORD: 'a_textureCoord',\n};\n\n/**\n * @type {Array<import('../../webgl/Helper.js').AttributeDescription>}\n */\nconst attributeDescriptions = [\n  {\n    name: Attributes.TEXTURE_COORD,\n    size: 2,\n    type: AttributeType.FLOAT,\n  },\n];\n\n/**\n * @typedef {Object} Options\n * @property {string} vertexShader Vertex shader source.\n * @property {string} fragmentShader Fragment shader source.\n * @property {Object<string, import(\"../../webgl/Helper\").UniformValue>} [uniforms] Additional uniforms\n * made available to shaders.\n * @property {Array<import(\"../../webgl/PaletteTexture.js\").default>} [paletteTextures] Palette textures.\n * @property {number} [cacheSize=512] The texture cache size.\n * @property {Array<import('./Layer.js').PostProcessesOptions>} [postProcesses] Post-processes definitions.\n */\n\n/**\n * @typedef {import(\"../../webgl/TileTexture.js\").TileType} TileTextureType\n */\n\n/**\n * @typedef {import(\"../../webgl/TileTexture.js\").default} TileTextureRepresentation\n */\n\n/**\n * @classdesc\n * WebGL renderer for tile layers.\n * @template {import(\"../../layer/WebGLTile.js\").default|import(\"../../layer/Flow.js\").default} LayerType\n * @extends {WebGLBaseTileLayerRenderer<LayerType, TileTextureType, TileTextureRepresentation>}\n * @api\n */\nclass WebGLTileLayerRenderer extends WebGLBaseTileLayerRenderer {\n  /**\n   * @param {LayerType} tileLayer Tile layer.\n   * @param {Options} options Options.\n   */\n  constructor(tileLayer, options) {\n    super(tileLayer, options);\n\n    /**\n     * @type {WebGLProgram}\n     * @private\n     */\n    this.program_;\n\n    /**\n     * @private\n     */\n    this.vertexShader_ = options.vertexShader;\n\n    /**\n     * @private\n     */\n    this.fragmentShader_ = options.fragmentShader;\n\n    /**\n     * Tiles are rendered as a quad with the following structure:\n     *\n     *  [P3]---------[P2]\n     *   |`           |\n     *   |  `     B   |\n     *   |    `       |\n     *   |      `     |\n     *   |   A    `   |\n     *   |          ` |\n     *  [P0]---------[P1]\n     *\n     * Triangle A: P0, P1, P3\n     * Triangle B: P1, P2, P3\n     *\n     * @private\n     */\n    this.indices_ = new WebGLArrayBuffer(ELEMENT_ARRAY_BUFFER, STATIC_DRAW);\n    this.indices_.fromArray([0, 1, 3, 1, 2, 3]);\n\n    /**\n     * @type {Array<import(\"../../webgl/PaletteTexture.js\").default>}\n     * @private\n     */\n    this.paletteTextures_ = options.paletteTextures || [];\n  }\n\n  /**\n   * @param {Options} options Options.\n   * @override\n   */\n  reset(options) {\n    super.reset(options);\n    if (this.helper) {\n      const gl = this.helper.getGL();\n      for (const paletteTexture of this.paletteTextures_) {\n        paletteTexture.delete(gl);\n      }\n    }\n\n    this.vertexShader_ = options.vertexShader;\n    this.fragmentShader_ = options.fragmentShader;\n    this.paletteTextures_ = options.paletteTextures || [];\n\n    if (this.helper) {\n      this.program_ = this.helper.getProgram(\n        this.fragmentShader_,\n        this.vertexShader_,\n      );\n      const gl = this.helper.getGL();\n      for (const paletteTexture of this.paletteTextures_) {\n        // upload the texture data\n        paletteTexture.getTexture(gl);\n      }\n    }\n  }\n\n  /**\n   * @override\n   */\n  afterHelperCreated() {\n    super.afterHelperCreated();\n\n    const gl = this.helper.getGL();\n    for (const paletteTexture of this.paletteTextures_) {\n      // upload the texture data\n      paletteTexture.getTexture(gl);\n    }\n\n    this.program_ = this.helper.getProgram(\n      this.fragmentShader_,\n      this.vertexShader_,\n    );\n    this.helper.flushBufferData(this.indices_);\n  }\n\n  /**\n   * @override\n   */\n  removeHelper() {\n    if (this.helper) {\n      const gl = this.helper.getGL();\n      for (const paletteTexture of this.paletteTextures_) {\n        paletteTexture.delete(gl);\n      }\n    }\n\n    super.removeHelper();\n  }\n\n  /**\n   * @override\n   */\n  createTileRepresentation(options) {\n    return new TileTexture(options);\n  }\n\n  /**\n   * @override\n   */\n  beforeTilesRender(frameState, tilesWithAlpha) {\n    super.beforeTilesRender(frameState, tilesWithAlpha);\n    this.helper.useProgram(this.program_, frameState);\n  }\n\n  /**\n   * @override\n   */\n  renderTile(\n    tileTexture,\n    tileTransform,\n    frameState,\n    renderExtent,\n    tileResolution,\n    tileSize,\n    tileOrigin,\n    tileExtent,\n    depth,\n    gutter,\n    alpha,\n  ) {\n    const gl = this.helper.getGL();\n    this.helper.bindBuffer(tileTexture.coords);\n    this.helper.bindBuffer(this.indices_);\n    this.helper.enableAttributes(attributeDescriptions);\n\n    let textureSlot = 0;\n    while (textureSlot < tileTexture.textures.length) {\n      const uniformName = `${Uniforms.TILE_TEXTURE_ARRAY}[${textureSlot}]`;\n      this.helper.bindTexture(\n        tileTexture.textures[textureSlot],\n        textureSlot,\n        uniformName,\n      );\n      ++textureSlot;\n    }\n\n    for (\n      let paletteIndex = 0;\n      paletteIndex < this.paletteTextures_.length;\n      ++paletteIndex\n    ) {\n      const paletteTexture = this.paletteTextures_[paletteIndex];\n      const texture = paletteTexture.getTexture(gl);\n      this.helper.bindTexture(texture, textureSlot, paletteTexture.name);\n      ++textureSlot;\n    }\n\n    const viewState = frameState.viewState;\n\n    const tileWidthWithGutter = tileSize[0] + 2 * gutter;\n    const tileHeightWithGutter = tileSize[1] + 2 * gutter;\n\n    const tile = tileTexture.tile;\n    const tileCoord = tile.tileCoord;\n\n    const tileCenterI = tileCoord[1];\n    const tileCenterJ = tileCoord[2];\n\n    this.helper.setUniformMatrixValue(\n      Uniforms.TILE_TRANSFORM,\n      mat4FromTransform(this.tempMat4, tileTransform),\n    );\n\n    this.helper.setUniformFloatValue(Uniforms.TRANSITION_ALPHA, alpha);\n    this.helper.setUniformFloatValue(Uniforms.DEPTH, depth);\n\n    let gutterExtent = renderExtent;\n    if (gutter > 0) {\n      gutterExtent = tileExtent;\n      getIntersection(gutterExtent, renderExtent, gutterExtent);\n    }\n    this.helper.setUniformFloatVec4(Uniforms.RENDER_EXTENT, gutterExtent);\n\n    this.helper.setUniformFloatValue(Uniforms.RESOLUTION, viewState.resolution);\n    this.helper.setUniformFloatValue(Uniforms.ZOOM, viewState.zoom);\n\n    this.helper.setUniformFloatValue(\n      Uniforms.TEXTURE_PIXEL_WIDTH,\n      tileWidthWithGutter,\n    );\n    this.helper.setUniformFloatValue(\n      Uniforms.TEXTURE_PIXEL_HEIGHT,\n      tileHeightWithGutter,\n    );\n    this.helper.setUniformFloatValue(\n      Uniforms.TEXTURE_RESOLUTION,\n      tileResolution,\n    );\n    this.helper.setUniformFloatValue(\n      Uniforms.TEXTURE_ORIGIN_X,\n      tileOrigin[0] +\n        tileCenterI * tileSize[0] * tileResolution -\n        gutter * tileResolution,\n    );\n    this.helper.setUniformFloatValue(\n      Uniforms.TEXTURE_ORIGIN_Y,\n      tileOrigin[1] -\n        tileCenterJ * tileSize[1] * tileResolution +\n        gutter * tileResolution,\n    );\n\n    this.helper.drawElements(0, this.indices_.getSize());\n  }\n\n  /**\n   * @param {import(\"../../pixel.js\").Pixel} pixel Pixel.\n   * @return {Uint8ClampedArray|Uint8Array|Float32Array|DataView} Data at the pixel location.\n   * @override\n   */\n  getData(pixel) {\n    const gl = this.helper.getGL();\n    if (!gl) {\n      return null;\n    }\n\n    const frameState = this.frameState;\n    if (!frameState) {\n      return null;\n    }\n\n    const layer = this.getLayer();\n    const coordinate = applyTransform(\n      frameState.pixelToCoordinateTransform,\n      pixel.slice(),\n    );\n\n    const viewState = frameState.viewState;\n    const layerExtent = layer.getExtent();\n    if (layerExtent) {\n      if (\n        !containsCoordinate(\n          fromUserExtent(layerExtent, viewState.projection),\n          coordinate,\n        )\n      ) {\n        return null;\n      }\n    }\n\n    // determine last source suitable for rendering at coordinate\n    const sources = layer.getSources(\n      boundingExtent([coordinate]),\n      viewState.resolution,\n    );\n    let i, source, tileGrid;\n    for (i = sources.length - 1; i >= 0; --i) {\n      source = sources[i];\n      if (source.getState() === 'ready') {\n        tileGrid = source.getTileGridForProjection(viewState.projection);\n        if (source.getWrapX()) {\n          break;\n        }\n        const gridExtent = tileGrid.getExtent();\n        if (!gridExtent || containsCoordinate(gridExtent, coordinate)) {\n          break;\n        }\n      }\n    }\n    if (i < 0) {\n      return null;\n    }\n\n    const tileTextureCache = this.tileRepresentationCache;\n    for (\n      let z = tileGrid.getZForResolution(viewState.resolution);\n      z >= tileGrid.getMinZoom();\n      --z\n    ) {\n      const tileCoord = tileGrid.getTileCoordForCoordAndZ(coordinate, z);\n      const cacheKey = getCacheKey(source, tileCoord);\n      if (!tileTextureCache.containsKey(cacheKey)) {\n        continue;\n      }\n      const tileTexture = tileTextureCache.get(cacheKey);\n      const tile = tileTexture.tile;\n      if (tile.getState() === TileState.EMPTY) {\n        return null;\n      }\n      if (!tileTexture.loaded) {\n        continue;\n      }\n      const tileOrigin = tileGrid.getOrigin(z);\n      const tileSize = toSize(tileGrid.getTileSize(z));\n      const tileResolution = tileGrid.getResolution(z);\n\n      const col =\n        (coordinate[0] - tileOrigin[0]) / tileResolution -\n        tileCoord[1] * tileSize[0];\n\n      const row =\n        (tileOrigin[1] - coordinate[1]) / tileResolution -\n        tileCoord[2] * tileSize[1];\n\n      return tileTexture.getPixelData(col, row);\n    }\n    return null;\n  }\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    const helper = this.helper;\n    if (helper) {\n      const gl = helper.getGL();\n      for (const paletteTexture of this.paletteTextures_) {\n        paletteTexture.delete(gl);\n      }\n      this.paletteTextures_.length = 0;\n\n      gl.deleteProgram(this.program_);\n      delete this.program_;\n      helper.deleteBuffer(this.indices_);\n    }\n    super.disposeInternal();\n    delete this.indices_;\n  }\n}\n\nexport default WebGLTileLayerRenderer;\n","/**\n * @module ol/webgl/PaletteTexture\n */\n\nclass PaletteTexture {\n  /**\n   * @param {string} name The name of the texture.\n   * @param {Uint8Array} data The texture data.\n   */\n  constructor(name, data) {\n    this.name = name;\n    this.data = data;\n\n    /**\n     * @type {WebGLTexture|null}\n     * @private\n     */\n    this.texture_ = null;\n  }\n\n  /**\n   * @param {WebGLRenderingContext} gl Rendering context.\n   * @return {WebGLTexture} The texture.\n   */\n  getTexture(gl) {\n    if (!this.texture_) {\n      const texture = gl.createTexture();\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        0,\n        gl.RGBA,\n        this.data.length / 4,\n        1,\n        0,\n        gl.RGBA,\n        gl.UNSIGNED_BYTE,\n        this.data,\n      );\n      this.texture_ = texture;\n    }\n    return this.texture_;\n  }\n\n  /**\n   * @param {WebGLRenderingContext} gl Rendering context.\n   */\n  delete(gl) {\n    if (this.texture_) {\n      gl.deleteTexture(this.texture_);\n    }\n    this.texture_ = null;\n  }\n}\n\nexport default PaletteTexture;\n","/**\n * @module ol/expr/gpu\n */\nimport {asArray} from '../color.js';\nimport {Uniforms} from '../renderer/webgl/TileLayer.js';\nimport {toSize} from '../size.js';\nimport PaletteTexture from '../webgl/PaletteTexture.js';\nimport {\n  BooleanType,\n  CallExpression,\n  ColorType,\n  NumberArrayType,\n  NumberType,\n  Ops,\n  SizeType,\n  StringType,\n  isType,\n  parse,\n  typeName,\n} from './expression.js';\n\n/**\n * @param {string} operator Operator\n * @param {CompilationContext} context Compilation context\n * @return {string} A function name based on the operator, unique in the given context\n */\nfunction computeOperatorFunctionName(operator, context) {\n  return `operator_${operator}_${Object.keys(context.functions).length}`;\n}\n\n/**\n * Will return the number as a float with a dot separator, which is required by GLSL.\n * @param {number} v Numerical value.\n * @return {string} The value as string.\n */\nexport function numberToGlsl(v) {\n  const s = v.toString();\n  return s.includes('.') ? s : s + '.0';\n}\n\n/**\n * Will return the number array as a float with a dot separator, concatenated with ', '.\n * @param {Array<number>} array Numerical values array.\n * @return {string} The array as a vector, e. g.: `vec3(1.0, 2.0, 3.0)`.\n */\nexport function arrayToGlsl(array) {\n  if (array.length < 2 || array.length > 4) {\n    throw new Error(\n      '`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.',\n    );\n  }\n  return `vec${array.length}(${array.map(numberToGlsl).join(', ')})`;\n}\n\n/**\n * Will normalize and converts to string a `vec4` color array compatible with GLSL.\n * @param {string|import(\"../color.js\").Color} color Color either in string format or [r, g, b, a] array format,\n * with RGB components in the 0..255 range and the alpha component in the 0..1 range.\n * Note that the final array will always have 4 components.\n * @return {string} The color expressed in the `vec4(1.0, 1.0, 1.0, 1.0)` form.\n */\nexport function colorToGlsl(color) {\n  const array = asArray(color);\n  const alpha = array.length > 3 ? array[3] : 1;\n  return arrayToGlsl([array[0] / 255, array[1] / 255, array[2] / 255, alpha]);\n}\n\n/**\n * Normalizes and converts a number or array toa `vec2` array compatible with GLSL.\n * @param {number|import('../size.js').Size} size Size.\n * @return {string} The color expressed in the `vec4(1.0, 1.0, 1.0, 1.0)` form.\n */\nexport function sizeToGlsl(size) {\n  const array = toSize(size);\n  return arrayToGlsl(array);\n}\n\n/** @type {Object<string, number>} */\nconst stringToFloatMap = {};\nlet stringToFloatCounter = 0;\n\n/**\n * Returns a stable equivalent number for the string literal.\n * @param {string} string String literal value\n * @return {number} Number equivalent\n */\nexport function getStringNumberEquivalent(string) {\n  if (!(string in stringToFloatMap)) {\n    stringToFloatMap[string] = stringToFloatCounter++;\n  }\n  return stringToFloatMap[string];\n}\n\n/**\n * Returns a stable equivalent number for the string literal, for use in shaders. This number is then\n * converted to be a GLSL-compatible string.\n * Note: with a float precision of `mediump`, the amount of unique strings supported is 16,777,216\n * @param {string} string String literal value\n * @return {string} GLSL-compatible string containing a number\n */\nexport function stringToGlsl(string) {\n  return numberToGlsl(getStringNumberEquivalent(string));\n}\n\n/**\n * Get the uniform name given a variable name.\n * @param {string} variableName The variable name.\n * @return {string} The uniform name.\n */\nexport function uniformNameForVariable(variableName) {\n  return 'u_var_' + variableName;\n}\n\n/**\n * @typedef {import('./expression.js').ParsingContext} ParsingContext\n */\n/**\n *\n * @typedef {import(\"./expression.js\").Expression} Expression\n */\n/**\n *\n * @typedef {import(\"./expression.js\").LiteralExpression} LiteralExpression\n */\n\n/**\n * @typedef {Object} CompilationContextProperty\n * @property {string} name Name\n * @property {number} type Resolved property type\n */\n\n/**\n * @typedef {Object} CompilationContextVariable\n * @property {string} name Name\n * @property {number} type Resolved variable type\n */\n\n/**\n * @typedef {Object} CompilationContext\n * @property {Object<string, CompilationContextProperty>} properties The values for properties used in 'get' expressions.\n * @property {Object<string, CompilationContextVariable>} variables The values for variables used in 'var' expressions.\n * @property {Object<string, string>} functions Lookup of functions used by the style.\n * @property {number} [bandCount] Number of bands per pixel.\n * @property {Array<PaletteTexture>} [paletteTextures] List of palettes used by the style.\n * @property {boolean} featureId Whether the feature ID is used in the expression\n * @property {boolean} geometryType Whether the geometry type is used in the expression\n */\n\n/**\n * @return {CompilationContext} A new compilation context.\n */\nexport function newCompilationContext() {\n  return {\n    variables: {},\n    properties: {},\n    functions: {},\n    bandCount: 0,\n    featureId: false,\n    geometryType: false,\n  };\n}\n\nconst GET_BAND_VALUE_FUNC = 'getBandValue';\n\nexport const PALETTE_TEXTURE_ARRAY = 'u_paletteTextures';\n\nexport const FEATURE_ID_PROPERTY_NAME = 'featureId';\nexport const GEOMETRY_TYPE_PROPERTY_NAME = 'geometryType';\n\n/**\n * The value `-9999999` will be used to indicate that a property on a feature is not defined, similar to a \"no data\" value.\n */\nexport const UNDEFINED_PROP_VALUE = -9999999;\n\n/**\n * @typedef {string} CompiledExpression\n */\n\n/**\n * @typedef {function(CompilationContext, CallExpression, number): string} Compiler\n * Third argument is the expected value types\n */\n\n/**\n * @param {import('./expression.js').EncodedExpression} encoded The encoded expression.\n * @param {number} type The expected type.\n * @param {import('./expression.js').ParsingContext} parsingContext The parsing context.\n * @param {CompilationContext} compilationContext An existing compilation context\n * @return {CompiledExpression} The compiled expression.\n */\nexport function buildExpression(\n  encoded,\n  type,\n  parsingContext,\n  compilationContext,\n) {\n  const expression = parse(encoded, type, parsingContext);\n  return compile(expression, type, compilationContext);\n}\n\n/**\n * @param {function(Array<CompiledExpression>, CompilationContext): string} output Function that takes in parsed arguments and returns a string\n * @return {function(CompilationContext, import(\"./expression.js\").CallExpression, number): string} Compiler for the call expression\n */\nfunction createCompiler(output) {\n  return (context, expression, type) => {\n    const length = expression.args.length;\n    const args = new Array(length);\n    for (let i = 0; i < length; ++i) {\n      args[i] = compile(expression.args[i], type, context);\n    }\n    return output(args, context);\n  };\n}\n\n/**\n * @type {Object<string, Compiler>}\n */\nconst compilers = {\n  [Ops.Get]: (context, expression) => {\n    const firstArg = /** @type {LiteralExpression} */ (expression.args[0]);\n    const propName = /** @type {string} */ (firstArg.value);\n    const isExisting = propName in context.properties;\n    if (!isExisting) {\n      context.properties[propName] = {\n        name: propName,\n        type: expression.type,\n      };\n    }\n    let result = 'a_prop_' + propName;\n    if (isType(expression.type, BooleanType)) {\n      result = `(${result} > 0.0)`;\n    }\n    return result;\n  },\n  [Ops.Id]: (context) => {\n    context.featureId = true;\n    return 'a_' + FEATURE_ID_PROPERTY_NAME;\n  },\n  [Ops.GeometryType]: (context) => {\n    context.geometryType = true;\n    return 'a_' + GEOMETRY_TYPE_PROPERTY_NAME;\n  },\n  [Ops.LineMetric]: () => 'currentLineMetric', // this variable is assumed to always be present in shaders, default is 0.\n  [Ops.Var]: (context, expression) => {\n    const firstArg = /** @type {LiteralExpression} */ (expression.args[0]);\n    const varName = /** @type {string} */ (firstArg.value);\n    const isExisting = varName in context.variables;\n    if (!isExisting) {\n      context.variables[varName] = {\n        name: varName,\n        type: expression.type,\n      };\n    }\n    let result = uniformNameForVariable(varName);\n    if (isType(expression.type, BooleanType)) {\n      result = `(${result} > 0.0)`;\n    }\n    return result;\n  },\n  [Ops.Has]: (context, expression) => {\n    const firstArg = /** @type {LiteralExpression} */ (expression.args[0]);\n    const propName = /** @type {string} */ (firstArg.value);\n    const isExisting = propName in context.properties;\n    if (!isExisting) {\n      context.properties[propName] = {\n        name: propName,\n        type: expression.type,\n      };\n    }\n    return `(a_prop_${propName} != ${numberToGlsl(UNDEFINED_PROP_VALUE)})`;\n  },\n  [Ops.Resolution]: () => 'u_resolution',\n  [Ops.Zoom]: () => 'u_zoom',\n  [Ops.Time]: () => 'u_time',\n  [Ops.Any]: createCompiler((compiledArgs) => `(${compiledArgs.join(` || `)})`),\n  [Ops.All]: createCompiler((compiledArgs) => `(${compiledArgs.join(` && `)})`),\n  [Ops.Not]: createCompiler(([value]) => `(!${value})`),\n  [Ops.Equal]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} == ${secondValue})`,\n  ),\n  [Ops.NotEqual]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} != ${secondValue})`,\n  ),\n  [Ops.GreaterThan]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} > ${secondValue})`,\n  ),\n  [Ops.GreaterThanOrEqualTo]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} >= ${secondValue})`,\n  ),\n  [Ops.LessThan]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} < ${secondValue})`,\n  ),\n  [Ops.LessThanOrEqualTo]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} <= ${secondValue})`,\n  ),\n  [Ops.Multiply]: createCompiler(\n    (compiledArgs) => `(${compiledArgs.join(' * ')})`,\n  ),\n  [Ops.Divide]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} / ${secondValue})`,\n  ),\n  [Ops.Add]: createCompiler((compiledArgs) => `(${compiledArgs.join(' + ')})`),\n  [Ops.Subtract]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} - ${secondValue})`,\n  ),\n  [Ops.Clamp]: createCompiler(\n    ([value, min, max]) => `clamp(${value}, ${min}, ${max})`,\n  ),\n  [Ops.Mod]: createCompiler(([value, modulo]) => `mod(${value}, ${modulo})`),\n  [Ops.Pow]: createCompiler(([value, power]) => `pow(${value}, ${power})`),\n  [Ops.Abs]: createCompiler(([value]) => `abs(${value})`),\n  [Ops.Floor]: createCompiler(([value]) => `floor(${value})`),\n  [Ops.Ceil]: createCompiler(([value]) => `ceil(${value})`),\n  [Ops.Round]: createCompiler(([value]) => `floor(${value} + 0.5)`),\n  [Ops.Sin]: createCompiler(([value]) => `sin(${value})`),\n  [Ops.Cos]: createCompiler(([value]) => `cos(${value})`),\n  [Ops.Atan]: createCompiler(([firstValue, secondValue]) => {\n    return secondValue !== undefined\n      ? `atan(${firstValue}, ${secondValue})`\n      : `atan(${firstValue})`;\n  }),\n  [Ops.Sqrt]: createCompiler(([value]) => `sqrt(${value})`),\n  [Ops.Match]: createCompiler((compiledArgs) => {\n    const input = compiledArgs[0];\n    const fallback = compiledArgs[compiledArgs.length - 1];\n    let result = null;\n    for (let i = compiledArgs.length - 3; i >= 1; i -= 2) {\n      const match = compiledArgs[i];\n      const output = compiledArgs[i + 1];\n      result = `(${input} == ${match} ? ${output} : ${result || fallback})`;\n    }\n    return result;\n  }),\n  [Ops.Between]: createCompiler(\n    ([value, min, max]) => `(${value} >= ${min} && ${value} <= ${max})`,\n  ),\n  [Ops.Interpolate]: createCompiler(([exponent, input, ...compiledArgs]) => {\n    let result = '';\n    for (let i = 0; i < compiledArgs.length - 2; i += 2) {\n      const stop1 = compiledArgs[i];\n      const output1 = result || compiledArgs[i + 1];\n      const stop2 = compiledArgs[i + 2];\n      const output2 = compiledArgs[i + 3];\n      let ratio;\n      if (exponent === numberToGlsl(1)) {\n        ratio = `(${input} - ${stop1}) / (${stop2} - ${stop1})`;\n      } else {\n        ratio = `(pow(${exponent}, (${input} - ${stop1})) - 1.0) / (pow(${exponent}, (${stop2} - ${stop1})) - 1.0)`;\n      }\n      result = `mix(${output1}, ${output2}, clamp(${ratio}, 0.0, 1.0))`;\n    }\n    return result;\n  }),\n  [Ops.Case]: createCompiler((compiledArgs) => {\n    const fallback = compiledArgs[compiledArgs.length - 1];\n    let result = null;\n    for (let i = compiledArgs.length - 3; i >= 0; i -= 2) {\n      const condition = compiledArgs[i];\n      const output = compiledArgs[i + 1];\n      result = `(${condition} ? ${output} : ${result || fallback})`;\n    }\n    return result;\n  }),\n  [Ops.In]: createCompiler(([needle, ...haystack], context) => {\n    const funcName = computeOperatorFunctionName('in', context);\n    const tests = [];\n    for (let i = 0; i < haystack.length; i += 1) {\n      tests.push(`  if (inputValue == ${haystack[i]}) { return true; }`);\n    }\n    context.functions[funcName] = `bool ${funcName}(float inputValue) {\n${tests.join('\\n')}\n  return false;\n}`;\n    return `${funcName}(${needle})`;\n  }),\n  [Ops.Array]: createCompiler(\n    (args) => `vec${args.length}(${args.join(', ')})`,\n  ),\n  [Ops.Color]: createCompiler((compiledArgs) => {\n    if (compiledArgs.length === 1) {\n      //grayscale\n      return `vec4(vec3(${compiledArgs[0]} / 255.0), 1.0)`;\n    }\n    if (compiledArgs.length === 2) {\n      //grayscale with alpha\n      return `vec4(vec3(${compiledArgs[0]} / 255.0), ${compiledArgs[1]})`;\n    }\n    const rgb = compiledArgs.slice(0, 3).map((color) => `${color} / 255.0`);\n    if (compiledArgs.length === 3) {\n      return `vec4(${rgb.join(', ')}, 1.0)`;\n    }\n    const alpha = compiledArgs[3];\n    return `vec4(${rgb.join(', ')}, ${alpha})`;\n  }),\n  [Ops.Band]: createCompiler(([band, xOffset, yOffset], context) => {\n    if (!(GET_BAND_VALUE_FUNC in context.functions)) {\n      let ifBlocks = '';\n      const bandCount = context.bandCount || 1;\n      for (let i = 0; i < bandCount; i++) {\n        const colorIndex = Math.floor(i / 4);\n        let bandIndex = i % 4;\n        if (i === bandCount - 1 && bandIndex === 1) {\n          // LUMINANCE_ALPHA - band 1 assigned to rgb and band 2 assigned to alpha\n          bandIndex = 3;\n        }\n        const textureName = `${Uniforms.TILE_TEXTURE_ARRAY}[${colorIndex}]`;\n        ifBlocks += `  if (band == ${i + 1}.0) {\n    return texture2D(${textureName}, v_textureCoord + vec2(dx, dy))[${bandIndex}];\n  }\n`;\n      }\n\n      context.functions[GET_BAND_VALUE_FUNC] =\n        `float getBandValue(float band, float xOffset, float yOffset) {\n  float dx = xOffset / ${Uniforms.TEXTURE_PIXEL_WIDTH};\n  float dy = yOffset / ${Uniforms.TEXTURE_PIXEL_HEIGHT};\n${ifBlocks}\n}`;\n    }\n\n    return `${GET_BAND_VALUE_FUNC}(${band}, ${xOffset ?? '0.0'}, ${\n      yOffset ?? '0.0'\n    })`;\n  }),\n  [Ops.Palette]: (context, expression) => {\n    const [index, ...colors] = expression.args;\n    const numColors = colors.length;\n    const palette = new Uint8Array(numColors * 4);\n    for (let i = 0; i < colors.length; i++) {\n      const parsedValue = /** @type {string | Array<number>} */ (\n        /** @type {LiteralExpression} */ (colors[i]).value\n      );\n      const color = asArray(parsedValue);\n      const offset = i * 4;\n      palette[offset] = color[0];\n      palette[offset + 1] = color[1];\n      palette[offset + 2] = color[2];\n      palette[offset + 3] = color[3] * 255;\n    }\n    if (!context.paletteTextures) {\n      context.paletteTextures = [];\n    }\n    const paletteName = `${PALETTE_TEXTURE_ARRAY}[${context.paletteTextures.length}]`;\n    const paletteTexture = new PaletteTexture(paletteName, palette);\n    context.paletteTextures.push(paletteTexture);\n    const compiledIndex = compile(index, NumberType, context);\n    return `texture2D(${paletteName}, vec2((${compiledIndex} + 0.5) / ${numColors}.0, 0.5))`;\n  },\n  // TODO: unimplemented\n  // Ops.Number\n  // Ops.String\n  // Ops.Coalesce\n  // Ops.Concat\n  // Ops.ToString\n};\n\n/**\n * @param {Expression} expression The expression.\n * @param {number} returnType The expected return type.\n * @param {CompilationContext} context The compilation context.\n * @return {CompiledExpression} The compiled expression\n */\nfunction compile(expression, returnType, context) {\n  // operator\n  if (expression instanceof CallExpression) {\n    const compiler = compilers[expression.operator];\n    if (compiler === undefined) {\n      throw new Error(\n        `No compiler defined for this operator: ${JSON.stringify(\n          expression.operator,\n        )}`,\n      );\n    }\n    return compiler(context, expression, returnType);\n  }\n\n  if ((expression.type & NumberType) > 0) {\n    return numberToGlsl(/** @type {number} */ (expression.value));\n  }\n\n  if ((expression.type & BooleanType) > 0) {\n    return expression.value.toString();\n  }\n\n  if ((expression.type & StringType) > 0) {\n    return stringToGlsl(expression.value.toString());\n  }\n\n  if ((expression.type & ColorType) > 0) {\n    return colorToGlsl(\n      /** @type {Array<number> | string} */ (expression.value),\n    );\n  }\n\n  if ((expression.type & NumberArrayType) > 0) {\n    return arrayToGlsl(/** @type {Array<number>} */ (expression.value));\n  }\n\n  if ((expression.type & SizeType) > 0) {\n    return sizeToGlsl(\n      /** @type {number|import('../size.js').Size} */ (expression.value),\n    );\n  }\n\n  throw new Error(\n    `Unexpected expression ${expression.value} (expected type ${typeName(\n      returnType,\n    )})`,\n  );\n}\n","/**\n * Utilities for compiling expressions and turning them into WebGL concepts\n * @module ol/render/webgl/compileUtil\n */\n\nimport {asArray} from '../../color.js';\nimport {\n  ColorType,\n  NumberArrayType,\n  SizeType,\n  newParsingContext,\n} from '../../expr/expression.js';\nimport {\n  buildExpression,\n  getStringNumberEquivalent,\n  uniformNameForVariable,\n} from '../../expr/gpu.js';\n\n/**\n * Recursively parses a style expression and outputs a GLSL-compatible string. Takes in a compilation context that\n * will be read and modified during the parsing operation.\n * @param {import(\"../../expr/gpu.js\").CompilationContext} compilationContext Compilation context\n * @param {import(\"../../expr/expression.js\").EncodedExpression} value Value\n * @param {number} [expectedType] Expected final type (can be several types combined)\n * @return {string} GLSL-compatible output\n */\nexport function expressionToGlsl(compilationContext, value, expectedType) {\n  const parsingContext = newParsingContext();\n  return buildExpression(\n    value,\n    expectedType,\n    parsingContext,\n    compilationContext,\n  );\n}\n\n/**\n * Packs all components of a color into a two-floats array\n * @param {import(\"../../color.js\").Color|string} color Color as array of numbers or string\n * @return {Array<number>} Vec2 array containing the color in compressed form\n */\nexport function packColor(color) {\n  const array = asArray(color);\n  const r = array[0] * 256;\n  const g = array[1];\n  const b = array[2] * 256;\n  const a = Math.round(array[3] * 255);\n  return [r + g, b + a];\n}\n\n/**\n * Unpacks a color from a packed color in two-floats array form\n * NOTE: this is only used for testing purposes\n * @param {Array<number>} packedColor Packed color generated by the `packColor` function\n * @return {Array<number>} Resulting unpacked color in array form with components in the range [0, 1]\n */\nexport function unpackColor(packedColor) {\n  return [\n    Math.min(Math.floor(packedColor[0] / 256.0) / 255.0, 1),\n    Math.min((packedColor[0] % 256.0) / 255.0, 1),\n    Math.min(Math.floor(packedColor[1] / 256.0) / 255.0, 1),\n    Math.min((packedColor[1] % 256.0) / 255.0, 1),\n  ];\n}\n\n/**\n * Equivalent of `unpackColor()` in GLSL\n * @type {string}\n */\nexport const UNPACK_COLOR_FN = `vec4 unpackColor(vec2 packedColor) {\n  return vec4(\n    min(floor(packedColor[0] / 256.0) / 255.0, 1.0),\n    min(mod(packedColor[0], 256.0) / 255.0, 1.0),\n    min(floor(packedColor[1] / 256.0) / 255.0, 1.0),\n    min(mod(packedColor[1], 256.0) / 255.0, 1.0)\n  );\n}`;\n\n/**\n * @param {number} type Value type\n * @return {1|2|3|4} The amount of components for this value\n */\nexport function getGlslSizeFromType(type) {\n  if (type === ColorType || type === SizeType) {\n    return 2;\n  }\n  if (type === NumberArrayType) {\n    return 4;\n  }\n  return 1;\n}\n\n/**\n * @param {number} type Value type\n * @return {'float'|'vec2'|'vec3'|'vec4'} The corresponding GLSL type for this value\n */\nexport function getGlslTypeFromType(type) {\n  const size = getGlslSizeFromType(type);\n  if (size > 1) {\n    return /** @type {'vec2'|'vec3'|'vec4'} */ (`vec${size}`);\n  }\n  return 'float';\n}\n\n/**\n * Applies the properties and variables collected in a compilation context to a ShaderBuilder instance:\n * properties will show up as attributes in shaders, and variables will show up as uniforms.\n * @param {import(\"./ShaderBuilder.js\").ShaderBuilder} builder Shader builder\n * @param {import(\"../../expr/gpu.js\").CompilationContext} context Compilation context\n */\nexport function applyContextToBuilder(builder, context) {\n  // define one uniform per variable\n  for (const varName in context.variables) {\n    const variable = context.variables[varName];\n    const uniformName = uniformNameForVariable(variable.name);\n    let glslType = getGlslTypeFromType(variable.type);\n    if (variable.type === ColorType) {\n      // we're not packing colors when they're passed as uniforms\n      glslType = 'vec4';\n    }\n    builder.addUniform(uniformName, glslType);\n  }\n\n  // for each feature attribute used in the fragment shader, define a varying that will be used to pass data\n  // from the vertex to the fragment shader, as well as an attribute in the vertex shader (if not already present)\n  for (const propName in context.properties) {\n    const property = context.properties[propName];\n    const glslType = getGlslTypeFromType(property.type);\n    const attributeName = `a_prop_${property.name}`;\n    if (property.type === ColorType) {\n      builder.addAttribute(\n        attributeName,\n        glslType,\n        `unpackColor(${attributeName})`,\n        'vec4',\n      );\n    } else {\n      builder.addAttribute(attributeName, glslType);\n    }\n  }\n\n  // add functions that were collected in the compilation contexts\n  for (const functionName in context.functions) {\n    builder.addVertexShaderFunction(context.functions[functionName]);\n    builder.addFragmentShaderFunction(context.functions[functionName]);\n  }\n}\n\n/**\n * Generates a set of uniforms from variables collected in a compilation context,\n * to be fed to a WebGLHelper instance\n * @param {import(\"../../expr/gpu.js\").CompilationContext} context Compilation context\n * @param {import('../../style/flat.js').StyleVariables} [variables] Style variables.\n * @return {Object<string,import(\"../../webgl/Helper\").UniformValue>} Uniforms\n */\nexport function generateUniformsFromContext(context, variables) {\n  /** @type {Object<string,import(\"../../webgl/Helper\").UniformValue>} */\n  const uniforms = {};\n\n  // define one uniform per variable\n  for (const varName in context.variables) {\n    const variable = context.variables[varName];\n    const uniformName = uniformNameForVariable(variable.name);\n\n    uniforms[uniformName] = () => {\n      const value = variables[variable.name];\n      if (typeof value === 'number') {\n        return value;\n      }\n      if (typeof value === 'boolean') {\n        return value ? 1 : 0;\n      }\n      if (variable.type === ColorType) {\n        const color = [...asArray(value || '#eee')];\n        color[0] /= 255;\n        color[1] /= 255;\n        color[2] /= 255;\n        color[3] ??= 1;\n        return color;\n      }\n      if (typeof value === 'string') {\n        return getStringNumberEquivalent(value);\n      }\n      return value;\n    };\n  }\n\n  return uniforms;\n}\n\n/**\n * Generates a set of attributes from properties collected in a compilation context,\n * to be fed to a WebGLHelper instance\n * @param {import(\"../../expr/gpu.js\").CompilationContext} context Compilation context\n * @return {import('./VectorStyleRenderer.js').AttributeDefinitions} Attributes\n */\nexport function generateAttributesFromContext(context) {\n  /**\n   * @type {import('./VectorStyleRenderer.js').AttributeDefinitions}\n   */\n  const attributes = {};\n\n  // Define attributes with their callback for each property used in the vertex shader\n  for (const propName in context.properties) {\n    const property = context.properties[propName];\n    const callback = (feature) => {\n      const value = feature.get(property.name);\n      if (property.type === ColorType) {\n        return packColor([...asArray(value || '#eee')]);\n      }\n      if (typeof value === 'string') {\n        return getStringNumberEquivalent(value);\n      }\n      if (typeof value === 'boolean') {\n        return value ? 1 : 0;\n      }\n      return value;\n    };\n\n    attributes[`prop_${property.name}`] = {\n      size: getGlslSizeFromType(property.type),\n      callback,\n    };\n  }\n  return attributes;\n}\n"],"names":["ARRAY_BUFFER","ELEMENT_ARRAY_BUFFER","STATIC_DRAW","DYNAMIC_DRAW","UNSIGNED_BYTE","UNSIGNED_SHORT","UNSIGNED_INT","FLOAT","CONTEXT_IDS","getContext","canvas","attributes","SAFARI_BUG_237906","ii","i","context","BufferUsage","WebGLArrayBuffer","type","usage","assert","size","getArrayClassForType","array","buffer","ArrayType","ContextEventType","DEFAULT_VERTEX_SHADER","DEFAULT_FRAGMENT_SHADER","WebGLPostProcessingPass","options","gl","vertexShader","fragmentShader","verticesArray","name","frameState","textureSize","level","internalFormat","border","format","data","nextPass","preCompose","postCompose","canvasId","getUid","opacity","value","textureSlot","uniform","DefaultUniform","AttributeType","canvasCache","getSharedCanvasCacheKey","key","uniqueCanvasCacheKeyCount","getUniqueCanvasCacheKey","getOrCreateContext","cacheItem","releaseCanvas","extension","WebGLHelper","Disposable","createTransform","create","uniforms","canvasCacheKey","ext","bufferKey","bufferCache","webGlBuffer","buf","disableAlphaBlend","enableDepth","pixelRatio","frameBuffer","texture","slot","uniformName","attributeName","index","renderTarget","start","end","elementType","elementSize","numItems","offsetInBytes","instanceCount","rotation","enabled","loc","imageReady","fromTransform","program","source","shader","fragmentShaderSource","vertexShaderSource","message","programUid","transform","resolution","center","composeTransform","attribName","stride","offset","instanced","location","computeAttributesStride","attr","getByteSizeFromType","event","clear","nearest","filter","BaseTileRepresentation","EventTarget","tile","EventType","TileState","ImageTile","image","abstract","helper","bindAndConfigure","interpolate","resampleFilter","uploadImageTexture","uploadDataTexture","bandCount","textureType","canInterpolate","bytesPerRow","unpackAlignment","oldUnpackAlignment","pixelContext","createPixelContext","createCanvasContext2D","TileTexture","toSize","coords","ReprojTile","asImageLike","asArrayLike","sourceTileSize","pixelSize","isFloat","pixelCount","DataType","bytesPerElement","textureCount","textureDataArrays","textureIndex","dataIndex","rowOffset","colCount","rowIndex","colIndex","dataValue","pixelIndex","bandIndex","textureData","textureBandIndex","renderCol","renderRow","gutter","renderWidth","renderHeight","sourceWidth","sourceHeight","sourceWidthWithoutGutter","sourceHeightWithoutGutter","sourceCol","sourceRow","sourceSize","bytesPerPixel","DataTile","arrayData","WebGLLayerRenderer","LayerRenderer","layer","LayerProperty","RenderEventType","RenderEvent","incrementGroup","groupNumber","className","renderer","layerClassName","Uniforms","depthForZ","z","newTileRepresentationLookup","lookupHasTile","tileRepresentationLookup","addTileRepresentationToLookup","tileRepresentation","representationsByZ","getRenderExtent","extent","layerState","getIntersection","fromUserExtent","gridExtent","getCacheKey","tileCoord","getTileCoordKey","WebGLBaseTileLayerRenderer","tileLayer","createMat4","TileRange","createTileCoord","cacheSize","LRUCache","isEmpty","initialZ","preload","viewState","tileSource","tileGrid","tileSourceKey","wantedTiles","tileRepresentationCache","map","minZ","viewport","getRotatedViewport","tileRange","tileResolution","x","y","cacheKey","tileQueueKey","tilesWithAlpha","tileTransform","renderExtent","tileSize","tileOrigin","tileExtent","depth","alpha","tileZ","alphaLookup","tileCoordKey","centerX","centerY","tileWidthWithGutter","tileHeightWithGutter","aspectRatio","centerI","centerJ","tileScale","tileCenterI","tileCenterJ","resetTransform","scaleTransform","rotateTransform","translateTransform","targetZ","nextExtent","blend","uid","time","minZoom","parentZ","zs","descending","j","jj","altZ","covered","loaded","BaseUniforms","Attributes","attributeDescriptions","WebGLTileLayerRenderer","paletteTexture","tileTexture","paletteIndex","mat4FromTransform","gutterExtent","pixel","coordinate","applyTransform","layerExtent","containsCoordinate","sources","boundingExtent","tileTextureCache","col","row","PaletteTexture","computeOperatorFunctionName","operator","numberToGlsl","v","s","arrayToGlsl","colorToGlsl","color","asArray","sizeToGlsl","stringToFloatMap","stringToFloatCounter","getStringNumberEquivalent","string","stringToGlsl","uniformNameForVariable","variableName","newCompilationContext","GET_BAND_VALUE_FUNC","PALETTE_TEXTURE_ARRAY","FEATURE_ID_PROPERTY_NAME","GEOMETRY_TYPE_PROPERTY_NAME","UNDEFINED_PROP_VALUE","buildExpression","encoded","parsingContext","compilationContext","expression","parse","compile","createCompiler","output","length","args","compilers","Ops","propName","result","isType","BooleanType","varName","compiledArgs","firstValue","secondValue","min","max","modulo","power","input","fallback","match","exponent","stop1","output1","stop2","output2","ratio","condition","needle","haystack","funcName","tests","rgb","band","xOffset","yOffset","ifBlocks","colorIndex","textureName","colors","numColors","palette","parsedValue","paletteName","compiledIndex","NumberType","returnType","CallExpression","compiler","StringType","ColorType","NumberArrayType","SizeType","typeName","expressionToGlsl","expectedType","newParsingContext","packColor","r","g","b","a","UNPACK_COLOR_FN","getGlslSizeFromType","getGlslTypeFromType","applyContextToBuilder","builder","variable","glslType","property","functionName","generateUniformsFromContext","variables","generateAttributesFromContext","callback","feature"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12]}