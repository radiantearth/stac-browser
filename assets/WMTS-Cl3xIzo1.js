import{y as E,W as b,a1 as K,G as V}from"./GeoJSON-BoRJWQIG.js";import{T as U}from"./TileGrid-r8UQ2tK6.js";import{a as z}from"./tileurlfunction-naLPssJX.js";import{e as k,a as O}from"./uri-CWE-Y_zl.js";import v from"./TileImage-BNMca0aI.js";import"./index-B3F0456b.js";import"./utils-BXWzvTjY.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-DO3czC2y.js";import"./useStateClass-BGbSLWFN-eI-Q6wqs.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--5aly-L7g.js";import"./TileRange-2Tc-Ry00.js";import"./tilecoord-DBpIeO-O.js";import"./Tile-Bg7ozswn.js";import"./Tile-Dd8tR1PC.js";import"./common-CLWpeXJR.js";import"./Tile-BqAKaOfQ.js";import"./UrlTile-CjdLFnBY.js";import"./TileEventType-CTN_nmJ7.js";class B extends U{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}function X(l,e,r){const i=[],c=[],n=[],d=[],f=[];r=r!==void 0?r:[];const C="SupportedCRS",h="TileMatrix",a="Identifier",j="ScaleDenominator",u="TopLeftCorner",x="TileWidth",L="TileHeight",I=l[C],R=E(I),m=R.getMetersPerUnit(),S=R.getAxisOrientation().startsWith("ne");return l[h].sort(function(o,y){return y[j]-o[j]}),l[h].forEach(function(o){let y;if(r.length>0?y=r.find(function(g){return o[a]==g[h]?!0:o[a].includes(":")?!1:l[a]+":"+o[a]===g[h]}):y=!0,y){c.push(o[a]);const g=o[j]*28e-5/m,P=o[x],G=o[L];S?n.push([o[u][1],o[u][0]]):n.push(o[u]),i.push(g),d.push(P==G?P:[P,G]),f.push([o.MatrixWidth,o.MatrixHeight])}}),new B({extent:e,origins:n,resolutions:i,matrixIds:c,tileSizes:d,sizes:f})}class fe extends v{constructor(e){const r=e.requestEncoding!==void 0?e.requestEncoding:"KVP",i=e.tileGrid;let c=e.urls;c===void 0&&e.url!==void 0&&(c=k(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:c,wrapX:e.wrapX!==void 0?e.wrapX:!1,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=r,this.setKey(this.getKeyForDimensions_()),c&&c.length>0&&(this.tileUrlFunction=z(c.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const r=e.join(`
`);this.setTileUrlFunction(z(e.map(this.createFromWMTSTemplate.bind(this))),r)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const r in this.dimensions_)e.push(r+"-"+this.dimensions_[r]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const r=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};r=="KVP"&&Object.assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=r=="KVP"?O(e,i):e.replace(/\{(\w+?)\}/g,function(d,f){return f.toLowerCase()in i?i[f.toLowerCase()]:d});const c=this.tileGrid,n=this.dimensions_;return(function(d,f,C){if(!d)return;const h={TileMatrix:c.getMatrixId(d[0]),TileCol:d[1],TileRow:d[2]};Object.assign(h,n);let a=e;return r=="KVP"?a=O(a,h):a=a.replace(/\{(\w+?)\}/g,function(j,u){return encodeURIComponent(h[u])}),a})}}function me(l,e){const i=l.Contents.Layer?.find(function(t){return t.Identifier==e.layer});if(!i)return null;const c=l.Contents.TileMatrixSet;let n;i.TileMatrixSetLink.length>1?"projection"in e?n=i.TileMatrixSetLink.findIndex(function(t){const _=c.find(function(D){return D.Identifier==t.TileMatrixSet}).SupportedCRS,w=E(_),M=E(e.projection);return w&&M?b(w,M):_==e.projection}):n=i.TileMatrixSetLink.findIndex(function(t){return t.TileMatrixSet==e.matrixSet}):n=0,n<0&&(n=0);const d=i.TileMatrixSetLink[n].TileMatrixSet,f=i.TileMatrixSetLink[n].TileMatrixSetLimits;let C=i.Format[0];"format"in e&&(C=e.format),n=i.Style.findIndex(function(t){return"style"in e?t.Title==e.style:t.isDefault}),n<0&&(n=0);const h=i.Style[n].Identifier,a={};"Dimension"in i&&i.Dimension.forEach(function(t,s,_){const w=t.Identifier;let M=t.Default;M===void 0&&(M=t.Value[0]),a[w]=M});const u=l.Contents.TileMatrixSet.find(function(t){return t.Identifier==d});let x;const L=u.SupportedCRS;if(L&&(x=E(L)),"projection"in e){const t=E(e.projection);t&&(!x||b(t,x))&&(x=t)}let I=!1;const R=x.getAxisOrientation().startsWith("ne");let m=u.TileMatrix[0],S={MinTileCol:0,MinTileRow:0,MaxTileCol:m.MatrixWidth-1,MaxTileRow:m.MatrixHeight-1};if(f){S=f[f.length-1];const t=u.TileMatrix.find(s=>s.Identifier===S.TileMatrix||u.Identifier+":"+s.Identifier===S.TileMatrix);t&&(m=t)}const o=i.BoundingBox?.find(t=>E(t.crs)&&b(E(t.crs),x)),y=m.ScaleDenominator*28e-5/x.getMetersPerUnit(),g=R?[m.TopLeftCorner[1],m.TopLeftCorner[0]]:m.TopLeftCorner,P=m.TileWidth*y,G=m.TileHeight*y;let p=o?.extent??u.BoundingBox;p&&R&&(p=[p[1],p[0],p[3],p[2]]);let W=[g[0]+P*S.MinTileCol,g[1]-G*(1+S.MaxTileRow),g[0]+P*(1+S.MaxTileCol),g[1]-G*S.MinTileRow];if(p!==void 0&&!K(p,W)){const t=i.WGS84BoundingBox,s=E("EPSG:4326").getExtent();if(W=p,t)I=t[0]===s[0]&&t[2]===s[2];else{const _=V(p,u.SupportedCRS,"EPSG:4326");I=_[0]-1e-10<=s[0]&&_[2]+1e-10>=s[2]}}const q=X(u,W,f),F=[];let T=e.requestEncoding;if(T=T!==void 0?T:"","OperationsMetadata"in l&&"GetTile"in l.OperationsMetadata){const t=l.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let s=0,_=t.length;s<_;++s)if(t[s].Constraint){const M=t[s].Constraint.find(function(D){return D.name=="GetEncoding"}).AllowedValues.Value;if(T===""&&(T=M[0]),T==="KVP")M.includes("KVP")&&F.push(t[s].href);else break}else t[s].href&&(T="KVP",F.push(t[s].href))}return F.length===0&&(T="REST",i.ResourceURL.forEach(function(t){t.resourceType==="tile"&&(C=t.format,F.push(t.template))})),{urls:F,layer:e.layer,matrixSet:d,format:C,projection:x,requestEncoding:T,tileGrid:q,style:h,dimensions:a,wrapX:I,crossOrigin:e.crossOrigin}}export{fe as default,me as optionsFromCapabilities};
//# sourceMappingURL=WMTS-Cl3xIzo1.js.map
