import{_ as we}from"./BForm.vue_vue_type_script_setup_true_lang-u44ElAm9-BXKo2xbS.js";import{a4 as Ee,n as zt,B as Ht,y as at,bk as oe,L as G,z as le,bl as Rt,G as z,q as nt,H as xt,bs as ve}from"./index-CZLOmM9h.js";import{d as Se,c as be}from"./BFormGroup.vue_vue_type_script_setup_true_lang-RIWLdYTY-CUN4WT8G.js";import{_ as _e}from"./BFormInput.vue_vue_type_script_setup_true_lang-DRDhfD8d-UEFXxaIb.js";import{bA as Le,bB as Te,bu as ae,bC as Oe,bD as Me,V as Bt,J as Vt,bE as Ie,bF as Re,bG as Xt,aA as Zt,F as Pt,bH as Yt,bI as Pe,bg as Ce,t as Ne,bJ as Kt,d as ue,R as Ft,B as Ae,M as Be,K as Ve,N as Fe,G as Jt,H as Ge,i as ke,h as qe,bK as De,bL as Ue,a as ze}from"./GeoJSON-R3UKT-HL.js";import{t as He}from"./utils-BXWzvTjY.js";import"./I18N-DlIXJTel.js";import"./_commonjsHelpers-CE1G-McA.js";import"./useStateClass-BGbSLWFN-CfFJOZ-N.js";import"./debounce-BHqBzJ1a-inCByRg3.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-B3EEl1J0.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--fUwaC9LK.js";const je={viewBox:"0 0 16 16",width:"1.2em",height:"1.2em"};function $e(n,t){return zt(),Ht("svg",je,[...t[0]||(t[0]=[at("g",{fill:"currentColor","fill-rule":"evenodd"},[at("path",{d:"M3.1 11.2a.5.5 0 0 1 .4-.2H6a.5.5 0 0 1 0 1H3.75L1.5 15h13l-2.25-3H10a.5.5 0 0 1 0-1h2.5a.5.5 0 0 1 .4.2l3 4a.5.5 0 0 1-.4.8H.5a.5.5 0 0 1-.4-.8z"}),at("path",{d:"M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999z"})],-1)])])}const Xe=Ee({name:"bi-pin-map-fill",render:$e}),Ze={name:"UserLocationControl",mixins:[Le],props:{maxZoom:{type:Number,default:void 0}},methods:{request(){"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(n=>{const t=this.map.getView(),e=Te([n.coords.longitude,n.coords.latitude],t.getProjection()),s=new ae(e);t.fit(s,{maxZoom:this.maxZoom})},n=>this.$store.commit("showGlobalError",{error:n,message:n.message}),{maximumAge:1/0})}}},Ye={class:"ol-location ol-unselectable ol-control",style:{"pointer-events":"auto"}},Ke=["title"];function Je(n,t,e,s,i,a){const g=Xe;return zt(),Ht("div",Ye,[at("button",{onClick:t[0]||(t[0]=le((...f)=>a.request&&a.request(...f),["prevent","stop"])),title:n.$t("mapping.location.description")},[G(g)],8,Ke)])}const We=oe(Ze,[["render",Je],["__scopeId","data-v-f8d6420b"]]),Qe={EXTENTCHANGED:"extentchanged"};class tn extends Ae{constructor(t){super(Qe.EXTENTCHANGED),this.extent=t}}class en extends Oe{constructor(t){t=t||{},super(t),this.on,this.once,this.un,this.condition_=t.condition?t.condition:Me,this.createCondition_=t.createCondition||this.condition_,this.drag_=t.drag||!1,this.extent_=null,this.pointerHandler_=null,this.pixelTolerance_=t.pixelTolerance!==void 0?t.pixelTolerance:10,this.snappedToVertex_=!1,this.extentFeature_=null,this.vertexFeature_=null,t||(t={}),this.extentOverlay_=new Bt({source:new Vt({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.boxStyle?t.boxStyle:nn(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.vertexOverlay_=new Bt({source:new Vt({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.pointerStyle?t.pointerStyle:rn(),updateWhileAnimating:!0,updateWhileInteracting:!0}),t.extent&&this.setExtent(t.extent)}snapToVertex_(t,e){const s=e.getCoordinateFromPixelInternal(t),i=function(g,f){return Kt(s,g)-Kt(s,f)},a=this.getExtentInternal();if(a){const g=on(a);g.sort(i);const f=g[0];let E=Ie(s,f);const w=e.getPixelFromCoordinateInternal(E);if(Re(t,w)<=this.pixelTolerance_){const _=e.getPixelFromCoordinateInternal(f[0]),b=e.getPixelFromCoordinateInternal(f[1]),O=Xt(w,_),I=Xt(w,b),D=Math.sqrt(Math.min(O,I));return this.snappedToVertex_=D<=this.pixelTolerance_,this.snappedToVertex_&&(E=O>I?f[1]:f[0]),E}}return null}handlePointerMove_(t){const e=t.pixel,s=t.map,i=this.drag_&&Zt(this.extent_,t.coordinate);let a=this.snapToVertex_(e,s);return!a&&this.createCondition_(t)&&!i&&(a=s.getCoordinateFromPixelInternal(e)),i&&!a?this.getMap().getViewport().classList.add("ol-grab"):this.getMap().getViewport().classList.remove("ol-grab"),a?(this.updatePointerFeature_(a),!0):(this.noVertexFeature_(),!1)}createOrUpdateExtentFeature_(t){let e=this.extentFeature_;return e?t?e.setGeometry(Yt(t)):e.setGeometry(void 0):(t?e=new Pt(Yt(t)):e=new Pt({}),this.extentFeature_=e,this.extentOverlay_.getSource().addFeature(e)),e}updatePointerFeature_(t,e=!0){let s=this.vertexFeature_;return e&&!s&&(s=new Pt(new ae(t)),this.vertexFeature_=s,this.vertexOverlay_.getSource().addFeature(s)),s&&s.getGeometry().setCoordinates(t),s}noVertexFeature_(){this.vertexFeature_&&(this.vertexOverlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}handleEvent(t){if(!t.originalEvent||!this.condition_(t))return this.noVertexFeature_(),!0;let e=this.handlingDownUpSequence;return t.type==Pe.POINTERMOVE&&!this.handlingDownUpSequence&&(e=this.handlePointerMove_(t)),super.handleEvent(t),!e}handleDownEvent(t){const e=t.pixel,s=t.map,i=this.getExtentInternal();let a=this.snapToVertex_(e,s);const g=function(f){let E=null,w=null;return f[0]==i[0]?E=i[2]:f[0]==i[2]&&(E=i[0]),f[1]==i[1]?w=i[3]:f[1]==i[3]&&(w=i[1]),E!==null&&w!==null?[E,w]:null};if(a&&i){const f=a[0]==i[0]||a[0]==i[2]?a[0]:null,E=a[1]==i[1]||a[1]==i[3]?a[1]:null;f!==null&&E!==null?this.pointerHandler_=Wt(g(a)):f!==null?this.pointerHandler_=Qt(g([f,i[1]]),g([f,i[3]])):E!==null&&(this.pointerHandler_=Qt(g([i[0],E]),g([i[2],E])))}else{a=s.getCoordinateFromPixelInternal(e);let f=!1;this.drag_&&Zt(i,a)&&(this.pointerHandler_=sn(i,a),f=!0),!f&&this.createCondition_(t)&&(this.setExtent([a[0],a[1],a[0],a[1]]),this.pointerHandler_=Wt(a))}return!!this.pointerHandler_}handleDragEvent(t){if(this.pointerHandler_){const e=t.coordinate;this.setExtent(this.pointerHandler_(e)),this.updatePointerFeature_(e,!1)}}handleUpEvent(t){this.pointerHandler_=null;const e=this.getExtentInternal();return(!e||Ce(e)===0)&&this.setExtent(null),!1}setMap(t){this.extentOverlay_.setMap(t),this.vertexOverlay_.setMap(t),super.setMap(t)}getExtent(){return Ne(this.getExtentInternal(),this.getMap().getView().getProjection())}getExtentInternal(){return this.extent_}setExtent(t){this.extent_=t||null,this.createOrUpdateExtentFeature_(t),this.dispatchEvent(new tn(this.extent_))}}function nn(){const n=ue();return function(t,e){return n.Polygon}}function rn(){const n=ue();return function(t,e){return n.Point}}function Wt(n){return function(t){return Ft([n,t])}}function Qt(n,t){return n[0]==t[0]?function(e){return Ft([n,[e[0],t[1]]])}:n[1]==t[1]?function(e){return Ft([n,[t[0],e[1]]])}:null}function sn(n,t){return function(e){const s=e[0]-t[0],i=e[1]-t[1];return[n[0]+s,n[1]+i,n[2]+s,n[3]+i]}}function on(n){return[[[n[0],n[1]],[n[0],n[3]]],[[n[0],n[3]],[n[2],n[3]]],[[n[2],n[3]],[n[2],n[1]]],[[n[2],n[1]],[n[0],n[1]]]]}function he(n,t,e={}){const s={type:"Feature"};return(e.id===0||e.id)&&(s.id=e.id),e.bbox&&(s.bbox=e.bbox),s.properties={},s.geometry=n,s}function ln(n,t,e={}){for(const i of n){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let a=0;a<i[i.length-1].length;a++)if(i[i.length-1][a]!==i[0][a])throw new Error("First and last Position are not equivalent.")}return he({type:"Polygon",coordinates:n},t,e)}function an(n,t,e={}){return he({type:"MultiPolygon",coordinates:n},t,e)}var un=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Ct=Math.ceil,Y=Math.floor,H="[BigNumber Error] ",te=H+"Number primitive has more than 15 significant digits: ",J=1e14,M=14,Nt=9007199254740991,At=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],st=1e7,F=1e9;function fe(n){var t,e,s,i=S.prototype={constructor:S,toString:null,valueOf:null},a=new S(1),g=20,f=4,E=-7,w=21,_=-1e7,b=1e7,O=!1,I=1,D=0,j={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},k="0123456789abcdefghijklmnopqrstuvwxyz",Lt=!0;function S(r,o){var l,m,h,p,y,u,c,x,d=this;if(!(d instanceof S))return new S(r,o);if(o==null){if(r&&r._isBigNumber===!0){d.s=r.s,!r.c||r.e>b?d.c=d.e=null:r.e<_?d.c=[d.e=0]:(d.e=r.e,d.c=r.c.slice());return}if((u=typeof r=="number")&&r*0==0){if(d.s=1/r<0?(r=-r,-1):1,r===~~r){for(p=0,y=r;y>=10;y/=10,p++);p>b?d.c=d.e=null:(d.e=p,d.c=[r]);return}x=String(r)}else{if(!un.test(x=String(r)))return s(d,x,u);d.s=x.charCodeAt(0)==45?(x=x.slice(1),-1):1}(p=x.indexOf("."))>-1&&(x=x.replace(".","")),(y=x.search(/e/i))>0?(p<0&&(p=y),p+=+x.slice(y+1),x=x.substring(0,y)):p<0&&(p=x.length)}else{if(N(o,2,k.length,"Base"),o==10&&Lt)return d=new S(r),$(d,g+d.e+1,f);if(x=String(r),u=typeof r=="number"){if(r*0!=0)return s(d,x,u,o);if(d.s=1/r<0?(x=x.slice(1),-1):1,S.DEBUG&&x.replace(/^0\.0*|\./,"").length>15)throw Error(te+r)}else d.s=x.charCodeAt(0)===45?(x=x.slice(1),-1):1;for(l=k.slice(0,o),p=y=0,c=x.length;y<c;y++)if(l.indexOf(m=x.charAt(y))<0){if(m=="."){if(y>p){p=c;continue}}else if(!h&&(x==x.toUpperCase()&&(x=x.toLowerCase())||x==x.toLowerCase()&&(x=x.toUpperCase()))){h=!0,y=-1,p=0;continue}return s(d,String(r),u,o)}u=!1,x=e(x,o,10,d.s),(p=x.indexOf("."))>-1?x=x.replace(".",""):p=x.length}for(y=0;x.charCodeAt(y)===48;y++);for(c=x.length;x.charCodeAt(--c)===48;);if(x=x.slice(y,++c)){if(c-=y,u&&S.DEBUG&&c>15&&(r>Nt||r!==Y(r)))throw Error(te+d.s*r);if((p=p-y-1)>b)d.c=d.e=null;else if(p<_)d.c=[d.e=0];else{if(d.e=p,d.c=[],y=(p+1)%M,p<0&&(y+=M),y<c){for(y&&d.c.push(+x.slice(0,y)),c-=M;y<c;)d.c.push(+x.slice(y,y+=M));y=M-(x=x.slice(y)).length}else y-=c;for(;y--;x+="0");d.c.push(+x)}}else d.c=[d.e=0]}S.clone=fe,S.ROUND_UP=0,S.ROUND_DOWN=1,S.ROUND_CEIL=2,S.ROUND_FLOOR=3,S.ROUND_HALF_UP=4,S.ROUND_HALF_DOWN=5,S.ROUND_HALF_EVEN=6,S.ROUND_HALF_CEIL=7,S.ROUND_HALF_FLOOR=8,S.EUCLID=9,S.config=S.set=function(r){var o,l;if(r!=null)if(typeof r=="object"){if(r.hasOwnProperty(o="DECIMAL_PLACES")&&(l=r[o],N(l,0,F,o),g=l),r.hasOwnProperty(o="ROUNDING_MODE")&&(l=r[o],N(l,0,8,o),f=l),r.hasOwnProperty(o="EXPONENTIAL_AT")&&(l=r[o],l&&l.pop?(N(l[0],-F,0,o),N(l[1],0,F,o),E=l[0],w=l[1]):(N(l,-F,F,o),E=-(w=l<0?-l:l))),r.hasOwnProperty(o="RANGE"))if(l=r[o],l&&l.pop)N(l[0],-F,-1,o),N(l[1],1,F,o),_=l[0],b=l[1];else if(N(l,-F,F,o),l)_=-(b=l<0?-l:l);else throw Error(H+o+" cannot be zero: "+l);if(r.hasOwnProperty(o="CRYPTO"))if(l=r[o],l===!!l)if(l)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))O=l;else throw O=!l,Error(H+"crypto unavailable");else O=l;else throw Error(H+o+" not true or false: "+l);if(r.hasOwnProperty(o="MODULO_MODE")&&(l=r[o],N(l,0,9,o),I=l),r.hasOwnProperty(o="POW_PRECISION")&&(l=r[o],N(l,0,F,o),D=l),r.hasOwnProperty(o="FORMAT"))if(l=r[o],typeof l=="object")j=l;else throw Error(H+o+" not an object: "+l);if(r.hasOwnProperty(o="ALPHABET"))if(l=r[o],typeof l=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(l))Lt=l.slice(0,10)=="0123456789",k=l;else throw Error(H+o+" invalid: "+l)}else throw Error(H+"Object expected: "+r);return{DECIMAL_PLACES:g,ROUNDING_MODE:f,EXPONENTIAL_AT:[E,w],RANGE:[_,b],CRYPTO:O,MODULO_MODE:I,POW_PRECISION:D,FORMAT:j,ALPHABET:k}},S.isBigNumber=function(r){if(!r||r._isBigNumber!==!0)return!1;if(!S.DEBUG)return!0;var o,l,m=r.c,h=r.e,p=r.s;t:if({}.toString.call(m)=="[object Array]"){if((p===1||p===-1)&&h>=-F&&h<=F&&h===Y(h)){if(m[0]===0){if(h===0&&m.length===1)return!0;break t}if(o=(h+1)%M,o<1&&(o+=M),String(m[0]).length==o){for(o=0;o<m.length;o++)if(l=m[o],l<0||l>=J||l!==Y(l))break t;if(l!==0)return!0}}}else if(m===null&&h===null&&(p===null||p===1||p===-1))return!0;throw Error(H+"Invalid BigNumber: "+r)},S.maximum=S.max=function(){return $t(arguments,-1)},S.minimum=S.min=function(){return $t(arguments,1)},S.random=(function(){var r=9007199254740992,o=Math.random()*r&2097151?function(){return Y(Math.random()*r)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(l){var m,h,p,y,u,c=0,x=[],d=new S(a);if(l==null?l=g:N(l,0,F),y=Ct(l/M),O)if(crypto.getRandomValues){for(m=crypto.getRandomValues(new Uint32Array(y*=2));c<y;)u=m[c]*131072+(m[c+1]>>>11),u>=9e15?(h=crypto.getRandomValues(new Uint32Array(2)),m[c]=h[0],m[c+1]=h[1]):(x.push(u%1e14),c+=2);c=y/2}else if(crypto.randomBytes){for(m=crypto.randomBytes(y*=7);c<y;)u=(m[c]&31)*281474976710656+m[c+1]*1099511627776+m[c+2]*4294967296+m[c+3]*16777216+(m[c+4]<<16)+(m[c+5]<<8)+m[c+6],u>=9e15?crypto.randomBytes(7).copy(m,c):(x.push(u%1e14),c+=7);c=y/7}else throw O=!1,Error(H+"crypto unavailable");if(!O)for(;c<y;)u=o(),u<9e15&&(x[c++]=u%1e14);for(y=x[--c],l%=M,y&&l&&(u=At[M-l],x[c]=Y(y/u)*u);x[c]===0;x.pop(),c--);if(c<0)x=[p=0];else{for(p=-1;x[0]===0;x.splice(0,1),p-=M);for(c=1,u=x[0];u>=10;u/=10,c++);c<M&&(p-=M-c)}return d.e=p,d.c=x,d}})(),S.sum=function(){for(var r=1,o=arguments,l=new S(o[0]);r<o.length;)l=l.plus(o[r++]);return l},e=(function(){var r="0123456789";function o(l,m,h,p){for(var y,u=[0],c,x=0,d=l.length;x<d;){for(c=u.length;c--;u[c]*=m);for(u[0]+=p.indexOf(l.charAt(x++)),y=0;y<u.length;y++)u[y]>h-1&&(u[y+1]==null&&(u[y+1]=0),u[y+1]+=u[y]/h|0,u[y]%=h)}return u.reverse()}return function(l,m,h,p,y){var u,c,x,d,v,L,T,P,A=l.indexOf("."),V=g,R=f;for(A>=0&&(d=D,D=0,l=l.replace(".",""),P=new S(m),L=P.pow(l.length-A),D=d,P.c=o(it(Z(L.c),L.e,"0"),10,h,r),P.e=P.c.length),T=o(l,m,h,y?(u=k,r):(u=r,k)),x=d=T.length;T[--d]==0;T.pop());if(!T[0])return u.charAt(0);if(A<0?--x:(L.c=T,L.e=x,L.s=p,L=t(L,P,V,R,h),T=L.c,v=L.r,x=L.e),c=x+V+1,A=T[c],d=h/2,v=v||c<0||T[c+1]!=null,v=R<4?(A!=null||v)&&(R==0||R==(L.s<0?3:2)):A>d||A==d&&(R==4||v||R==6&&T[c-1]&1||R==(L.s<0?8:7)),c<1||!T[0])l=v?it(u.charAt(1),-V,u.charAt(0)):u.charAt(0);else{if(T.length=c,v)for(--h;++T[--c]>h;)T[c]=0,c||(++x,T=[1].concat(T));for(d=T.length;!T[--d];);for(A=0,l="";A<=d;l+=u.charAt(T[A++]));l=it(l,x,u.charAt(0))}return l}})(),t=(function(){function r(m,h,p){var y,u,c,x,d=0,v=m.length,L=h%st,T=h/st|0;for(m=m.slice();v--;)c=m[v]%st,x=m[v]/st|0,y=T*c+x*L,u=L*c+y%st*st+d,d=(u/p|0)+(y/st|0)+T*x,m[v]=u%p;return d&&(m=[d].concat(m)),m}function o(m,h,p,y){var u,c;if(p!=y)c=p>y?1:-1;else for(u=c=0;u<p;u++)if(m[u]!=h[u]){c=m[u]>h[u]?1:-1;break}return c}function l(m,h,p,y){for(var u=0;p--;)m[p]-=u,u=m[p]<h[p]?1:0,m[p]=u*y+m[p]-h[p];for(;!m[0]&&m.length>1;m.splice(0,1));}return function(m,h,p,y,u){var c,x,d,v,L,T,P,A,V,R,C,q,mt,Mt,It,W,ht,X=m.s==h.s?1:-1,U=m.c,B=h.c;if(!U||!U[0]||!B||!B[0])return new S(!m.s||!h.s||(U?B&&U[0]==B[0]:!B)?NaN:U&&U[0]==0||!B?X*0:X/0);for(A=new S(X),V=A.c=[],x=m.e-h.e,X=p+x+1,u||(u=J,x=K(m.e/M)-K(h.e/M),X=X/M|0),d=0;B[d]==(U[d]||0);d++);if(B[d]>(U[d]||0)&&x--,X<0)V.push(1),v=!0;else{for(Mt=U.length,W=B.length,d=0,X+=2,L=Y(u/(B[0]+1)),L>1&&(B=r(B,L,u),U=r(U,L,u),W=B.length,Mt=U.length),mt=W,R=U.slice(0,W),C=R.length;C<W;R[C++]=0);ht=B.slice(),ht=[0].concat(ht),It=B[0],B[1]>=u/2&&It++;do{if(L=0,c=o(B,R,W,C),c<0){if(q=R[0],W!=C&&(q=q*u+(R[1]||0)),L=Y(q/It),L>1)for(L>=u&&(L=u-1),T=r(B,L,u),P=T.length,C=R.length;o(T,R,P,C)==1;)L--,l(T,W<P?ht:B,P,u),P=T.length,c=1;else L==0&&(c=L=1),T=B.slice(),P=T.length;if(P<C&&(T=[0].concat(T)),l(R,T,C,u),C=R.length,c==-1)for(;o(B,R,W,C)<1;)L++,l(R,W<C?ht:B,C,u),C=R.length}else c===0&&(L++,R=[0]);V[d++]=L,R[0]?R[C++]=U[mt]||0:(R=[U[mt]],C=1)}while((mt++<Mt||R[0]!=null)&&X--);v=R[0]!=null,V[0]||V.splice(0,1)}if(u==J){for(d=1,X=V[0];X>=10;X/=10,d++);$(A,p+(A.e=d+x*M-1)+1,y,v)}else A.e=x,A.r=+v;return A}})();function Tt(r,o,l,m){var h,p,y,u,c;if(l==null?l=f:N(l,0,8),!r.c)return r.toString();if(h=r.c[0],y=r.e,o==null)c=Z(r.c),c=m==1||m==2&&(y<=E||y>=w)?wt(c,y):it(c,y,"0");else if(r=$(new S(r),o,l),p=r.e,c=Z(r.c),u=c.length,m==1||m==2&&(o<=p||p<=E)){for(;u<o;c+="0",u++);c=wt(c,p)}else if(o-=y+(m===2&&p>y),c=it(c,p,"0"),p+1>u){if(--o>0)for(c+=".";o--;c+="0");}else if(o+=p-u,o>0)for(p+1==u&&(c+=".");o--;c+="0");return r.s<0&&h?"-"+c:c}function $t(r,o){for(var l,m,h=1,p=new S(r[0]);h<r.length;h++)m=new S(r[h]),(!m.s||(l=ot(p,m))===o||l===0&&p.s===o)&&(p=m);return p}function Ot(r,o,l){for(var m=1,h=o.length;!o[--h];o.pop());for(h=o[0];h>=10;h/=10,m++);return(l=m+l*M-1)>b?r.c=r.e=null:l<_?r.c=[r.e=0]:(r.e=l,r.c=o),r}s=(function(){var r=/^(-?)0([xbo])(?=\w[\w.]*$)/i,o=/^([^.]+)\.$/,l=/^\.([^.]+)$/,m=/^-?(Infinity|NaN)$/,h=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(p,y,u,c){var x,d=u?y:y.replace(h,"");if(m.test(d))p.s=isNaN(d)?null:d<0?-1:1;else{if(!u&&(d=d.replace(r,function(v,L,T){return x=(T=T.toLowerCase())=="x"?16:T=="b"?2:8,!c||c==x?L:v}),c&&(x=c,d=d.replace(o,"$1").replace(l,"0.$1")),y!=d))return new S(d,x);if(S.DEBUG)throw Error(H+"Not a"+(c?" base "+c:"")+" number: "+y);p.s=null}p.c=p.e=null}})();function $(r,o,l,m){var h,p,y,u,c,x,d,v=r.c,L=At;if(v){t:{for(h=1,u=v[0];u>=10;u/=10,h++);if(p=o-h,p<0)p+=M,y=o,c=v[x=0],d=Y(c/L[h-y-1]%10);else if(x=Ct((p+1)/M),x>=v.length)if(m){for(;v.length<=x;v.push(0));c=d=0,h=1,p%=M,y=p-M+1}else break t;else{for(c=u=v[x],h=1;u>=10;u/=10,h++);p%=M,y=p-M+h,d=y<0?0:Y(c/L[h-y-1]%10)}if(m=m||o<0||v[x+1]!=null||(y<0?c:c%L[h-y-1]),m=l<4?(d||m)&&(l==0||l==(r.s<0?3:2)):d>5||d==5&&(l==4||m||l==6&&(p>0?y>0?c/L[h-y]:0:v[x-1])%10&1||l==(r.s<0?8:7)),o<1||!v[0])return v.length=0,m?(o-=r.e+1,v[0]=L[(M-o%M)%M],r.e=-o||0):v[0]=r.e=0,r;if(p==0?(v.length=x,u=1,x--):(v.length=x+1,u=L[M-p],v[x]=y>0?Y(c/L[h-y]%L[y])*u:0),m)for(;;)if(x==0){for(p=1,y=v[0];y>=10;y/=10,p++);for(y=v[0]+=u,u=1;y>=10;y/=10,u++);p!=u&&(r.e++,v[0]==J&&(v[0]=1));break}else{if(v[x]+=u,v[x]!=J)break;v[x--]=0,u=1}for(p=v.length;v[--p]===0;v.pop());}r.e>b?r.c=r.e=null:r.e<_&&(r.c=[r.e=0])}return r}function et(r){var o,l=r.e;return l===null?r.toString():(o=Z(r.c),o=l<=E||l>=w?wt(o,l):it(o,l,"0"),r.s<0?"-"+o:o)}return i.absoluteValue=i.abs=function(){var r=new S(this);return r.s<0&&(r.s=1),r},i.comparedTo=function(r,o){return ot(this,new S(r,o))},i.decimalPlaces=i.dp=function(r,o){var l,m,h,p=this;if(r!=null)return N(r,0,F),o==null?o=f:N(o,0,8),$(new S(p),r+p.e+1,o);if(!(l=p.c))return null;if(m=((h=l.length-1)-K(this.e/M))*M,h=l[h])for(;h%10==0;h/=10,m--);return m<0&&(m=0),m},i.dividedBy=i.div=function(r,o){return t(this,new S(r,o),g,f)},i.dividedToIntegerBy=i.idiv=function(r,o){return t(this,new S(r,o),0,1)},i.exponentiatedBy=i.pow=function(r,o){var l,m,h,p,y,u,c,x,d,v=this;if(r=new S(r),r.c&&!r.isInteger())throw Error(H+"Exponent not an integer: "+et(r));if(o!=null&&(o=new S(o)),u=r.e>14,!v.c||!v.c[0]||v.c[0]==1&&!v.e&&v.c.length==1||!r.c||!r.c[0])return d=new S(Math.pow(+et(v),u?r.s*(2-yt(r)):+et(r))),o?d.mod(o):d;if(c=r.s<0,o){if(o.c?!o.c[0]:!o.s)return new S(NaN);m=!c&&v.isInteger()&&o.isInteger(),m&&(v=v.mod(o))}else{if(r.e>9&&(v.e>0||v.e<-1||(v.e==0?v.c[0]>1||u&&v.c[1]>=24e7:v.c[0]<8e13||u&&v.c[0]<=9999975e7)))return p=v.s<0&&yt(r)?-0:0,v.e>-1&&(p=1/p),new S(c?1/p:p);D&&(p=Ct(D/M+2))}for(u?(l=new S(.5),c&&(r.s=1),x=yt(r)):(h=Math.abs(+et(r)),x=h%2),d=new S(a);;){if(x){if(d=d.times(v),!d.c)break;p?d.c.length>p&&(d.c.length=p):m&&(d=d.mod(o))}if(h){if(h=Y(h/2),h===0)break;x=h%2}else if(r=r.times(l),$(r,r.e+1,1),r.e>14)x=yt(r);else{if(h=+et(r),h===0)break;x=h%2}v=v.times(v),p?v.c&&v.c.length>p&&(v.c.length=p):m&&(v=v.mod(o))}return m?d:(c&&(d=a.div(d)),o?d.mod(o):p?$(d,D,f,y):d)},i.integerValue=function(r){var o=new S(this);return r==null?r=f:N(r,0,8),$(o,o.e+1,r)},i.isEqualTo=i.eq=function(r,o){return ot(this,new S(r,o))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function(r,o){return ot(this,new S(r,o))>0},i.isGreaterThanOrEqualTo=i.gte=function(r,o){return(o=ot(this,new S(r,o)))===1||o===0},i.isInteger=function(){return!!this.c&&K(this.e/M)>this.c.length-2},i.isLessThan=i.lt=function(r,o){return ot(this,new S(r,o))<0},i.isLessThanOrEqualTo=i.lte=function(r,o){return(o=ot(this,new S(r,o)))===-1||o===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function(r,o){var l,m,h,p,y=this,u=y.s;if(r=new S(r,o),o=r.s,!u||!o)return new S(NaN);if(u!=o)return r.s=-o,y.plus(r);var c=y.e/M,x=r.e/M,d=y.c,v=r.c;if(!c||!x){if(!d||!v)return d?(r.s=-o,r):new S(v?y:NaN);if(!d[0]||!v[0])return v[0]?(r.s=-o,r):new S(d[0]?y:f==3?-0:0)}if(c=K(c),x=K(x),d=d.slice(),u=c-x){for((p=u<0)?(u=-u,h=d):(x=c,h=v),h.reverse(),o=u;o--;h.push(0));h.reverse()}else for(m=(p=(u=d.length)<(o=v.length))?u:o,u=o=0;o<m;o++)if(d[o]!=v[o]){p=d[o]<v[o];break}if(p&&(h=d,d=v,v=h,r.s=-r.s),o=(m=v.length)-(l=d.length),o>0)for(;o--;d[l++]=0);for(o=J-1;m>u;){if(d[--m]<v[m]){for(l=m;l&&!d[--l];d[l]=o);--d[l],d[m]+=J}d[m]-=v[m]}for(;d[0]==0;d.splice(0,1),--x);return d[0]?Ot(r,d,x):(r.s=f==3?-1:1,r.c=[r.e=0],r)},i.modulo=i.mod=function(r,o){var l,m,h=this;return r=new S(r,o),!h.c||!r.s||r.c&&!r.c[0]?new S(NaN):!r.c||h.c&&!h.c[0]?new S(h):(I==9?(m=r.s,r.s=1,l=t(h,r,0,3),r.s=m,l.s*=m):l=t(h,r,0,I),r=h.minus(l.times(r)),!r.c[0]&&I==1&&(r.s=h.s),r)},i.multipliedBy=i.times=function(r,o){var l,m,h,p,y,u,c,x,d,v,L,T,P,A,V,R=this,C=R.c,q=(r=new S(r,o)).c;if(!C||!q||!C[0]||!q[0])return!R.s||!r.s||C&&!C[0]&&!q||q&&!q[0]&&!C?r.c=r.e=r.s=null:(r.s*=R.s,!C||!q?r.c=r.e=null:(r.c=[0],r.e=0)),r;for(m=K(R.e/M)+K(r.e/M),r.s*=R.s,c=C.length,v=q.length,c<v&&(P=C,C=q,q=P,h=c,c=v,v=h),h=c+v,P=[];h--;P.push(0));for(A=J,V=st,h=v;--h>=0;){for(l=0,L=q[h]%V,T=q[h]/V|0,y=c,p=h+y;p>h;)x=C[--y]%V,d=C[y]/V|0,u=T*x+d*L,x=L*x+u%V*V+P[p]+l,l=(x/A|0)+(u/V|0)+T*d,P[p--]=x%A;P[p]=l}return l?++m:P.splice(0,1),Ot(r,P,m)},i.negated=function(){var r=new S(this);return r.s=-r.s||null,r},i.plus=function(r,o){var l,m=this,h=m.s;if(r=new S(r,o),o=r.s,!h||!o)return new S(NaN);if(h!=o)return r.s=-o,m.minus(r);var p=m.e/M,y=r.e/M,u=m.c,c=r.c;if(!p||!y){if(!u||!c)return new S(h/0);if(!u[0]||!c[0])return c[0]?r:new S(u[0]?m:h*0)}if(p=K(p),y=K(y),u=u.slice(),h=p-y){for(h>0?(y=p,l=c):(h=-h,l=u),l.reverse();h--;l.push(0));l.reverse()}for(h=u.length,o=c.length,h-o<0&&(l=c,c=u,u=l,o=h),h=0;o;)h=(u[--o]=u[o]+c[o]+h)/J|0,u[o]=J===u[o]?0:u[o]%J;return h&&(u=[h].concat(u),++y),Ot(r,u,y)},i.precision=i.sd=function(r,o){var l,m,h,p=this;if(r!=null&&r!==!!r)return N(r,1,F),o==null?o=f:N(o,0,8),$(new S(p),r,o);if(!(l=p.c))return null;if(h=l.length-1,m=h*M+1,h=l[h]){for(;h%10==0;h/=10,m--);for(h=l[0];h>=10;h/=10,m++);}return r&&p.e+1>m&&(m=p.e+1),m},i.shiftedBy=function(r){return N(r,-Nt,Nt),this.times("1e"+r)},i.squareRoot=i.sqrt=function(){var r,o,l,m,h,p=this,y=p.c,u=p.s,c=p.e,x=g+4,d=new S("0.5");if(u!==1||!y||!y[0])return new S(!u||u<0&&(!y||y[0])?NaN:y?p:1/0);if(u=Math.sqrt(+et(p)),u==0||u==1/0?(o=Z(y),(o.length+c)%2==0&&(o+="0"),u=Math.sqrt(+o),c=K((c+1)/2)-(c<0||c%2),u==1/0?o="5e"+c:(o=u.toExponential(),o=o.slice(0,o.indexOf("e")+1)+c),l=new S(o)):l=new S(u+""),l.c[0]){for(c=l.e,u=c+x,u<3&&(u=0);;)if(h=l,l=d.times(h.plus(t(p,h,x,1))),Z(h.c).slice(0,u)===(o=Z(l.c)).slice(0,u))if(l.e<c&&--u,o=o.slice(u-3,u+1),o=="9999"||!m&&o=="4999"){if(!m&&($(h,h.e+g+2,0),h.times(h).eq(p))){l=h;break}x+=4,u+=4,m=1}else{(!+o||!+o.slice(1)&&o.charAt(0)=="5")&&($(l,l.e+g+2,1),r=!l.times(l).eq(p));break}}return $(l,l.e+g+1,f,r)},i.toExponential=function(r,o){return r!=null&&(N(r,0,F),r++),Tt(this,r,o,1)},i.toFixed=function(r,o){return r!=null&&(N(r,0,F),r=r+this.e+1),Tt(this,r,o)},i.toFormat=function(r,o,l){var m,h=this;if(l==null)r!=null&&o&&typeof o=="object"?(l=o,o=null):r&&typeof r=="object"?(l=r,r=o=null):l=j;else if(typeof l!="object")throw Error(H+"Argument not an object: "+l);if(m=h.toFixed(r,o),h.c){var p,y=m.split("."),u=+l.groupSize,c=+l.secondaryGroupSize,x=l.groupSeparator||"",d=y[0],v=y[1],L=h.s<0,T=L?d.slice(1):d,P=T.length;if(c&&(p=u,u=c,c=p,P-=p),u>0&&P>0){for(p=P%u||u,d=T.substr(0,p);p<P;p+=u)d+=x+T.substr(p,u);c>0&&(d+=x+T.slice(p)),L&&(d="-"+d)}m=v?d+(l.decimalSeparator||"")+((c=+l.fractionGroupSize)?v.replace(new RegExp("\\d{"+c+"}\\B","g"),"$&"+(l.fractionGroupSeparator||"")):v):d}return(l.prefix||"")+m+(l.suffix||"")},i.toFraction=function(r){var o,l,m,h,p,y,u,c,x,d,v,L,T=this,P=T.c;if(r!=null&&(u=new S(r),!u.isInteger()&&(u.c||u.s!==1)||u.lt(a)))throw Error(H+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+et(u));if(!P)return new S(T);for(o=new S(a),x=l=new S(a),m=c=new S(a),L=Z(P),p=o.e=L.length-T.e-1,o.c[0]=At[(y=p%M)<0?M+y:y],r=!r||u.comparedTo(o)>0?p>0?o:x:u,y=b,b=1/0,u=new S(L),c.c[0]=0;d=t(u,o,0,1),h=l.plus(d.times(m)),h.comparedTo(r)!=1;)l=m,m=h,x=c.plus(d.times(h=x)),c=h,o=u.minus(d.times(h=o)),u=h;return h=t(r.minus(l),m,0,1),c=c.plus(h.times(x)),l=l.plus(h.times(m)),c.s=x.s=T.s,p=p*2,v=t(x,m,p,f).minus(T).abs().comparedTo(t(c,l,p,f).minus(T).abs())<1?[x,m]:[c,l],b=y,v},i.toNumber=function(){return+et(this)},i.toPrecision=function(r,o){return r!=null&&N(r,1,F),Tt(this,r,o,2)},i.toString=function(r){var o,l=this,m=l.s,h=l.e;return h===null?m?(o="Infinity",m<0&&(o="-"+o)):o="NaN":(r==null?o=h<=E||h>=w?wt(Z(l.c),h):it(Z(l.c),h,"0"):r===10&&Lt?(l=$(new S(l),g+h+1,f),o=it(Z(l.c),l.e,"0")):(N(r,2,k.length,"Base"),o=e(it(Z(l.c),h,"0"),10,r,m,!0)),m<0&&l.c[0]&&(o="-"+o)),o},i.valueOf=i.toJSON=function(){return et(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,n!=null&&S.set(n),S}function K(n){var t=n|0;return n>0||n===t?t:t-1}function Z(n){for(var t,e,s=1,i=n.length,a=n[0]+"";s<i;){for(t=n[s++]+"",e=M-t.length;e--;t="0"+t);a+=t}for(i=a.length;a.charCodeAt(--i)===48;);return a.slice(0,i+1||1)}function ot(n,t){var e,s,i=n.c,a=t.c,g=n.s,f=t.s,E=n.e,w=t.e;if(!g||!f)return null;if(e=i&&!i[0],s=a&&!a[0],e||s)return e?s?0:-f:g;if(g!=f)return g;if(e=g<0,s=E==w,!i||!a)return s?0:!i^e?1:-1;if(!s)return E>w^e?1:-1;for(f=(E=i.length)<(w=a.length)?E:w,g=0;g<f;g++)if(i[g]!=a[g])return i[g]>a[g]^e?1:-1;return E==w?0:E>w^e?1:-1}function N(n,t,e,s){if(n<t||n>e||n!==Y(n))throw Error(H+(s||"Argument")+(typeof n=="number"?n<t||n>e?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function yt(n){var t=n.c.length-1;return K(n.e/M)==t&&n.c[t]%2!=0}function wt(n,t){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(t<0?"e":"e+")+t}function it(n,t,e){var s,i;if(t<0){for(i=e+".";++t;i+=e);n=i+n}else if(s=n.length,++t>s){for(i=e,t-=s;--t;i+=e);n+=i}else t<s&&(n=n.slice(0,t)+"."+n.slice(t));return n}var tt=fe(),hn=class{key;left=null;right=null;constructor(n){this.key=n}},ft=class extends hn{constructor(n){super(n)}},fn=class{size=0;modificationCount=0;splayCount=0;splay(n){const t=this.root;if(t==null)return this.compare(n,n),-1;let e=null,s=null,i=null,a=null,g=t;const f=this.compare;let E;for(;;)if(E=f(g.key,n),E>0){let w=g.left;if(w==null||(E=f(w.key,n),E>0&&(g.left=w.right,w.right=g,g=w,w=g.left,w==null)))break;e==null?s=g:e.left=g,e=g,g=w}else if(E<0){let w=g.right;if(w==null||(E=f(w.key,n),E<0&&(g.right=w.left,w.left=g,g=w,w=g.right,w==null)))break;i==null?a=g:i.right=g,i=g,g=w}else break;return i!=null&&(i.right=g.left,g.left=a),e!=null&&(e.left=g.right,g.right=s),this.root!==g&&(this.root=g,this.splayCount++),E}splayMin(n){let t=n,e=t.left;for(;e!=null;){const s=e;t.left=s.right,s.right=t,t=s,e=t.left}return t}splayMax(n){let t=n,e=t.right;for(;e!=null;){const s=e;t.right=s.left,s.left=t,t=s,e=t.right}return t}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let e=this.root;const s=e,i=e.left;if(this.size--,i==null)this.root=e.right;else{const a=e.right;e=this.splayMax(i),e.right=a,this.root=e}return this.modificationCount++,s}addNewRoot(n,t){this.size++,this.modificationCount++;const e=this.root;if(e==null){this.root=n;return}t<0?(n.left=e,n.right=e.right,e.right=null):(n.right=e,n.left=e.left,e.left=null),this.root=n}_first(){const n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){const n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,t)=>n<t?-1:n>t?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}},St=class pt extends fn{root=null;compare;validKey;constructor(t,e){super(),this.compare=t??this.defaultCompare(),this.validKey=e??(s=>s!=null&&s!=null)}delete(t){return this.validKey(t)?this._delete(t)!=null:!1}deleteAll(t){for(const e of t)this.delete(e)}forEach(t){const e=this[Symbol.iterator]();let s;for(;s=e.next(),!s.done;)t(s.value,s.value,this)}add(t){const e=this.splay(t);return e!=0&&this.addNewRoot(new ft(t),e),this}addAndReturn(t){const e=this.splay(t);return e!=0&&this.addNewRoot(new ft(t),e),this.root.key}addAll(t){for(const e of t)this.add(e)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(t){if(t==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(t)<0)return this.root.key;let s=this.root.left;if(s==null)return null;let i=s.right;for(;i!=null;)s=i,i=s.right;return s.key}firstAfter(t){if(t==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(t)>0)return this.root.key;let s=this.root.right;if(s==null)return null;let i=s.left;for(;i!=null;)s=i,i=s.left;return s.key}retainAll(t){const e=new pt(this.compare,this.validKey),s=this.modificationCount;for(const i of t){if(s!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(i)&&this.splay(i)==0&&e.add(this.root.key)}e.size!=this.size&&(this.root=e.root,this.size=e.size,this.modificationCount++)}lookup(t){return!this.validKey(t)||this.splay(t)!=0?null:this.root.key}intersection(t){const e=new pt(this.compare,this.validKey);for(const s of this)t.has(s)&&e.add(s);return e}difference(t){const e=new pt(this.compare,this.validKey);for(const s of this)t.has(s)||e.add(s);return e}union(t){const e=this.clone();return e.addAll(t),e}clone(){const t=new pt(this.compare,this.validKey);return t.size=this.size,t.root=this.copyNode(this.root),t}copyNode(t){if(t==null)return null;function e(i,a){let g,f;do{if(g=i.left,f=i.right,g!=null){const E=new ft(g.key);a.left=E,e(g,E)}if(f!=null){const E=new ft(f.key);a.right=E,i=f,a=E}}while(f!=null)}const s=new ft(t.key);return e(t,s),s}toSet(){return this.clone()}entries(){return new pn(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new cn(this.wrap())}[Symbol.toStringTag]="[object Set]"},ce=class{tree;path=new Array;modificationCount=null;splayCount;constructor(n){this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let e=this.tree.getRoot();for(;e!=null;)this.path.push(e),e=e.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],t=n.right;if(t!=null){for(;t!=null;)this.path.push(t),t=t.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},cn=class extends ce{getValue(n){return n.key}},pn=class extends ce{getValue(n){return[n.key,n.key]}},pe=n=>()=>n,Gt=n=>{const t=n?(e,s)=>s.minus(e).abs().isLessThanOrEqualTo(n):pe(!1);return(e,s)=>t(e,s)?0:e.comparedTo(s)};function gn(n){const t=n?(e,s,i,a,g)=>e.exponentiatedBy(2).isLessThanOrEqualTo(a.minus(s).exponentiatedBy(2).plus(g.minus(i).exponentiatedBy(2)).times(n)):pe(!1);return(e,s,i)=>{const a=e.x,g=e.y,f=i.x,E=i.y,w=g.minus(E).times(s.x.minus(f)).minus(a.minus(f).times(s.y.minus(E)));return t(w,a,g,f,E)?0:w.comparedTo(0)}}var dn=n=>n,mn=n=>{if(n){const t=new St(Gt(n)),e=new St(Gt(n)),s=(a,g)=>g.addAndReturn(a),i=a=>({x:s(a.x,t),y:s(a.y,e)});return i({x:new tt(0),y:new tt(0)}),i}return dn},kt=n=>({set:t=>{rt=kt(t)},reset:()=>kt(n),compare:Gt(n),snap:mn(n),orient:gn(n)}),rt=kt(),ct=(n,t)=>n.ll.x.isLessThanOrEqualTo(t.x)&&t.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(t.y)&&t.y.isLessThanOrEqualTo(n.ur.y),qt=(n,t)=>{if(t.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(t.ll.x)||t.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(t.ll.y))return null;const e=n.ll.x.isLessThan(t.ll.x)?t.ll.x:n.ll.x,s=n.ur.x.isLessThan(t.ur.x)?n.ur.x:t.ur.x,i=n.ll.y.isLessThan(t.ll.y)?t.ll.y:n.ll.y,a=n.ur.y.isLessThan(t.ur.y)?n.ur.y:t.ur.y;return{ll:{x:e,y:i},ur:{x:s,y:a}}},Et=(n,t)=>n.x.times(t.y).minus(n.y.times(t.x)),ge=(n,t)=>n.x.times(t.x).plus(n.y.times(t.y)),bt=n=>ge(n,n).sqrt(),xn=(n,t,e)=>{const s={x:t.x.minus(n.x),y:t.y.minus(n.y)},i={x:e.x.minus(n.x),y:e.y.minus(n.y)};return Et(i,s).div(bt(i)).div(bt(s))},yn=(n,t,e)=>{const s={x:t.x.minus(n.x),y:t.y.minus(n.y)},i={x:e.x.minus(n.x),y:e.y.minus(n.y)};return ge(i,s).div(bt(i)).div(bt(s))},ee=(n,t,e)=>t.y.isZero()?null:{x:n.x.plus(t.x.div(t.y).times(e.minus(n.y))),y:e},ne=(n,t,e)=>t.x.isZero()?null:{x:e,y:n.y.plus(t.y.div(t.x).times(e.minus(n.x)))},wn=(n,t,e,s)=>{if(t.x.isZero())return ne(e,s,n.x);if(s.x.isZero())return ne(n,t,e.x);if(t.y.isZero())return ee(e,s,n.y);if(s.y.isZero())return ee(n,t,e.y);const i=Et(t,s);if(i.isZero())return null;const a={x:e.x.minus(n.x),y:e.y.minus(n.y)},g=Et(a,t).div(i),f=Et(a,s).div(i),E=n.x.plus(f.times(t.x)),w=e.x.plus(g.times(s.x)),_=n.y.plus(f.times(t.y)),b=e.y.plus(g.times(s.y)),O=E.plus(w).div(2),I=_.plus(b).div(2);return{x:O,y:I}},Q=class de{point;isLeft;segment;otherSE;consumedBy;static compare(t,e){const s=de.comparePoints(t.point,e.point);return s!==0?s:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:_t.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x.isLessThan(e.x)?-1:t.x.isGreaterThan(e.x)?1:t.y.isLessThan(e.y)?-1:t.y.isGreaterThan(e.y)?1:0}constructor(t,e){t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let s=0,i=e.length;s<i;s++){const a=e[s];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const s=this.point.events[e];if(s.segment.consumedBy===void 0)for(let i=e+1;i<t;i++){const a=this.point.events[i];a.consumedBy===void 0&&s.otherSE.point.events===a.otherSE.point.events&&s.segment.consume(a.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,s=this.point.events.length;e<s;e++){const i=this.point.events[e];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}getLeftmostComparator(t){const e=new Map,s=i=>{const a=i.otherSE;e.set(i,{sine:xn(this.point,t.point,a.point),cosine:yn(this.point,t.point,a.point)})};return(i,a)=>{e.has(i)||s(i),e.has(a)||s(a);const{sine:g,cosine:f}=e.get(i),{sine:E,cosine:w}=e.get(a);return g.isGreaterThanOrEqualTo(0)&&E.isGreaterThanOrEqualTo(0)?f.isLessThan(w)?1:f.isGreaterThan(w)?-1:0:g.isLessThan(0)&&E.isLessThan(0)?f.isLessThan(w)?-1:f.isGreaterThan(w)?1:0:E.isLessThan(g)?-1:E.isGreaterThan(g)?1:0}}},En=class Dt{events;poly;_isExteriorRing;_enclosingRing;static factory(t){const e=[];for(let s=0,i=t.length;s<i;s++){const a=t[s];if(!a.isInResult()||a.ringOut)continue;let g=null,f=a.leftSE,E=a.rightSE;const w=[f],_=f.point,b=[];for(;g=f,f=E,w.push(f),f.point!==_;)for(;;){const O=f.getAvailableLinkedEvents();if(O.length===0){const j=w[0].point,k=w[w.length-1].point;throw new Error(`Unable to complete output ring starting at [${j.x}, ${j.y}]. Last matching segment found ends at [${k.x}, ${k.y}].`)}if(O.length===1){E=O[0].otherSE;break}let I=null;for(let j=0,k=b.length;j<k;j++)if(b[j].point===f.point){I=j;break}if(I!==null){const j=b.splice(I)[0],k=w.splice(j.index);k.unshift(k[0].otherSE),e.push(new Dt(k.reverse()));continue}b.push({index:w.length,point:f.point});const D=f.getLeftmostComparator(g);E=O.sort(D)[0].otherSE;break}e.push(new Dt(w))}return e}constructor(t){this.events=t;for(let e=0,s=t.length;e<s;e++)t[e].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const e=[t];for(let w=1,_=this.events.length-1;w<_;w++){const b=this.events[w].point,O=this.events[w+1].point;rt.orient(b,t,O)!==0&&(e.push(b),t=b)}if(e.length===1)return null;const s=e[0],i=e[1];rt.orient(s,t,i)===0&&e.shift(),e.push(e[0]);const a=this.isExteriorRing()?1:-1,g=this.isExteriorRing()?0:e.length-1,f=this.isExteriorRing()?e.length:-1,E=[];for(let w=g;w!=f;w+=a)E.push([e[w].x.toNumber(),e[w].y.toNumber()]);return E}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let i=1,a=this.events.length;i<a;i++){const g=this.events[i];Q.compare(t,g)>0&&(t=g)}let e=t.segment.prevInResult(),s=e?e.prevInResult():null;for(;;){if(!e)return null;if(!s)return e.ringOut;if(s.ringOut!==e.ringOut)return s.ringOut?.enclosingRing()!==e.ringOut?e.ringOut:e.ringOut?.enclosingRing();e=s.prevInResult(),s=e?e.prevInResult():null}}},ie=class{exteriorRing;interiorRings;constructor(n){this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){const n=this.exteriorRing.getGeom();if(n===null)return null;const t=[n];for(let e=0,s=this.interiorRings.length;e<s;e++){const i=this.interiorRings[e].getGeom();i!==null&&t.push(i)}return t}},vn=class{rings;polys;constructor(n){this.rings=n,this.polys=this._composePolys(n)}getGeom(){const n=[];for(let t=0,e=this.polys.length;t<e;t++){const s=this.polys[t].getGeom();s!==null&&n.push(s)}return n}_composePolys(n){const t=[];for(let e=0,s=n.length;e<s;e++){const i=n[e];if(!i.poly)if(i.isExteriorRing())t.push(new ie(i));else{const a=i.enclosingRing();a?.poly||t.push(new ie(a)),a?.poly?.addInterior(i)}}return t}},Sn=class{queue;tree;segments;constructor(n,t=_t.compare){this.queue=n,this.tree=new St(t),this.segments=[]}process(n){const t=n.segment,e=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(t),e;n.isLeft&&this.tree.add(t);let s=t,i=t;do s=this.tree.lastBefore(s);while(s!=null&&s.consumedBy!=null);do i=this.tree.firstAfter(i);while(i!=null&&i.consumedBy!=null);if(n.isLeft){let a=null;if(s){const f=s.getIntersection(t);if(f!==null&&(t.isAnEndpoint(f)||(a=f),!s.isAnEndpoint(f))){const E=this._splitSafely(s,f);for(let w=0,_=E.length;w<_;w++)e.push(E[w])}}let g=null;if(i){const f=i.getIntersection(t);if(f!==null&&(t.isAnEndpoint(f)||(g=f),!i.isAnEndpoint(f))){const E=this._splitSafely(i,f);for(let w=0,_=E.length;w<_;w++)e.push(E[w])}}if(a!==null||g!==null){let f=null;a===null?f=g:g===null?f=a:f=Q.comparePoints(a,g)<=0?a:g,this.queue.delete(t.rightSE),e.push(t.rightSE);const E=t.split(f);for(let w=0,_=E.length;w<_;w++)e.push(E[w])}e.length>0?(this.tree.delete(t),e.push(n)):(this.segments.push(t),t.prev=s)}else{if(s&&i){const a=s.getIntersection(i);if(a!==null){if(!s.isAnEndpoint(a)){const g=this._splitSafely(s,a);for(let f=0,E=g.length;f<E;f++)e.push(g[f])}if(!i.isAnEndpoint(a)){const g=this._splitSafely(i,a);for(let f=0,E=g.length;f<E;f++)e.push(g[f])}}}this.tree.delete(t)}return e}_splitSafely(n,t){this.tree.delete(n);const e=n.rightSE;this.queue.delete(e);const s=n.split(t);return s.push(e),n.consumedBy===void 0&&this.tree.add(n),s}},bn=class{type;numMultiPolys;run(n,t,e){gt.type=n;const s=[new se(t,!0)];for(let w=0,_=e.length;w<_;w++)s.push(new se(e[w],!1));if(gt.numMultiPolys=s.length,gt.type==="difference"){const w=s[0];let _=1;for(;_<s.length;)qt(s[_].bbox,w.bbox)!==null?_++:s.splice(_,1)}if(gt.type==="intersection")for(let w=0,_=s.length;w<_;w++){const b=s[w];for(let O=w+1,I=s.length;O<I;O++)if(qt(b.bbox,s[O].bbox)===null)return[]}const i=new St(Q.compare);for(let w=0,_=s.length;w<_;w++){const b=s[w].getSweepEvents();for(let O=0,I=b.length;O<I;O++)i.add(b[O])}const a=new Sn(i);let g=null;for(i.size!=0&&(g=i.first(),i.delete(g));g;){const w=a.process(g);for(let _=0,b=w.length;_<b;_++){const O=w[_];O.consumedBy===void 0&&i.add(O)}i.size!=0?(g=i.first(),i.delete(g)):g=null}rt.reset();const f=En.factory(a.segments);return new vn(f).getGeom()}},gt=new bn,ut=gt,_n=0,_t=class vt{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(t,e){const s=t.leftSE.point.x,i=e.leftSE.point.x,a=t.rightSE.point.x,g=e.rightSE.point.x;if(g.isLessThan(s))return 1;if(a.isLessThan(i))return-1;const f=t.leftSE.point.y,E=e.leftSE.point.y,w=t.rightSE.point.y,_=e.rightSE.point.y;if(s.isLessThan(i)){if(E.isLessThan(f)&&E.isLessThan(w))return 1;if(E.isGreaterThan(f)&&E.isGreaterThan(w))return-1;const b=t.comparePoint(e.leftSE.point);if(b<0)return 1;if(b>0)return-1;const O=e.comparePoint(t.rightSE.point);return O!==0?O:-1}if(s.isGreaterThan(i)){if(f.isLessThan(E)&&f.isLessThan(_))return-1;if(f.isGreaterThan(E)&&f.isGreaterThan(_))return 1;const b=e.comparePoint(t.leftSE.point);if(b!==0)return b;const O=t.comparePoint(e.rightSE.point);return O<0?1:O>0?-1:1}if(f.isLessThan(E))return-1;if(f.isGreaterThan(E))return 1;if(a.isLessThan(g)){const b=e.comparePoint(t.rightSE.point);if(b!==0)return b}if(a.isGreaterThan(g)){const b=t.comparePoint(e.rightSE.point);if(b<0)return 1;if(b>0)return-1}if(!a.eq(g)){const b=w.minus(f),O=a.minus(s),I=_.minus(E),D=g.minus(i);if(b.isGreaterThan(O)&&I.isLessThan(D))return 1;if(b.isLessThan(O)&&I.isGreaterThan(D))return-1}return a.isGreaterThan(g)?1:a.isLessThan(g)||w.isLessThan(_)?-1:w.isGreaterThan(_)?1:t.id<e.id?-1:t.id>e.id?1:0}constructor(t,e,s,i){this.id=++_n,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=s,this.windings=i}static fromRing(t,e,s){let i,a,g;const f=Q.comparePoints(t,e);if(f<0)i=t,a=e,g=1;else if(f>0)i=e,a=t,g=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const E=new Q(i,!0),w=new Q(a,!1);return new vt(E,w,[s],[g])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t.isLessThan(e)?t:e},ur:{x:this.rightSE.point.x,y:t.isGreaterThan(e)?t:e}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(t){return t.x.eq(this.leftSE.point.x)&&t.y.eq(this.leftSE.point.y)||t.x.eq(this.rightSE.point.x)&&t.y.eq(this.rightSE.point.y)}comparePoint(t){return rt.orient(this.leftSE.point,t,this.rightSE.point)}getIntersection(t){const e=this.bbox(),s=t.bbox(),i=qt(e,s);if(i===null)return null;const a=this.leftSE.point,g=this.rightSE.point,f=t.leftSE.point,E=t.rightSE.point,w=ct(e,f)&&this.comparePoint(f)===0,_=ct(s,a)&&t.comparePoint(a)===0,b=ct(e,E)&&this.comparePoint(E)===0,O=ct(s,g)&&t.comparePoint(g)===0;if(_&&w)return O&&!b?g:!O&&b?E:null;if(_)return b&&a.x.eq(E.x)&&a.y.eq(E.y)?null:a;if(w)return O&&g.x.eq(f.x)&&g.y.eq(f.y)?null:f;if(O&&b)return null;if(O)return g;if(b)return E;const I=wn(a,this.vector(),f,t.vector());return I===null||!ct(i,I)?null:rt.snap(I)}split(t){const e=[],s=t.events!==void 0,i=new Q(t,!0),a=new Q(t,!1),g=this.rightSE;this.replaceRightSE(a),e.push(a),e.push(i);const f=new vt(i,g,this.rings.slice(),this.windings.slice());return Q.comparePoints(f.leftSE.point,f.rightSE.point)>0&&f.swapEvents(),Q.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),s&&(i.checkForConsuming(),a.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,s=this.windings.length;e<s;e++)this.windings[e]*=-1}consume(t){let e=this,s=t;for(;e.consumedBy;)e=e.consumedBy;for(;s.consumedBy;)s=s.consumedBy;const i=vt.compare(e,s);if(i!==0){if(i>0){const a=e;e=s,s=a}if(e.prev===s){const a=e;e=s,s=a}for(let a=0,g=s.rings.length;a<g;a++){const f=s.rings[a],E=s.windings[a],w=e.rings.indexOf(f);w===-1?(e.rings.push(f),e.windings.push(E)):e.windings[w]+=E}s.rings=null,s.windings=null,s.consumedBy=e,s.leftSE.consumedBy=e.leftSE,s.rightSE.consumedBy=e.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,s=this._afterState.windings,i=this._afterState.multiPolys;for(let f=0,E=this.rings.length;f<E;f++){const w=this.rings[f],_=this.windings[f],b=e.indexOf(w);b===-1?(e.push(w),s.push(_)):s[b]+=_}const a=[],g=[];for(let f=0,E=e.length;f<E;f++){if(s[f]===0)continue;const w=e[f],_=w.poly;if(g.indexOf(_)===-1)if(w.isExterior)a.push(_);else{g.indexOf(_)===-1&&g.push(_);const b=a.indexOf(w.poly);b!==-1&&a.splice(b,1)}}for(let f=0,E=a.length;f<E;f++){const w=a[f].multiPoly;i.indexOf(w)===-1&&i.push(w)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(ut.type){case"union":{const s=t.length===0,i=e.length===0;this._isInResult=s!==i;break}case"intersection":{let s,i;t.length<e.length?(s=t.length,i=e.length):(s=e.length,i=t.length),this._isInResult=i===ut.numMultiPolys&&s<i;break}case"xor":{const s=Math.abs(t.length-e.length);this._isInResult=s%2===1;break}case"difference":{const s=i=>i.length===1&&i[0].isSubject;this._isInResult=s(t)!==s(e);break}}return this._isInResult}},re=class{poly;isExterior;segments;bbox;constructor(n,t,e){if(!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=e,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const s=rt.snap({x:new tt(n[0][0]),y:new tt(n[0][1])});this.bbox={ll:{x:s.x,y:s.y},ur:{x:s.x,y:s.y}};let i=s;for(let a=1,g=n.length;a<g;a++){if(typeof n[a][0]!="number"||typeof n[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const f=rt.snap({x:new tt(n[a][0]),y:new tt(n[a][1])});f.x.eq(i.x)&&f.y.eq(i.y)||(this.segments.push(_t.fromRing(i,f,this)),f.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=f.x),f.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=f.y),f.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=f.x),f.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=f.y),i=f)}(!s.x.eq(i.x)||!s.y.eq(i.y))&&this.segments.push(_t.fromRing(i,s,this))}getSweepEvents(){const n=[];for(let t=0,e=this.segments.length;t<e;t++){const s=this.segments[t];n.push(s.leftSE),n.push(s.rightSE)}return n}},Ln=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(n,t){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new re(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let e=1,s=n.length;e<s;e++){const i=new re(n[e],this,!1);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=t}getSweepEvents(){const n=this.exteriorRing.getSweepEvents();for(let t=0,e=this.interiorRings.length;t<e;t++){const s=this.interiorRings[t].getSweepEvents();for(let i=0,a=s.length;i<a;i++)n.push(s[i])}return n}},se=class{isSubject;polys;bbox;constructor(n,t){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new tt(Number.POSITIVE_INFINITY),y:new tt(Number.POSITIVE_INFINITY)},ur:{x:new tt(Number.NEGATIVE_INFINITY),y:new tt(Number.NEGATIVE_INFINITY)}};for(let e=0,s=n.length;e<s;e++){const i=new Ln(n[e],this);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=t}getSweepEvents(){const n=[];for(let t=0,e=this.polys.length;t<e;t++){const s=this.polys[t].getSweepEvents();for(let i=0,a=s.length;i<a;i++)n.push(s[i])}return n}},dt=(n,...t)=>ut.run("union",n,t),Tn=(n,...t)=>ut.run("intersection",n,t),On=(n,...t)=>ut.run("xor",n,t),Mn=(n,...t)=>ut.run("difference",n,t),In=rt.set;const Rn=Object.freeze(Object.defineProperty({__proto__:null,difference:Mn,intersection:Tn,setPrecision:In,union:dt,xor:On},Symbol.toStringTag,{value:"Module"}));function Pn(n){if(!n)throw new Error("geojson is required");switch(n.type){case"Feature":return me(n);case"FeatureCollection":return Cn(n);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return jt(n);default:throw new Error("unknown GeoJSON type")}}function me(n){const t={type:"Feature"};return Object.keys(n).forEach(e=>{switch(e){case"type":case"properties":case"geometry":return;default:t[e]=n[e]}}),t.properties=xe(n.properties),n.geometry==null?t.geometry=null:t.geometry=jt(n.geometry),t}function xe(n){const t={};return n&&Object.keys(n).forEach(e=>{const s=n[e];typeof s=="object"?s===null?t[e]=null:Array.isArray(s)?t[e]=s.map(i=>i):t[e]=xe(s):t[e]=s}),t}function Cn(n){const t={type:"FeatureCollection"};return Object.keys(n).forEach(e=>{switch(e){case"type":case"features":return;default:t[e]=n[e]}}),t.features=n.features.map(e=>me(e)),t}function jt(n){const t={type:n.type};return n.bbox&&(t.bbox=n.bbox),n.type==="GeometryCollection"?(t.geometries=n.geometries.map(e=>jt(e)),t):(t.coordinates=ye(n.coordinates),t)}function ye(n){const t=n;return typeof t[0]!="object"?t.slice():t.map(e=>ye(e))}function Nn(n,t,e){var s;const i=(s=e?.mutate)!=null?s:!1;let a=t;t&&i===!1&&(a=Pn(t));const g=Bn(a);let f=null;return n.type==="FeatureCollection"?f=An(n):n.type==="Feature"?f=Ut(dt(n.geometry.coordinates)):f=Ut(dt(n.coordinates)),f.geometry.coordinates.forEach(function(E){g.geometry.coordinates.push(E[0])}),g}function An(n){const t=n.features.length===2?dt(n.features[0].geometry.coordinates,n.features[1].geometry.coordinates):dt.apply(Rn,n.features.map(function(e){return e.geometry.coordinates}));return Ut(t)}function Ut(n){return an(n)}function Bn(n){let e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]];return n&&(n.type==="Feature"?e=n.geometry.coordinates:e=n.coordinates),ln(e)}var Vn=Nn;function lt(){return{westLon:null,southLat:null,eastLon:null,northLat:null}}const Fn={name:"MapSelect",components:{LayerControl:Fe,TextControl:Ve,UserLocationControl:We},mixins:[Be],props:{stac:{type:Object,default:null},modelValue:{type:Array,default:null}},emits:["update:modelValue"],data(){return{crs:"EPSG:4326",extent:this.modelValue,dragging:!1,validationErrors:lt(),bboxValues:lt()}},computed:{...ve(["uiLanguage"]),projectedExtent(){return this.extent?this.stacToOlExtent(this.extent):null},help(){return this.extent?this.$t("mapping.bboxSelect.remove"):this.$t("mapping.bboxSelect.add")}},watch:{async stac(){await this.initMap()}},async mounted(){await this.initMap(),this.updateBboxValues()},methods:{async initMap(){this.map=null,await this.createMap(this.$refs.map,this.stac,!0);const n=e=>{if(e.type==="singleclick")if(this.extent)Ue(this.projectedExtent,...e.coordinate)&&(this.interaction.setExtent(null),this.interaction.vertexOverlay_.getSource().clear(),this.interaction.vertexFeature_=null);else{let s=this.map.getSize().map(f=>f*.2),i=this.map.getView().calculateExtent(s),a=[i[2]-i[0],i[3]-i[1]],g=[e.coordinate[0]-a[0],e.coordinate[1]-a[1],e.coordinate[0]+a[0],e.coordinate[1]+a[1]];return this.interaction.setExtent(g),!1}else if(this.interaction.handlingDownUpSequence||this.interaction.snapToVertex_(e.pixel,e.map))return!0;return ze(e)};this.interaction=new en({extent:this.projectedExtent,condition:n,boxStyle:De()}),this.interaction.on("extentchanged",this.update),this.map.addInteraction(this.interaction),this.stac&&this.addMask(this.stac);let t;this.projectedExtent?t=this.projectedExtent:this.stac&&(t=this.stacToOlExtent(this.stac.getBoundingBox())),t&&this.map.getView().fit(t,{padding:[50,50,50,50],maxZoom:this.maxZoom})},addMask(n){if(!n||typeof n.toGeoJSON!="function")return;const t=n.toGeoJSON();if(!t)return;const e=He([-180,-90,180,90]),s=Vn(t,e),i=new Ge().readFeatures(s,{featureProjection:this.map.getView().getProjection()}),a=new Bt({source:new Vt({features:i}),style:new ke({fill:new qe({color:"rgba(0, 0, 0, 0.5)"})})});this.map.addLayer(a)},fixX(n){for(;n>180;)n-=360;for(;n<-180;)n+=360;return n},fixY(n){return Math.max(-90,Math.min(90,n))},update(n){if(n.extent){this.extent=Jt(n.extent,this.map.getView().getProjection(),this.crs);const t=[this.fixX(this.extent[0]),this.fixY(this.extent[1]),this.fixX(this.extent[2]),this.fixY(this.extent[3])];this.updateBboxValues(),this.$emit("update:modelValue",t)}else this.extent=null,this.clearBboxValues(),this.$emit("update:modelValue",null);this.validationErrors=lt()},updateBboxValues(){this.extent&&Array.isArray(this.extent)&&this.extent.length===4&&(this.bboxValues={westLon:Math.round(this.fixX(this.extent[0])*1e5)/1e5,southLat:Math.round(this.fixY(this.extent[1])*1e5)/1e5,eastLon:Math.round(this.fixX(this.extent[2])*1e5)/1e5,northLat:Math.round(this.fixY(this.extent[3])*1e5)/1e5})},clearBboxValues(){this.bboxValues=lt()},validateBbox(){const{westLon:n,southLat:t,eastLon:e,northLat:s}=this.bboxValues,i=lt(),a=this.$t("mapping.bboxSelect.error.incomplete");if(n===""&&(i.westLon=a),t===""&&(i.southLat=a),e===""&&(i.eastLon=a),s===""&&(i.northLat=a),Object.values(this.bboxValues).some(g=>g===""||g===null))return this.validationErrors=i,!1;if((n<-180||n>180)&&(i.westLon=this.$t("mapping.bboxSelect.error.invalidLon")),(e<-180||e>180)&&(i.eastLon=this.$t("mapping.bboxSelect.error.invalidLon")),!i.westLon&&!i.eastLon){const g=n>0&&e<0;n>=e&&!g&&(i.westLon=this.$t("mapping.bboxSelect.error.lonOrder"))}return(t<-90||t>90)&&(i.southLat=this.$t("mapping.bboxSelect.error.invalidLat")),(s<-90||s>90)&&(i.northLat=this.$t("mapping.bboxSelect.error.invalidLat")),t>=s&&(i.southLat=this.$t("mapping.bboxSelect.error.latOrder")),this.validationErrors=i,Object.values(i).every(g=>!g)},applyManualBbox(){if(!this.validateBbox()||(this.validationErrors=lt(),!this.map||!this.interaction))return;const t=[this.bboxValues.westLon,this.bboxValues.southLat,this.bboxValues.eastLon,this.bboxValues.northLat];this.extent=t,this.$emit("update:modelValue",t);const e=this.stacToOlExtent(t);this.map.getView().fit(e,{padding:[50,50,50,50],maxZoom:this.maxZoom}),this.interaction.setExtent(e)},stacToOlExtent(n){if(!Array.isArray(n)||n.length!==4)return null;const t=[...n];return t[0]>t[2]&&(t[2]+=360),Jt(t,this.crs,this.map.getView().getProjection())}}},Gn={class:"map-container"},kn={ref:"map",class:"map"},qn={class:"bbox-controls"};function Dn(n,t,e,s,i,a){const g=Rt("TextControl"),f=Rt("UserLocationControl"),E=Rt("LayerControl"),w=_e,_=Se,b=be,O=we;return zt(),Ht("div",Gn,[at("div",kn,[G(g,{text:a.help,map:n.map},null,8,["text","map"]),t[4]||(t[4]=z()),G(f,{map:n.map,maxZoom:n.maxZoom},null,8,["map","maxZoom"]),t[5]||(t[5]=z()),G(E,{map:n.map,maxZoom:n.maxZoom},null,8,["map","maxZoom"])],512),t[13]||(t[13]=z()),at("div",qn,[G(O,{class:"compass-grid",onChange:a.applyManualBbox,onSubmit:le(a.applyManualBbox,["prevent"])},{default:nt(()=>[G(_,{label:n.$t("mapping.bboxSelect.northLat"),"label-for":"northLat",class:"compass-input compass-top",state:i.validationErrors.northLat?!1:null},{default:nt(()=>[G(w,{id:"northLat",modelValue:i.bboxValues.northLat,"onUpdate:modelValue":t[0]||(t[0]=I=>i.bboxValues.northLat=I),modelModifiers:{number:!0},lazy:"",type:"number",step:"any",min:"-90",max:"90"},null,8,["modelValue"])]),_:1},8,["label","state"]),t[6]||(t[6]=z()),G(b,{state:i.validationErrors.northLat?!1:null,class:"validation error-top text-danger"},{default:nt(()=>[z(xt(i.validationErrors.northLat),1)]),_:1},8,["state"]),t[7]||(t[7]=z()),G(_,{label:n.$t("mapping.bboxSelect.westLon"),"label-for":"westLon",class:"compass-input compass-left",state:i.validationErrors.westLon?!1:null},{default:nt(()=>[G(w,{id:"westLon",modelValue:i.bboxValues.westLon,"onUpdate:modelValue":t[1]||(t[1]=I=>i.bboxValues.westLon=I),modelModifiers:{number:!0},lazy:"",type:"number",step:"any"},null,8,["modelValue"])]),_:1},8,["label","state"]),t[8]||(t[8]=z()),G(b,{state:i.validationErrors.westLon?!1:null,class:"validation error-left text-danger"},{default:nt(()=>[z(xt(i.validationErrors.westLon),1)]),_:1},8,["state"]),t[9]||(t[9]=z()),G(_,{label:n.$t("mapping.bboxSelect.eastLon"),"label-for":"eastLon",class:"compass-input compass-right",state:i.validationErrors.eastLon?!1:null},{default:nt(()=>[G(w,{id:"eastLon",modelValue:i.bboxValues.eastLon,"onUpdate:modelValue":t[2]||(t[2]=I=>i.bboxValues.eastLon=I),modelModifiers:{number:!0},lazy:"",type:"number",step:"any"},null,8,["modelValue"])]),_:1},8,["label","state"]),t[10]||(t[10]=z()),G(b,{state:i.validationErrors.eastLon?!1:null,class:"validation error-right text-danger"},{default:nt(()=>[z(xt(i.validationErrors.eastLon),1)]),_:1},8,["state"]),t[11]||(t[11]=z()),G(_,{label:n.$t("mapping.bboxSelect.southLat"),"label-for":"southLat",class:"compass-input compass-bottom",state:i.validationErrors.southLat?!1:null},{default:nt(()=>[G(w,{id:"southLat",modelValue:i.bboxValues.southLat,"onUpdate:modelValue":t[3]||(t[3]=I=>i.bboxValues.southLat=I),modelModifiers:{number:!0},lazy:"",type:"number",step:"any",min:"-90",max:"90"},null,8,["modelValue"])]),_:1},8,["label","state"]),t[12]||(t[12]=z()),G(b,{state:i.validationErrors.southLat?!1:null,class:"validation error-bottom text-danger"},{default:nt(()=>[z(xt(i.validationErrors.southLat),1)]),_:1},8,["state"])]),_:1},8,["onChange","onSubmit"])])])}const ti=oe(Fn,[["render",Dn],["__scopeId","data-v-08ebdf92"]]);export{ti as default};
//# sourceMappingURL=MapSelect-3Y0O40mI.js.map
