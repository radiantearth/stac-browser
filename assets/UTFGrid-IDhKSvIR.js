import{T as m}from"./Tile-Dd8tR1PC.js";import{f as a,bY as f,y as u,an as g,q as E,_ as T,E as x}from"./GeoJSON-BoRJWQIG.js";import{j as c}from"./net-C8OyH0QR.js";import{L as R}from"./LRUCache-Cy7VNIXe.js";import{d as L}from"./tilecoord-DBpIeO-O.js";import{T as C,e as y,c as D}from"./Tile-BqAKaOfQ.js";import{n as v,c as S}from"./tileurlfunction-naLPssJX.js";import"./index-B3F0456b.js";import"./utils-BXWzvTjY.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-DO3czC2y.js";import"./useStateClass-BGbSLWFN-eI-Q6wqs.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--5aly-L7g.js";import"./TileGrid-r8UQ2tK6.js";import"./TileRange-2Tc-Ry00.js";import"./uri-CWE-Y_zl.js";class X extends m{constructor(t,e,i,r,s,n){super(t,e),this.src_=i,this.extent_=r,this.preemptive_=s,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=n}getImage(){return null}getData(t){if(!this.grid_||!this.keys_)return null;const e=(t[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),i=(t[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),r=this.grid_[Math.floor((1-i)*this.grid_.length)];if(typeof r!="string")return null;let s=r.charCodeAt(Math.floor(e*r.length));s>=93&&s--,s>=35&&s--,s-=32;let n=null;if(s in this.keys_){const o=this.keys_[s];this.data_&&o in this.data_?n=this.data_[o]:n=o}return n}forDataAtCoordinate(t,e,i){this.state==a.EMPTY&&i===!0?(this.state=a.IDLE,f(this,x.CHANGE,r=>{e(this.getData(t))}),this.loadInternal_()):i===!0?setTimeout(()=>{e(this.getData(t))},0):e(this.getData(t))}getKey(){return this.src_}handleError_(){this.state=a.ERROR,this.changed()}handleLoad_(t){this.grid_=t.grid,this.keys_=t.keys,this.data_=t.data,this.state=a.LOADED,this.changed()}loadInternal_(){if(this.state==a.IDLE)if(this.state=a.LOADING,this.jsonp_)c(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",this.src_),t.send()}}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let i;try{i=JSON.parse(e.responseText)}catch{this.handleError_();return}this.handleLoad_(i)}else this.handleError_()}onXHRError_(t){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(a.EMPTY)}}class K extends C{constructor(t){if(super({projection:u("EPSG:3857"),state:"loading",wrapX:t.wrapX!==void 0?t.wrapX:!0,zDirection:t.zDirection}),this.preemptive_=t.preemptive!==void 0?t.preemptive:!0,this.tileUrlFunction_=v,this.template_=void 0,this.jsonp_=t.jsonp||!1,this.tileCache_=new R(512),t.url)if(this.jsonp_)c(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",t.url),e.send()}else if(t.tileJSON)this.handleTileJSONResponse(t.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let i;try{i=JSON.parse(e.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()}onXHRError_(t){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(t,e,i,r){if(this.tileGrid){const s=this.tileGrid.getZForResolution(e,this.zDirection),n=this.tileGrid.getTileCoordForCoordAndZ(t,s),o=this.getTile(n[0],n[1],n[2],1,this.getProjection());o.getState()==a.IDLE&&o.load(),o.forDataAtCoordinate(t,i,r)}else r===!0?setTimeout(function(){i(null)},0):i(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(t){const e=u("EPSG:4326"),i=this.getProjection();let r;if(t.bounds!==void 0){const d=g(e,i);r=E(t.bounds,d)}const s=y(i),n=t.minzoom||0,o=t.maxzoom||22,h=D({extent:s,maxZoom:o,minZoom:n});this.tileGrid=h,this.template_=t.template;const l=t.grids;if(!l){this.setState("error");return}if(this.tileUrlFunction_=S(l,h),t.attribution){const d=r!==void 0?r:s;this.setAttributions(function(p){return T(d,p.extent)?[t.attribution]:null})}this.setState("ready")}getTile(t,e,i,r,s){const n=[t,e,i],o=this.getTileCoordForTileUrlFunction(n,s),h=this.tileUrlFunction_(o,r,s),l=`${this.getKey()},${L(t,e,i)}`;if(this.tileCache_.containsKey(l))return this.tileCache_.get(l);this.tileCache_.expireCache();const d=new X(n,h!==void 0?a.IDLE:a.EMPTY,h!==void 0?h:"",this.tileGrid.getTileCoordExtent(n),this.preemptive_,this.jsonp_);return this.tileCache_.set(l,d),d}}export{X as CustomTile,K as default};
//# sourceMappingURL=UTFGrid-IDhKSvIR.js.map
