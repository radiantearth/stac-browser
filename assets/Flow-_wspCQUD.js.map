{"version":3,"file":"Flow-_wspCQUD.js","sources":["../../node_modules/ol/renderer/webgl/FlowLayer.js","../../node_modules/ol/layer/Flow.js"],"sourcesContent":["/**\n * @module ol/renderer/webgl/FlowLayer\n */\nimport WebGLArrayBuffer from '../../webgl/Buffer.js';\nimport {DefaultUniform} from '../../webgl/Helper.js';\nimport {ARRAY_BUFFER, STATIC_DRAW} from '../../webgl.js';\nimport WebGLTileLayerRenderer from './TileLayer.js';\n\n/**\n * @typedef {import(\"../../layer/Flow.js\").default} LayerType\n */\n\n/**\n * @typedef {Object} Options\n * @property {number} maxSpeed The maximum particle speed in the input data.\n * @property {number} [speedFactor=0.001] A larger factor increases the rate at which particles cross the screen.\n * @property {number} [particles=65536] The number of particles to render.\n * @property {number} [cacheSize=512] The texture cache size.\n * @property {string} tileVertexShader The flow tile vertex shader.\n * @property {string} tileFragmentShader The flow tile fragment shader.\n * @property {string} textureVertexShader Generic texture fragment shader.\n * @property {string} textureFragmentShader Generic texture fragment shader.\n * @property {string} particlePositionVertexShader The particle position vertex shader.\n * @property {string} particlePositionFragmentShader The particle position fragment shader.\n * @property {string} particleColorVertexShader The particle color vertex shader.\n * @property {string} particleColorFragmentShader The particle color fragment shader.\n */\n\n/**\n * Shader uniforms.\n * @enum {string}\n */\nexport const U = {\n  TEXTURE: 'u_texture',\n  VELOCITY_TEXTURE: 'u_velocityTexture',\n  POSITION_TEXTURE: 'u_positionTexture',\n  PARTICLE_COUNT_SQRT: 'u_particleCountSqrt',\n  MAX_SPEED: 'u_maxSpeed',\n  GAIN: 'u_gain',\n  OFFSET: 'u_offset',\n  IS_FLOAT: 'u_isFloat',\n  RANDOM_SEED: 'u_randomSeed',\n  SPEED_FACTOR: 'u_speedFactor',\n  DROP_RATE: 'u_dropRate',\n  DROP_RATE_BUMP: 'u_dropRateBump',\n  OPACITY: 'u_opacity',\n  ROTATION: DefaultUniform.ROTATION,\n  VIEWPORT_SIZE_PX: DefaultUniform.VIEWPORT_SIZE_PX,\n};\n\n/**\n * Shader attributes.\n * @enum {string}\n */\nexport const A = {\n  POSITION: 'a_position',\n  INDEX: 'a_index',\n};\n\n/**\n * Shader varyings.\n * @enum {string}\n */\nexport const V = {\n  POSITION: 'v_position',\n};\n\n/**\n * @classdesc\n * Experimental WebGL renderer for vector fields.\n * @extends {WebGLTileLayerRenderer<LayerType>}\n */\nclass FlowLayerRenderer extends WebGLTileLayerRenderer {\n  /**\n   * @param {LayerType} layer The tiled field layer.\n   * @param {Options} options The renderer options.\n   */\n  constructor(layer, options) {\n    super(layer, {\n      vertexShader: options.tileVertexShader,\n      fragmentShader: options.tileFragmentShader,\n      cacheSize: options.cacheSize,\n      // TODO: rework the post-processing logic\n      // see https://github.com/openlayers/openlayers/issues/16120\n      postProcesses: [{}],\n      uniforms: {\n        [U.MAX_SPEED]: options.maxSpeed,\n      },\n    });\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.particleColorFragmentShader_ = options.particleColorFragmentShader;\n\n    /**\n     * @type {WebGLTexture|null}\n     * @private\n     */\n    this.velocityTexture_ = null;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.particleCountSqrt_ = options.particles\n      ? Math.ceil(Math.sqrt(options.particles))\n      : 256;\n\n    /**\n     * @type {WebGLArrayBuffer}\n     * @private\n     */\n    this.particleIndexBuffer_;\n\n    /**\n     * @type {WebGLArrayBuffer}\n     * @private\n     */\n    this.quadBuffer_;\n\n    /**\n     * @type {WebGLProgram}\n     * @private\n     */\n    this.particlePositionProgram_;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.particlePositionVertexShader_ = options.particlePositionVertexShader;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.particlePositionFragmentShader_ =\n      options.particlePositionFragmentShader;\n\n    /**\n     * @type {WebGLTexture}\n     * @private\n     */\n    this.previousPositionTexture_;\n\n    /**\n     * @type {WebGLTexture}\n     * @private\n     */\n    this.nextPositionTexture_;\n\n    /**\n     * @type {WebGLProgram}\n     * @private\n     */\n    this.particleColorProgram_;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.particleColorVertexShader_ = options.particleColorVertexShader;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.particleColorFragmentShader_ = options.particleColorFragmentShader;\n\n    /**\n     * @type {WebGLProgram}\n     * @private\n     */\n    this.textureProgram_;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.textureVertexShader_ = options.textureVertexShader;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.textureFragmentShader_ = options.textureFragmentShader;\n\n    /**\n     * @type {WebGLTexture}\n     * @private\n     */\n    this.previousTrailsTexture_;\n\n    /**\n     * @type {WebGLTexture}\n     * @private\n     */\n    this.nextTrailsTexture_;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.fadeOpacity_ = 0.996; // how fast the particle trails fade on each frame\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.maxSpeed_ = options.maxSpeed;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.speedFactor_ = options.speedFactor || 0.001;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.dropRate_ = 0.003; // how often the particles move to a random place\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.dropRateBump_ = 0.01; // drop rate increase relative to individual particle speed\n\n    /**\n     * @type {Array<number>}\n     * @private\n     */\n    this.tempVec2_ = [0, 0];\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.renderedWidth_ = 0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.renderedHeight_ = 0;\n  }\n\n  /**\n   * @override\n   */\n  afterHelperCreated() {\n    super.afterHelperCreated();\n    const helper = this.helper;\n\n    const gl = helper.getGL();\n    this.framebuffer_ = gl.createFramebuffer();\n\n    const particleCount = this.particleCountSqrt_ * this.particleCountSqrt_;\n    const particleIndices = new Float32Array(particleCount);\n    for (let i = 0; i < particleCount; ++i) {\n      particleIndices[i] = i;\n    }\n    const particleIndexBuffer = new WebGLArrayBuffer(ARRAY_BUFFER, STATIC_DRAW);\n    particleIndexBuffer.setArray(particleIndices);\n    helper.flushBufferData(particleIndexBuffer);\n    this.particleIndexBuffer_ = particleIndexBuffer;\n\n    const quadIndices = new Float32Array([0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1]);\n    const quadBuffer = new WebGLArrayBuffer(ARRAY_BUFFER, STATIC_DRAW);\n    quadBuffer.setArray(quadIndices);\n    helper.flushBufferData(quadBuffer);\n    this.quadBuffer_ = quadBuffer;\n\n    const particlePositions = new Uint8Array(particleCount * 4);\n    for (let i = 0; i < particlePositions.length; ++i) {\n      particlePositions[i] = Math.floor(Math.random() * 256);\n    }\n\n    this.previousPositionTexture_ = helper.createTexture(\n      [this.particleCountSqrt_, this.particleCountSqrt_],\n      particlePositions,\n      null,\n      true,\n    );\n\n    this.nextPositionTexture_ = helper.createTexture(\n      [this.particleCountSqrt_, this.particleCountSqrt_],\n      particlePositions,\n      null,\n      true,\n    );\n\n    this.particlePositionProgram_ = helper.getProgram(\n      this.particlePositionFragmentShader_,\n      this.particlePositionVertexShader_,\n    );\n\n    this.particleColorProgram_ = helper.getProgram(\n      this.particleColorFragmentShader_,\n      this.particleColorVertexShader_,\n    );\n\n    this.textureProgram_ = helper.getProgram(\n      this.textureFragmentShader_,\n      this.textureVertexShader_,\n    );\n  }\n\n  createSizeDependentTextures_() {\n    const helper = this.helper;\n    const gl = helper.getGL();\n    const canvas = helper.getCanvas();\n    const screenWidth = canvas.width;\n    const screenHeight = canvas.height;\n\n    const blank = new Uint8Array(screenWidth * screenHeight * 4);\n\n    if (this.nextTrailsTexture_) {\n      gl.deleteTexture(this.nextTrailsTexture_);\n    }\n    this.nextTrailsTexture_ = helper.createTexture(\n      [screenWidth, screenHeight],\n      blank,\n      null,\n      true,\n    );\n\n    if (this.previousTrailsTexture_) {\n      gl.deleteTexture(this.previousTrailsTexture_);\n    }\n    this.previousTrailsTexture_ = helper.createTexture(\n      [screenWidth, screenHeight],\n      blank,\n      null,\n      true,\n    );\n  }\n\n  /**\n   * @override\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   */\n  beforeFinalize(frameState) {\n    const helper = this.helper;\n    const gl = helper.getGL();\n    const canvas = helper.getCanvas();\n    const screenWidth = canvas.width;\n    const screenHeight = canvas.height;\n\n    if (\n      this.renderedWidth_ != screenWidth ||\n      this.renderedHeight_ != screenHeight\n    ) {\n      this.createSizeDependentTextures_();\n    }\n\n    const size = [screenWidth, screenHeight];\n\n    // copy current frame buffer to the velocity texture\n    this.velocityTexture_ = helper.createTexture(\n      size,\n      null,\n      this.velocityTexture_,\n    );\n    gl.copyTexImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.RGBA,\n      0,\n      0,\n      screenWidth,\n      screenHeight,\n      0,\n    );\n\n    this.drawParticleTrails_(frameState);\n    this.updateParticlePositions_(frameState);\n\n    frameState.animate = true;\n    this.renderedWidth_ = screenWidth;\n    this.renderedHeight_ = screenHeight;\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   */\n  drawParticleTrails_(frameState) {\n    const helper = this.helper;\n    const gl = helper.getGL();\n\n    helper.bindFrameBuffer(this.framebuffer_, this.nextTrailsTexture_);\n\n    this.drawTexture_(this.previousTrailsTexture_, this.fadeOpacity_);\n    this.drawParticleColor_(frameState);\n\n    helper.bindInitialFrameBuffer();\n    gl.clearColor(0.0, 0.0, 0.0, 0.0);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n\n    gl.enable(gl.BLEND);\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    this.drawTexture_(this.nextTrailsTexture_, 1);\n    gl.disable(gl.BLEND);\n\n    const current = this.nextTrailsTexture_;\n    this.nextTrailsTexture_ = this.previousTrailsTexture_;\n    this.previousTrailsTexture_ = current;\n  }\n\n  /**\n   * @param {WebGLTexture} texture The texture to draw.\n   * @param {number} opacity The opacity.\n   */\n  drawTexture_(texture, opacity) {\n    const helper = this.helper;\n    const gl = helper.getGL();\n\n    helper.useProgram(this.textureProgram_);\n    helper.bindTexture(texture, 0, U.TEXTURE);\n    helper.bindAttribute(this.quadBuffer_, A.POSITION, 2);\n    this.helper.setUniformFloatValue(U.OPACITY, opacity);\n\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   */\n  drawParticleColor_(frameState) {\n    const helper = this.helper;\n    const gl = helper.getGL();\n\n    helper.useProgram(this.particleColorProgram_);\n\n    const particleCount = this.particleCountSqrt_ * this.particleCountSqrt_;\n\n    helper.bindAttribute(this.particleIndexBuffer_, A.INDEX, 1);\n\n    helper.bindTexture(this.previousPositionTexture_, 0, U.POSITION_TEXTURE);\n    helper.bindTexture(this.velocityTexture_, 1, U.VELOCITY_TEXTURE);\n\n    this.helper.setUniformFloatValue(\n      U.PARTICLE_COUNT_SQRT,\n      this.particleCountSqrt_,\n    );\n\n    const rotation = this.tempVec2_;\n    rotation[0] = Math.cos(-frameState.viewState.rotation);\n    rotation[1] = Math.sin(-frameState.viewState.rotation);\n    this.helper.setUniformFloatVec2(U.ROTATION, rotation);\n\n    this.helper.setUniformFloatValue(U.MAX_SPEED, this.maxSpeed_);\n\n    gl.drawArrays(gl.POINTS, 0, particleCount);\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   */\n  updateParticlePositions_(frameState) {\n    const helper = this.helper;\n    const gl = helper.getGL();\n\n    helper.useProgram(this.particlePositionProgram_);\n    gl.viewport(0, 0, this.particleCountSqrt_, this.particleCountSqrt_);\n    helper.bindFrameBuffer(this.framebuffer_, this.nextPositionTexture_);\n\n    helper.bindTexture(this.previousPositionTexture_, 0, U.POSITION_TEXTURE);\n    helper.bindTexture(this.velocityTexture_, 1, U.VELOCITY_TEXTURE);\n    helper.bindAttribute(this.quadBuffer_, A.POSITION, 2);\n\n    helper.setUniformFloatValue(U.RANDOM_SEED, Math.random());\n    helper.setUniformFloatValue(U.SPEED_FACTOR, this.speedFactor_);\n    helper.setUniformFloatValue(U.DROP_RATE, this.dropRate_);\n    helper.setUniformFloatValue(U.DROP_RATE_BUMP, this.dropRateBump_);\n\n    const rotation = this.tempVec2_;\n    rotation[0] = Math.cos(-frameState.viewState.rotation);\n    rotation[1] = Math.sin(-frameState.viewState.rotation);\n    this.helper.setUniformFloatVec2(U.ROTATION, rotation);\n\n    const size = frameState.size;\n    this.helper.setUniformFloatVec2(U.VIEWPORT_SIZE_PX, [size[0], size[1]]);\n\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n    const current = this.nextPositionTexture_;\n    this.nextPositionTexture_ = this.previousPositionTexture_;\n    this.previousPositionTexture_ = current;\n  }\n}\n\nexport default FlowLayerRenderer;\n","/**\n * @module ol/layer/Flow\n */\nimport {ColorType} from '../expr/expression.js';\nimport {\n  getStringNumberEquivalent,\n  newCompilationContext,\n  uniformNameForVariable,\n} from '../expr/gpu.js';\nimport {expressionToGlsl} from '../render/webgl/compileUtil.js';\nimport FlowLayerRenderer, {A, U, V} from '../renderer/webgl/FlowLayer.js';\nimport {Attributes as BA, Uniforms as BU} from '../renderer/webgl/TileLayer.js';\nimport BaseTileLayer from './BaseTile.js';\nimport LayerProperty from './Property.js';\n\n/**\n * @typedef {import(\"../source/DataTile.js\").default} SourceType\n */\n\n/**\n * @typedef {Object} Style\n * Translates tile data to rendered pixels.\n *\n * @property {Object<string, (string|number)>} [variables] Style variables.  Each variable must hold a number or string.  These\n * variables can be used in the `color` {@link import(\"../expr/expression.js\").ExpressionValue expression} using\n * the `['var', 'varName']` operator.  To update style variables, use the {@link import(\"./WebGLTile.js\").default#updateStyleVariables} method.\n * @property {import(\"../expr/expression.js\").ExpressionValue} [color] An expression applied to color values.\n */\n\n/**\n * @typedef {Object} Options\n * @property {number} maxSpeed The maximum particle speed.\n * @property {number} [speedFactor=0.001] A larger factor increases the rate at which particles cross the screen.\n * @property {number} [particles=65536] The number of particles to render.\n * @property {Style} [style] Style to apply to the layer.\n * @property {string} [className='ol-layer'] A CSS class name to set to the layer element.\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {import(\"../extent.js\").Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position. When `undefined`, a `zIndex` of 0 is assumed\n * for layers that are added to the map's `layers` collection, or `Infinity` when the layer's `setMap()`\n * method was used.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {number} [minZoom] The minimum view zoom level (exclusive) above which this layer will be\n * visible.\n * @property {number} [maxZoom] The maximum view zoom level (inclusive) at which this layer will\n * be visible.\n * @property {number} [preload=0] Preload. Load low-resolution tiles up to `preload` levels. `0`\n * means no preloading.\n * @property {SourceType} [source] Source for this layer.\n * @property {import(\"../Map.js\").default} [map] Sets the layer as overlay on a map. The map will not manage\n * this layer in its layers collection, and the layer will be rendered on top. This is useful for\n * temporary layers. The standard way to add a layer to a map and have it managed by the map is to\n * use {@link module:ol/Map~Map#addLayer}.\n * @property {boolean} [useInterimTilesOnError=true] Use interim tiles on error.\n * @property {number} [cacheSize=512] The internal texture cache size.  This needs to be large enough to render\n * two zoom levels worth of tiles.\n */\n\nconst tileVertexShader = `\n  attribute vec2 ${BA.TEXTURE_COORD};\n  uniform mat4 ${BU.TILE_TRANSFORM};\n  uniform float ${BU.TEXTURE_PIXEL_WIDTH};\n  uniform float ${BU.TEXTURE_PIXEL_HEIGHT};\n  uniform float ${BU.TEXTURE_RESOLUTION};\n  uniform float ${BU.TEXTURE_ORIGIN_X};\n  uniform float ${BU.TEXTURE_ORIGIN_Y};\n  uniform float ${BU.DEPTH};\n\n  varying vec2 v_textureCoord;\n  varying vec2 v_mapCoord;\n\n  void main() {\n    v_textureCoord = ${BA.TEXTURE_COORD};\n    v_mapCoord = vec2(\n      ${BU.TEXTURE_ORIGIN_X} + ${BU.TEXTURE_RESOLUTION} * ${BU.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],\n      ${BU.TEXTURE_ORIGIN_Y} - ${BU.TEXTURE_RESOLUTION} * ${BU.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]\n    );\n    gl_Position = ${BU.TILE_TRANSFORM} * vec4(${BA.TEXTURE_COORD}, ${BU.DEPTH}, 1.0);\n  }\n`;\n\nconst tileFragmentShader = `\n  #ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  #else\n  precision mediump float;\n  #endif\n\n  uniform vec4 ${BU.RENDER_EXTENT};\n  uniform float ${U.MAX_SPEED};\n  uniform sampler2D ${BU.TILE_TEXTURE_ARRAY}[1];\n\n  varying vec2 v_textureCoord;\n  varying vec2 v_mapCoord;\n\n  void main() {\n    if (\n      v_mapCoord[0] < ${BU.RENDER_EXTENT}[0] ||\n      v_mapCoord[1] < ${BU.RENDER_EXTENT}[1] ||\n      v_mapCoord[0] > ${BU.RENDER_EXTENT}[2] ||\n      v_mapCoord[1] > ${BU.RENDER_EXTENT}[3]\n    ) {\n      discard;\n    }\n\n    vec4 velocity = texture2D(${BU.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);\n    gl_FragColor = vec4((velocity.xy + ${U.MAX_SPEED}) / (2.0 * ${U.MAX_SPEED}), 0, 1);\n  }\n`;\n\n/**\n * Sets up a varying position for rendering textures.\n */\nconst quadVertexShader = `\n  #ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  #else\n  precision mediump float;\n  #endif\n\n  attribute vec2 ${A.POSITION};\n\n  varying vec2 ${V.POSITION};\n\n  void main() {\n    ${V.POSITION} = ${A.POSITION};\n    gl_Position = vec4(1.0 - 2.0 * ${A.POSITION}, 0, 1);\n  }\n`;\n\n/**\n * Sampes a texture and renders it with a new opacity.\n */\nconst textureFragmentShader = `\n  #ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  #else\n  precision mediump float;\n  #endif\n\n  uniform sampler2D ${U.TEXTURE};\n  uniform float ${U.OPACITY};\n\n  varying vec2 ${V.POSITION};\n\n  void main() {\n    vec4 color = texture2D(${U.TEXTURE}, 1.0 - ${V.POSITION});\n    gl_FragColor = vec4(floor(255.0 * color * ${U.OPACITY}) / 255.0);\n  }\n`;\n\n/**\n * Samples current particle positions, determines new positions based on velocity, and\n * encodes the new position as a color.\n */\nconst particlePositionFragmentShader = `\n  #ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  #else\n  precision mediump float;\n  #endif\n\n  uniform sampler2D ${U.POSITION_TEXTURE};\n  uniform sampler2D ${U.VELOCITY_TEXTURE};\n  uniform float ${U.RANDOM_SEED};\n  uniform float ${U.SPEED_FACTOR};\n  uniform float ${U.DROP_RATE};\n  uniform float ${U.DROP_RATE_BUMP};\n  uniform vec2 ${U.ROTATION};\n  uniform vec2 ${U.VIEWPORT_SIZE_PX};\n\n  varying vec2 ${V.POSITION};\n\n  // pseudo-random generator\n  const vec3 randConstants = vec3(12.9898, 78.233, 4375.85453);\n\n  float rand(const vec2 co) {\n    float t = dot(randConstants.xy, co);\n    return fract(sin(t) * (randConstants.z + t));\n  }\n\n  void main() {\n    vec4 positionColor = texture2D(${U.POSITION_TEXTURE}, ${V.POSITION});\n\n    // decode particle position from pixel RGBA\n    vec2 particlePosition = vec2(\n      positionColor.r / 255.0 + positionColor.b,\n      positionColor.g / 255.0 + positionColor.a\n    );\n\n    vec4 velocityColor = texture2D(${U.VELOCITY_TEXTURE}, particlePosition);\n    if (velocityColor.a == 0.0) {\n      discard;\n    }\n\n    float vx = 2.0 * velocityColor.r - 1.0;\n    float vy = 2.0 * velocityColor.g - 1.0;\n\n    // normalized veloicty (magnitude 0 - 1)\n    vec2 velocity = vec2(\n      vx * ${U.ROTATION}.x - vy * ${U.ROTATION}.y,\n      vx * ${U.ROTATION}.y + vy * ${U.ROTATION}.x\n    );\n\n    // account for aspect ratio (square particle position texture, non-square map)\n    float aspectRatio = ${U.VIEWPORT_SIZE_PX}.x / ${U.VIEWPORT_SIZE_PX}.y;\n    vec2 offset = vec2(velocity.x / aspectRatio, velocity.y) * ${U.SPEED_FACTOR};\n\n    // update particle position, wrapping around the edge\n    particlePosition = fract(1.0 + particlePosition + offset);\n\n    // a random seed to use for the particle drop\n    vec2 seed = (particlePosition + ${V.POSITION}) * ${U.RANDOM_SEED};\n\n    // drop rate is a chance a particle will restart at random position, to avoid degeneration\n    float dropRate = ${U.DROP_RATE} + length(velocity) * ${U.DROP_RATE_BUMP};\n    float drop = step(1.0 - dropRate, rand(seed));\n\n    vec2 randomPosition = vec2(rand(seed + 1.3), rand(seed + 2.1));\n    particlePosition = mix(particlePosition, randomPosition, drop);\n\n    // encode the new particle position back into RGBA\n    gl_FragColor = vec4(\n      fract(particlePosition * 255.0),\n      floor(particlePosition * 255.0) / 255.0\n    );\n  }\n`;\n\n/**\n * Samples the particle position texture to decode the particle position\n * based on pixel color.\n */\nconst particleColorVertexShader = `\n  #ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  #else\n  precision mediump float;\n  #endif\n\n  attribute float ${A.INDEX};\n\n  uniform sampler2D ${U.POSITION_TEXTURE};\n  uniform float ${U.PARTICLE_COUNT_SQRT};\n\n  varying vec2 ${V.POSITION};\n\n  void main() {\n    vec4 color = texture2D(\n      ${U.POSITION_TEXTURE},\n      vec2(\n        fract(${A.INDEX} / ${U.PARTICLE_COUNT_SQRT}),\n        floor(${A.INDEX} / ${U.PARTICLE_COUNT_SQRT}) / ${U.PARTICLE_COUNT_SQRT}\n      )\n    );\n\n    ${V.POSITION} = vec2(\n      color.r / 255.0 + color.b,\n      color.g / 255.0 + color.a\n    );\n\n    gl_PointSize = 1.0;\n    gl_Position = vec4(\n      2.0 * ${V.POSITION}.x - 1.0,\n      2.0 * ${V.POSITION}.y - 1.0,\n      0,\n      1\n    );\n  }\n`;\n\n/**\n * @typedef {Object} ParsedStyle\n * @property {string} tileVertexShader The flow tile vertex shader.\n * @property {string} tileFragmentShader The flow tile fragment shader.\n * @property {string} textureVertexShader Generic texture fragment shader.\n * @property {string} textureFragmentShader Generic texture fragment shader.\n * @property {string} particlePositionVertexShader The particle position vertex shader.\n * @property {string} particlePositionFragmentShader The particle position fragment shader.\n * @property {string} particleColorVertexShader The particle color vertex shader.\n * @property {string} particleColorFragmentShader The particle color fragment shader.\n */\n\n/**\n * @param {Style} style The layer style.\n * @return {ParsedStyle} Shaders and uniforms generated from the style.\n */\nfunction parseStyle(style) {\n  const context = newCompilationContext();\n  const pipeline = [];\n\n  if (style.color !== undefined) {\n    const color = expressionToGlsl(context, style.color, ColorType);\n    pipeline.push(`color = ${color};`);\n  }\n\n  const variableNames = Object.keys(context.variables);\n  if (variableNames.length > 1 && !style.variables) {\n    throw new Error(\n      `Missing variables in style (expected ${context.variables})`,\n    );\n  }\n\n  /** @type {Object<string,import(\"../webgl/Helper\").UniformValue>} */\n  const uniforms = {};\n\n  for (const variableName of variableNames) {\n    if (!(variableName in style.variables)) {\n      throw new Error(`Missing '${variableName}' in style variables`);\n    }\n\n    const uniformName = uniformNameForVariable(variableName);\n    uniforms[uniformName] = function () {\n      let value = style.variables[variableName];\n      if (typeof value === 'string') {\n        value = getStringNumberEquivalent(value);\n      }\n      return value !== undefined ? value : -9999999; // to avoid matching with the first string literal\n    };\n  }\n\n  const uniformDeclarations = Object.keys(uniforms).map(function (name) {\n    return `uniform float ${name};`;\n  });\n\n  const functionDefintions = Object.keys(context.functions).map(\n    function (name) {\n      return context.functions[name];\n    },\n  );\n\n  const particleColorFragmentShader = `\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n\n    uniform sampler2D ${U.VELOCITY_TEXTURE};\n    uniform float ${U.MAX_SPEED};\n    uniform vec2 ${U.ROTATION};\n\n    ${uniformDeclarations.join('\\n')}\n\n    varying vec2 ${V.POSITION};\n    \n    ${functionDefintions.join('\\n')}\n\n    void main() {\n      vec4 velocityColor = texture2D(${U.VELOCITY_TEXTURE}, ${V.POSITION});\n\n      float vx = mix(-${U.MAX_SPEED}, ${U.MAX_SPEED}, velocityColor.r);\n      float vy = mix(-${U.MAX_SPEED}, ${U.MAX_SPEED}, velocityColor.g);\n\n      vec2 velocity = vec2(\n        vx * ${U.ROTATION}.x - vy * ${U.ROTATION}.y,\n        vx * ${U.ROTATION}.y + vy * ${U.ROTATION}.x\n      );\n\n      float a_prop_speed = length(velocity);\n\n      vec4 color;\n\n      ${pipeline.join('\\n')}\n\n      if (color.a == 0.0) {\n        discard;\n      }\n\n      gl_FragColor = color;\n    }\n  `;\n\n  return {\n    tileVertexShader,\n    tileFragmentShader,\n    particleColorVertexShader,\n    particleColorFragmentShader,\n    particlePositionVertexShader: quadVertexShader,\n    particlePositionFragmentShader,\n    textureVertexShader: quadVertexShader,\n    textureFragmentShader,\n  };\n}\n\n/**\n * @type {Array<SourceType>}\n */\nconst sources = [];\n\n/**\n * @classdesc\n * Experimental layer that renders particles moving through a vector field.\n *\n * @extends BaseTileLayer<SourceType, FlowLayerRenderer>\n * @fires import(\"../render/Event.js\").RenderEvent#prerender\n * @fires import(\"../render/Event.js\").RenderEvent#postrender\n */\nclass FlowLayer extends BaseTileLayer {\n  /**\n   * @param {Options} options Flow layer options.\n   */\n  constructor(options) {\n    const baseOptions = Object.assign({}, options);\n    delete baseOptions.maxSpeed;\n    delete baseOptions.speedFactor;\n    delete baseOptions.particles;\n    super(baseOptions);\n\n    /**\n     * @type {Style}\n     * @private\n     */\n    this.style_ = options.style || {};\n\n    if (!(options.maxSpeed > 0)) {\n      throw new Error('maxSpeed is required');\n    }\n    /**\n     * @type {number}\n     * @private\n     */\n    this.maxSpeed_ = options.maxSpeed;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.speedFactor_ = options.speedFactor;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.particles_ = options.particles;\n\n    /**\n     * @type {Object<string, (string|number)>}\n     * @private\n     */\n    this.styleVariables_ = this.style_.variables || {};\n\n    this.addChangeListener(LayerProperty.SOURCE, this.handleSourceUpdate_);\n  }\n\n  /**\n   * @private\n   */\n  handleSourceUpdate_() {\n    if (this.hasRenderer()) {\n      this.getRenderer().clearCache();\n    }\n  }\n\n  /**\n   * Update any variables used by the layer style and trigger a re-render.\n   * @param {Object<string, number>} variables Variables to update.\n   */\n  updateStyleVariables(variables) {\n    Object.assign(this.styleVariables_, variables);\n    this.changed();\n  }\n\n  /**\n   * Gets the sources for this layer, for a given extent and resolution.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @return {Array<SourceType>} Sources.\n   */\n  getSources(extent, resolution) {\n    const source = this.getSource();\n    sources[0] = source;\n    return sources;\n  }\n\n  /**\n   * @override\n   */\n  createRenderer() {\n    const parsedStyle = parseStyle(this.style_);\n\n    return new FlowLayerRenderer(this, {\n      ...parsedStyle,\n      cacheSize: this.getCacheSize(),\n      maxSpeed: this.maxSpeed_,\n      speedFactor: this.speedFactor_,\n      particles: this.particles_,\n    });\n  }\n}\n\n/**\n * Clean up underlying WebGL resources.\n * @function\n */\nFlowLayer.prototype.dispose;\n\nexport default FlowLayer;\n"],"names":["U","DefaultUniform","A","V","FlowLayerRenderer","WebGLTileLayerRenderer","layer","options","helper","gl","particleCount","particleIndices","i","particleIndexBuffer","WebGLArrayBuffer","ARRAY_BUFFER","STATIC_DRAW","quadIndices","quadBuffer","particlePositions","canvas","screenWidth","screenHeight","blank","frameState","size","current","texture","opacity","rotation","tileVertexShader","BA","BU","tileFragmentShader","quadVertexShader","textureFragmentShader","particlePositionFragmentShader","particleColorVertexShader","parseStyle","style","context","newCompilationContext","pipeline","color","expressionToGlsl","ColorType","variableNames","uniforms","variableName","uniformName","uniformNameForVariable","value","getStringNumberEquivalent","uniformDeclarations","name","functionDefintions","particleColorFragmentShader","sources","FlowLayer","BaseTileLayer","baseOptions","LayerProperty","variables","extent","resolution","source","parsedStyle"],"mappings":"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","x_google_ignoreList":[0,1]}