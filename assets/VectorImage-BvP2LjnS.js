import{c7 as y,p as C,A as h,bX as _,aB as I,aC as T,U as R,D as w,c8 as F,E as A,az as E,aD as L,ag as P}from"./GeoJSON-BlyzYhKz.js";import{I as V}from"./ImageCanvas-CGLoEptj.js";import{f as D}from"./resolution-CU8ppKQ3.js";import{C as O}from"./ImageLayer-Bn5NP1Zc.js";import"./index-4V-ffF_e.js";import"./utils-BXWzvTjY.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-CVtNDUBO.js";import"./useStateClass-BGbSLWFN-lMazZNQ7.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--B1-KiooU.js";class b extends O{constructor(e){super(e),this.vectorRenderer_=new y(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=C(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const t=h(this.coordinateToVectorPixelTransform_,h(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){const t=e.pixelRatio,i=e.viewState,o=i.resolution,s=e.viewHints,r=this.vectorRenderer_;let a=e.extent;this.layerImageRatio_!==1&&(a=a.slice(0),_(a,this.layerImageRatio_));const g=I(a)/o,m=T(a)/o;if(!s[R.ANIMATING]&&!s[R.INTERACTING]&&!w(a)){r.useContainer(null,null);const v=r.context,x=e.layerStatesArray[e.layerIndex],f=Object.assign({},x,{opacity:1}),c=Object.assign({},e,{extent:a,size:[g,m],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[f],layerIndex:0,declutter:null}),u=this.getLayer().getDeclutter();u&&(c.declutter={[u]:new F(9)});const n=new V(a,o,t,v.canvas,function(d){r.prepareFrame(c)&&r.replayGroupChanged&&(r.clipping=!1,r.renderFrame(c,null),r.renderDeclutter(c),r.renderDeferred(c),d())});n.addEventListener(A.CHANGE,()=>{if(n.getState()!==E.LOADED)return;this.image=n;const d=n.getPixelRatio(),l=D(n.getResolution())*t/d;this.renderedResolution=l,this.coordinateToVectorPixelTransform_=L(this.coordinateToVectorPixelTransform_,g/2,m/2,1/l,-1/l,0,-i.center[0],-i.center[1])}),n.load()}return this.image&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!this.getLayer().getSource()?.loading&&!!this.image}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,t,i,o,s){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,i,o,s):super.forEachFeatureAtCoordinate(e,t,i,o,s)}}class $ extends P{constructor(e){e=e||{};const t=Object.assign({},e);delete t.imageRatio,super(t),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new b(this)}}export{$ as default};
//# sourceMappingURL=VectorImage-BvP2LjnS.js.map
