import{a4 as dt,n as De,B as Ve,y as he,bk as it,L as de,z as xt,bl as Oe,G as $e,bs as mt}from"./index-B3F0456b.js";import{bA as yt,bB as wt,bu as rt,bC as Et,bD as vt,V as Ne,J as Ce,bE as St,bF as _t,bG as He,aA as je,F as Ie,bH as Xe,bI as bt,bg as Tt,t as Ot,bJ as Ze,d as st,R as Ae,B as It,M as Lt,K as Mt,N as Pt,G as Le,H as Rt,i as Nt,h as Ct,bK as At,bL as Ft,a as Bt}from"./GeoJSON-BoRJWQIG.js";import{t as Gt}from"./utils-BXWzvTjY.js";import"./I18N-DlIXJTel.js";import"./_commonjsHelpers-CE1G-McA.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-DO3czC2y.js";import"./useStateClass-BGbSLWFN-eI-Q6wqs.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--5aly-L7g.js";const kt={viewBox:"0 0 16 16",width:"1.2em",height:"1.2em"};function qt(n,e){return De(),Ve("svg",kt,[...e[0]||(e[0]=[he("g",{fill:"currentColor","fill-rule":"evenodd"},[he("path",{d:"M3.1 11.2a.5.5 0 0 1 .4-.2H6a.5.5 0 0 1 0 1H3.75L1.5 15h13l-2.25-3H10a.5.5 0 0 1 0-1h2.5a.5.5 0 0 1 .4.2l3 4a.5.5 0 0 1-.4.8H.5a.5.5 0 0 1-.4-.8z"}),he("path",{d:"M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999z"})],-1)])])}const Dt=dt({name:"bi-pin-map-fill",render:qt}),Vt={name:"UserLocationControl",mixins:[yt],props:{maxZoom:{type:Number,default:void 0}},methods:{request(){"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(n=>{const e=this.map.getView(),t=wt([n.coords.longitude,n.coords.latitude],e.getProjection()),s=new rt(t);e.fit(s,{maxZoom:this.maxZoom})},n=>this.$store.commit("showGlobalError",{error:n,message:n.message}),{maximumAge:1/0})}}},Ut={class:"ol-location ol-unselectable ol-control",style:{"pointer-events":"auto"}},zt=["title"];function $t(n,e,t,s,i,a){const x=Dt;return De(),Ve("div",Ut,[he("button",{onClick:e[0]||(e[0]=xt((...c)=>a.request&&a.request(...c),["prevent","stop"])),title:n.$t("mapping.location.description")},[de(x)],8,zt)])}const Ht=it(Vt,[["render",$t],["__scopeId","data-v-f8d6420b"]]),jt={EXTENTCHANGED:"extentchanged"};class Xt extends It{constructor(e){super(jt.EXTENTCHANGED),this.extent=e}}class Zt extends Et{constructor(e){e=e||{},super(e),this.on,this.once,this.un,this.condition_=e.condition?e.condition:vt,this.createCondition_=e.createCondition||this.condition_,this.drag_=e.drag||!1,this.extent_=null,this.pointerHandler_=null,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.extentFeature_=null,this.vertexFeature_=null,e||(e={}),this.extentOverlay_=new Ne({source:new Ce({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.boxStyle?e.boxStyle:Kt(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.vertexOverlay_=new Ne({source:new Ce({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.pointerStyle?e.pointerStyle:Yt(),updateWhileAnimating:!0,updateWhileInteracting:!0}),e.extent&&this.setExtent(e.extent)}snapToVertex_(e,t){const s=t.getCoordinateFromPixelInternal(e),i=function(x,c){return Ze(s,x)-Ze(s,c)},a=this.getExtentInternal();if(a){const x=Wt(a);x.sort(i);const c=x[0];let E=St(s,c);const w=t.getPixelFromCoordinateInternal(E);if(_t(e,w)<=this.pixelTolerance_){const T=t.getPixelFromCoordinateInternal(c[0]),_=t.getPixelFromCoordinateInternal(c[1]),I=He(w,T),N=He(w,_),D=Math.sqrt(Math.min(I,N));return this.snappedToVertex_=D<=this.pixelTolerance_,this.snappedToVertex_&&(E=I>N?c[1]:c[0]),E}}return null}handlePointerMove_(e){const t=e.pixel,s=e.map,i=this.drag_&&je(this.extent_,e.coordinate);let a=this.snapToVertex_(t,s);return!a&&this.createCondition_(e)&&!i&&(a=s.getCoordinateFromPixelInternal(t)),i&&!a?this.getMap().getViewport().classList.add("ol-grab"):this.getMap().getViewport().classList.remove("ol-grab"),a?(this.updatePointerFeature_(a),!0):(this.noVertexFeature_(),!1)}createOrUpdateExtentFeature_(e){let t=this.extentFeature_;return t?e?t.setGeometry(Xe(e)):t.setGeometry(void 0):(e?t=new Ie(Xe(e)):t=new Ie({}),this.extentFeature_=t,this.extentOverlay_.getSource().addFeature(t)),t}updatePointerFeature_(e,t=!0){let s=this.vertexFeature_;return t&&!s&&(s=new Ie(new rt(e)),this.vertexFeature_=s,this.vertexOverlay_.getSource().addFeature(s)),s&&s.getGeometry().setCoordinates(e),s}noVertexFeature_(){this.vertexFeature_&&(this.vertexOverlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}handleEvent(e){if(!e.originalEvent||!this.condition_(e))return this.noVertexFeature_(),!0;let t=this.handlingDownUpSequence;return e.type==bt.POINTERMOVE&&!this.handlingDownUpSequence&&(t=this.handlePointerMove_(e)),super.handleEvent(e),!t}handleDownEvent(e){const t=e.pixel,s=e.map,i=this.getExtentInternal();let a=this.snapToVertex_(t,s);const x=function(c){let E=null,w=null;return c[0]==i[0]?E=i[2]:c[0]==i[2]&&(E=i[0]),c[1]==i[1]?w=i[3]:c[1]==i[3]&&(w=i[1]),E!==null&&w!==null?[E,w]:null};if(a&&i){const c=a[0]==i[0]||a[0]==i[2]?a[0]:null,E=a[1]==i[1]||a[1]==i[3]?a[1]:null;c!==null&&E!==null?this.pointerHandler_=Ke(x(a)):c!==null?this.pointerHandler_=Ye(x([c,i[1]]),x([c,i[3]])):E!==null&&(this.pointerHandler_=Ye(x([i[0],E]),x([i[2],E])))}else{a=s.getCoordinateFromPixelInternal(t);let c=!1;this.drag_&&je(i,a)&&(this.pointerHandler_=Jt(i,a),c=!0),!c&&this.createCondition_(e)&&(this.setExtent([a[0],a[1],a[0],a[1]]),this.pointerHandler_=Ke(a))}return!!this.pointerHandler_}handleDragEvent(e){if(this.pointerHandler_){const t=e.coordinate;this.setExtent(this.pointerHandler_(t)),this.updatePointerFeature_(t,!1)}}handleUpEvent(e){this.pointerHandler_=null;const t=this.getExtentInternal();return(!t||Tt(t)===0)&&this.setExtent(null),!1}setMap(e){this.extentOverlay_.setMap(e),this.vertexOverlay_.setMap(e),super.setMap(e)}getExtent(){return Ot(this.getExtentInternal(),this.getMap().getView().getProjection())}getExtentInternal(){return this.extent_}setExtent(e){this.extent_=e||null,this.createOrUpdateExtentFeature_(e),this.dispatchEvent(new Xt(this.extent_))}}function Kt(){const n=st();return function(e,t){return n.Polygon}}function Yt(){const n=st();return function(e,t){return n.Point}}function Ke(n){return function(e){return Ae([n,e])}}function Ye(n,e){return n[0]==e[0]?function(t){return Ae([n,[t[0],e[1]]])}:n[1]==e[1]?function(t){return Ae([n,[e[0],t[1]]])}:null}function Jt(n,e){return function(t){const s=t[0]-e[0],i=t[1]-e[1];return[n[0]+s,n[1]+i,n[2]+s,n[3]+i]}}function Wt(n){return[[[n[0],n[1]],[n[0],n[3]]],[[n[0],n[3]],[n[2],n[3]]],[[n[2],n[3]],[n[2],n[1]]],[[n[2],n[1]],[n[0],n[1]]]]}function ot(n,e,t={}){const s={type:"Feature"};return(t.id===0||t.id)&&(s.id=t.id),t.bbox&&(s.bbox=t.bbox),s.properties={},s.geometry=n,s}function Qt(n,e,t={}){for(const i of n){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let a=0;a<i[i.length-1].length;a++)if(i[i.length-1][a]!==i[0][a])throw new Error("First and last Position are not equivalent.")}return ot({type:"Polygon",coordinates:n},e,t)}function en(n,e,t={}){return ot({type:"MultiPolygon",coordinates:n},e,t)}var tn=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Me=Math.ceil,X=Math.floor,U="[BigNumber Error] ",Je=U+"Number primitive has more than 15 significant digits: ",K=1e14,L=14,Pe=9007199254740991,Re=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],ne=1e7,G=1e9;function lt(n){var e,t,s,i=S.prototype={constructor:S,toString:null,valueOf:null},a=new S(1),x=20,c=4,E=-7,w=21,T=-1e7,_=1e7,I=!1,N=1,D=0,z={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},k="0123456789abcdefghijklmnopqrstuvwxyz",ve=!0;function S(r,o){var l,d,h,p,y,u,f,m,g=this;if(!(g instanceof S))return new S(r,o);if(o==null){if(r&&r._isBigNumber===!0){g.s=r.s,!r.c||r.e>_?g.c=g.e=null:r.e<T?g.c=[g.e=0]:(g.e=r.e,g.c=r.c.slice());return}if((u=typeof r=="number")&&r*0==0){if(g.s=1/r<0?(r=-r,-1):1,r===~~r){for(p=0,y=r;y>=10;y/=10,p++);p>_?g.c=g.e=null:(g.e=p,g.c=[r]);return}m=String(r)}else{if(!tn.test(m=String(r)))return s(g,m,u);g.s=m.charCodeAt(0)==45?(m=m.slice(1),-1):1}(p=m.indexOf("."))>-1&&(m=m.replace(".","")),(y=m.search(/e/i))>0?(p<0&&(p=y),p+=+m.slice(y+1),m=m.substring(0,y)):p<0&&(p=m.length)}else{if(C(o,2,k.length,"Base"),o==10&&ve)return g=new S(r),$(g,x+g.e+1,c);if(m=String(r),u=typeof r=="number"){if(r*0!=0)return s(g,m,u,o);if(g.s=1/r<0?(m=m.slice(1),-1):1,S.DEBUG&&m.replace(/^0\.0*|\./,"").length>15)throw Error(Je+r)}else g.s=m.charCodeAt(0)===45?(m=m.slice(1),-1):1;for(l=k.slice(0,o),p=y=0,f=m.length;y<f;y++)if(l.indexOf(d=m.charAt(y))<0){if(d=="."){if(y>p){p=f;continue}}else if(!h&&(m==m.toUpperCase()&&(m=m.toLowerCase())||m==m.toLowerCase()&&(m=m.toUpperCase()))){h=!0,y=-1,p=0;continue}return s(g,String(r),u,o)}u=!1,m=t(m,o,10,g.s),(p=m.indexOf("."))>-1?m=m.replace(".",""):p=m.length}for(y=0;m.charCodeAt(y)===48;y++);for(f=m.length;m.charCodeAt(--f)===48;);if(m=m.slice(y,++f)){if(f-=y,u&&S.DEBUG&&f>15&&(r>Pe||r!==X(r)))throw Error(Je+g.s*r);if((p=p-y-1)>_)g.c=g.e=null;else if(p<T)g.c=[g.e=0];else{if(g.e=p,g.c=[],y=(p+1)%L,p<0&&(y+=L),y<f){for(y&&g.c.push(+m.slice(0,y)),f-=L;y<f;)g.c.push(+m.slice(y,y+=L));y=L-(m=m.slice(y)).length}else y-=f;for(;y--;m+="0");g.c.push(+m)}}else g.c=[g.e=0]}S.clone=lt,S.ROUND_UP=0,S.ROUND_DOWN=1,S.ROUND_CEIL=2,S.ROUND_FLOOR=3,S.ROUND_HALF_UP=4,S.ROUND_HALF_DOWN=5,S.ROUND_HALF_EVEN=6,S.ROUND_HALF_CEIL=7,S.ROUND_HALF_FLOOR=8,S.EUCLID=9,S.config=S.set=function(r){var o,l;if(r!=null)if(typeof r=="object"){if(r.hasOwnProperty(o="DECIMAL_PLACES")&&(l=r[o],C(l,0,G,o),x=l),r.hasOwnProperty(o="ROUNDING_MODE")&&(l=r[o],C(l,0,8,o),c=l),r.hasOwnProperty(o="EXPONENTIAL_AT")&&(l=r[o],l&&l.pop?(C(l[0],-G,0,o),C(l[1],0,G,o),E=l[0],w=l[1]):(C(l,-G,G,o),E=-(w=l<0?-l:l))),r.hasOwnProperty(o="RANGE"))if(l=r[o],l&&l.pop)C(l[0],-G,-1,o),C(l[1],1,G,o),T=l[0],_=l[1];else if(C(l,-G,G,o),l)T=-(_=l<0?-l:l);else throw Error(U+o+" cannot be zero: "+l);if(r.hasOwnProperty(o="CRYPTO"))if(l=r[o],l===!!l)if(l)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))I=l;else throw I=!l,Error(U+"crypto unavailable");else I=l;else throw Error(U+o+" not true or false: "+l);if(r.hasOwnProperty(o="MODULO_MODE")&&(l=r[o],C(l,0,9,o),N=l),r.hasOwnProperty(o="POW_PRECISION")&&(l=r[o],C(l,0,G,o),D=l),r.hasOwnProperty(o="FORMAT"))if(l=r[o],typeof l=="object")z=l;else throw Error(U+o+" not an object: "+l);if(r.hasOwnProperty(o="ALPHABET"))if(l=r[o],typeof l=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(l))ve=l.slice(0,10)=="0123456789",k=l;else throw Error(U+o+" invalid: "+l)}else throw Error(U+"Object expected: "+r);return{DECIMAL_PLACES:x,ROUNDING_MODE:c,EXPONENTIAL_AT:[E,w],RANGE:[T,_],CRYPTO:I,MODULO_MODE:N,POW_PRECISION:D,FORMAT:z,ALPHABET:k}},S.isBigNumber=function(r){if(!r||r._isBigNumber!==!0)return!1;if(!S.DEBUG)return!0;var o,l,d=r.c,h=r.e,p=r.s;e:if({}.toString.call(d)=="[object Array]"){if((p===1||p===-1)&&h>=-G&&h<=G&&h===X(h)){if(d[0]===0){if(h===0&&d.length===1)return!0;break e}if(o=(h+1)%L,o<1&&(o+=L),String(d[0]).length==o){for(o=0;o<d.length;o++)if(l=d[o],l<0||l>=K||l!==X(l))break e;if(l!==0)return!0}}}else if(d===null&&h===null&&(p===null||p===1||p===-1))return!0;throw Error(U+"Invalid BigNumber: "+r)},S.maximum=S.max=function(){return ze(arguments,-1)},S.minimum=S.min=function(){return ze(arguments,1)},S.random=(function(){var r=9007199254740992,o=Math.random()*r&2097151?function(){return X(Math.random()*r)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(l){var d,h,p,y,u,f=0,m=[],g=new S(a);if(l==null?l=x:C(l,0,G),y=Me(l/L),I)if(crypto.getRandomValues){for(d=crypto.getRandomValues(new Uint32Array(y*=2));f<y;)u=d[f]*131072+(d[f+1]>>>11),u>=9e15?(h=crypto.getRandomValues(new Uint32Array(2)),d[f]=h[0],d[f+1]=h[1]):(m.push(u%1e14),f+=2);f=y/2}else if(crypto.randomBytes){for(d=crypto.randomBytes(y*=7);f<y;)u=(d[f]&31)*281474976710656+d[f+1]*1099511627776+d[f+2]*4294967296+d[f+3]*16777216+(d[f+4]<<16)+(d[f+5]<<8)+d[f+6],u>=9e15?crypto.randomBytes(7).copy(d,f):(m.push(u%1e14),f+=7);f=y/7}else throw I=!1,Error(U+"crypto unavailable");if(!I)for(;f<y;)u=o(),u<9e15&&(m[f++]=u%1e14);for(y=m[--f],l%=L,y&&l&&(u=Re[L-l],m[f]=X(y/u)*u);m[f]===0;m.pop(),f--);if(f<0)m=[p=0];else{for(p=-1;m[0]===0;m.splice(0,1),p-=L);for(f=1,u=m[0];u>=10;u/=10,f++);f<L&&(p-=L-f)}return g.e=p,g.c=m,g}})(),S.sum=function(){for(var r=1,o=arguments,l=new S(o[0]);r<o.length;)l=l.plus(o[r++]);return l},t=(function(){var r="0123456789";function o(l,d,h,p){for(var y,u=[0],f,m=0,g=l.length;m<g;){for(f=u.length;f--;u[f]*=d);for(u[0]+=p.indexOf(l.charAt(m++)),y=0;y<u.length;y++)u[y]>h-1&&(u[y+1]==null&&(u[y+1]=0),u[y+1]+=u[y]/h|0,u[y]%=h)}return u.reverse()}return function(l,d,h,p,y){var u,f,m,g,v,b,O,P,A=l.indexOf("."),B=x,M=c;for(A>=0&&(g=D,D=0,l=l.replace(".",""),P=new S(d),b=P.pow(l.length-A),D=g,P.c=o(ee(j(b.c),b.e,"0"),10,h,r),P.e=P.c.length),O=o(l,d,h,y?(u=k,r):(u=r,k)),m=g=O.length;O[--g]==0;O.pop());if(!O[0])return u.charAt(0);if(A<0?--m:(b.c=O,b.e=m,b.s=p,b=e(b,P,B,M,h),O=b.c,v=b.r,m=b.e),f=m+B+1,A=O[f],g=h/2,v=v||f<0||O[f+1]!=null,v=M<4?(A!=null||v)&&(M==0||M==(b.s<0?3:2)):A>g||A==g&&(M==4||v||M==6&&O[f-1]&1||M==(b.s<0?8:7)),f<1||!O[0])l=v?ee(u.charAt(1),-B,u.charAt(0)):u.charAt(0);else{if(O.length=f,v)for(--h;++O[--f]>h;)O[f]=0,f||(++m,O=[1].concat(O));for(g=O.length;!O[--g];);for(A=0,l="";A<=g;l+=u.charAt(O[A++]));l=ee(l,m,u.charAt(0))}return l}})(),e=(function(){function r(d,h,p){var y,u,f,m,g=0,v=d.length,b=h%ne,O=h/ne|0;for(d=d.slice();v--;)f=d[v]%ne,m=d[v]/ne|0,y=O*f+m*b,u=b*f+y%ne*ne+g,g=(u/p|0)+(y/ne|0)+O*m,d[v]=u%p;return g&&(d=[g].concat(d)),d}function o(d,h,p,y){var u,f;if(p!=y)f=p>y?1:-1;else for(u=f=0;u<p;u++)if(d[u]!=h[u]){f=d[u]>h[u]?1:-1;break}return f}function l(d,h,p,y){for(var u=0;p--;)d[p]-=u,u=d[p]<h[p]?1:0,d[p]=u*y+d[p]-h[p];for(;!d[0]&&d.length>1;d.splice(0,1));}return function(d,h,p,y,u){var f,m,g,v,b,O,P,A,B,M,R,q,fe,be,Te,Y,se,H=d.s==h.s?1:-1,V=d.c,F=h.c;if(!V||!V[0]||!F||!F[0])return new S(!d.s||!h.s||(V?F&&V[0]==F[0]:!F)?NaN:V&&V[0]==0||!F?H*0:H/0);for(A=new S(H),B=A.c=[],m=d.e-h.e,H=p+m+1,u||(u=K,m=Z(d.e/L)-Z(h.e/L),H=H/L|0),g=0;F[g]==(V[g]||0);g++);if(F[g]>(V[g]||0)&&m--,H<0)B.push(1),v=!0;else{for(be=V.length,Y=F.length,g=0,H+=2,b=X(u/(F[0]+1)),b>1&&(F=r(F,b,u),V=r(V,b,u),Y=F.length,be=V.length),fe=Y,M=V.slice(0,Y),R=M.length;R<Y;M[R++]=0);se=F.slice(),se=[0].concat(se),Te=F[0],F[1]>=u/2&&Te++;do{if(b=0,f=o(F,M,Y,R),f<0){if(q=M[0],Y!=R&&(q=q*u+(M[1]||0)),b=X(q/Te),b>1)for(b>=u&&(b=u-1),O=r(F,b,u),P=O.length,R=M.length;o(O,M,P,R)==1;)b--,l(O,Y<P?se:F,P,u),P=O.length,f=1;else b==0&&(f=b=1),O=F.slice(),P=O.length;if(P<R&&(O=[0].concat(O)),l(M,O,R,u),R=M.length,f==-1)for(;o(F,M,Y,R)<1;)b++,l(M,Y<R?se:F,R,u),R=M.length}else f===0&&(b++,M=[0]);B[g++]=b,M[0]?M[R++]=V[fe]||0:(M=[V[fe]],R=1)}while((fe++<be||M[0]!=null)&&H--);v=M[0]!=null,B[0]||B.splice(0,1)}if(u==K){for(g=1,H=B[0];H>=10;H/=10,g++);$(A,p+(A.e=g+m*L-1)+1,y,v)}else A.e=m,A.r=+v;return A}})();function Se(r,o,l,d){var h,p,y,u,f;if(l==null?l=c:C(l,0,8),!r.c)return r.toString();if(h=r.c[0],y=r.e,o==null)f=j(r.c),f=d==1||d==2&&(y<=E||y>=w)?ge(f,y):ee(f,y,"0");else if(r=$(new S(r),o,l),p=r.e,f=j(r.c),u=f.length,d==1||d==2&&(o<=p||p<=E)){for(;u<o;f+="0",u++);f=ge(f,p)}else if(o-=y+(d===2&&p>y),f=ee(f,p,"0"),p+1>u){if(--o>0)for(f+=".";o--;f+="0");}else if(o+=p-u,o>0)for(p+1==u&&(f+=".");o--;f+="0");return r.s<0&&h?"-"+f:f}function ze(r,o){for(var l,d,h=1,p=new S(r[0]);h<r.length;h++)d=new S(r[h]),(!d.s||(l=ie(p,d))===o||l===0&&p.s===o)&&(p=d);return p}function _e(r,o,l){for(var d=1,h=o.length;!o[--h];o.pop());for(h=o[0];h>=10;h/=10,d++);return(l=d+l*L-1)>_?r.c=r.e=null:l<T?r.c=[r.e=0]:(r.e=l,r.c=o),r}s=(function(){var r=/^(-?)0([xbo])(?=\w[\w.]*$)/i,o=/^([^.]+)\.$/,l=/^\.([^.]+)$/,d=/^-?(Infinity|NaN)$/,h=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(p,y,u,f){var m,g=u?y:y.replace(h,"");if(d.test(g))p.s=isNaN(g)?null:g<0?-1:1;else{if(!u&&(g=g.replace(r,function(v,b,O){return m=(O=O.toLowerCase())=="x"?16:O=="b"?2:8,!f||f==m?b:v}),f&&(m=f,g=g.replace(o,"$1").replace(l,"0.$1")),y!=g))return new S(g,m);if(S.DEBUG)throw Error(U+"Not a"+(f?" base "+f:"")+" number: "+y);p.s=null}p.c=p.e=null}})();function $(r,o,l,d){var h,p,y,u,f,m,g,v=r.c,b=Re;if(v){e:{for(h=1,u=v[0];u>=10;u/=10,h++);if(p=o-h,p<0)p+=L,y=o,f=v[m=0],g=X(f/b[h-y-1]%10);else if(m=Me((p+1)/L),m>=v.length)if(d){for(;v.length<=m;v.push(0));f=g=0,h=1,p%=L,y=p-L+1}else break e;else{for(f=u=v[m],h=1;u>=10;u/=10,h++);p%=L,y=p-L+h,g=y<0?0:X(f/b[h-y-1]%10)}if(d=d||o<0||v[m+1]!=null||(y<0?f:f%b[h-y-1]),d=l<4?(g||d)&&(l==0||l==(r.s<0?3:2)):g>5||g==5&&(l==4||d||l==6&&(p>0?y>0?f/b[h-y]:0:v[m-1])%10&1||l==(r.s<0?8:7)),o<1||!v[0])return v.length=0,d?(o-=r.e+1,v[0]=b[(L-o%L)%L],r.e=-o||0):v[0]=r.e=0,r;if(p==0?(v.length=m,u=1,m--):(v.length=m+1,u=b[L-p],v[m]=y>0?X(f/b[h-y]%b[y])*u:0),d)for(;;)if(m==0){for(p=1,y=v[0];y>=10;y/=10,p++);for(y=v[0]+=u,u=1;y>=10;y/=10,u++);p!=u&&(r.e++,v[0]==K&&(v[0]=1));break}else{if(v[m]+=u,v[m]!=K)break;v[m--]=0,u=1}for(p=v.length;v[--p]===0;v.pop());}r.e>_?r.c=r.e=null:r.e<T&&(r.c=[r.e=0])}return r}function Q(r){var o,l=r.e;return l===null?r.toString():(o=j(r.c),o=l<=E||l>=w?ge(o,l):ee(o,l,"0"),r.s<0?"-"+o:o)}return i.absoluteValue=i.abs=function(){var r=new S(this);return r.s<0&&(r.s=1),r},i.comparedTo=function(r,o){return ie(this,new S(r,o))},i.decimalPlaces=i.dp=function(r,o){var l,d,h,p=this;if(r!=null)return C(r,0,G),o==null?o=c:C(o,0,8),$(new S(p),r+p.e+1,o);if(!(l=p.c))return null;if(d=((h=l.length-1)-Z(this.e/L))*L,h=l[h])for(;h%10==0;h/=10,d--);return d<0&&(d=0),d},i.dividedBy=i.div=function(r,o){return e(this,new S(r,o),x,c)},i.dividedToIntegerBy=i.idiv=function(r,o){return e(this,new S(r,o),0,1)},i.exponentiatedBy=i.pow=function(r,o){var l,d,h,p,y,u,f,m,g,v=this;if(r=new S(r),r.c&&!r.isInteger())throw Error(U+"Exponent not an integer: "+Q(r));if(o!=null&&(o=new S(o)),u=r.e>14,!v.c||!v.c[0]||v.c[0]==1&&!v.e&&v.c.length==1||!r.c||!r.c[0])return g=new S(Math.pow(+Q(v),u?r.s*(2-pe(r)):+Q(r))),o?g.mod(o):g;if(f=r.s<0,o){if(o.c?!o.c[0]:!o.s)return new S(NaN);d=!f&&v.isInteger()&&o.isInteger(),d&&(v=v.mod(o))}else{if(r.e>9&&(v.e>0||v.e<-1||(v.e==0?v.c[0]>1||u&&v.c[1]>=24e7:v.c[0]<8e13||u&&v.c[0]<=9999975e7)))return p=v.s<0&&pe(r)?-0:0,v.e>-1&&(p=1/p),new S(f?1/p:p);D&&(p=Me(D/L+2))}for(u?(l=new S(.5),f&&(r.s=1),m=pe(r)):(h=Math.abs(+Q(r)),m=h%2),g=new S(a);;){if(m){if(g=g.times(v),!g.c)break;p?g.c.length>p&&(g.c.length=p):d&&(g=g.mod(o))}if(h){if(h=X(h/2),h===0)break;m=h%2}else if(r=r.times(l),$(r,r.e+1,1),r.e>14)m=pe(r);else{if(h=+Q(r),h===0)break;m=h%2}v=v.times(v),p?v.c&&v.c.length>p&&(v.c.length=p):d&&(v=v.mod(o))}return d?g:(f&&(g=a.div(g)),o?g.mod(o):p?$(g,D,c,y):g)},i.integerValue=function(r){var o=new S(this);return r==null?r=c:C(r,0,8),$(o,o.e+1,r)},i.isEqualTo=i.eq=function(r,o){return ie(this,new S(r,o))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function(r,o){return ie(this,new S(r,o))>0},i.isGreaterThanOrEqualTo=i.gte=function(r,o){return(o=ie(this,new S(r,o)))===1||o===0},i.isInteger=function(){return!!this.c&&Z(this.e/L)>this.c.length-2},i.isLessThan=i.lt=function(r,o){return ie(this,new S(r,o))<0},i.isLessThanOrEqualTo=i.lte=function(r,o){return(o=ie(this,new S(r,o)))===-1||o===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function(r,o){var l,d,h,p,y=this,u=y.s;if(r=new S(r,o),o=r.s,!u||!o)return new S(NaN);if(u!=o)return r.s=-o,y.plus(r);var f=y.e/L,m=r.e/L,g=y.c,v=r.c;if(!f||!m){if(!g||!v)return g?(r.s=-o,r):new S(v?y:NaN);if(!g[0]||!v[0])return v[0]?(r.s=-o,r):new S(g[0]?y:c==3?-0:0)}if(f=Z(f),m=Z(m),g=g.slice(),u=f-m){for((p=u<0)?(u=-u,h=g):(m=f,h=v),h.reverse(),o=u;o--;h.push(0));h.reverse()}else for(d=(p=(u=g.length)<(o=v.length))?u:o,u=o=0;o<d;o++)if(g[o]!=v[o]){p=g[o]<v[o];break}if(p&&(h=g,g=v,v=h,r.s=-r.s),o=(d=v.length)-(l=g.length),o>0)for(;o--;g[l++]=0);for(o=K-1;d>u;){if(g[--d]<v[d]){for(l=d;l&&!g[--l];g[l]=o);--g[l],g[d]+=K}g[d]-=v[d]}for(;g[0]==0;g.splice(0,1),--m);return g[0]?_e(r,g,m):(r.s=c==3?-1:1,r.c=[r.e=0],r)},i.modulo=i.mod=function(r,o){var l,d,h=this;return r=new S(r,o),!h.c||!r.s||r.c&&!r.c[0]?new S(NaN):!r.c||h.c&&!h.c[0]?new S(h):(N==9?(d=r.s,r.s=1,l=e(h,r,0,3),r.s=d,l.s*=d):l=e(h,r,0,N),r=h.minus(l.times(r)),!r.c[0]&&N==1&&(r.s=h.s),r)},i.multipliedBy=i.times=function(r,o){var l,d,h,p,y,u,f,m,g,v,b,O,P,A,B,M=this,R=M.c,q=(r=new S(r,o)).c;if(!R||!q||!R[0]||!q[0])return!M.s||!r.s||R&&!R[0]&&!q||q&&!q[0]&&!R?r.c=r.e=r.s=null:(r.s*=M.s,!R||!q?r.c=r.e=null:(r.c=[0],r.e=0)),r;for(d=Z(M.e/L)+Z(r.e/L),r.s*=M.s,f=R.length,v=q.length,f<v&&(P=R,R=q,q=P,h=f,f=v,v=h),h=f+v,P=[];h--;P.push(0));for(A=K,B=ne,h=v;--h>=0;){for(l=0,b=q[h]%B,O=q[h]/B|0,y=f,p=h+y;p>h;)m=R[--y]%B,g=R[y]/B|0,u=O*m+g*b,m=b*m+u%B*B+P[p]+l,l=(m/A|0)+(u/B|0)+O*g,P[p--]=m%A;P[p]=l}return l?++d:P.splice(0,1),_e(r,P,d)},i.negated=function(){var r=new S(this);return r.s=-r.s||null,r},i.plus=function(r,o){var l,d=this,h=d.s;if(r=new S(r,o),o=r.s,!h||!o)return new S(NaN);if(h!=o)return r.s=-o,d.minus(r);var p=d.e/L,y=r.e/L,u=d.c,f=r.c;if(!p||!y){if(!u||!f)return new S(h/0);if(!u[0]||!f[0])return f[0]?r:new S(u[0]?d:h*0)}if(p=Z(p),y=Z(y),u=u.slice(),h=p-y){for(h>0?(y=p,l=f):(h=-h,l=u),l.reverse();h--;l.push(0));l.reverse()}for(h=u.length,o=f.length,h-o<0&&(l=f,f=u,u=l,o=h),h=0;o;)h=(u[--o]=u[o]+f[o]+h)/K|0,u[o]=K===u[o]?0:u[o]%K;return h&&(u=[h].concat(u),++y),_e(r,u,y)},i.precision=i.sd=function(r,o){var l,d,h,p=this;if(r!=null&&r!==!!r)return C(r,1,G),o==null?o=c:C(o,0,8),$(new S(p),r,o);if(!(l=p.c))return null;if(h=l.length-1,d=h*L+1,h=l[h]){for(;h%10==0;h/=10,d--);for(h=l[0];h>=10;h/=10,d++);}return r&&p.e+1>d&&(d=p.e+1),d},i.shiftedBy=function(r){return C(r,-Pe,Pe),this.times("1e"+r)},i.squareRoot=i.sqrt=function(){var r,o,l,d,h,p=this,y=p.c,u=p.s,f=p.e,m=x+4,g=new S("0.5");if(u!==1||!y||!y[0])return new S(!u||u<0&&(!y||y[0])?NaN:y?p:1/0);if(u=Math.sqrt(+Q(p)),u==0||u==1/0?(o=j(y),(o.length+f)%2==0&&(o+="0"),u=Math.sqrt(+o),f=Z((f+1)/2)-(f<0||f%2),u==1/0?o="5e"+f:(o=u.toExponential(),o=o.slice(0,o.indexOf("e")+1)+f),l=new S(o)):l=new S(u+""),l.c[0]){for(f=l.e,u=f+m,u<3&&(u=0);;)if(h=l,l=g.times(h.plus(e(p,h,m,1))),j(h.c).slice(0,u)===(o=j(l.c)).slice(0,u))if(l.e<f&&--u,o=o.slice(u-3,u+1),o=="9999"||!d&&o=="4999"){if(!d&&($(h,h.e+x+2,0),h.times(h).eq(p))){l=h;break}m+=4,u+=4,d=1}else{(!+o||!+o.slice(1)&&o.charAt(0)=="5")&&($(l,l.e+x+2,1),r=!l.times(l).eq(p));break}}return $(l,l.e+x+1,c,r)},i.toExponential=function(r,o){return r!=null&&(C(r,0,G),r++),Se(this,r,o,1)},i.toFixed=function(r,o){return r!=null&&(C(r,0,G),r=r+this.e+1),Se(this,r,o)},i.toFormat=function(r,o,l){var d,h=this;if(l==null)r!=null&&o&&typeof o=="object"?(l=o,o=null):r&&typeof r=="object"?(l=r,r=o=null):l=z;else if(typeof l!="object")throw Error(U+"Argument not an object: "+l);if(d=h.toFixed(r,o),h.c){var p,y=d.split("."),u=+l.groupSize,f=+l.secondaryGroupSize,m=l.groupSeparator||"",g=y[0],v=y[1],b=h.s<0,O=b?g.slice(1):g,P=O.length;if(f&&(p=u,u=f,f=p,P-=p),u>0&&P>0){for(p=P%u||u,g=O.substr(0,p);p<P;p+=u)g+=m+O.substr(p,u);f>0&&(g+=m+O.slice(p)),b&&(g="-"+g)}d=v?g+(l.decimalSeparator||"")+((f=+l.fractionGroupSize)?v.replace(new RegExp("\\d{"+f+"}\\B","g"),"$&"+(l.fractionGroupSeparator||"")):v):g}return(l.prefix||"")+d+(l.suffix||"")},i.toFraction=function(r){var o,l,d,h,p,y,u,f,m,g,v,b,O=this,P=O.c;if(r!=null&&(u=new S(r),!u.isInteger()&&(u.c||u.s!==1)||u.lt(a)))throw Error(U+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+Q(u));if(!P)return new S(O);for(o=new S(a),m=l=new S(a),d=f=new S(a),b=j(P),p=o.e=b.length-O.e-1,o.c[0]=Re[(y=p%L)<0?L+y:y],r=!r||u.comparedTo(o)>0?p>0?o:m:u,y=_,_=1/0,u=new S(b),f.c[0]=0;g=e(u,o,0,1),h=l.plus(g.times(d)),h.comparedTo(r)!=1;)l=d,d=h,m=f.plus(g.times(h=m)),f=h,o=u.minus(g.times(h=o)),u=h;return h=e(r.minus(l),d,0,1),f=f.plus(h.times(m)),l=l.plus(h.times(d)),f.s=m.s=O.s,p=p*2,v=e(m,d,p,c).minus(O).abs().comparedTo(e(f,l,p,c).minus(O).abs())<1?[m,d]:[f,l],_=y,v},i.toNumber=function(){return+Q(this)},i.toPrecision=function(r,o){return r!=null&&C(r,1,G),Se(this,r,o,2)},i.toString=function(r){var o,l=this,d=l.s,h=l.e;return h===null?d?(o="Infinity",d<0&&(o="-"+o)):o="NaN":(r==null?o=h<=E||h>=w?ge(j(l.c),h):ee(j(l.c),h,"0"):r===10&&ve?(l=$(new S(l),x+h+1,c),o=ee(j(l.c),l.e,"0")):(C(r,2,k.length,"Base"),o=t(ee(j(l.c),h,"0"),10,r,d,!0)),d<0&&l.c[0]&&(o="-"+o)),o},i.valueOf=i.toJSON=function(){return Q(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,n!=null&&S.set(n),S}function Z(n){var e=n|0;return n>0||n===e?e:e-1}function j(n){for(var e,t,s=1,i=n.length,a=n[0]+"";s<i;){for(e=n[s++]+"",t=L-e.length;t--;e="0"+e);a+=e}for(i=a.length;a.charCodeAt(--i)===48;);return a.slice(0,i+1||1)}function ie(n,e){var t,s,i=n.c,a=e.c,x=n.s,c=e.s,E=n.e,w=e.e;if(!x||!c)return null;if(t=i&&!i[0],s=a&&!a[0],t||s)return t?s?0:-c:x;if(x!=c)return x;if(t=x<0,s=E==w,!i||!a)return s?0:!i^t?1:-1;if(!s)return E>w^t?1:-1;for(c=(E=i.length)<(w=a.length)?E:w,x=0;x<c;x++)if(i[x]!=a[x])return i[x]>a[x]^t?1:-1;return E==w?0:E>w^t?1:-1}function C(n,e,t,s){if(n<e||n>t||n!==X(n))throw Error(U+(s||"Argument")+(typeof n=="number"?n<e||n>t?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function pe(n){var e=n.c.length-1;return Z(n.e/L)==e&&n.c[e]%2!=0}function ge(n,e){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(e<0?"e":"e+")+e}function ee(n,e,t){var s,i;if(e<0){for(i=t+".";++e;i+=t);n=i+n}else if(s=n.length,++e>s){for(i=t,e-=s;--e;i+=t);n+=i}else e<s&&(n=n.slice(0,e)+"."+n.slice(e));return n}var W=lt(),nn=class{key;left=null;right=null;constructor(n){this.key=n}},oe=class extends nn{constructor(n){super(n)}},rn=class{size=0;modificationCount=0;splayCount=0;splay(n){const e=this.root;if(e==null)return this.compare(n,n),-1;let t=null,s=null,i=null,a=null,x=e;const c=this.compare;let E;for(;;)if(E=c(x.key,n),E>0){let w=x.left;if(w==null||(E=c(w.key,n),E>0&&(x.left=w.right,w.right=x,x=w,w=x.left,w==null)))break;t==null?s=x:t.left=x,t=x,x=w}else if(E<0){let w=x.right;if(w==null||(E=c(w.key,n),E<0&&(x.right=w.left,w.left=x,x=w,w=x.right,w==null)))break;i==null?a=x:i.right=x,i=x,x=w}else break;return i!=null&&(i.right=x.left,x.left=a),t!=null&&(t.left=x.right,x.right=s),this.root!==x&&(this.root=x,this.splayCount++),E}splayMin(n){let e=n,t=e.left;for(;t!=null;){const s=t;e.left=s.right,s.right=e,e=s,t=e.left}return e}splayMax(n){let e=n,t=e.right;for(;t!=null;){const s=t;e.right=s.left,s.left=e,e=s,t=e.right}return e}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let t=this.root;const s=t,i=t.left;if(this.size--,i==null)this.root=t.right;else{const a=t.right;t=this.splayMax(i),t.right=a,this.root=t}return this.modificationCount++,s}addNewRoot(n,e){this.size++,this.modificationCount++;const t=this.root;if(t==null){this.root=n;return}e<0?(n.left=t,n.right=t.right,t.right=null):(n.right=t,n.left=t.left,t.left=null),this.root=n}_first(){const n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){const n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,e)=>n<e?-1:n>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}},ye=class ue extends rn{root=null;compare;validKey;constructor(e,t){super(),this.compare=e??this.defaultCompare(),this.validKey=t??(s=>s!=null&&s!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const t of e)this.delete(t)}forEach(e){const t=this[Symbol.iterator]();let s;for(;s=t.next(),!s.done;)e(s.value,s.value,this)}add(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new oe(e),t),this}addAndReturn(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new oe(e),t),this.root.key}addAll(e){for(const t of e)this.add(t)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let s=this.root.left;if(s==null)return null;let i=s.right;for(;i!=null;)s=i,i=s.right;return s.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let s=this.root.right;if(s==null)return null;let i=s.left;for(;i!=null;)s=i,i=s.left;return s.key}retainAll(e){const t=new ue(this.compare,this.validKey),s=this.modificationCount;for(const i of e){if(s!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(i)&&this.splay(i)==0&&t.add(this.root.key)}t.size!=this.size&&(this.root=t.root,this.size=t.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const t=new ue(this.compare,this.validKey);for(const s of this)e.has(s)&&t.add(s);return t}difference(e){const t=new ue(this.compare,this.validKey);for(const s of this)e.has(s)||t.add(s);return t}union(e){const t=this.clone();return t.addAll(e),t}clone(){const e=new ue(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function t(i,a){let x,c;do{if(x=i.left,c=i.right,x!=null){const E=new oe(x.key);a.left=E,t(x,E)}if(c!=null){const E=new oe(c.key);a.right=E,i=c,a=E}}while(c!=null)}const s=new oe(e.key);return t(e,s),s}toSet(){return this.clone()}entries(){return new on(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new sn(this.wrap())}[Symbol.toStringTag]="[object Set]"},ut=class{tree;path=new Array;modificationCount=null;splayCount;constructor(n){this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let t=this.tree.getRoot();for(;t!=null;)this.path.push(t),t=t.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],e=n.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},sn=class extends ut{getValue(n){return n.key}},on=class extends ut{getValue(n){return[n.key,n.key]}},at=n=>()=>n,Fe=n=>{const e=n?(t,s)=>s.minus(t).abs().isLessThanOrEqualTo(n):at(!1);return(t,s)=>e(t,s)?0:t.comparedTo(s)};function ln(n){const e=n?(t,s,i,a,x)=>t.exponentiatedBy(2).isLessThanOrEqualTo(a.minus(s).exponentiatedBy(2).plus(x.minus(i).exponentiatedBy(2)).times(n)):at(!1);return(t,s,i)=>{const a=t.x,x=t.y,c=i.x,E=i.y,w=x.minus(E).times(s.x.minus(c)).minus(a.minus(c).times(s.y.minus(E)));return e(w,a,x,c,E)?0:w.comparedTo(0)}}var un=n=>n,an=n=>{if(n){const e=new ye(Fe(n)),t=new ye(Fe(n)),s=(a,x)=>x.addAndReturn(a),i=a=>({x:s(a.x,e),y:s(a.y,t)});return i({x:new W(0),y:new W(0)}),i}return un},Be=n=>({set:e=>{te=Be(e)},reset:()=>Be(n),compare:Fe(n),snap:an(n),orient:ln(n)}),te=Be(),le=(n,e)=>n.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(n.ur.y),Ge=(n,e)=>{if(e.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(e.ll.y))return null;const t=n.ll.x.isLessThan(e.ll.x)?e.ll.x:n.ll.x,s=n.ur.x.isLessThan(e.ur.x)?n.ur.x:e.ur.x,i=n.ll.y.isLessThan(e.ll.y)?e.ll.y:n.ll.y,a=n.ur.y.isLessThan(e.ur.y)?n.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:s,y:a}}},xe=(n,e)=>n.x.times(e.y).minus(n.y.times(e.x)),ht=(n,e)=>n.x.times(e.x).plus(n.y.times(e.y)),we=n=>ht(n,n).sqrt(),hn=(n,e,t)=>{const s={x:e.x.minus(n.x),y:e.y.minus(n.y)},i={x:t.x.minus(n.x),y:t.y.minus(n.y)};return xe(i,s).div(we(i)).div(we(s))},cn=(n,e,t)=>{const s={x:e.x.minus(n.x),y:e.y.minus(n.y)},i={x:t.x.minus(n.x),y:t.y.minus(n.y)};return ht(i,s).div(we(i)).div(we(s))},We=(n,e,t)=>e.y.isZero()?null:{x:n.x.plus(e.x.div(e.y).times(t.minus(n.y))),y:t},Qe=(n,e,t)=>e.x.isZero()?null:{x:t,y:n.y.plus(e.y.div(e.x).times(t.minus(n.x)))},fn=(n,e,t,s)=>{if(e.x.isZero())return Qe(t,s,n.x);if(s.x.isZero())return Qe(n,e,t.x);if(e.y.isZero())return We(t,s,n.y);if(s.y.isZero())return We(n,e,t.y);const i=xe(e,s);if(i.isZero())return null;const a={x:t.x.minus(n.x),y:t.y.minus(n.y)},x=xe(a,e).div(i),c=xe(a,s).div(i),E=n.x.plus(c.times(e.x)),w=t.x.plus(x.times(s.x)),T=n.y.plus(c.times(e.y)),_=t.y.plus(x.times(s.y)),I=E.plus(w).div(2),N=T.plus(_).div(2);return{x:I,y:N}},J=class ct{point;isLeft;segment;otherSE;consumedBy;static compare(e,t){const s=ct.comparePoints(e.point,t.point);return s!==0?s:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Ee.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let s=0,i=t.length;s<i;s++){const a=t[s];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const s=this.point.events[t];if(s.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){const a=this.point.events[i];a.consumedBy===void 0&&s.otherSE.point.events===a.otherSE.point.events&&s.segment.consume(a.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,s=this.point.events.length;t<s;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const t=new Map,s=i=>{const a=i.otherSE;t.set(i,{sine:hn(this.point,e.point,a.point),cosine:cn(this.point,e.point,a.point)})};return(i,a)=>{t.has(i)||s(i),t.has(a)||s(a);const{sine:x,cosine:c}=t.get(i),{sine:E,cosine:w}=t.get(a);return x.isGreaterThanOrEqualTo(0)&&E.isGreaterThanOrEqualTo(0)?c.isLessThan(w)?1:c.isGreaterThan(w)?-1:0:x.isLessThan(0)&&E.isLessThan(0)?c.isLessThan(w)?-1:c.isGreaterThan(w)?1:0:E.isLessThan(x)?-1:E.isGreaterThan(x)?1:0}}},pn=class ke{events;poly;_isExteriorRing;_enclosingRing;static factory(e){const t=[];for(let s=0,i=e.length;s<i;s++){const a=e[s];if(!a.isInResult()||a.ringOut)continue;let x=null,c=a.leftSE,E=a.rightSE;const w=[c],T=c.point,_=[];for(;x=c,c=E,w.push(c),c.point!==T;)for(;;){const I=c.getAvailableLinkedEvents();if(I.length===0){const z=w[0].point,k=w[w.length-1].point;throw new Error(`Unable to complete output ring starting at [${z.x}, ${z.y}]. Last matching segment found ends at [${k.x}, ${k.y}].`)}if(I.length===1){E=I[0].otherSE;break}let N=null;for(let z=0,k=_.length;z<k;z++)if(_[z].point===c.point){N=z;break}if(N!==null){const z=_.splice(N)[0],k=w.splice(z.index);k.unshift(k[0].otherSE),t.push(new ke(k.reverse()));continue}_.push({index:w.length,point:c.point});const D=c.getLeftmostComparator(x);E=I.sort(D)[0].otherSE;break}t.push(new ke(w))}return t}constructor(e){this.events=e;for(let t=0,s=e.length;t<s;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let w=1,T=this.events.length-1;w<T;w++){const _=this.events[w].point,I=this.events[w+1].point;te.orient(_,e,I)!==0&&(t.push(_),e=_)}if(t.length===1)return null;const s=t[0],i=t[1];te.orient(s,e,i)===0&&t.shift(),t.push(t[0]);const a=this.isExteriorRing()?1:-1,x=this.isExteriorRing()?0:t.length-1,c=this.isExteriorRing()?t.length:-1,E=[];for(let w=x;w!=c;w+=a)E.push([t[w].x.toNumber(),t[w].y.toNumber()]);return E}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let i=1,a=this.events.length;i<a;i++){const x=this.events[i];J.compare(e,x)>0&&(e=x)}let t=e.segment.prevInResult(),s=t?t.prevInResult():null;for(;;){if(!t)return null;if(!s)return t.ringOut;if(s.ringOut!==t.ringOut)return s.ringOut?.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut?.enclosingRing();t=s.prevInResult(),s=t?t.prevInResult():null}}},et=class{exteriorRing;interiorRings;constructor(n){this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){const n=this.exteriorRing.getGeom();if(n===null)return null;const e=[n];for(let t=0,s=this.interiorRings.length;t<s;t++){const i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}},gn=class{rings;polys;constructor(n){this.rings=n,this.polys=this._composePolys(n)}getGeom(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const s=this.polys[e].getGeom();s!==null&&n.push(s)}return n}_composePolys(n){const e=[];for(let t=0,s=n.length;t<s;t++){const i=n[t];if(!i.poly)if(i.isExteriorRing())e.push(new et(i));else{const a=i.enclosingRing();a?.poly||e.push(new et(a)),a?.poly?.addInterior(i)}}return e}},dn=class{queue;tree;segments;constructor(n,e=Ee.compare){this.queue=n,this.tree=new ye(e),this.segments=[]}process(n){const e=n.segment,t=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(e),t;n.isLeft&&this.tree.add(e);let s=e,i=e;do s=this.tree.lastBefore(s);while(s!=null&&s.consumedBy!=null);do i=this.tree.firstAfter(i);while(i!=null&&i.consumedBy!=null);if(n.isLeft){let a=null;if(s){const c=s.getIntersection(e);if(c!==null&&(e.isAnEndpoint(c)||(a=c),!s.isAnEndpoint(c))){const E=this._splitSafely(s,c);for(let w=0,T=E.length;w<T;w++)t.push(E[w])}}let x=null;if(i){const c=i.getIntersection(e);if(c!==null&&(e.isAnEndpoint(c)||(x=c),!i.isAnEndpoint(c))){const E=this._splitSafely(i,c);for(let w=0,T=E.length;w<T;w++)t.push(E[w])}}if(a!==null||x!==null){let c=null;a===null?c=x:x===null?c=a:c=J.comparePoints(a,x)<=0?a:x,this.queue.delete(e.rightSE),t.push(e.rightSE);const E=e.split(c);for(let w=0,T=E.length;w<T;w++)t.push(E[w])}t.length>0?(this.tree.delete(e),t.push(n)):(this.segments.push(e),e.prev=s)}else{if(s&&i){const a=s.getIntersection(i);if(a!==null){if(!s.isAnEndpoint(a)){const x=this._splitSafely(s,a);for(let c=0,E=x.length;c<E;c++)t.push(x[c])}if(!i.isAnEndpoint(a)){const x=this._splitSafely(i,a);for(let c=0,E=x.length;c<E;c++)t.push(x[c])}}}this.tree.delete(e)}return t}_splitSafely(n,e){this.tree.delete(n);const t=n.rightSE;this.queue.delete(t);const s=n.split(e);return s.push(t),n.consumedBy===void 0&&this.tree.add(n),s}},xn=class{type;numMultiPolys;run(n,e,t){ae.type=n;const s=[new nt(e,!0)];for(let w=0,T=t.length;w<T;w++)s.push(new nt(t[w],!1));if(ae.numMultiPolys=s.length,ae.type==="difference"){const w=s[0];let T=1;for(;T<s.length;)Ge(s[T].bbox,w.bbox)!==null?T++:s.splice(T,1)}if(ae.type==="intersection")for(let w=0,T=s.length;w<T;w++){const _=s[w];for(let I=w+1,N=s.length;I<N;I++)if(Ge(_.bbox,s[I].bbox)===null)return[]}const i=new ye(J.compare);for(let w=0,T=s.length;w<T;w++){const _=s[w].getSweepEvents();for(let I=0,N=_.length;I<N;I++)i.add(_[I])}const a=new dn(i);let x=null;for(i.size!=0&&(x=i.first(),i.delete(x));x;){const w=a.process(x);for(let T=0,_=w.length;T<_;T++){const I=w[T];I.consumedBy===void 0&&i.add(I)}i.size!=0?(x=i.first(),i.delete(x)):x=null}te.reset();const c=pn.factory(a.segments);return new gn(c).getGeom()}},ae=new xn,re=ae,mn=0,Ee=class me{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(e,t){const s=e.leftSE.point.x,i=t.leftSE.point.x,a=e.rightSE.point.x,x=t.rightSE.point.x;if(x.isLessThan(s))return 1;if(a.isLessThan(i))return-1;const c=e.leftSE.point.y,E=t.leftSE.point.y,w=e.rightSE.point.y,T=t.rightSE.point.y;if(s.isLessThan(i)){if(E.isLessThan(c)&&E.isLessThan(w))return 1;if(E.isGreaterThan(c)&&E.isGreaterThan(w))return-1;const _=e.comparePoint(t.leftSE.point);if(_<0)return 1;if(_>0)return-1;const I=t.comparePoint(e.rightSE.point);return I!==0?I:-1}if(s.isGreaterThan(i)){if(c.isLessThan(E)&&c.isLessThan(T))return-1;if(c.isGreaterThan(E)&&c.isGreaterThan(T))return 1;const _=t.comparePoint(e.leftSE.point);if(_!==0)return _;const I=e.comparePoint(t.rightSE.point);return I<0?1:I>0?-1:1}if(c.isLessThan(E))return-1;if(c.isGreaterThan(E))return 1;if(a.isLessThan(x)){const _=t.comparePoint(e.rightSE.point);if(_!==0)return _}if(a.isGreaterThan(x)){const _=e.comparePoint(t.rightSE.point);if(_<0)return 1;if(_>0)return-1}if(!a.eq(x)){const _=w.minus(c),I=a.minus(s),N=T.minus(E),D=x.minus(i);if(_.isGreaterThan(I)&&N.isLessThan(D))return 1;if(_.isLessThan(I)&&N.isGreaterThan(D))return-1}return a.isGreaterThan(x)?1:a.isLessThan(x)||w.isLessThan(T)?-1:w.isGreaterThan(T)?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,s,i){this.id=++mn,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=s,this.windings=i}static fromRing(e,t,s){let i,a,x;const c=J.comparePoints(e,t);if(c<0)i=e,a=t,x=1;else if(c>0)i=t,a=e,x=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const E=new J(i,!0),w=new J(a,!1);return new me(E,w,[s],[x])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return te.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const t=this.bbox(),s=e.bbox(),i=Ge(t,s);if(i===null)return null;const a=this.leftSE.point,x=this.rightSE.point,c=e.leftSE.point,E=e.rightSE.point,w=le(t,c)&&this.comparePoint(c)===0,T=le(s,a)&&e.comparePoint(a)===0,_=le(t,E)&&this.comparePoint(E)===0,I=le(s,x)&&e.comparePoint(x)===0;if(T&&w)return I&&!_?x:!I&&_?E:null;if(T)return _&&a.x.eq(E.x)&&a.y.eq(E.y)?null:a;if(w)return I&&x.x.eq(c.x)&&x.y.eq(c.y)?null:c;if(I&&_)return null;if(I)return x;if(_)return E;const N=fn(a,this.vector(),c,e.vector());return N===null||!le(i,N)?null:te.snap(N)}split(e){const t=[],s=e.events!==void 0,i=new J(e,!0),a=new J(e,!1),x=this.rightSE;this.replaceRightSE(a),t.push(a),t.push(i);const c=new me(i,x,this.rings.slice(),this.windings.slice());return J.comparePoints(c.leftSE.point,c.rightSE.point)>0&&c.swapEvents(),J.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),s&&(i.checkForConsuming(),a.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,s=this.windings.length;t<s;t++)this.windings[t]*=-1}consume(e){let t=this,s=e;for(;t.consumedBy;)t=t.consumedBy;for(;s.consumedBy;)s=s.consumedBy;const i=me.compare(t,s);if(i!==0){if(i>0){const a=t;t=s,s=a}if(t.prev===s){const a=t;t=s,s=a}for(let a=0,x=s.rings.length;a<x;a++){const c=s.rings[a],E=s.windings[a],w=t.rings.indexOf(c);w===-1?(t.rings.push(c),t.windings.push(E)):t.windings[w]+=E}s.rings=null,s.windings=null,s.consumedBy=t,s.leftSE.consumedBy=t.leftSE,s.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,s=this._afterState.windings,i=this._afterState.multiPolys;for(let c=0,E=this.rings.length;c<E;c++){const w=this.rings[c],T=this.windings[c],_=t.indexOf(w);_===-1?(t.push(w),s.push(T)):s[_]+=T}const a=[],x=[];for(let c=0,E=t.length;c<E;c++){if(s[c]===0)continue;const w=t[c],T=w.poly;if(x.indexOf(T)===-1)if(w.isExterior)a.push(T);else{x.indexOf(T)===-1&&x.push(T);const _=a.indexOf(w.poly);_!==-1&&a.splice(_,1)}}for(let c=0,E=a.length;c<E;c++){const w=a[c].multiPoly;i.indexOf(w)===-1&&i.push(w)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(re.type){case"union":{const s=e.length===0,i=t.length===0;this._isInResult=s!==i;break}case"intersection":{let s,i;e.length<t.length?(s=e.length,i=t.length):(s=t.length,i=e.length),this._isInResult=i===re.numMultiPolys&&s<i;break}case"xor":{const s=Math.abs(e.length-t.length);this._isInResult=s%2===1;break}case"difference":{const s=i=>i.length===1&&i[0].isSubject;this._isInResult=s(e)!==s(t);break}}return this._isInResult}},tt=class{poly;isExterior;segments;bbox;constructor(n,e,t){if(!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=t,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const s=te.snap({x:new W(n[0][0]),y:new W(n[0][1])});this.bbox={ll:{x:s.x,y:s.y},ur:{x:s.x,y:s.y}};let i=s;for(let a=1,x=n.length;a<x;a++){if(typeof n[a][0]!="number"||typeof n[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const c=te.snap({x:new W(n[a][0]),y:new W(n[a][1])});c.x.eq(i.x)&&c.y.eq(i.y)||(this.segments.push(Ee.fromRing(i,c,this)),c.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.x),c.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.y),c.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.x),c.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.y),i=c)}(!s.x.eq(i.x)||!s.y.eq(i.y))&&this.segments.push(Ee.fromRing(i,s,this))}getSweepEvents(){const n=[];for(let e=0,t=this.segments.length;e<t;e++){const s=this.segments[e];n.push(s.leftSE),n.push(s.rightSE)}return n}},yn=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new tt(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,s=n.length;t<s;t++){const i=new tt(n[t],this,!1);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=e}getSweepEvents(){const n=this.exteriorRing.getSweepEvents();for(let e=0,t=this.interiorRings.length;e<t;e++){const s=this.interiorRings[e].getSweepEvents();for(let i=0,a=s.length;i<a;i++)n.push(s[i])}return n}},nt=class{isSubject;polys;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new W(Number.POSITIVE_INFINITY),y:new W(Number.POSITIVE_INFINITY)},ur:{x:new W(Number.NEGATIVE_INFINITY),y:new W(Number.NEGATIVE_INFINITY)}};for(let t=0,s=n.length;t<s;t++){const i=new yn(n[t],this);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=e}getSweepEvents(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const s=this.polys[e].getSweepEvents();for(let i=0,a=s.length;i<a;i++)n.push(s[i])}return n}},ce=(n,...e)=>re.run("union",n,e),wn=(n,...e)=>re.run("intersection",n,e),En=(n,...e)=>re.run("xor",n,e),vn=(n,...e)=>re.run("difference",n,e),Sn=te.set;const _n=Object.freeze(Object.defineProperty({__proto__:null,difference:vn,intersection:wn,setPrecision:Sn,union:ce,xor:En},Symbol.toStringTag,{value:"Module"}));function bn(n){if(!n)throw new Error("geojson is required");switch(n.type){case"Feature":return ft(n);case"FeatureCollection":return Tn(n);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Ue(n);default:throw new Error("unknown GeoJSON type")}}function ft(n){const e={type:"Feature"};return Object.keys(n).forEach(t=>{switch(t){case"type":case"properties":case"geometry":return;default:e[t]=n[t]}}),e.properties=pt(n.properties),n.geometry==null?e.geometry=null:e.geometry=Ue(n.geometry),e}function pt(n){const e={};return n&&Object.keys(n).forEach(t=>{const s=n[t];typeof s=="object"?s===null?e[t]=null:Array.isArray(s)?e[t]=s.map(i=>i):e[t]=pt(s):e[t]=s}),e}function Tn(n){const e={type:"FeatureCollection"};return Object.keys(n).forEach(t=>{switch(t){case"type":case"features":return;default:e[t]=n[t]}}),e.features=n.features.map(t=>ft(t)),e}function Ue(n){const e={type:n.type};return n.bbox&&(e.bbox=n.bbox),n.type==="GeometryCollection"?(e.geometries=n.geometries.map(t=>Ue(t)),e):(e.coordinates=gt(n.coordinates),e)}function gt(n){const e=n;return typeof e[0]!="object"?e.slice():e.map(t=>gt(t))}function On(n,e,t){var s;const i=(s=t?.mutate)!=null?s:!1;let a=e;e&&i===!1&&(a=bn(e));const x=Ln(a);let c=null;return n.type==="FeatureCollection"?c=In(n):n.type==="Feature"?c=qe(ce(n.geometry.coordinates)):c=qe(ce(n.coordinates)),c.geometry.coordinates.forEach(function(E){x.geometry.coordinates.push(E[0])}),x}function In(n){const e=n.features.length===2?ce(n.features[0].geometry.coordinates,n.features[1].geometry.coordinates):ce.apply(_n,n.features.map(function(t){return t.geometry.coordinates}));return qe(e)}function qe(n){return en(n)}function Ln(n){let t=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]];return n&&(n.type==="Feature"?t=n.geometry.coordinates:t=n.coordinates),Qt(t)}var Mn=On;const Pn={name:"MapSelect",components:{LayerControl:Pt,TextControl:Mt,UserLocationControl:Ht},mixins:[Lt],props:{stac:{type:Object,default:null},value:{type:Array,default:null}},emits:["input"],data(){return{crs:"EPSG:4326",extent:this.value,dragging:!1}},computed:{...mt(["uiLanguage"]),projectedExtent(){return this.extent?Le(this.extent,this.crs,this.map.getView().getProjection()):null},help(){return this.extent?this.$t("mapping.bboxSelect.remove"):this.$t("mapping.bboxSelect.add")}},watch:{async stac(){await this.initMap()},uiLanguage(){}},async mounted(){await this.initMap()},methods:{async initMap(){this.map=null,await this.createMap(this.$refs.map,this.stac,!0);const n=t=>{if(t.type==="singleclick")if(this.extent)Ft(this.projectedExtent,...t.coordinate)&&(this.interaction.setExtent(null),this.interaction.vertexOverlay_.getSource().clear(),this.interaction.vertexFeature_=null);else{let s=this.map.getSize().map(c=>c*.2),i=this.map.getView().calculateExtent(s),a=[i[2]-i[0],i[3]-i[1]],x=[t.coordinate[0]-a[0],t.coordinate[1]-a[1],t.coordinate[0]+a[0],t.coordinate[1]+a[1]];return this.interaction.setExtent(x),!1}else if(this.interaction.handlingDownUpSequence||this.interaction.snapToVertex_(t.pixel,t.map))return!0;return Bt(t)};this.interaction=new Zt({extent:this.projectedExtent,condition:n,boxStyle:At()}),this.interaction.on("extentchanged",this.update),this.map.addInteraction(this.interaction),this.stac&&this.addMask(this.stac);let e;if(this.projectedExtent)e=this.projectedExtent;else if(this.stac){const t=this.stac.getBoundingBox();t&&(e=Le(t,this.crs,this.map.getView().getProjection()))}e&&this.map.getView().fit(e,{padding:[50,50,50,50],maxZoom:this.maxZoom})},addMask(n){if(!n||typeof n.toGeoJSON!="function")return;const e=n.toGeoJSON();if(!e)return;const t=Gt([-180,-90,180,90]),s=Mn(e,t),i=new Rt().readFeatures(s,{featureProjection:this.map.getView().getProjection()}),a=new Ne({source:new Ce({features:i}),style:new Nt({fill:new Ct({color:"rgba(0, 0, 0, 0.5)"})})});this.map.addLayer(a)},fixX(n){return(n+180)%360-180},fixY(n){return Math.max(-90,Math.min(90,n))},update(n){if(n.extent){this.extent=Le(n.extent,this.map.getView().getProjection(),this.crs);const e=[this.fixX(this.extent[0]),this.fixY(this.extent[1]),this.fixX(this.extent[2]),this.fixY(this.extent[3])];this.$emit("input",e)}else this.extent=null,this.$emit("input",null)}}},Rn={class:"map-container"},Nn={ref:"map",class:"map"};function Cn(n,e,t,s,i,a){const x=Oe("TextControl"),c=Oe("UserLocationControl"),E=Oe("LayerControl");return De(),Ve("div",Rn,[he("div",Nn,[de(x,{text:a.help,map:n.map},null,8,["text","map"]),e[0]||(e[0]=$e()),de(c,{map:n.map,maxZoom:n.maxZoom},null,8,["map","maxZoom"]),e[1]||(e[1]=$e()),de(E,{map:n.map,maxZoom:n.maxZoom},null,8,["map","maxZoom"])],512)])}const Un=it(Pn,[["render",Cn]]);export{Un as default};
//# sourceMappingURL=MapSelect-DSut9IxG.js.map
