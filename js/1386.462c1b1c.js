"use strict";(self["webpackChunk_radiantearth_stac_browser"]=self["webpackChunk_radiantearth_stac_browser"]||[]).push([[107,1386,3820,8807],{19551:function(t,e,i){i.r(e);var r=i(70915),s=i(77076),n=i(38599),a=i(4863),o=i(42654),l=i(28512);class h extends l["default"]{constructor(t){if(super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:(0,n.Jt)("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,zDirection:t.zDirection}),this.tileJSON_=null,this.tileSize_=t.tileSize,t.url)if(t.jsonp)(0,s.FQ)(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",t.url),e.send()}else{if(!t.tileJSON)throw new Error("Either `url` or `tileJSON` options must be provided");this.handleTileJSONResponse(t.tileJSON)}}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let t;try{t=JSON.parse(e.responseText)}catch{return void this.handleTileJSONError()}this.handleTileJSONResponse(t)}else this.handleTileJSONError()}onXHRError_(t){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(t){const e=(0,n.Jt)("EPSG:4326"),i=this.getProjection();let s;if(void 0!==t["bounds"]){const a=(0,n.FO)(e,i);s=(0,r.NW)(t["bounds"],a)}const l=(0,a.kZ)(i),h=t["minzoom"]||0,c=t["maxzoom"]||22,u=(0,a.EN)({extent:l,maxZoom:c,minZoom:h,tileSize:this.tileSize_});if(this.tileGrid=u,this.tileUrlFunction=(0,o.Qz)(t["tiles"],u),t["attribution"]&&!this.getAttributions()){const e=void 0!==s?s:l;this.setAttributions(function(i){return(0,r.HY)(e,i.extent)?[t["attribution"]]:null})}this.tileJSON_=t,this.setState("ready")}handleTileJSONError(){this.setState("error")}}e["default"]=h},30945:function(t,e,i){i.r(e);var r=i(24029),s=i(22808);class n extends s["default"]{constructor(t){super(t)}createRenderer(){return new r.A(this,{cacheSize:this.getCacheSize()})}}e["default"]=n},31386:function(t,e,i){i.r(e),i.d(e,{default:function(){return vs}});i(18111),i(61701);var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"map-container"},[e("div",{ref:"map",staticClass:"map",attrs:{id:t.mapId}},[e("LayerControl",{attrs:{map:t.map}}),t.empty?e("TextControl",{attrs:{map:t.map,text:t.$t("mapping.nodata")}}):t.hasBasemap?t._e():e("TextControl",{attrs:{map:t.map,text:t.$t("mapping.nobasemap")}})],1),e("div",{ref:"target",staticClass:"popover-target"}),t.popover&&t.selectedItems?e("b-popover",{attrs:{show:"",placement:"auto",triggers:"manual",target:t.selectedItems.target,container:t.container}},[e("section",{staticClass:"popover-items"},[e("Items",{attrs:{stac:t.stac,items:t.selectedItems.items}})],1),e("div",{staticClass:"text-center"},[e("b-button",{attrs:{target:"_blank",variant:"danger"},on:{click:t.resetSelectedItems}},[t._v(t._s(t.$t("mapping.close")))])],1)]):t._e()],1)},s=[],n=i(39665),a=i(79743),o=i(82209),l=i(95353),h=i(30278),c=i(50071),u=i(32135),d=i(86717),f=i(66514),p=i(1685),g=i(58704),m=i(74238),y=i(82986),w=i(43530),v=i(29276),_=i(4087),b=i(71603);const x={SELECT:"select"};class S extends p.Ay{constructor(t,e,i,r){super(t),this.selected=e,this.deselected=i,this.mapBrowserEvent=r}}const T={};class E extends b.Ay{constructor(t){let e;if(super(),this.on,this.once,this.un,t=t||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=t.condition?t.condition:g.t5,this.addCondition_=t.addCondition?t.addCondition:g.Zm,this.removeCondition_=t.removeCondition?t.removeCondition:g.Zm,this.toggleCondition_=t.toggleCondition?t.toggleCondition:g.Kg,this.multi_=!!t.multi&&t.multi,this.filter_=t.filter?t.filter:m.rT,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0,this.style_=void 0!==t.style?t.style:F(),this.features_=t.features||new c.A,t.layers)if("function"===typeof t.layers)e=t.layers;else{const i=t.layers;e=function(t){return i.includes(t)}}else e=m.rT;this.layerFilter_=e,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(t,e){this.featureLayerAssociation_[(0,_.v6)(t)]=e}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(t){return this.featureLayerAssociation_[(0,_.v6)(t)]}setHitTolerance(t){this.hitTolerance_=t}setMap(t){const e=this.getMap();e&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(t),t?(this.features_.addEventListener(u.A.ADD,this.boundAddFeature_),this.features_.addEventListener(u.A.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(u.A.ADD,this.boundAddFeature_),this.features_.removeEventListener(u.A.REMOVE,this.boundRemoveFeature_))}addFeature_(t){const e=t.element;if(this.style_&&this.applySelectedStyle_(e),!this.getLayer(e)){const t=this.getMap().getAllLayers().find(function(t){if(t instanceof y["default"]&&t.getSource()&&t.getSource().hasFeature(e))return t});t&&this.addFeatureLayerAssociation_(e,t)}}removeFeature_(t){this.style_&&this.restorePreviousStyle_(t.element)}getStyle(){return this.style_}applySelectedStyle_(t){const e=(0,_.v6)(t);e in T||(T[e]=t.getStyle()),t.setStyle(this.style_)}restorePreviousStyle_(t){const e=this.getMap().getInteractions().getArray();for(let r=e.length-1;r>=0;--r){const i=e[r];if(i!==this&&i instanceof E&&i.getStyle()&&-1!==i.getFeatures().getArray().lastIndexOf(t))return void t.setStyle(i.getStyle())}const i=(0,_.v6)(t);t.setStyle(T[i]),delete T[i]}removeFeatureLayerAssociation_(t){delete this.featureLayerAssociation_[(0,_.v6)(t)]}handleEvent(t){if(!this.condition_(t))return!0;const e=this.addCondition_(t),i=this.removeCondition_(t),r=this.toggleCondition_(t),s=!e&&!i&&!r,n=t.map,a=this.getFeatures(),o=[],l=[];if(s){(0,w.I)(this.featureLayerAssociation_),n.forEachFeatureAtPixel(t.pixel,(t,e)=>{if(t instanceof d.A&&this.filter_(t,e))return this.addFeatureLayerAssociation_(t,e),l.push(t),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let t=a.getLength()-1;t>=0;--t){const e=a.item(t),i=l.indexOf(e);i>-1?l.splice(i,1):(a.remove(e),o.push(e))}0!==l.length&&a.extend(l)}else{n.forEachFeatureAtPixel(t.pixel,(t,s)=>{if(t instanceof d.A&&this.filter_(t,s))return!e&&!r||a.getArray().includes(t)?(i||r)&&a.getArray().includes(t)&&(o.push(t),this.removeFeatureLayerAssociation_(t)):(this.addFeatureLayerAssociation_(t,s),l.push(t)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let t=o.length-1;t>=0;--t)a.remove(o[t]);a.extend(l)}return(l.length>0||o.length>0)&&this.dispatchEvent(new S(x.SELECT,l,o,t)),!0}}function F(){const t=(0,v.mY)();return(0,f.X$)(t["Polygon"],t["LineString"]),(0,f.X$)(t["GeometryCollection"],t["LineString"]),function(e){return e.getGeometry()?t[e.getGeometry().getType()]:null}}var A=E,P=Uint8Array,O=Uint16Array,M=Int32Array,C=new P([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),I=new P([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),R=new P([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),V=function(t,e){for(var i=new O(31),r=0;r<31;++r)i[r]=e+=1<<t[r-1];var s=new M(i[30]);for(r=1;r<30;++r)for(var n=i[r];n<i[r+1];++n)s[n]=n-i[r]<<5|r;return{b:i,r:s}},k=V(C,2),D=k.b,U=k.r;D[28]=258,U[258]=28;for(var N=V(I,0),j=N.b,G=(N.r,new O(32768)),B=0;B<32768;++B){var z=(43690&B)>>1|(21845&B)<<1;z=(52428&z)>>2|(13107&z)<<2,z=(61680&z)>>4|(3855&z)<<4,G[B]=((65280&z)>>8|(255&z)<<8)>>1}var Z=function(t,e,i){for(var r=t.length,s=0,n=new O(e);s<r;++s)t[s]&&++n[t[s]-1];var a,o=new O(e);for(s=1;s<e;++s)o[s]=o[s-1]+n[s-1]<<1;if(i){a=new O(1<<e);var l=15-e;for(s=0;s<r;++s)if(t[s])for(var h=s<<4|t[s],c=e-t[s],u=o[t[s]-1]++<<c,d=u|(1<<c)-1;u<=d;++u)a[G[u]>>l]=h}else for(a=new O(r),s=0;s<r;++s)t[s]&&(a[s]=G[o[t[s]-1]++]>>15-t[s]);return a},W=new P(288);for(B=0;B<144;++B)W[B]=8;for(B=144;B<256;++B)W[B]=9;for(B=256;B<280;++B)W[B]=7;for(B=280;B<288;++B)W[B]=8;var J=new P(32);for(B=0;B<32;++B)J[B]=5;var H=Z(W,9,1),$=Z(J,5,1),X=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},Y=function(t,e,i){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&i},q=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},K=function(t){return(t+7)/8|0},Q=function(t,e,i){return(null==e||e<0)&&(e=0),(null==i||i>t.length)&&(i=t.length),new P(t.subarray(e,i))},tt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],et=function(t,e,i){var r=new Error(e||tt[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,et),!i)throw r;return r},it=function(t,e,i,r){var s=t.length,n=r?r.length:0;if(!s||e.f&&!e.l)return i||new P(0);var a=!i,o=a||2!=e.i,l=e.i;a&&(i=new P(3*s));var h=function(t){var e=i.length;if(t>e){var r=new P(Math.max(2*e,t));r.set(i),i=r}},c=e.f||0,u=e.p||0,d=e.b||0,f=e.l,p=e.d,g=e.m,m=e.n,y=8*s;do{if(!f){c=Y(t,u,1);var w=Y(t,u+1,3);if(u+=3,!w){var v=K(u)+4,_=t[v-4]|t[v-3]<<8,b=v+_;if(b>s){l&&et(0);break}o&&h(d+_),i.set(t.subarray(v,b),d),e.b=d+=_,e.p=u=8*b,e.f=c;continue}if(1==w)f=H,p=$,g=9,m=5;else if(2==w){var x=Y(t,u,31)+257,S=Y(t,u+10,15)+4,T=x+Y(t,u+5,31)+1;u+=14;for(var L=new P(T),E=new P(19),F=0;F<S;++F)E[R[F]]=Y(t,u+3*F,7);u+=3*S;var A=X(E),O=(1<<A)-1,M=Z(E,A,1);for(F=0;F<T;){var V=M[Y(t,u,O)];u+=15&V;v=V>>4;if(v<16)L[F++]=v;else{var k=0,U=0;16==v?(U=3+Y(t,u,3),u+=2,k=L[F-1]):17==v?(U=3+Y(t,u,7),u+=3):18==v&&(U=11+Y(t,u,127),u+=7);while(U--)L[F++]=k}}var N=L.subarray(0,x),G=L.subarray(x);g=X(N),m=X(G),f=Z(N,g,1),p=Z(G,m,1)}else et(1);if(u>y){l&&et(0);break}}o&&h(d+131072);for(var B=(1<<g)-1,z=(1<<m)-1,W=u;;W=u){k=f[q(t,u)&B];var J=k>>4;if(u+=15&k,u>y){l&&et(0);break}if(k||et(2),J<256)i[d++]=J;else{if(256==J){W=u,f=null;break}var tt=J-254;if(J>264){F=J-257;var it=C[F];tt=Y(t,u,(1<<it)-1)+D[F],u+=it}var rt=p[q(t,u)&z],st=rt>>4;rt||et(3),u+=15&rt;G=j[st];if(st>3){it=I[st];G+=q(t,u)&(1<<it)-1,u+=it}if(u>y){l&&et(0);break}o&&h(d+131072);var nt=d+tt;if(d<G){var at=n-G,ot=Math.min(G,nt);for(at+d<0&&et(3);d<ot;++d)i[d]=r[at+d]}for(;d<nt;++d)i[d]=i[d-G]}}e.l=f,e.p=W,e.b=d,e.f=c,f&&(c=1,e.m=g,e.d=p,e.n=m)}while(!c);return d!=i.length&&a?Q(i,0,d):i.subarray(0,d)},rt=new P(0),st=function(t){31==t[0]&&139==t[1]&&8==t[2]||et(6,"invalid gzip data");var e=t[3],i=10;4&e&&(i+=2+(t[10]|t[11]<<8));for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!t[i++]);return i+(2&e)},nt=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},at=function(t,e){return(8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31)&&et(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&et(6,"invalid zlib data: "+(32&t[1]?"need":"unexpected")+" dictionary"),2+(t[1]>>3&4)};function ot(t,e){return it(t,{i:2},e&&e.out,e&&e.dictionary)}function lt(t,e){var i=st(t);return i+8>t.length&&et(6,"invalid gzip data"),it(t.subarray(i,-8),{i:2},e&&e.out||new P(nt(t)),e&&e.dictionary)}function ht(t,e){return it(t.subarray(at(t,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function ct(t,e){return 31==t[0]&&139==t[1]&&8==t[2]?lt(t,e):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?ot(t,e):ht(t,e)}var ut="undefined"!=typeof TextDecoder&&new TextDecoder;try{ut.decode(rt,{stream:!0})}catch(_s){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;var dt=Object.defineProperty,ft=Math.pow,pt=(t,e)=>dt(t,"name",{value:e,configurable:!0}),gt=(t,e,i)=>new Promise((r,s)=>{var n=t=>{try{o(i.next(t))}catch(e){s(e)}},a=t=>{try{o(i.throw(t))}catch(e){s(e)}},o=t=>t.done?r(t.value):Promise.resolve(t.value).then(n,a);o((i=i.apply(t,e)).next())}),mt=(pt((t,e)=>{let i=!1,r="",s=L.GridLayer.extend({createTile:pt((e,s)=>{let n=document.createElement("img"),a=new AbortController,o=a.signal;return n.cancel=()=>{a.abort()},i||(t.getHeader().then(t=>{1===t.tileType?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):2===t.tileType?r="image/png":3===t.tileType?r="image/jpeg":4===t.tileType?r="image/webp":5===t.tileType&&(r="image/avif")}),i=!0),t.getZxy(e.z,e.x,e.y,o).then(t=>{if(t){let e=new Blob([t.data],{type:r}),i=window.URL.createObjectURL(e);n.src=i,n.cancel=void 0,s(void 0,n)}}).catch(t=>{if("AbortError"!==t.name)throw t}),n},"createTile"),_removeTile:pt(function(t){let e=this._tiles[t];e&&(e.el.cancel&&e.el.cancel(),e.el.width=0,e.el.height=0,e.el.deleted=!0,L.DomUtil.remove(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},"_removeTile")});return new s(e)},"leafletRasterLayer"),pt(t=>(e,i)=>{if(i instanceof AbortController)return t(e,i);let r=new AbortController;return t(e,r).then(t=>i(void 0,t.data,t.cacheControl||"",t.expires||""),t=>i(t)).catch(t=>i(t)),{cancel:pt(()=>r.abort(),"cancel")}},"v3compat")),yt=class{constructor(t){this.tilev4=pt((t,e)=>gt(this,null,function*(){if("json"===t.type){let e=t.url.substr(10),i=this.tiles.get(e);if(i||(i=new Jt(e),this.tiles.set(e,i)),this.metadata)return{data:yield i.getTileJson(t.url)};let r=yield i.getHeader();return(r.minLon>=r.maxLon||r.minLat>=r.maxLat)&&console.error(`Bounds of PMTiles archive ${r.minLon},${r.minLat},${r.maxLon},${r.maxLat} are not valid.`),{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:r.minZoom,maxzoom:r.maxZoom,bounds:[r.minLon,r.minLat,r.maxLon,r.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),r=t.url.match(i);if(!r)throw new Error("Invalid PMTiles protocol URL");let s=r[1],n=this.tiles.get(s);n||(n=new Jt(s),this.tiles.set(s,n));let a=r[2],o=r[3],l=r[4],h=yield n.getHeader(),c=yield null==n?void 0:n.getZxy(+a,+o,+l,e.signal);if(c)return{data:new Uint8Array(c.data),cacheControl:c.cacheControl,expires:c.expires};if(1===h.tileType){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=mt(this.tilev4),this.tiles=new Map,this.metadata=(null==t?void 0:t.metadata)||!1,this.errorOnMissingTile=(null==t?void 0:t.errorOnMissingTile)||!1}add(t){this.tiles.set(t.source.getKey(),t)}get(t){return this.tiles.get(t)}};pt(yt,"Protocol");function wt(t,e){return 4294967296*(e>>>0)+(t>>>0)}function vt(t,e){let i=e.buf,r=i[e.pos++],s=(112&r)>>4;if(r<128||(r=i[e.pos++],s|=(127&r)<<3,r<128)||(r=i[e.pos++],s|=(127&r)<<10,r<128)||(r=i[e.pos++],s|=(127&r)<<17,r<128)||(r=i[e.pos++],s|=(127&r)<<24,r<128)||(r=i[e.pos++],s|=(1&r)<<31,r<128))return wt(t,s);throw new Error("Expected varint not more than 10 bytes")}function _t(t){let e=t.buf,i=e[t.pos++],r=127&i;return i<128||(i=e[t.pos++],r|=(127&i)<<7,i<128)||(i=e[t.pos++],r|=(127&i)<<14,i<128)||(i=e[t.pos++],r|=(127&i)<<21,i<128)?r:(i=e[t.pos],r|=(15&i)<<28,vt(r,t))}function bt(t,e,i,r){if(0===r){1===i&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);let r=e[0];e[0]=e[1],e[1]=r}}function xt(t,e){let i=ft(2,t),r=e,s=e,n=e,a=[0,0],o=1;for(;o<i;)r=1&n/2,s=1&(n^r),bt(o,a,r,s),a[0]+=o*r,a[1]+=o*s,n/=4,o*=2;return[t,a[0],a[1]]}pt(wt,"toNum"),pt(vt,"readVarintRemainder"),pt(_t,"readVarint"),pt(bt,"rotate"),pt(xt,"idOnLevel");var St=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Tt(t,e,i){if(t>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>ft(2,t)-1||i>ft(2,t)-1)throw new Error("tile x/y outside zoom level bounds");let r=St[t],s=ft(2,t),n=0,a=0,o=0,l=[e,i],h=s/2;for(;h>0;)n=(l[0]&h)>0?1:0,a=(l[1]&h)>0?1:0,o+=h*h*(3*n^a),bt(h,l,n,a),h/=2;return r+o}function Lt(t){let e=0;for(let i=0;i<27;i++){let r=(1<<i)*(1<<i);if(e+r>t)return xt(i,t-e);e+=r}throw new Error("Tile zoom level exceeds max safe number limit (26)")}pt(Tt,"zxyToTileId"),pt(Lt,"tileIdToZxy");var Et=(t=>(t[t.Unknown=0]="Unknown",t[t.None=1]="None",t[t.Gzip=2]="Gzip",t[t.Brotli=3]="Brotli",t[t.Zstd=4]="Zstd",t))(Et||{});function Ft(t,e){return gt(this,null,function*(){if(1===e||0===e)return t;if(2===e){if("undefined"==typeof globalThis.DecompressionStream)return ct(new Uint8Array(t));let e=new Response(t).body;if(!e)throw new Error("Failed to read response stream");let i=e.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(i).arrayBuffer()}throw new Error("Compression method not supported")})}pt(Ft,"defaultDecompress");var At=(t=>(t[t.Unknown=0]="Unknown",t[t.Mvt=1]="Mvt",t[t.Png=2]="Png",t[t.Jpeg=3]="Jpeg",t[t.Webp=4]="Webp",t[t.Avif=5]="Avif",t))(At||{});function Pt(t){return 1===t?".mvt":2===t?".png":3===t?".jpg":4===t?".webp":5===t?".avif":""}pt(Pt,"tileTypeExt");var Ot=127;function Mt(t,e){let i=0,r=t.length-1;for(;i<=r;){let s=r+i>>1,n=e-t[s].tileId;if(n>0)i=s+1;else{if(!(n<0))return t[s];r=s-1}}return r>=0&&(0===t[r].runLength||e-t[r].tileId<t[r].runLength)?t[r]:null}pt(Mt,"findTile");var Ct=class{constructor(t){this.file=t}getKey(){return this.file.name}getBytes(t,e){return gt(this,null,function*(){return{data:yield this.file.slice(t,t+e).arrayBuffer()}})}};pt(Ct,"FileSource");var It=class{constructor(t,e=new Headers){this.url=t,this.customHeaders=e,this.mustReload=!1;let i="";"navigator"in globalThis&&(i=globalThis.navigator.userAgent||"");let r=i.indexOf("Windows")>-1,s=/Chrome|Chromium|Edg|OPR|Brave/.test(i);this.chromeWindowsNoCache=!1,r&&s&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(t){this.customHeaders=t}getBytes(t,e,i,r){return gt(this,null,function*(){let s,n;i?n=i:(s=new AbortController,n=s.signal);let a,o=new Headers(this.customHeaders);o.set("range",`bytes=${t}-${t+e-1}`),this.mustReload?a="reload":this.chromeWindowsNoCache&&(a="no-store");let l=yield fetch(this.url,{signal:n,cache:a,headers:o});if(0===t&&416===l.status){let t=l.headers.get("Content-Range");if(!t||!t.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let e=+t.substr(8);l=yield fetch(this.url,{signal:n,cache:"reload",headers:{range:"bytes=0-"+(e-1)}})}let h=l.headers.get("Etag");if(null!=h&&h.startsWith("W/")&&(h=null),416===l.status||r&&h&&h!==r)throw this.mustReload=!0,new Nt(`Server returned non-matching ETag ${r} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(l.status>=300)throw new Error(`Bad response code: ${l.status}`);let c=l.headers.get("Content-Length");if(200===l.status&&(!c||+c>e))throw s&&s.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield l.arrayBuffer(),etag:h||void 0,cacheControl:l.headers.get("Cache-Control")||void 0,expires:l.headers.get("Expires")||void 0}})}};pt(It,"FetchSource");var Rt=It;function Vt(t,e){let i=t.getUint32(e+4,!0),r=t.getUint32(e+0,!0);return i*ft(2,32)+r}function kt(t,e){let i=new DataView(t),r=i.getUint8(7);if(r>3)throw new Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:Vt(i,8),rootDirectoryLength:Vt(i,16),jsonMetadataOffset:Vt(i,24),jsonMetadataLength:Vt(i,32),leafDirectoryOffset:Vt(i,40),leafDirectoryLength:Vt(i,48),tileDataOffset:Vt(i,56),tileDataLength:Vt(i,64),numAddressedTiles:Vt(i,72),numTileEntries:Vt(i,80),numTileContents:Vt(i,88),clustered:1===i.getUint8(96),internalCompression:i.getUint8(97),tileCompression:i.getUint8(98),tileType:i.getUint8(99),minZoom:i.getUint8(100),maxZoom:i.getUint8(101),minLon:i.getInt32(102,!0)/1e7,minLat:i.getInt32(106,!0)/1e7,maxLon:i.getInt32(110,!0)/1e7,maxLat:i.getInt32(114,!0)/1e7,centerZoom:i.getUint8(118),centerLon:i.getInt32(119,!0)/1e7,centerLat:i.getInt32(123,!0)/1e7,etag:e}}function Dt(t){let e={buf:new Uint8Array(t),pos:0},i=_t(e),r=[],s=0;for(let n=0;n<i;n++){let t=_t(e);r.push({tileId:s+t,offset:0,length:0,runLength:1}),s+=t}for(let n=0;n<i;n++)r[n].runLength=_t(e);for(let n=0;n<i;n++)r[n].length=_t(e);for(let n=0;n<i;n++){let t=_t(e);r[n].offset=0===t&&n>0?r[n-1].offset+r[n-1].length:t-1}return r}pt(Vt,"getUint64"),pt(kt,"bytesToHeader"),pt(Dt,"deserializeIndex");var Ut=class extends Error{};pt(Ut,"EtagMismatch");var Nt=Ut;function jt(t,e){return gt(this,null,function*(){let i=yield t.getBytes(0,16384);if(19792!==new DataView(i.data).getUint16(0,!0))throw new Error("Wrong magic number for PMTiles archive");let r=i.data.slice(0,Ot),s=kt(r,i.etag),n=i.data.slice(s.rootDirectoryOffset,s.rootDirectoryOffset+s.rootDirectoryLength),a=`${t.getKey()}|${s.etag||""}|${s.rootDirectoryOffset}|${s.rootDirectoryLength}`,o=Dt(yield e(n,s.internalCompression));return[s,[a,o.length,o]]})}function Gt(t,e,i,r,s){return gt(this,null,function*(){let n=yield t.getBytes(i,r,void 0,s.etag),a=yield e(n.data,s.internalCompression),o=Dt(a);if(0===o.length)throw new Error("Empty directory is invalid");return o})}pt(jt,"getHeaderAndRoot"),pt(Gt,"getDirectory");var Bt=class{constructor(t=100,e=!0,i=Ft){this.cache=new Map,this.maxCacheEntries=t,this.counter=1,this.decompress=i}getHeader(t){return gt(this,null,function*(){let e=t.getKey(),i=this.cache.get(e);if(i)return i.lastUsed=this.counter++,i.data;let r=yield jt(t,this.decompress);return r[1]&&this.cache.set(r[1][0],{lastUsed:this.counter++,data:r[1][2]}),this.cache.set(e,{lastUsed:this.counter++,data:r[0]}),this.prune(),r[0]})}getDirectory(t,e,i,r){return gt(this,null,function*(){let s=`${t.getKey()}|${r.etag||""}|${e}|${i}`,n=this.cache.get(s);if(n)return n.lastUsed=this.counter++,n.data;let a=yield Gt(t,this.decompress,e,i,r);return this.cache.set(s,{lastUsed:this.counter++,data:a}),this.prune(),a})}prune(){if(this.cache.size>this.maxCacheEntries){let t,e=1/0;this.cache.forEach((i,r)=>{i.lastUsed<e&&(e=i.lastUsed,t=r)}),t&&this.cache.delete(t)}}invalidate(t){return gt(this,null,function*(){this.cache.delete(t.getKey())})}};pt(Bt,"ResolvedValueCache");var zt=class{constructor(t=100,e=!0,i=Ft){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=t,this.counter=1,this.decompress=i}getHeader(t){return gt(this,null,function*(){let e=t.getKey(),i=this.cache.get(e);if(i)return i.lastUsed=this.counter++,yield i.data;let r=new Promise((e,i)=>{jt(t,this.decompress).then(t=>{t[1]&&this.cache.set(t[1][0],{lastUsed:this.counter++,data:Promise.resolve(t[1][2])}),e(t[0]),this.prune()}).catch(t=>{i(t)})});return this.cache.set(e,{lastUsed:this.counter++,data:r}),r})}getDirectory(t,e,i,r){return gt(this,null,function*(){let s=`${t.getKey()}|${r.etag||""}|${e}|${i}`,n=this.cache.get(s);if(n)return n.lastUsed=this.counter++,yield n.data;let a=new Promise((s,n)=>{Gt(t,this.decompress,e,i,r).then(t=>{s(t),this.prune()}).catch(t=>{n(t)})});return this.cache.set(s,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let t,e=1/0;this.cache.forEach((i,r)=>{i.lastUsed<e&&(e=i.lastUsed,t=r)}),t&&this.cache.delete(t)}}invalidate(t){return gt(this,null,function*(){let e=t.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(t.getKey());let i=new Promise((i,r)=>{this.getHeader(t).then(t=>{i(),this.invalidations.delete(e)}).catch(t=>{r(t)})});this.invalidations.set(e,i)})}};pt(zt,"SharedPromiseCache");var Zt=zt,Wt=class{constructor(t,e,i){this.source="string"==typeof t?new Rt(t):t,this.decompress=i||Ft,this.cache=e||new Zt}getHeader(){return gt(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,i,r){return gt(this,null,function*(){let s=Tt(t,e,i),n=yield this.cache.getHeader(this.source);if(t<n.minZoom||t>n.maxZoom)return;let a=n.rootDirectoryOffset,o=n.rootDirectoryLength;for(let t=0;t<=3;t++){let t=yield this.cache.getDirectory(this.source,a,o,n),e=Mt(t,s);if(!e)return;if(e.runLength>0){let t=yield this.source.getBytes(n.tileDataOffset+e.offset,e.length,r,n.etag);return{data:yield this.decompress(t.data,n.tileCompression),cacheControl:t.cacheControl,expires:t.expires}}a=n.leafDirectoryOffset+e.offset,o=e.length}throw new Error("Maximum directory depth exceeded")})}getZxy(t,e,i,r){return gt(this,null,function*(){try{return yield this.getZxyAttempt(t,e,i,r)}catch(s){if(s instanceof Nt)return this.cache.invalidate(this.source),yield this.getZxyAttempt(t,e,i,r);throw s}})}getMetadataAttempt(){return gt(this,null,function*(){let t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength,void 0,t.etag),i=yield this.decompress(e.data,t.internalCompression),r=new TextDecoder("utf-8");return JSON.parse(r.decode(i))})}getMetadata(){return gt(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(_s){if(_s instanceof Nt)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw _s}})}getTileJson(t){return gt(this,null,function*(){let e=yield this.getHeader(),i=yield this.getMetadata(),r=Pt(e.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${t}/{z}/{x}/{y}${r}`],vector_layers:i.vector_layers,attribution:i.attribution,description:i.description,name:i.name,version:i.version,bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],center:[e.centerLon,e.centerLat,e.centerZoom],minzoom:e.minZoom,maxzoom:e.maxZoom}})}};pt(Wt,"PMTiles");var Jt=Wt,Ht=i(6837);class $t extends p.Ay{constructor(t){super(Ht.A.ERROR),this.error=t}}var Xt=$t,Yt=i(73354),qt=i(5255),Kt=i(53820),Qt=i(35598);class te{constructor(t){this.name=t}toString(){return this.name}}te.GeoTIFF=new te("GeoTIFF"),te.ImageStatic=new te("ImageStatic"),te.PMTilesRaster=new te("PMTilesRaster"),te.PMTilesVector=new te("PMTilesVector"),te.TileJSON=new te("TileJSON"),te.TileWMS=new te("TileWMS"),te.WMTS=new te("WMTS"),te.XYZ=new te("XYZ");var ee=te,ie=i(58262),re=i(19551),se=i(30945),ne=i(37078),ae=i(65544),oe=i(40180),le=i(82728),he=i(36181),ce=i(70915);function ue(t,e){return Te().createElementNS(t,e)}function de(t,e){return fe(t,e,[]).join("")}function fe(t,e,i){if(t.nodeType==Node.CDATA_SECTION_NODE||t.nodeType==Node.TEXT_NODE)e?i.push(String(t.nodeValue).replace(/(\r\n|\r|\n)/g,"")):i.push(t.nodeValue);else{let r;for(r=t.firstChild;r;r=r.nextSibling)fe(r,e,i)}return i}function pe(t){return"documentElement"in t}function ge(t){return(new DOMParser).parseFromString(t,"application/xml")}function me(t,e){return function(i,r){const s=t.call(e??this,i,r);if(void 0!==s){const t=r[r.length-1];t.push(s)}}}function ye(t,e,i){return function(r,s){const n=t.call(i??this,r,s);if(void 0!==n){const t=s[s.length-1],i=void 0!==e?e:r.localName;let a;i in t?a=t[i]:(a=[],t[i]=a),a.push(n)}}}function we(t,e,i){return function(r,s){const n=t.call(i??this,r,s);if(void 0!==n){const t=s[s.length-1],i=void 0!==e?e:r.localName;t[i]=n}}}function ve(t,e){return function(i,r,s){const n=r[r.length-1],a=n.node;let o=t;void 0===o&&(o=s);const l=void 0!==e?e:a.namespaceURI;return ue(l,o)}}ve();function _e(t,e,i){let r,s;for(i=void 0!==i?i:{},r=0,s=t.length;r<s;++r)i[t[r]]=e;return i}function be(t,e,i,r){let s;for(s=e.firstElementChild;s;s=s.nextElementSibling){const e=t[s.namespaceURI];if(void 0!==e){const t=e[s.localName];void 0!==t&&t.call(r,s,i)}}}function xe(t,e,i,r,s){return r.push(t),be(e,i,r,s),r.pop()}let Se;function Te(){return void 0===Se&&"undefined"!==typeof document&&(Se=document.implementation.createDocument("","",null)),Se}class Le{read(t){if(!t)return null;if("string"===typeof t){const e=ge(t);return this.readFromDocument(e)}return pe(t)?this.readFromDocument(t):this.readFromNode(t)}readFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null}readFromNode(t){(0,_.b0)()}}var Ee=Le;const Fe="http://www.w3.org/1999/xlink";function Ae(t){return t.getAttributeNS(Fe,"href")}function Pe(t){const e=de(t,!1);return Oe(e)}function Oe(t){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(t);if(e)return parseFloat(e[1])}function Me(t){const e=de(t,!1);return Ce(e)}function Ce(t){const e=/^\s*(\d+)\s*$/.exec(t);if(e)return parseInt(e[1],10)}function Ie(t){return de(t,!1).trim()}const Re=[null,"http://www.opengis.net/ows/1.1"],Ve=_e(Re,{ServiceIdentification:we(ai),ServiceProvider:we(li),OperationsMetadata:we(si)});class ke extends Ee{constructor(){super()}readFromNode(t){const e=xe({},Ve,t,[]);return e||null}}const De=_e(Re,{DeliveryPoint:we(Ie),City:we(Ie),AdministrativeArea:we(Ie),PostalCode:we(Ie),Country:we(Ie),ElectronicMailAddress:we(Ie)}),Ue=_e(Re,{Value:ye(hi)}),Ne=_e(Re,{AllowedValues:we(qe)}),je=_e(Re,{Phone:we(ni),Address:we(Ye)}),Ge=_e(Re,{HTTP:we(ii)}),Be=_e(Re,{Get:ye(ei),Post:void 0}),ze=_e(Re,{DCP:we(ti)}),Ze=_e(Re,{Operation:ri}),We=_e(Re,{Voice:we(Ie),Facsimile:we(Ie)}),Je=_e(Re,{Constraint:ye(Ke)}),He=_e(Re,{IndividualName:we(Ie),PositionName:we(Ie),ContactInfo:we(Qe)}),$e=_e(Re,{Abstract:we(Ie),AccessConstraints:we(Ie),Fees:we(Ie),Title:we(Ie),ServiceTypeVersion:we(Ie),ServiceType:we(Ie)}),Xe=_e(Re,{ProviderName:we(Ie),ProviderSite:we(Ae),ServiceContact:we(oi)});function Ye(t,e){return xe({},De,t,e)}function qe(t,e){return xe({},Ue,t,e)}function Ke(t,e){const i=t.getAttribute("name");if(i)return xe({name:i},Ne,t,e)}function Qe(t,e){return xe({},je,t,e)}function ti(t,e){return xe({},Ge,t,e)}function ei(t,e){const i=Ae(t);if(i)return xe({href:i},Je,t,e)}function ii(t,e){return xe({},Be,t,e)}function ri(t,e){const i=t.getAttribute("name"),r=xe({},ze,t,e);if(!r)return;const s=e[e.length-1];s[i]=r}function si(t,e){return xe({},Ze,t,e)}function ni(t,e){return xe({},We,t,e)}function ai(t,e){return xe({},$e,t,e)}function oi(t,e){return xe({},He,t,e)}function li(t,e){return xe({},Xe,t,e)}function hi(t,e){return Ie(t)}var ci=ke;const ui=[null,"http://www.opengis.net/wmts/1.0"],di=[null,"http://www.opengis.net/ows/1.1"],fi=_e(ui,{Contents:we(Li)});class pi extends Ee{constructor(){super(),this.owsParser_=new ci}readFromNode(t){let e=t.getAttribute("version");e&&(e=e.trim());let i=this.owsParser_.readFromNode(t);return i?(i["version"]=e,i=xe(i,fi,t,[]),i||null):null}}const gi=_e(ui,{Layer:ye(Ei),TileMatrixSet:ye(Fi)}),mi=_e(ui,{Style:ye(Ai),Format:ye(Ie),TileMatrixSetLink:ye(Pi),Dimension:ye(Oi),ResourceURL:ye(Mi)},_e(di,{Title:we(Ie),Abstract:we(Ie),WGS84BoundingBox:we(Ci),BoundingBox:ye(Ii),Identifier:we(Ie)})),yi=_e(ui,{LegendURL:ye(Ri)},_e(di,{Title:we(Ie),Identifier:we(Ie)})),wi=_e(ui,{TileMatrixSet:we(Ie),TileMatrixSetLimits:we(Di)}),vi=_e(ui,{TileMatrixLimits:me(Ui)}),_i=_e(ui,{TileMatrix:we(Ie),MinTileRow:we(Me),MaxTileRow:we(Me),MinTileCol:we(Me),MaxTileCol:we(Me)}),bi=_e(ui,{Default:we(Ie),Value:ye(Ie)},_e(di,{Identifier:we(Ie)})),xi=_e(di,{LowerCorner:me(Vi),UpperCorner:me(Vi)}),Si=_e(ui,{WellKnownScaleSet:we(Ie),TileMatrix:ye(ki)},_e(di,{SupportedCRS:we(Ie),Identifier:we(Ie),BoundingBox:we(Ci)})),Ti=_e(ui,{TopLeftCorner:we(Vi),ScaleDenominator:we(Pe),TileWidth:we(Me),TileHeight:we(Me),MatrixWidth:we(Me),MatrixHeight:we(Me)},_e(di,{Identifier:we(Ie)}));function Li(t,e){return xe({},gi,t,e)}function Ei(t,e){return xe({},mi,t,e)}function Fi(t,e){return xe({},Si,t,e)}function Ai(t,e){const i=xe({},yi,t,e);if(!i)return;const r="true"===t.getAttribute("isDefault");return i["isDefault"]=r,i}function Pi(t,e){return xe({},wi,t,e)}function Oi(t,e){return xe({},bi,t,e)}function Mi(t,e){const i=t.getAttribute("format"),r=t.getAttribute("template"),s=t.getAttribute("resourceType"),n={};return i&&(n["format"]=i),r&&(n["template"]=r),s&&(n["resourceType"]=s),n}function Ci(t,e){const i=xe([],xi,t,e);if(2==i.length)return(0,ce.Tr)(i)}function Ii(t,e){const i=t.getAttribute("crs"),r=xe([],xi,t,e);if(2==r.length)return{extent:(0,ce.Tr)(r),crs:i}}function Ri(t,e){const i={};return i["format"]=t.getAttribute("format"),i["href"]=Ae(t),i}function Vi(t,e){const i=Ie(t).split(/\s+/);if(!i||2!=i.length)return;const r=+i[0],s=+i[1];return isNaN(r)||isNaN(s)?void 0:[r,s]}function ki(t,e){return xe({},Ti,t,e)}function Di(t,e){return xe([],vi,t,e)}function Ui(t,e){return xe({},_i,t,e)}var Ni=pi,ji=i(18056),Gi=i(10702),Bi=i(40221),zi=i(27733),Zi=i(13628),Wi=i(953),Ji=i(84078);const Hi="https://stac-extensions.github.io/label/v1.*/schema.json",$i=new Zi.A({color:"rgba(0,0,0,0)"});function Xi(t,e,i="rgba(255,255,255,0.4)",r=5){let s=$i;i&&(s=new Zi.A({color:i}));const n=new Wi.A({color:t,width:e});return new v.Ay({image:new zi.A({fill:s,stroke:n,radius:r}),fill:s,stroke:n})}const Yi=Xi("#3399CC",3),qi=Xi("#ff9933",2,null);async function Ki(t,e=null,i=null,r=0){const s=new Set;return t.map.forEachFeatureAtPixel(t.pixel,(t,e)=>{i&&i.push(t),s.add(e.get("stac"))},{hitTolerance:r,layerFilter(t){if(t instanceof y["default"]&&!0===t.get("bounds")){const i=t.get("stac");if(i instanceof Bi.O7&&(!e||!i.equals(e)))return!0}return!1}}),[...s]}function Qi(t,e){const i={url:t.getAbsoluteUrl()};let r=t;1===t.getBands().length&&(r=t.getBand(0));const{minimum:s,maximum:n}=r.getMinMaxValues();"number"===typeof s&&(i.min=s),"number"===typeof n&&(i.max=n);const a=r.getNoDataValues();return a.length>0&&(i.nodata=a[0]),e.length>0&&(i.bands=e),i}async function tr(t,e=void 0){let i=e;if((0,Ji.zN)()){const e=t.getMetadata("proj:code");if(e)try{if(e.startsWith("EPSG:")){const t=parseInt(e.replace("EPSG:",""),10);i=await(0,Ji.N1)(t)}}catch(Pt){}}return i}function er(t,e){const i=t.clone();return e.hasOnlyBounds()||i.setFill($i),i}function ir(t){let e=t.href;if(e.includes("{s}")){if(!(Array.isArray(t["href:servers"])&&t["href:servers"].length>0))return null;{const i=Math.random()*t["href:servers"].length|0;e=e.replace("{s}",t["href:servers"][i])}}return e}var rr=i(22615),sr=i(11078);const nr=4294967296,ar=1/nr,or=12,lr="undefined"===typeof TextDecoder?null:new TextDecoder("utf-8"),hr=0,cr=1,ur=2,dr=5;class fr{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,e,i=this.length){while(this.pos<i){const i=this.readVarint(),r=i>>3,s=this.pos;this.type=7&i,t(r,e,this),this.pos===s&&this.skip(i)}return e}readMessage(t,e){return this.readFields(t,e,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*nr;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*nr;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const e=this.buf;let i,r;return r=e[this.pos++],i=127&r,r<128?i:(r=e[this.pos++],i|=(127&r)<<7,r<128?i:(r=e[this.pos++],i|=(127&r)<<14,r<128?i:(r=e[this.pos++],i|=(127&r)<<21,r<128?i:(r=e[this.pos],i|=(15&r)<<28,pr(i,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2===1?(t+1)/-2:t/2}readBoolean(){return Boolean(this.readVarint())}readString(){const t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=or&&lr?lr.decode(this.buf.subarray(e,t)):Pr(this.buf,e,t)}readBytes(){const t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e}readPackedVarint(t=[],e){const i=this.readPackedEnd();while(this.pos<i)t.push(this.readVarint(e));return t}readPackedSVarint(t=[]){const e=this.readPackedEnd();while(this.pos<e)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const e=this.readPackedEnd();while(this.pos<e)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const e=this.readPackedEnd();while(this.pos<e)t.push(this.readFloat());return t}readPackedDouble(t=[]){const e=this.readPackedEnd();while(this.pos<e)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const e=this.readPackedEnd();while(this.pos<e)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const e=this.readPackedEnd();while(this.pos<e)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const e=this.readPackedEnd();while(this.pos<e)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const e=this.readPackedEnd();while(this.pos<e)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===ur?this.readVarint()+this.pos:this.pos+1}skip(t){const e=7&t;if(e===hr)while(this.buf[this.pos++]>127);else if(e===ur)this.pos=this.readVarint()+this.pos;else if(e===dr)this.pos+=4;else{if(e!==cr)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(t,e){this.writeVarint(t<<3|e)}realloc(t){let e=this.length||16;while(e<this.pos+t)e*=2;if(e!==this.length){const t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.dataView=new DataView(t.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*ar),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*ar),!0),this.pos+=8}writeVarint(t){t=+t||0,t>268435455||t<0?mr(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const e=this.pos;this.pos=Or(this.buf,t,this.pos);const i=this.pos-e;i>=128&&vr(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const e=t.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=t[i]}writeRawMessage(t,e){this.pos++;const i=this.pos;t(e,this);const r=this.pos-i;r>=128&&vr(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r}writeMessage(t,e,i){this.writeTag(t,ur),this.writeRawMessage(e,i)}writePackedVarint(t,e){e.length&&this.writeMessage(t,_r,e)}writePackedSVarint(t,e){e.length&&this.writeMessage(t,br,e)}writePackedBoolean(t,e){e.length&&this.writeMessage(t,Tr,e)}writePackedFloat(t,e){e.length&&this.writeMessage(t,xr,e)}writePackedDouble(t,e){e.length&&this.writeMessage(t,Sr,e)}writePackedFixed32(t,e){e.length&&this.writeMessage(t,Lr,e)}writePackedSFixed32(t,e){e.length&&this.writeMessage(t,Er,e)}writePackedFixed64(t,e){e.length&&this.writeMessage(t,Fr,e)}writePackedSFixed64(t,e){e.length&&this.writeMessage(t,Ar,e)}writeBytesField(t,e){this.writeTag(t,ur),this.writeBytes(e)}writeFixed32Field(t,e){this.writeTag(t,dr),this.writeFixed32(e)}writeSFixed32Field(t,e){this.writeTag(t,dr),this.writeSFixed32(e)}writeFixed64Field(t,e){this.writeTag(t,cr),this.writeFixed64(e)}writeSFixed64Field(t,e){this.writeTag(t,cr),this.writeSFixed64(e)}writeVarintField(t,e){this.writeTag(t,hr),this.writeVarint(e)}writeSVarintField(t,e){this.writeTag(t,hr),this.writeSVarint(e)}writeStringField(t,e){this.writeTag(t,ur),this.writeString(e)}writeFloatField(t,e){this.writeTag(t,dr),this.writeFloat(e)}writeDoubleField(t,e){this.writeTag(t,cr),this.writeDouble(e)}writeBooleanField(t,e){this.writeVarintField(t,+e)}}function pr(t,e,i){const r=i.buf;let s,n;if(n=r[i.pos++],s=(112&n)>>4,n<128)return gr(t,s,e);if(n=r[i.pos++],s|=(127&n)<<3,n<128)return gr(t,s,e);if(n=r[i.pos++],s|=(127&n)<<10,n<128)return gr(t,s,e);if(n=r[i.pos++],s|=(127&n)<<17,n<128)return gr(t,s,e);if(n=r[i.pos++],s|=(127&n)<<24,n<128)return gr(t,s,e);if(n=r[i.pos++],s|=(1&n)<<31,n<128)return gr(t,s,e);throw new Error("Expected varint not more than 10 bytes")}function gr(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function mr(t,e){let i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(i=~(-t%4294967296),r=~(-t/4294967296),4294967295^i?i=i+1|0:(i=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),yr(i,r,e),wr(r,e)}function yr(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t}function wr(t,e){const i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}function vr(t,e,i){const r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(let s=i.pos-1;s>=t;s--)i.buf[s+r]=i.buf[s]}function _r(t,e){for(let i=0;i<t.length;i++)e.writeVarint(t[i])}function br(t,e){for(let i=0;i<t.length;i++)e.writeSVarint(t[i])}function xr(t,e){for(let i=0;i<t.length;i++)e.writeFloat(t[i])}function Sr(t,e){for(let i=0;i<t.length;i++)e.writeDouble(t[i])}function Tr(t,e){for(let i=0;i<t.length;i++)e.writeBoolean(t[i])}function Lr(t,e){for(let i=0;i<t.length;i++)e.writeFixed32(t[i])}function Er(t,e){for(let i=0;i<t.length;i++)e.writeSFixed32(t[i])}function Fr(t,e){for(let i=0;i<t.length;i++)e.writeFixed64(t[i])}function Ar(t,e){for(let i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Pr(t,e,i){let r="",s=e;while(s<i){const e=t[s];let n,a,o,l=null,h=e>239?4:e>223?3:e>191?2:1;if(s+h>i)break;1===h?e<128&&(l=e):2===h?(n=t[s+1],128===(192&n)&&(l=(31&e)<<6|63&n,l<=127&&(l=null))):3===h?(n=t[s+1],a=t[s+2],128===(192&n)&&128===(192&a)&&(l=(15&e)<<12|(63&n)<<6|63&a,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===h&&(n=t[s+1],a=t[s+2],o=t[s+3],128===(192&n)&&128===(192&a)&&128===(192&o)&&(l=(15&e)<<18|(63&n)<<12|(63&a)<<6|63&o,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,h=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),s+=h}return r}function Or(t,e,i){for(let r,s,n=0;n<e.length;n++){if(r=e.charCodeAt(n),r>55295&&r<57344){if(!s){r>56319||n+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):s=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,s=r;continue}r=s-55296<<10|r-56320|65536,s=null}else s&&(t[i++]=239,t[i++]=191,t[i++]=189,s=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}var Mr=i(11217),Cr=i(96702),Ir=i(30503),Rr=i(2871),Vr=i(44294),kr=i(79787),Dr=i(71225),Ur=i(95286),Nr=i(38599),jr=i(24778),Gr=i(56579);class Br extends Gr.Ay{constructor(t){super(),t=t||{},this.dataProjection=new Ur.A({code:"",units:"tile-pixels"}),this.featureClass=t.featureClass?t.featureClass:jr.Ay,this.geometryName_=t.geometryName,this.layerName_=t.layerName?t.layerName:"layer",this.layers_=t.layers?t.layers:null,this.idProperty_=t.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(t,e,i,r){t.pos=e.geometry;const s=t.readVarint()+t.pos;let n=1,a=0,o=0,l=0,h=0,c=0;while(t.pos<s){if(!a){const e=t.readVarint();n=7&e,a=e>>3}if(a--,1===n||2===n)o+=t.readSVarint(),l+=t.readSVarint(),1===n&&h>c&&(r.push(h),c=h),i.push(o,l),h+=2;else{if(7!==n)throw new Error("Invalid command found in the PBF");h>c&&(i.push(i[c],i[c+1]),h+=2)}}h>c&&(r.push(h),c=h)}createFeature_(t,e,i){const r=e.type;if(0===r)return null;let s;const n=e.properties;let a;this.idProperty_?(a=n[this.idProperty_],delete n[this.idProperty_]):a=e.id,n[this.layerName_]=e.layer.name;const o=[],l=[];this.readRawGeometry_(t,e,o,l);const h=Hr(r,l.length);if(this.featureClass===jr.Ay)s=new this.featureClass(h,o,l,2,n,a),s.transform(i.dataProjection);else{let t;if("Polygon"==h){const e=(0,Dr.yJ)(o,l);t=e.length>1?new Rr.A(o,"XY",e):new kr.Ay(o,"XY",l)}else t="Point"===h?new Vr.A(o,"XY"):"LineString"===h?new Mr.A(o,"XY"):"MultiPoint"===h?new Ir.A(o,"XY"):"MultiLineString"===h?new Cr.A(o,"XY",l):null;const e=this.featureClass;s=new e,this.geometryName_&&s.setGeometryName(this.geometryName_);const r=(0,Gr.hX)(t,!1,i);s.setGeometry(r),void 0!==a&&s.setId(a),s.setProperties(n,!0)}return s}getType(){return"arraybuffer"}readFeatures(t,e){const i=this.layers_;e=this.adaptOptions(e);const r=(0,Nr.Jt)(e.dataProjection);r.setWorldExtent(e.extent),e.dataProjection=r;const s=new fr(t),n=s.readFields(zr,{}),a=[];for(const o in n){if(i&&!i.includes(o))continue;const t=n[o],l=t?[0,0,t.extent,t.extent]:null;r.setExtent(l);for(let i=0,r=t.length;i<r;++i){const r=Jr(s,t,i),n=this.createFeature_(s,r,e);null!==n&&a.push(n)}}return a}readProjection(t){return this.dataProjection}setLayers(t){this.layers_=t}}function zr(t,e,i){if(3===t){const t={keys:[],values:[],features:[]},r=i.readVarint()+i.pos;i.readFields(Zr,t,r),t.length=t.features.length,t.length&&(e[t.name]=t)}}function Zr(t,e,i){if(15===t)e.version=i.readVarint();else if(1===t)e.name=i.readString();else if(5===t)e.extent=i.readVarint();else if(2===t)e.features.push(i.pos);else if(3===t)e.keys.push(i.readString());else if(4===t){let r=null;const s=i.readVarint()+i.pos;while(i.pos<s)t=i.readVarint()>>3,r=1===t?i.readString():2===t?i.readFloat():3===t?i.readDouble():4===t?i.readVarint64():5===t?i.readVarint():6===t?i.readSVarint():7===t?i.readBoolean():null;e.values.push(r)}}function Wr(t,e,i){if(1==t)e.id=i.readVarint();else if(2==t){const t=i.readVarint()+i.pos;while(i.pos<t){const t=e.layer.keys[i.readVarint()],r=e.layer.values[i.readVarint()];e.properties[t]=r}}else 3==t?e.type=i.readVarint():4==t&&(e.geometry=i.pos)}function Jr(t,e,i){t.pos=e.features[i];const r=t.readVarint()+t.pos,s={layer:e,type:0,properties:{}};return t.readFields(Wr,s,r),s}function Hr(t,e){let i;return 1===t?i=1===e?"Point":"MultiPoint":2===t?i=1===e?"LineString":"MultiLineString":3===t&&(i="Polygon"),i}var $r=Br,Xr=i(4863),Yr=Object.defineProperty,qr=Object.getOwnPropertySymbols,Kr=Object.prototype.hasOwnProperty,Qr=Object.prototype.propertyIsEnumerable,ts=(t,e,i)=>e in t?Yr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,es=(t,e)=>{for(var i in e||(e={}))Kr.call(e,i)&&ts(t,i,e[i]);if(qr)for(var i of qr(e))Qr.call(e,i)&&ts(t,i,e[i]);return t},is=(t,e)=>Yr(t,"name",{value:e,configurable:!0}),rs=(t,e,i)=>new Promise((r,s)=>{var n=t=>{try{o(i.next(t))}catch(_s){s(_s)}},a=t=>{try{o(i.throw(t))}catch(_s){s(_s)}},o=t=>t.done?r(t.value):Promise.resolve(t.value).then(n,a);o((i=i.apply(t,e)).next())}),ss=class extends rr["default"]{constructor(t){super(es(es({},t),{state:"loading"})),this.loadImage=is(t=>new Promise((e,i)=>{const r=new Image;r.addEventListener("load",()=>e(r)),r.addEventListener("error",()=>i(new Error("load failed"))),r.src=t}),"loadImage");const e=new Jt(t.url);e.getHeader().then(i=>{const r=void 0===t.projection?"EPSG:3857":t.projection;this.tileGrid=t.tileGrid||(0,Xr.EN)({extent:(0,Xr.kZ)(r),maxResolution:t.maxResolution,minZoom:i.minZoom,maxZoom:i.maxZoom,tileSize:t.tileSize}),this.setLoader((t,i,r)=>rs(this,null,function*(){const s=yield e.getZxy(t,i,r);if(!s)return new Uint8Array;const n=URL.createObjectURL(new Blob([s.data])),a=yield this.loadImage(n);return URL.revokeObjectURL(n),a})),this.setState("ready")})}};is(ss,"PMTilesRasterSource");var ns=ss,as=class extends oe["default"]{constructor(t){super(es(es({},t),{state:"loading",url:"pmtiles://{z}/{x}/{y}",format:t.format||new $r})),this.tileLoadFunction=is((t,e)=>{const i=t,r=new RegExp(/pmtiles:\/\/(\d+)\/(\d+)\/(\d+)/),s=e.match(r);if(!(s&&s.length>=4))throw Error("Could not parse tile URL");const n=+s[1],a=+s[2],o=+s[3];i.setLoader((t,e,r)=>{this.pmtiles_.getZxy(n,a,o).then(e=>{if(e){const s=i.getFormat();i.setFeatures(s.readFeatures(e.data,{extent:t,featureProjection:r})),i.setState(sr.A.LOADED)}else i.setFeatures([]),i.setState(sr.A.EMPTY)}).catch(t=>{i.setFeatures([]),i.setState(sr.A.ERROR)})})},"tileLoadFunction"),this.pmtiles_=new Jt(t.url),this.pmtiles_.getHeader().then(e=>{const i=t.projection||"EPSG:3857",r=t.extent||(0,Xr.kZ)(i);this.tileGrid=t.tileGrid||(0,Xr.EN)({extent:r,maxResolution:t.maxResolution,maxZoom:void 0!==t.maxZoom?t.maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:t.tileSize||512}),this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}};is(as,"PMTilesVectorSource");var os=as,ls=i(34533),hs=i(88319),cs=i(20537);class us extends Qt["default"]{constructor(t){const e={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(i=>e[i]=t[i]),super(e),this.getSourceOptions_=t.getSourceOptions,this.children_=null,this.childrenOptions_=t.childrenOptions||{},this.assets_=null,this.bands_=[],this.crossOrigin_=t.crossOrigin||null,this.displayFootprint_=!1!==t.displayFootprint,this.displayGeoTiffByDefault_=Boolean(t.displayGeoTiffByDefault),this.displayPreview_=Boolean(t.displayPreview),this.displayOverview_=!1!==t.displayOverview,this.displayWebMapLink_=t.displayWebMapLink||!1,this.buildTileUrlTemplate_=t.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=t.useTileLayerAsFallback||!1,this.boundsStyle_=t.boundsStyle||Yi,this.collectionStyle_=t.collectionStyle||qi,this.boundsLayer_=null,this.disableMigration_=t.disableMigration||!1,this.map_=null,this.eventQueue_=[],t.httpRequestFn&&(this.fetch_=t.httpRequestFn),t.data)try{this.configure_(t.data,t.url,t.children,t.assets,t.bands)}catch(i){this.handleError_(i)}else{if(!t.url)throw new Error("Either url or data must be provided");this.fetch_(t.url).then(e=>this.configure_(e,t.url,t.children,t.assets,t.bands)).catch(t=>this.handleError_(t))}}async fetch_(t,e="json"){const i=await fetch(t);if(!i.ok)throw new Error(`Unexpected response from ${t}: ${i.status}`);return"json"===e?await i.json():"text"===e?await i.text():null}getBoundsLayer(){return this.boundsLayer_}isEmpty(){var t;const e=this.getLayers().getLength();if(e>1)return!1;const i=null===(t=this.getData())||void 0===t?void 0:t.getBoundingBox();return!(i&&!(0,ce.Im)(i))||(!this.boundsLayer_||!this.displayFootprint_)}handleError_(t){this.dispatch_(new Xt(t))}configure_(t,e=null,i=null,r=null,s=[]){let n;t instanceof Bi.Vd||t instanceof Bi.O7?n=t:(n=(0,Bi["default"])(t,!this.disableMigration_),e&&e.includes("://")&&n.setAbsoluteUrl(e)),this.set("stac",n),this.bands_=s,this.boundsLayer_=this.addFootprint_();const a=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(er(this.boundsStyle_,this))};this.getLayers().on("add",a),this.getLayers().on("remove",a);const o=t=>this.handleError_(t),l=this.setChildren(i).catch(o),h=this.setAssets(r).catch(o);Promise.all([l,h]).then(()=>this.dispatch_("layersready")),this.dispatch_("sourceready")}dispatch_(t){this.eventQueue_.push(t),this.flush_()}flush_(){if(this.map_){for(const t of this.eventQueue_)this.dispatchEvent(t);this.eventQueue_=[]}}setMap_(t){this.map_!==t&&(this.map_=t,this.flush_())}async addChildren_(t,e={}){const i=t.map(t=>{const i={data:t,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_,useTileLayerAsFallback:this.useTileLayerAsFallback_,buildTileUrlTemplate:this.buildTileUrlTemplate_},r=new us(Object.assign(i,e));return r.on("sourceready",()=>{r.map_&&this.setMap_(r.map_)}),this.addLayer_(r,null),r});return await Promise.all(i)}async addPreviewImage_(t){const e=await tr(t,"EPSG:4326"),i=t.getContext().getBoundingBoxes();if(1!==i.length)return;const r=i[0];let s={url:t.getAbsoluteUrl(),projection:e,imageExtent:(0,Nr.DI)(r,"EPSG:4326",e),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(s=await this.getSourceOptions_(ee.ImageStatic,s,t));const n=new Kt["default"]({source:new ie["default"](s)});return this.addLayer_(n,t),n}async addLayerForLink(t){const e=ir(t);if(!e)return;const i={attributions:t.getMetadata("attribution")||this.getData().getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:e},r=async(e,i)=>(this.getSourceOptions_&&(i=await this.getSourceOptions_(e,i,t)),i),s=[];switch(t.rel){case"pmtiles":const n=new Jt(i.url),a=await n.getHeader();let o;switch(a.tileType){case At.Mvt:o=new os(await r(ee.PMTilesVector,i));break;case At.Avif:case At.Jpeg:case At.Png:case At.Webp:o=new ns(await r(ee.PMTilesRaster,i));break;default:return}s.push(o);break;case"tilejson":s.push(new re["default"](await r(ee.TileJSON,i)));break;case"wms":if(!Array.isArray(t["wms:layers"]))break;for(const e in t["wms:layers"]){const n=t["wms:layers"][e]||"";let a="";Array.isArray(t["wms:styles"])&&"string"===typeof t["wms:styles"][e]&&(a=t["wms:styles"][e]);const o=Object.assign({LAYERS:n,STYLES:a},t["wms:dimensions"]);"boolean"===typeof t["wms:transparent"]&&(o.TRANSPARENT=String(t["wms:transparent"])),"string"===typeof t["type"]&&t["type"].startsWith("image/")&&(o.FORMAT=t["type"]);const l=await r(ee.TileWMS,Object.assign({},i,{params:o}));s.push(new le["default"](l))}break;case"wmts":const l=await this.getWmtsCapabilities_(e);if(!l)return;const h=Array.isArray(t["wmts:layer"])?t["wmts:layer"]:[t["wmts:layer"]];for(const e of h){let n=Object.assign({},i,{layer:e});"string"===typeof t["type"]&&t["type"].startsWith("image/")&&(n.format=t["type"]),n=await r(ee.WMTS,n),s.push(new he["default"]((0,he.optionsFromCapabilities)(l,n)))}break;case"xyz":s.push(new Gi["default"](await r(ee.XYZ,i)));break;default:return}return s.map(e=>{let i;return i=e instanceof oe["default"]?new ae["default"]({source:e,declutter:!0}):e instanceof ns?new ji["default"]({source:e}):new se["default"]({source:e}),this.addLayer_(i,t),i})}async addGeoTiff_(t){if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(t);const e=Qi(t,this.bands_);let i={sources:[e],convertToRGB:"auto"};const r=await tr(t);r&&(i.projection=r),this.getSourceOptions_&&(i=await this.getSourceOptions_(ee.GeoTIFF,i,t));const s=new qt["default"](i),n=new Promise((t,e)=>{s.on("error",e),s.on("change",()=>{"error"===s.getState()?e(s.getError()):t()})});try{await n;const e=new ji["default"]({source:s});return this.addLayer_(e,t),e}catch(a){if(this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(t);this.handleError_(a)}}async addTileLayerForImagery_(t){let e=this.buildTileUrlTemplate_(t);e instanceof Promise&&(e=await e);let i={crossOrigin:this.crossOrigin_,url:e};this.getSourceOptions_&&(i=await this.getSourceOptions_(ee.XYZ,i,t));const r=new se["default"]({source:new Gi["default"](i)});return this.addLayer_(r,t),r}addLayer_(t,e=null,i=0){e&&t.set("stac",e),t.setZIndex(i),this.getLayers().push(t)}addFootprint_(){let t=null;const e=this.getData();if(t=e.isItemCollection()||e.isCollectionCollection()?(0,ls.Jx)(e.getBoundingBox()):e.toGeoJSON(),t){const i=this.createGeoJsonLayer_(t,er(this.boundsStyle_,this),this.displayFootprint_);return i.set("bounds",!0),i.on("change",()=>this.setMap_(i.getMapInternal())),this.addLayer_(i,e,1),i}return null}async addGeoJson_(t){try{const e=await this.fetch_(t.getAbsoluteUrl()),i=this.createGeoJsonLayer_(e);return this.addLayer_(i,t),i}catch(e){this.handleError_(e)}}createGeoJsonLayer_(t,e=null,i=!0){const r=new Yt.A,s=new ne["default"]({format:r,loader:(e,i,n)=>{t=(0,ls.z)(t);const a=r.readFeatures(t,{featureProjection:n});s.addFeatures(a)}});return e||(e=qi),new y["default"]({source:s,style:e,visible:i})}async addLabelExtension_(){const t=this.getData();if(!(t instanceof Bi.q7))return;let e,i=t.getAssetsWithRoles(["labels","labels-vector"],!0);i.length>1&&(e=i.find(t=>t.roles.includes("labels-vector"))),e||(e=t.getAsset("vector_labels")),e||(i=t.getAssets().filter(t=>t.type===hs.oV&&!t.roles),1===i.length&&(e=i[0]));const r=t.getLinksWithRels(["source"]);if(e&&r.length>0){const t=r.map(async t=>{try{const e=await this.fetch_(t.getAbsoluteUrl()),i=(0,Bi["default"])(e);return i}catch(e){return this.handleError_(e),null}}),e=(await Promise.all(t)).filter(t=>t instanceof Bi.O7);await this.addChildren_(e,{displayFootprint:!1})}try{await this.addGeoJson_(e)}catch(s){this.handleError_(s)}}async updateLayers_(){const t=this.getLayers();for(let r=t.getLength()-1;r>=0;r--){const e=t.item(r);e.get("stac")&&!e.get("bounds")&&t.removeAt(r)}const e=this.getData();if(Array.isArray(this.displayWebMapLink_)){const t=this.getWebMapLinks().map(async t=>await this.addLayerForLink(t));await Promise.all(t)}this.children_&&await this.addChildren_(this.children_,this.childrenOptions_);const i=this.getAssets();if(i){const t=i.map(async t=>{if(t)return t.type===hs.oV?await this.addGeoJson_(t):t.isGeoTIFF()?await this.addGeoTiff_(t):t.canBrowserDisplayImage()?await this.addPreviewImage_(t):void 0});await Promise.all(t)}if(this.hasOnlyBounds())if(e instanceof Bi.Ly)await this.addChildren_(e.getAll(),this.childrenOptions_);else if(e instanceof Bi.O7){if(e.isItem()&&e.supportsExtension(Hi)&&"vector"===e.getMetadata("label:type"))return void await this.addLabelExtension_();const t=this.getWebMapLinks();if(t.length>0)await this.addLayerForLink(t[0]);else{const t=e.getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);let i;if(t&&this.displayOverview_&&(i=await this.addGeoTiff_(t)),this.displayPreview_&&(!t||!i)){const t=e.getThumbnails(!0,"overview");t.length>0&&await this.addPreviewImage_(t[0])}}}}hasOnlyBounds(){const t=this.getBoundsLayer(),e=this.getLayersArray().find(e=>e!==t);return"undefined"===typeof e}getWebMapLinks(){const t=this.getData();if(t instanceof Bi.Vd)return[];let e=["xyz","tilejson","pmtiles","wmts","wms"];"string"===typeof this.displayWebMapLink_&&(e=[this.displayWebMapLink_]);let i=t.getLinksWithRels(e);return Array.isArray(this.displayWebMapLink_)?i=this.displayWebMapLink_.map(t=>{if("string"===typeof t){const e=i.find(e=>e.id===t);return e||null}return t}).filter(t=>!!t):i.sort((t,i)=>{const r=e.indexOf(t.rel),s=e.indexOf(i.rel);return r-s}),i}async setAssets(t){if(Array.isArray(t)){const e=this.getData();this.assets_=t.map(t=>e instanceof Bi.O7&&"string"===typeof t?e.getAsset(t):t instanceof Bi.Vd?t:new Bi.Vd(t))}else this.assets_=null;await this.updateLayers_()}async setChildren(t,e=null){t instanceof Bi.iJ?this.children_=t.getAll():(0,cs.Gv)(t)&&"FeatureCollection"===t.type?this.children_=(0,Bi["default"])(t,!this.disableMigration_).getAll():Array.isArray(t)?this.children_=t.map(t=>t instanceof Bi.O7?t:(0,Bi["default"])(t,!this.disableMigration_)):this.children_=null,this.children_&&0===this.children_.length&&(this.children_=null),this.children_&&(0,cs.Gv)(e)&&(this.childrenOptions_=e),await this.updateLayers_()}getData(){return this.get("stac")}getChildren(){return this.children_}getAssets(){return this.assets_}getExtent(){if(!this.map_)return;const t=this.map_.getView();if(!t)return;let e;const i=this.getData();i&&(e=i.getBoundingBox());const r=this.getChildren();if(r){const t=r.map(t=>t.getBoundingBox());e=(0,ls.l6)(t)}return e?(0,Nr.DI)(e,"EPSG:4326",t.getProjection()):void 0}getLayerState(){const t=super.getLayerState();return t.extent=void 0,t}getAttributions(){const t=[],e=this.getData();if(e){const t=e.getMetadata("attribution");t&&t.push(t)}return t}getSource(){return null}async getWmtsCapabilities_(t){try{const e=new URL(t);e.searchParams.set("service","wmts"),e.searchParams.set("request","GetCapabilities");const i=await this.fetch_(e.toString(),"text");return(new Ni).read(i)}catch(e){return null}}}var ds=us;const fs=Xi("#ff0000",2,null);let ps=0;var gs={name:"Map",components:{BPopover:h.u,Items:()=>Promise.resolve().then(i.bind(i,58224)),LayerControl:a.A,TextControl:o.A},mixins:[n.A],props:{stac:{type:Object,default:null},assets:{type:Array,default:null},items:{type:Object,default:null},onfocusOnly:{type:Boolean,default:!1},popover:{type:Boolean,default:!1}},data(){return{stacLayer:null,selectedItems:null,empty:!1,selector:null,mapId:"map-"+ ++ps}},computed:{...(0,l.L8)(["getStac"]),container(){return this.isFullScreen?"#"+this.mapId:"#stac-browser"}},watch:{async stac(){await this.showStacLayer()},async assets(){this.stacLayer&&await this.stacLayer.setAssets(this.assets)},async items(){this.stacLayer&&(await this.stacLayer.setAssets(null),await this.stacLayer.setChildren(this.items,{displayPreview:!0}),this.fit())},empty(t){t&&this.$emit("empty")},selectedItems(t){!t&&this.selector&&this.selector.getFeatures().clear()}},async mounted(){await this.showStacLayer()},methods:{async showStacLayer(){this.map=null,this.stacLayer=null,await this.createMap(this.$refs.map,this.stac,this.onfocusOnly),this.stac&&await this.addStacLayer()},async addStacLayer(){let t=Object.assign({},this.stacLayerOptions,{data:this.stac,children:this.items,assets:this.assets||null,displayWebMapLink:!0,displayPreview:!this.items,disableMigration:!0});this.stacLayer=new ds(t),this.stacLayer.on("error",t=>{console.warn(t),this.fit()}),this.stacLayer.on("sourceready",this.fit),this.stacLayer.on("layersready",()=>{this.empty=this.stacLayer.isEmpty(),this.$emit("assets",this.stacLayer.getAssets())}),this.map.addLayer(this.stacLayer),this.popover&&(this.selector=new A({toggleCondition:()=>!1,condition:()=>!1,style:fs}),this.map.addInteraction(this.selector),this.map.on("singleclick",async t=>{this.$refs.target.style.left=t.pixel[0]+"px",this.$refs.target.style.top=t.pixel[1]+"px",this.selector.getFeatures().clear();const e=this.selector.getFeatures(),i=this.stacLayer.getData(),r=await Ki(t,i,e,5);r.length>0?this.selectedItems={target:this.$refs.target,items:r.map(t=>this.getStac(t.getAbsoluteUrl()))}:this.selectedItems=null}),this.map.on("change",()=>this.selectedItems=null),this.map.on("movestart",()=>this.selectedItems=null))},fit(){const t=this.stacLayer.getExtent();t&&(this.map.updateSize(),this.map.getView().fit(t,{padding:[50,50,50,50]}))},resetSelectedItems(){this.selectedItems=null}}},ms=gs,ys=i(81656),ws=(0,ys.A)(ms,r,s,!1,null,null,null),vs=ws.exports},48807:function(t,e,i){i.r(e),i.d(e,{createLoader:function(){return n}});var r=i(43938),s=i(70915);function n(t){const e=t.load||r.D4,i=t.imageExtent,n=t.crossOrigin??null;return()=>{const r=new Image;return r.crossOrigin=n,e(r,t.url).then(t=>{const e=(0,s.RG)(i)/t.width,r=(0,s.Oq)(i)/t.height,n=e!==r?[e,r]:r;return{image:t,extent:i,resolution:n,pixelRatio:1}})}}},53820:function(t,e,i){i.r(e);var r=i(69796),s=i(70107);class n extends s["default"]{constructor(t){super(t)}createRenderer(){return new r.A(this)}getData(t){return super.getData(t)}}e["default"]=n},58262:function(t,e,i){i.r(e);var r=i(43938),s=i(6837),n=i(70915),a=i(38599),o=i(83440),l=i(48807);class h extends o["default"]{constructor(t){const e=void 0!==t.crossOrigin?t.crossOrigin:null,i=void 0!==t.imageLoadFunction?t.imageLoadFunction:o.defaultImageLoadFunction;super({attributions:t.attributions,interpolate:t.interpolate,projection:(0,a.Jt)(t.projection)}),this.url_=t.url,this.imageExtent_=t.imageExtent,this.image=null,this.image=new r.Ay(this.imageExtent_,void 0,1,(0,l.createLoader)({url:t.url,imageExtent:t.imageExtent,crossOrigin:e,load:(t,e)=>(this.image.setImage(t),i(this.image,e),(0,r.D4)(t))})),this.image.addEventListener(s.A.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(t,e,i,r){return(0,n.HY)(t,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}e["default"]=h},69796:function(t,e,i){var r=i(6141),s=i(62703),n=i(70915),a=i(38599),o=i(9703),l=i(96769);class h extends l.A{constructor(t){super(t),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],i=t.pixelRatio,o=t.viewState,l=o.resolution,h=this.getLayer().getSource(),c=t.viewHints;let u=t.extent;if(void 0!==e.extent&&(u=(0,n._N)(u,(0,a.SD)(e.extent,o.projection))),!c[s.A.ANIMATING]&&!c[s.A.INTERACTING]&&!(0,n.Im)(u))if(h){const t=o.projection,e=h.getImage(u,l,i,t);e&&(this.loadImage(e)?this.image=e:e.getState()===r.A.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),r=(0,o.Bb)(e.pixelToCoordinateTransform,t.slice()),s=i.getExtent();if(s&&!(0,n.Ym)(s,r))return null;const a=this.image.getExtent(),l=this.image.getImage(),h=(0,n.RG)(a),c=Math.floor(l.width*((r[0]-a[0])/h));if(c<0||c>=l.width)return null;const u=(0,n.Oq)(a),d=Math.floor(l.height*((a[3]-r[1])/u));return d<0||d>=l.height?null:this.getImageData(l,c,d)}renderFrame(t,e){const i=this.image,r=i.getExtent(),s=i.getResolution(),[l,h]=Array.isArray(s)?s:[s,s],c=i.getPixelRatio(),u=t.layerStatesArray[t.layerIndex],d=t.pixelRatio,f=t.viewState,p=f.center,g=f.resolution,m=d*l/(g*c),y=d*h/(g*c);this.prepareContainer(t,e);const w=this.context.canvas.width,v=this.context.canvas.height,_=this.getRenderContext(t);let b=!1,x=!0;if(u.extent){const e=(0,a.SD)(u.extent,f.projection);x=(0,n.HY)(e,t.extent),b=x&&!(0,n.ms)(e,t.extent),b&&this.clipUnrotated(_,t,e)}const S=i.getImage(),T=(0,o.Zz)(this.tempTransform,w/2,v/2,m,y,0,c*(r[0]-p[0])/l,c*(p[1]-r[3])/h);this.renderedResolution=h*d/c;const L=S.width*T[0],E=S.height*T[3];if(this.getLayer().getSource().getInterpolate()||(_.imageSmoothingEnabled=!1),this.preRender(_,t),x&&L>=.5&&E>=.5){const t=T[4],e=T[5],i=u.opacity;1!==i&&(_.save(),_.globalAlpha=i),_.drawImage(S,0,0,+S.width,+S.height,t,e,L,E),1!==i&&_.restore()}return this.postRender(this.context,t),b&&_.restore(),_.imageSmoothingEnabled=!0,this.container}}e.A=h},70107:function(t,e,i){i.r(e);var r=i(60764);class s extends r["default"]{constructor(t){t=t||{},super(t)}}e["default"]=s},77076:function(t,e,i){i.d(e,{FQ:function(){return s},O2:function(){return l},hm:function(){return o}});var r=i(4087);function s(t,e,i,s){const n=document.createElement("script"),a="olc_"+(0,r.v6)(e);function o(){delete window[a],n.parentNode.removeChild(n)}n.async=!0,n.src=t+(t.includes("?")?"&":"?")+(s||"callback")+"="+a;const l=setTimeout(function(){o(),i&&i()},1e4);window[a]=function(t){clearTimeout(l),o(),e(t)},document.head.appendChild(n)}class n extends Error{constructor(t){const e="Unexpected response status: "+t.status;super(e),this.name="ResponseError",this.response=t}}class a extends Error{constructor(t){super("Failed to issue request"),this.name="ClientError",this.client=t}}function o(t){return new Promise(function(e,i){function r(t){const r=t.target;if(!r.status||r.status>=200&&r.status<300){let t;try{t=JSON.parse(r.responseText)}catch(s){const t="Error parsing response text as JSON: "+s.message;return void i(new Error(t))}return void e(t)}i(new n(r))}function s(t){i(new a(t.target))}const o=new XMLHttpRequest;o.addEventListener("load",r),o.addEventListener("error",s),o.open("GET",t),o.setRequestHeader("Accept","application/json"),o.send()})}function l(t,e){return e.includes("://")?e:new URL(e,t).href}},82728:function(t,e,i){i.r(e);var r=i(70915),s=i(61597),n=i(38599),a=i(33513),o=i(82806),l=i(40186),h=i(14465),c=i(28512),u=i(7500);class d extends c["default"]{constructor(t){t=t||{};const e=Object.assign({},t.params);super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0,this.params_=e,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=void 0===t.hidpi||t.hidpi,this.tmpExtent_=(0,r.S5)(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(t,e,i,s){const o=(0,n.Jt)(i),l=this.getProjection()||o;let h=this.getTileGrid();h||(h=this.getTileGridForProjection(l));const c=(0,n.pd)(t,o,l),d=(0,a.KQ)(l,o,t,e),f=h.getZForResolution(d,this.zDirection),p=h.getResolution(f),g=h.getTileCoordForCoordAndZ(c,f);if(h.getResolutions().length<=g[0])return;let m=h.getTileCoordExtent(g,this.tmpExtent_);const y=this.gutter_;0!==y&&(m=(0,r.r)(m,p*y,m));const w={QUERY_LAYERS:this.params_["LAYERS"]};Object.assign(w,(0,u.getRequestParams)(this.params_,"GetFeatureInfo"),s);const v=Math.floor((c[0]-m[0])/p),_=Math.floor((m[3]-c[1])/p);return w[this.v13_?"I":"X"]=v,w[this.v13_?"J":"Y"]=_,this.getRequestUrl_(g,m,1,l||o,w)}getLegendUrl(t,e){if(void 0===this.urls[0])return;const i={SERVICE:"WMS",VERSION:u.DEFAULT_VERSION,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===e||void 0===e["LAYER"]){const t=this.params_.LAYERS,e=!Array.isArray(t)||1===t.length;if(!e)return;i["LAYER"]=t}if(void 0!==t){const e=this.getProjection()?this.getProjection().getMetersPerUnit():1,r=28e-5;i["SCALE"]=t*e/r}return Object.assign(i,e),(0,h.LW)(this.urls[0],i)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(t,e,i,r,n){const a=this.urls;if(!a)return;let o;if(1==a.length)o=a[0];else{const e=(0,s.xP)((0,l.tW)(t),a.length);o=a[e]}return(0,u.getImageSrc)(e,(this.tileGrid||this.getTileGridForProjection(r)).getResolution(t[0]),i,r,o,n,this.serverType_)}getTilePixelRatio(t){return this.hidpi_&&void 0!==this.serverType_?t:1}getKeyForParams_(){let t=0;const e=[];for(const i in this.params_)e[t++]=i+"-"+this.params_[i];return e.join("/")}setParams_(t){this.params_=t,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(t){this.setParams_(Object.assign({},t))}updateParams(t){this.setParams_(Object.assign(this.params_,t))}updateV13_(){const t=this.params_["VERSION"]||u.DEFAULT_VERSION;this.v13_=(0,o.Z)(t,"1.3")>=0}tileUrlFunction(t,e,i){let s=this.getTileGrid();if(s||(s=this.getTileGridForProjection(i)),s.getResolutions().length<=t[0])return;1==e||this.hidpi_&&void 0!==this.serverType_||(e=1);const n=s.getResolution(t[0]);let a=s.getTileCoordExtent(t,this.tmpExtent_);const o=this.gutter_;0!==o&&(a=(0,r.r)(a,n*o,a));const l=Object.assign({},(0,u.getRequestParams)(this.params_,"GetMap"));return this.getRequestUrl_(t,a,e,i,l)}}e["default"]=d}}]);
//# sourceMappingURL=1386.462c1b1c.js.map