{"version":3,"file":"js/4582.73a7aed1.js","mappings":"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","sources":["webpack://@radiantearth/stac-browser/./node_modules/ol/resolution.js","webpack://@radiantearth/stac-browser/./node_modules/ol/reproj/Image.js","webpack://@radiantearth/stac-browser/./node_modules/ol/source/Image.js","webpack://@radiantearth/stac-browser/./node_modules/ol/source/ImageMapGuide.js","webpack://@radiantearth/stac-browser/./node_modules/ol/source/common.js","webpack://@radiantearth/stac-browser/./node_modules/ol/source/mapguide.js","webpack://@radiantearth/stac-browser/./node_modules/ol/tilecoord.js","webpack://@radiantearth/stac-browser/./node_modules/ol/uri.js"],"sourcesContent":["/**\n * @module ol/resolution\n */\n\n/**\n * @typedef {number|Array<number>} ResolutionLike\n */\n\n/**\n * @param {ResolutionLike} resolution Resolution.\n * @return {number} Resolution.\n */\nexport function fromResolutionLike(resolution) {\n  if (Array.isArray(resolution)) {\n    return Math.min(...resolution);\n  }\n  return resolution;\n}\n","/**\n * @module ol/reproj/Image\n */\n\nimport ImageWrapper from '../Image.js';\nimport ImageState from '../ImageState.js';\nimport EventType from '../events/EventType.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport {\n  getCenter,\n  getHeight,\n  getIntersection,\n  getWidth,\n  isEmpty,\n} from '../extent.js';\nimport {\n  calculateSourceResolution,\n  render as renderReprojected,\n} from '../reproj.js';\nimport {fromResolutionLike} from '../resolution.js';\nimport Triangulation from './Triangulation.js';\nimport {ERROR_THRESHOLD} from './common.js';\n\n/**\n * @typedef {function(import(\"../extent.js\").Extent, number, number) : import(\"../Image.js\").default} FunctionType\n */\n\n/**\n * @classdesc\n * Class encapsulating single reprojected image.\n * See {@link module:ol/source/Image~ImageSource}.\n */\nclass ReprojImage extends ImageWrapper {\n  /**\n   * @param {import(\"../proj/Projection.js\").default} sourceProj Source projection (of the data).\n   * @param {import(\"../proj/Projection.js\").default} targetProj Target projection.\n   * @param {import(\"../extent.js\").Extent} targetExtent Target extent.\n   * @param {number} targetResolution Target resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {FunctionType} getImageFunction\n   *     Function returning source images (extent, resolution, pixelRatio).\n   * @param {boolean} interpolate Use linear interpolation when resampling.\n   */\n  constructor(\n    sourceProj,\n    targetProj,\n    targetExtent,\n    targetResolution,\n    pixelRatio,\n    getImageFunction,\n    interpolate,\n  ) {\n    let maxSourceExtent = sourceProj.getExtent();\n    if (maxSourceExtent && sourceProj.canWrapX()) {\n      maxSourceExtent = maxSourceExtent.slice();\n      maxSourceExtent[0] = -Infinity;\n      maxSourceExtent[2] = Infinity;\n    }\n    let maxTargetExtent = targetProj.getExtent();\n    if (maxTargetExtent && targetProj.canWrapX()) {\n      maxTargetExtent = maxTargetExtent.slice();\n      maxTargetExtent[0] = -Infinity;\n      maxTargetExtent[2] = Infinity;\n    }\n\n    const limitedTargetExtent = maxTargetExtent\n      ? getIntersection(targetExtent, maxTargetExtent)\n      : targetExtent;\n\n    const targetCenter = getCenter(limitedTargetExtent);\n    const sourceResolution = calculateSourceResolution(\n      sourceProj,\n      targetProj,\n      targetCenter,\n      targetResolution,\n    );\n\n    const errorThresholdInPixels = ERROR_THRESHOLD;\n\n    const triangulation = new Triangulation(\n      sourceProj,\n      targetProj,\n      limitedTargetExtent,\n      maxSourceExtent,\n      sourceResolution * errorThresholdInPixels,\n      targetResolution,\n    );\n\n    const sourceExtent = triangulation.calculateSourceExtent();\n    const sourceImage = isEmpty(sourceExtent)\n      ? null\n      : getImageFunction(sourceExtent, sourceResolution, pixelRatio);\n    const state = sourceImage ? ImageState.IDLE : ImageState.EMPTY;\n    const sourcePixelRatio = sourceImage ? sourceImage.getPixelRatio() : 1;\n\n    super(targetExtent, targetResolution, sourcePixelRatio, state);\n\n    /**\n     * @private\n     * @type {import(\"../proj/Projection.js\").default}\n     */\n    this.targetProj_ = targetProj;\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.maxSourceExtent_ = maxSourceExtent;\n\n    /**\n     * @private\n     * @type {!import(\"./Triangulation.js\").default}\n     */\n    this.triangulation_ = triangulation;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.targetResolution_ = targetResolution;\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.targetExtent_ = targetExtent;\n\n    /**\n     * @private\n     * @type {import(\"../Image.js\").default}\n     */\n    this.sourceImage_ = sourceImage;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.sourcePixelRatio_ = sourcePixelRatio;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.interpolate_ = interpolate;\n\n    /**\n     * @private\n     * @type {HTMLCanvasElement}\n     */\n    this.canvas_ = null;\n\n    /**\n     * @private\n     * @type {?import(\"../events.js\").EventsKey}\n     */\n    this.sourceListenerKey_ = null;\n  }\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    if (this.state == ImageState.LOADING) {\n      this.unlistenSource_();\n    }\n    super.disposeInternal();\n  }\n\n  /**\n   * @return {HTMLCanvasElement} Image.\n   * @override\n   */\n  getImage() {\n    return this.canvas_;\n  }\n\n  /**\n   * @return {import(\"../proj/Projection.js\").default} Projection.\n   */\n  getProjection() {\n    return this.targetProj_;\n  }\n\n  /**\n   * @private\n   */\n  reproject_() {\n    const sourceState = this.sourceImage_.getState();\n    if (sourceState == ImageState.LOADED) {\n      const width = getWidth(this.targetExtent_) / this.targetResolution_;\n      const height = getHeight(this.targetExtent_) / this.targetResolution_;\n      this.canvas_ = renderReprojected(\n        width,\n        height,\n        this.sourcePixelRatio_,\n        fromResolutionLike(this.sourceImage_.getResolution()),\n        this.maxSourceExtent_,\n        this.targetResolution_,\n        this.targetExtent_,\n        this.triangulation_,\n        [\n          {\n            extent: this.sourceImage_.getExtent(),\n            image: this.sourceImage_.getImage(),\n          },\n        ],\n        0,\n        undefined,\n        this.interpolate_,\n        true,\n      );\n    }\n    this.state = sourceState;\n    this.changed();\n  }\n\n  /**\n   * Load not yet loaded URI.\n   * @override\n   */\n  load() {\n    if (this.state == ImageState.IDLE) {\n      this.state = ImageState.LOADING;\n      this.changed();\n\n      const sourceState = this.sourceImage_.getState();\n      if (sourceState == ImageState.LOADED || sourceState == ImageState.ERROR) {\n        this.reproject_();\n      } else {\n        this.sourceListenerKey_ = listen(\n          this.sourceImage_,\n          EventType.CHANGE,\n          (e) => {\n            const sourceState = this.sourceImage_.getState();\n            if (\n              sourceState == ImageState.LOADED ||\n              sourceState == ImageState.ERROR\n            ) {\n              this.unlistenSource_();\n              this.reproject_();\n            }\n          },\n        );\n        this.sourceImage_.load();\n      }\n    }\n  }\n\n  /**\n   * @private\n   */\n  unlistenSource_() {\n    unlistenByKey(\n      /** @type {!import(\"../events.js\").EventsKey} */ (\n        this.sourceListenerKey_\n      ),\n    );\n    this.sourceListenerKey_ = null;\n  }\n}\n\nexport default ReprojImage;\n","/**\n * @module ol/source/Image\n */\nimport ImageWrapper from '../Image.js';\nimport ImageState from '../ImageState.js';\nimport {linearFindNearest} from '../array.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport {\n  containsExtent,\n  equals,\n  getCenter,\n  getForViewAndSize,\n  getHeight,\n  getWidth,\n} from '../extent.js';\nimport {ceil} from '../math.js';\nimport {equivalent} from '../proj.js';\nimport ReprojImage from '../reproj/Image.js';\nimport {fromResolutionLike} from '../resolution.js';\nimport Source from './Source.js';\nimport {DECIMALS} from './common.js';\n\n/**\n * @enum {string}\n */\nexport const ImageSourceEventType = {\n  /**\n   * Triggered when an image starts loading.\n   * @event module:ol/source/Image.ImageSourceEvent#imageloadstart\n   * @api\n   */\n  IMAGELOADSTART: 'imageloadstart',\n\n  /**\n   * Triggered when an image finishes loading.\n   * @event module:ol/source/Image.ImageSourceEvent#imageloadend\n   * @api\n   */\n  IMAGELOADEND: 'imageloadend',\n\n  /**\n   * Triggered if image loading results in an error.\n   * @event module:ol/source/Image.ImageSourceEvent#imageloaderror\n   * @api\n   */\n  IMAGELOADERROR: 'imageloaderror',\n};\n\n/**\n * @typedef {'imageloadend'|'imageloaderror'|'imageloadstart'} ImageSourceEventTypes\n */\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/source/Image~ImageSource} instances are instances of this\n * type.\n */\nexport class ImageSourceEvent extends Event {\n  /**\n   * @param {string} type Type.\n   * @param {import(\"../Image.js\").default} image The image.\n   */\n  constructor(type, image) {\n    super(type);\n\n    /**\n     * The image related to the event.\n     * @type {import(\"../Image.js\").default}\n     * @api\n     */\n    this.image = image;\n  }\n}\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types, import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<ImageSourceEventTypes, ImageSourceEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types\n *     |ImageSourceEventTypes, Return>} ImageSourceOnSignature\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {import(\"../Image.js\").Loader} [loader] Loader. Can either be a custom loader, or one of the\n * loaders created with a `createLoader()` function ({@link module:ol/source/wms.createLoader wms},\n * {@link module:ol/source/arcgisRest.createLoader arcgisRest}, {@link module:ol/source/mapguide.createLoader mapguide},\n * {@link module:ol/source/static.createLoader static}).\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection.\n * @property {Array<number>} [resolutions] Resolutions.\n * @property {import(\"./Source.js\").State} [state] State.\n */\n\n/**\n * @classdesc\n * Base class for sources providing a single image.\n * @fires module:ol/source/Image.ImageSourceEvent\n * @api\n */\nclass ImageSource extends Source {\n  /**\n   * @param {Options} options Single image source options.\n   */\n  constructor(options) {\n    super({\n      attributions: options.attributions,\n      projection: options.projection,\n      state: options.state,\n      interpolate:\n        options.interpolate !== undefined ? options.interpolate : true,\n    });\n\n    /***\n     * @type {ImageSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {ImageSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {ImageSourceOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @protected\n     * @type {import(\"../Image.js\").Loader}\n     */\n    this.loader = options.loader || null;\n\n    /**\n     * @private\n     * @type {Array<number>|null}\n     */\n    this.resolutions_ =\n      options.resolutions !== undefined ? options.resolutions : null;\n\n    /**\n     * @private\n     * @type {import(\"../reproj/Image.js\").default}\n     */\n    this.reprojectedImage_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.reprojectedRevision_ = 0;\n\n    /**\n     * @protected\n     * @type {import(\"../Image.js\").default}\n     */\n    this.image = null;\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.wantedExtent_;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.wantedResolution_;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.static_ = options.loader ? options.loader.length === 0 : false;\n\n    /**\n     * @private\n     * @type {import(\"../proj/Projection.js\").default}\n     */\n    this.wantedProjection_ = null;\n  }\n\n  /**\n   * @return {Array<number>|null} Resolutions.\n   * @override\n   */\n  getResolutions() {\n    return this.resolutions_;\n  }\n\n  /**\n   * @param {Array<number>|null} resolutions Resolutions.\n   */\n  setResolutions(resolutions) {\n    this.resolutions_ = resolutions;\n  }\n\n  /**\n   * @protected\n   * @param {number} resolution Resolution.\n   * @return {number} Resolution.\n   */\n  findNearestResolution(resolution) {\n    const resolutions = this.getResolutions();\n    if (resolutions) {\n      const idx = linearFindNearest(resolutions, resolution, 0);\n      resolution = resolutions[idx];\n    }\n    return resolution;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../Image.js\").default} Single image.\n   */\n  getImage(extent, resolution, pixelRatio, projection) {\n    const sourceProjection = this.getProjection();\n    if (\n      !sourceProjection ||\n      !projection ||\n      equivalent(sourceProjection, projection)\n    ) {\n      if (sourceProjection) {\n        projection = sourceProjection;\n      }\n\n      return this.getImageInternal(extent, resolution, pixelRatio, projection);\n    }\n    if (this.reprojectedImage_) {\n      if (\n        this.reprojectedRevision_ == this.getRevision() &&\n        equivalent(this.reprojectedImage_.getProjection(), projection) &&\n        this.reprojectedImage_.getResolution() == resolution &&\n        equals(this.reprojectedImage_.getExtent(), extent)\n      ) {\n        return this.reprojectedImage_;\n      }\n      this.reprojectedImage_.dispose();\n      this.reprojectedImage_ = null;\n    }\n\n    this.reprojectedImage_ = new ReprojImage(\n      sourceProjection,\n      projection,\n      extent,\n      resolution,\n      pixelRatio,\n      (extent, resolution, pixelRatio) =>\n        this.getImageInternal(extent, resolution, pixelRatio, sourceProjection),\n      this.getInterpolate(),\n    );\n    this.reprojectedRevision_ = this.getRevision();\n\n    return this.reprojectedImage_;\n  }\n\n  /**\n   * @abstract\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../Image.js\").default} Single image.\n   * @protected\n   */\n  getImageInternal(extent, resolution, pixelRatio, projection) {\n    if (this.loader) {\n      const requestExtent = getRequestExtent(extent, resolution, pixelRatio, 1);\n      const requestResolution = this.findNearestResolution(resolution);\n      if (\n        this.image &&\n        (this.static_ ||\n          (this.wantedProjection_ === projection &&\n            ((this.wantedExtent_ &&\n              containsExtent(this.wantedExtent_, requestExtent)) ||\n              containsExtent(this.image.getExtent(), requestExtent)) &&\n            ((this.wantedResolution_ &&\n              fromResolutionLike(this.wantedResolution_) ===\n                requestResolution) ||\n              fromResolutionLike(this.image.getResolution()) ===\n                requestResolution)))\n      ) {\n        return this.image;\n      }\n      this.wantedProjection_ = projection;\n      this.wantedExtent_ = requestExtent;\n      this.wantedResolution_ = requestResolution;\n      this.image = new ImageWrapper(\n        requestExtent,\n        requestResolution,\n        pixelRatio,\n        this.loader,\n      );\n      this.image.addEventListener(\n        EventType.CHANGE,\n        this.handleImageChange.bind(this),\n      );\n    }\n    return this.image;\n  }\n\n  /**\n   * Handle image change events.\n   * @param {import(\"../events/Event.js\").default} event Event.\n   * @protected\n   */\n  handleImageChange(event) {\n    const image = /** @type {import(\"../Image.js\").default} */ (event.target);\n    let type;\n    switch (image.getState()) {\n      case ImageState.LOADING:\n        this.loading = true;\n        type = ImageSourceEventType.IMAGELOADSTART;\n        break;\n      case ImageState.LOADED:\n        this.loading = false;\n        type = ImageSourceEventType.IMAGELOADEND;\n        break;\n      case ImageState.ERROR:\n        this.loading = false;\n        type = ImageSourceEventType.IMAGELOADERROR;\n        break;\n      default:\n        return;\n    }\n    if (this.hasListener(type)) {\n      this.dispatchEvent(new ImageSourceEvent(type, image));\n    }\n  }\n}\n\n/**\n * Default image load function for image sources that use import(\"../Image.js\").Image image\n * instances.\n * @param {import(\"../Image.js\").default} image Image.\n * @param {string} src Source.\n */\nexport function defaultImageLoadFunction(image, src) {\n  /** @type {HTMLImageElement|HTMLVideoElement} */ (image.getImage()).src = src;\n}\n\n/**\n * Adjusts the extent so it aligns with pixel boundaries.\n * @param {import(\"../extent.js\").Extent} extent Extent.\n * @param {number} resolution Reolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} ratio Ratio between request size and view size.\n * @return {import(\"../extent.js\").Extent} Request extent.\n */\nexport function getRequestExtent(extent, resolution, pixelRatio, ratio) {\n  const imageResolution = resolution / pixelRatio;\n  const center = getCenter(extent);\n  const viewWidth = ceil(getWidth(extent) / imageResolution, DECIMALS);\n  const viewHeight = ceil(getHeight(extent) / imageResolution, DECIMALS);\n  const marginWidth = ceil(((ratio - 1) * viewWidth) / 2, DECIMALS);\n  const requestWidth = viewWidth + 2 * marginWidth;\n  const marginHeight = ceil(((ratio - 1) * viewHeight) / 2, DECIMALS);\n  const requestHeight = viewHeight + 2 * marginHeight;\n  return getForViewAndSize(center, imageResolution, 0, [\n    requestWidth,\n    requestHeight,\n  ]);\n}\n\nexport default ImageSource;\n","/**\n * @module ol/source/ImageMapGuide\n */\n\nimport {decode} from '../Image.js';\nimport ImageSource, {defaultImageLoadFunction} from './Image.js';\nimport {createLoader} from './mapguide.js';\n\n/**\n * @typedef {Object} Options\n * @property {string} [url] The mapagent url.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {number} [displayDpi=96] The display resolution.\n * @property {number} [metersPerUnit=1] The meters-per-unit value.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting\n * the image from the remote server.\n * @property {boolean} [useOverlay] If `true`, will use `GETDYNAMICMAPOVERLAYIMAGE`.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * @property {number} [ratio=1] Ratio. `1` means image requests are the size of the map viewport, `2` means\n * twice the width and height of the map viewport, and so on. Must be `1` or higher.\n * @property {Array<number>} [resolutions] Resolutions.\n * If specified, requests will be made for these resolutions only.\n * @property {import(\"../Image.js\").LoadFunction} [imageLoadFunction] Optional function to load an image given a URL.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {Object} [params] Additional parameters.\n */\n\n/**\n * @classdesc\n * Source for images from Mapguide servers\n *\n * @fires module:ol/source/Image.ImageSourceEvent\n * @api\n */\nclass ImageMapGuide extends ImageSource {\n  /**\n   * @param {Options} options ImageMapGuide options.\n   */\n  constructor(options) {\n    super({\n      interpolate: options.interpolate,\n      projection: options.projection,\n      resolutions: options.resolutions,\n    });\n\n    /**\n     * @private\n     * @type {?string}\n     */\n    this.crossOrigin_ =\n      options.crossOrigin !== undefined ? options.crossOrigin : null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.displayDpi_ =\n      options.displayDpi !== undefined ? options.displayDpi : 96;\n\n    /**\n     * @private\n     * @type {!Object}\n     */\n    this.params_ = Object.assign({}, options.params);\n\n    /**\n     * @private\n     * @type {string|undefined}\n     */\n    this.url_ = options.url;\n\n    /**\n     * @private\n     * @type {import(\"../Image.js\").LoadFunction}\n     */\n    this.imageLoadFunction_ =\n      options.imageLoadFunction !== undefined\n        ? options.imageLoadFunction\n        : defaultImageLoadFunction;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.hidpi_ = options.hidpi !== undefined ? options.hidpi : true;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.metersPerUnit_ =\n      options.metersPerUnit !== undefined ? options.metersPerUnit : 1;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.ratio_ = options.ratio !== undefined ? options.ratio : 1;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.useOverlay_ =\n      options.useOverlay !== undefined ? options.useOverlay : false;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedRevision_ = 0;\n\n    /**\n     * @private\n     * @type {import(\"../proj/Projection.js\").default}\n     */\n    this.loaderProjection_ = null;\n  }\n\n  /**\n   * Get the user-provided params, i.e. those passed to the constructor through\n   * the \"params\" option, and possibly updated using the updateParams method.\n   * @return {Object} Params.\n   * @api\n   */\n  getParams() {\n    return this.params_;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../Image.js\").default} Single image.\n   * @override\n   */\n  getImageInternal(extent, resolution, pixelRatio, projection) {\n    if (this.url_ === undefined) {\n      return null;\n    }\n    if (!this.loader || this.loaderProjection_ !== projection) {\n      // Lazily create loader to pick up the view projection and to allow `params` updates\n      this.loaderProjection_ = projection;\n      this.loader = createLoader({\n        crossOrigin: this.crossOrigin_,\n        params: this.params_,\n        hidpi: this.hidpi_,\n        metersPerUnit: this.metersPerUnit_,\n        url: this.url_,\n        useOverlay: this.useOverlay_,\n        ratio: this.ratio_,\n        load: (image, src) => {\n          this.image.setImage(image);\n          this.imageLoadFunction_(this.image, src);\n          return decode(image);\n        },\n      });\n    }\n\n    return super.getImageInternal(extent, resolution, pixelRatio, projection);\n  }\n\n  /**\n   * Return the image load function of the source.\n   * @return {import(\"../Image.js\").LoadFunction} The image load function.\n   * @api\n   */\n  getImageLoadFunction() {\n    return this.imageLoadFunction_;\n  }\n\n  /**\n   * Set the user-provided params.\n   * @param {Object} params Params.\n   * @api\n   */\n  setParams(params) {\n    this.params_ = Object.assign({}, params);\n    this.changed();\n  }\n\n  /**\n   * Update the user-provided params.\n   * @param {Object} params Params.\n   * @api\n   */\n  updateParams(params) {\n    Object.assign(this.params_, params);\n    this.changed();\n  }\n\n  /**\n   * Set the image load function of the MapGuide source.\n   * @param {import(\"../Image.js\").LoadFunction} imageLoadFunction Image load function.\n   * @api\n   */\n  setImageLoadFunction(imageLoadFunction) {\n    this.imageLoadFunction_ = imageLoadFunction;\n    this.changed();\n  }\n\n  /**\n   * @override\n   */\n  changed() {\n    this.image = null;\n    super.changed();\n  }\n}\n\nexport default ImageMapGuide;\n","/**\n * @module ol/source/common\n */\n\n/**\n * Default WMS version.\n * @type {string}\n */\nexport const DEFAULT_WMS_VERSION = '1.3.0';\n\n/**\n * Number of decimal digits to consider in integer values when rounding.\n * @type {number}\n */\nexport const DECIMALS = 4;\n","/**\n * @module ol/source/mapguide\n */\n\nimport {decode} from '../Image.js';\nimport {getCenter, getHeight, getWidth} from '../extent.js';\nimport {appendParams} from '../uri.js';\nimport {getRequestExtent} from './Image.js';\n\n/**\n * @typedef {Object} LoaderOptions\n * @property {string} url The mapagent url.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {number} [displayDpi=96] The display resolution.\n * @property {number} [metersPerUnit=1] The meters-per-unit value.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting\n * the image from the remote server.\n * @property {boolean} [useOverlay] If `true`, will use `GETDYNAMICMAPOVERLAYIMAGE`.\n * @property {number} [ratio=1] Ratio. `1` means image requests are the size of the map viewport, `2` means\n * twice the width and height of the map viewport, and so on. Must be `1` or higher.\n * @property {Object} [params] Additional query parameters.\n * @property {function(HTMLImageElement, string): Promise<import('../DataTile.js').ImageLike>} [load] Function\n * to perform loading of the image. Receives the created `HTMLImageElement` and the desired `src` as argument and\n * returns a promise resolving to the loaded or decoded image. Default is {@link module:ol/Image.decode}.\n */\n\n/**\n * @param {import(\"../extent.js\").Extent} extent The map extents.\n * @param {import(\"../size.js\").Size} size The viewport size.\n * @param {number} metersPerUnit The meters-per-unit value.\n * @param {number} dpi The display resolution.\n * @return {number} The computed map scale.\n */\nfunction getScale(extent, size, metersPerUnit, dpi) {\n  const mcsW = getWidth(extent);\n  const mcsH = getHeight(extent);\n  const devW = size[0];\n  const devH = size[1];\n  const mpp = 0.0254 / dpi;\n  if (devH * mcsW > devW * mcsH) {\n    return (mcsW * metersPerUnit) / (devW * mpp); // width limited\n  }\n  return (mcsH * metersPerUnit) / (devH * mpp); // height limited\n}\n\n/**\n * @param {string} baseUrl The mapagent url.\n * @param {Object<string, string|number>} params Request parameters.\n * @param {import(\"../extent.js\").Extent} extent Extent.\n * @param {import(\"../size.js\").Size} size Size.\n * @param {boolean} useOverlay If `true`, will use `GETDYNAMICMAPOVERLAYIMAGE`.\n * @param {number} metersPerUnit The meters-per-unit value.\n * @param {number} displayDpi The display resolution.\n * @return {string} The mapagent map image request URL.\n */\nfunction getUrl(\n  baseUrl,\n  params,\n  extent,\n  size,\n  useOverlay,\n  metersPerUnit,\n  displayDpi,\n) {\n  const scale = getScale(extent, size, metersPerUnit, displayDpi);\n  const center = getCenter(extent);\n  const baseParams = {\n    'OPERATION': useOverlay ? 'GETDYNAMICMAPOVERLAYIMAGE' : 'GETMAPIMAGE',\n    'VERSION': '2.0.0',\n    'LOCALE': 'en',\n    'CLIENTAGENT': 'ol/source/ImageMapGuide source',\n    'CLIP': '1',\n    'SETDISPLAYDPI': displayDpi,\n    'SETDISPLAYWIDTH': Math.round(size[0]),\n    'SETDISPLAYHEIGHT': Math.round(size[1]),\n    'SETVIEWSCALE': scale,\n    'SETVIEWCENTERX': center[0],\n    'SETVIEWCENTERY': center[1],\n  };\n  Object.assign(baseParams, params);\n  return appendParams(baseUrl, baseParams);\n}\n\n/**\n * Creates a loader for MapGuide images.\n * @param {LoaderOptions} options Image ArcGIS Rest Options.\n * @return {import('../Image.js').ImageObjectPromiseLoader} ArcGIS Rest image.\n * @api\n */\nexport function createLoader(options) {\n  const load = options.load || decode;\n  const useOverlay = options.useOverlay ?? false;\n  const metersPerUnit = options.metersPerUnit || 1;\n  const displayDpi = options.displayDpi || 96;\n  const ratio = options.ratio ?? 1;\n  const crossOrigin = options.crossOrigin ?? null;\n\n  return function (extent, resolution, pixelRatio) {\n    const image = new Image();\n    image.crossOrigin = crossOrigin;\n    extent = getRequestExtent(extent, resolution, pixelRatio, ratio);\n    const width = getWidth(extent) / resolution;\n    const height = getHeight(extent) / resolution;\n    const size = [width * pixelRatio, height * pixelRatio];\n    const src = getUrl(\n      options.url,\n      options.params,\n      extent,\n      size,\n      useOverlay,\n      metersPerUnit,\n      displayDpi,\n    );\n    return load(image, src).then((image) => ({image, extent, pixelRatio}));\n  };\n}\n","/**\n * @module ol/tilecoord\n */\n\n/**\n * An array of three numbers representing the location of a tile in a tile\n * grid. The order is `z` (zoom level), `x` (column), and `y` (row).\n * @typedef {Array<number>} TileCoord\n * @api\n */\n\n/**\n * @param {number} z Z.\n * @param {number} x X.\n * @param {number} y Y.\n * @param {TileCoord} [tileCoord] Tile coordinate.\n * @return {TileCoord} Tile coordinate.\n */\nexport function createOrUpdate(z, x, y, tileCoord) {\n  if (tileCoord !== undefined) {\n    tileCoord[0] = z;\n    tileCoord[1] = x;\n    tileCoord[2] = y;\n    return tileCoord;\n  }\n  return [z, x, y];\n}\n\n/**\n * @param {number} z Z.\n * @param {number} x X.\n * @param {number} y Y.\n * @return {string} Key.\n */\nexport function getKeyZXY(z, x, y) {\n  return z + '/' + x + '/' + y;\n}\n\n/**\n * Get the key for a tile coord.\n * @param {TileCoord} tileCoord The tile coord.\n * @return {string} Key.\n */\nexport function getKey(tileCoord) {\n  return getKeyZXY(tileCoord[0], tileCoord[1], tileCoord[2]);\n}\n\n/**\n * Get the tile cache key for a tile key obtained through `tile.getKey()`.\n * @param {string} tileKey The tile key.\n * @return {string} The cache key.\n */\nexport function getCacheKeyForTileKey(tileKey) {\n  const [z, x, y] = tileKey\n    .substring(tileKey.lastIndexOf('/') + 1, tileKey.length)\n    .split(',')\n    .map(Number);\n  return getKeyZXY(z, x, y);\n}\n\n/**\n * Get a tile coord given a key.\n * @param {string} key The tile coord key.\n * @return {TileCoord} The tile coord.\n */\nexport function fromKey(key) {\n  return key.split('/').map(Number);\n}\n\n/**\n * @param {TileCoord} tileCoord Tile coord.\n * @return {number} Hash.\n */\nexport function hash(tileCoord) {\n  return hashZXY(tileCoord[0], tileCoord[1], tileCoord[2]);\n}\n\n/**\n * @param {number} z The tile z coordinate.\n * @param {number} x The tile x coordinate.\n * @param {number} y The tile y coordinate.\n * @return {number} Hash.\n */\nexport function hashZXY(z, x, y) {\n  return (x << z) + y;\n}\n\n/**\n * @param {TileCoord} tileCoord Tile coordinate.\n * @param {!import(\"./tilegrid/TileGrid.js\").default} tileGrid Tile grid.\n * @return {boolean} Tile coordinate is within extent and zoom level range.\n */\nexport function withinExtentAndZ(tileCoord, tileGrid) {\n  const z = tileCoord[0];\n  const x = tileCoord[1];\n  const y = tileCoord[2];\n\n  if (tileGrid.getMinZoom() > z || z > tileGrid.getMaxZoom()) {\n    return false;\n  }\n  const tileRange = tileGrid.getFullTileRange(z);\n  if (!tileRange) {\n    return true;\n  }\n  return tileRange.containsXY(x, y);\n}\n","/**\n * @module ol/uri\n */\n\nimport {modulo} from './math.js';\nimport {hashZXY} from './tilecoord.js';\n\n/**\n * Appends query parameters to a URI.\n *\n * @param {string} uri The original URI, which may already have query data.\n * @param {!Object} params An object where keys are URI-encoded parameter keys,\n *     and the values are arbitrary types or arrays.\n * @return {string} The new URI.\n */\nexport function appendParams(uri, params) {\n  /** @type {Array<string>} */\n  const keyParams = [];\n  // Skip any null or undefined parameter values\n  Object.keys(params).forEach(function (k) {\n    if (params[k] !== null && params[k] !== undefined) {\n      keyParams.push(k + '=' + encodeURIComponent(params[k]));\n    }\n  });\n  const qs = keyParams.join('&');\n  // remove any trailing ? or &\n  uri = uri.replace(/[?&]$/, '');\n  // append ? or & depending on whether uri has existing parameters\n  uri += uri.includes('?') ? '&' : '?';\n  return uri + qs;\n}\n\nconst zRegEx = /\\{z\\}/g;\nconst xRegEx = /\\{x\\}/g;\nconst yRegEx = /\\{y\\}/g;\nconst dashYRegEx = /\\{-y\\}/g;\n\n/**\n * @param {string} template The URL template.  Should have `{x}`, `{y}`, and `{z}` placeholders.  If\n * the template has a `{-y}` placeholder, the `maxY` parameter must be supplied.\n * @param {number} z The tile z coordinate.\n * @param {number} x The tile x coordinate.\n * @param {number} y The tile y coordinate.\n * @param {number} [maxY] The maximum y coordinate at the given z level.\n * @return {string} The URL.\n */\nexport function renderXYZTemplate(template, z, x, y, maxY) {\n  return template\n    .replace(zRegEx, z.toString())\n    .replace(xRegEx, x.toString())\n    .replace(yRegEx, y.toString())\n    .replace(dashYRegEx, function () {\n      if (maxY === undefined) {\n        throw new Error(\n          'If the URL template has a {-y} placeholder, the grid extent must be known',\n        );\n      }\n      return (maxY - y).toString();\n    });\n}\n\n/**\n * @param {Array<string>} urls List of URLs.\n * @param {number} z The tile z coordinate.\n * @param {number} x The tile x coordinate.\n * @param {number} y The tile y coordinate.\n * @return {string} The chosen URL.\n */\nexport function pickUrl(urls, z, x, y) {\n  const hash = hashZXY(z, x, y);\n  const index = modulo(hash, urls.length);\n  return urls[index];\n}\n\n/**\n * @param {string} url URL.\n * @return {Array<string>} Array of urls.\n */\nexport function expandUrl(url) {\n  const urls = [];\n  let match = /\\{([a-z])-([a-z])\\}/.exec(url);\n  if (match) {\n    // char range\n    const startCharCode = match[1].charCodeAt(0);\n    const stopCharCode = match[2].charCodeAt(0);\n    let charCode;\n    for (charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      urls.push(url.replace(match[0], String.fromCharCode(charCode)));\n    }\n    return urls;\n  }\n  match = /\\{(\\d+)-(\\d+)\\}/.exec(url);\n  if (match) {\n    // number range\n    const stop = parseInt(match[2], 10);\n    for (let i = parseInt(match[1], 10); i <= stop; i++) {\n      urls.push(url.replace(match[0], i.toString()));\n    }\n    return urls;\n  }\n  urls.push(url);\n  return urls;\n}\n"],"names":["fromResolutionLike","resolution","Array","isArray","Math","min","ReprojImage","Image","constructor","sourceProj","targetProj","targetExtent","targetResolution","pixelRatio","getImageFunction","interpolate","maxSourceExtent","getExtent","canWrapX","slice","Infinity","maxTargetExtent","limitedTargetExtent","targetCenter","sourceResolution","errorThresholdInPixels","triangulation","Triangulation","sourceExtent","calculateSourceExtent","sourceImage","state","ImageState","IDLE","EMPTY","sourcePixelRatio","getPixelRatio","super","this","targetProj_","maxSourceExtent_","triangulation_","targetResolution_","targetExtent_","sourceImage_","sourcePixelRatio_","interpolate_","canvas_","sourceListenerKey_","disposeInternal","LOADING","unlistenSource_","getImage","getProjection","reproject_","sourceState","getState","LOADED","width","height","getResolution","extent","image","undefined","changed","load","ERROR","EventType","CHANGE","e","ImageSourceEventType","IMAGELOADSTART","IMAGELOADEND","IMAGELOADERROR","ImageSourceEvent","Event","type","ImageSource","Source","options","attributions","projection","on","once","un","loader","resolutions_","resolutions","reprojectedImage_","reprojectedRevision_","wantedExtent_","wantedResolution_","static_","length","wantedProjection_","getResolutions","setResolutions","findNearestResolution","idx","sourceProjection","getImageInternal","getRevision","dispose","getInterpolate","requestExtent","getRequestExtent","requestResolution","addEventListener","handleImageChange","bind","event","loading","hasListener","dispatchEvent","defaultImageLoadFunction","src","ratio","imageResolution","center","viewWidth","DECIMALS","viewHeight","marginWidth","requestWidth","marginHeight","requestHeight","ImageMapGuide","crossOrigin_","crossOrigin","displayDpi_","displayDpi","params_","Object","assign","params","url_","url","imageLoadFunction_","imageLoadFunction","hidpi_","hidpi","metersPerUnit_","metersPerUnit","ratio_","useOverlay_","useOverlay","renderedRevision_","loaderProjection_","getParams","createLoader","setImage","getImageLoadFunction","setParams","updateParams","setImageLoadFunction","DEFAULT_WMS_VERSION","getScale","size","dpi","mcsW","mcsH","devW","devH","mpp","getUrl","baseUrl","scale","baseParams","round","then","createOrUpdate","z","x","y","tileCoord","getKeyZXY","getKey","hash","hashZXY","withinExtentAndZ","tileGrid","getMinZoom","getMaxZoom","tileRange","getFullTileRange","containsXY","appendParams","uri","keyParams","keys","forEach","k","push","encodeURIComponent","qs","join","replace","includes","zRegEx","xRegEx","yRegEx","dashYRegEx","renderXYZTemplate","template","maxY","toString","Error","pickUrl","urls","index","expandUrl","match","exec","startCharCode","charCodeAt","stopCharCode","charCode","String","fromCharCode","stop","parseInt","i"],"sourceRoot":""}