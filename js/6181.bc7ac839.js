"use strict";(self["webpackChunk_radiantearth_stac_browser"]=self["webpackChunk_radiantearth_stac_browser"]||[]).push([[6181],{36181:function(t,e,i){i.r(e),i.d(e,{default:function(){return h},optionsFromCapabilities:function(){return f}});var n=i(70915),r=i(38599),s=i(56758);class o extends s.A{constructor(t){super({extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes}),this.matrixIds_=t.matrixIds}getMatrixId(t){return this.matrixIds_[t]}getMatrixIds(){return this.matrixIds_}}function a(t,e,i){const n=[],s=[],a=[],l=[],u=[];i=void 0!==i?i:[];const c="SupportedCRS",d="TileMatrix",h="Identifier",f="ScaleDenominator",p="TopLeftCorner",m="TileWidth",x="TileHeight",g=t[c],T=(0,r.Jt)(g),S=T.getMetersPerUnit(),M=T.getAxisOrientation().startsWith("ne");return t[d].sort(function(t,e){return e[f]-t[f]}),t[d].forEach(function(e){let r;if(r=!(i.length>0)||i.find(function(i){return e[h]==i[d]||!e[h].includes(":")&&t[h]+":"+e[h]===i[d]}),r){s.push(e[h]);const t=28e-5*e[f]/S,i=e[m],r=e[x];M?a.push([e[p][1],e[p][0]]):a.push(e[p]),n.push(t),l.push(i==r?i:[i,r]),u.push([e["MatrixWidth"],e["MatrixHeight"]])}}),new o({extent:e,origins:a,resolutions:n,matrixIds:s,tileSizes:l,sizes:u})}var l=i(42654),u=i(14465),c=i(28512);class d extends c["default"]{constructor(t){const e=void 0!==t.requestEncoding?t.requestEncoding:"KVP",i=t.tileGrid;let n=t.urls;void 0===n&&void 0!==t.url&&(n=(0,u.Uu)(t.url)),super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,urls:n,wrapX:void 0!==t.wrapX&&t.wrapX,transition:t.transition,zDirection:t.zDirection}),this.version_=void 0!==t.version?t.version:"1.0.0",this.format_=void 0!==t.format?t.format:"image/jpeg",this.dimensions_=void 0!==t.dimensions?t.dimensions:{},this.layer_=t.layer,this.matrixSet_=t.matrixSet,this.style_=t.style,this.requestEncoding_=e,this.setKey(this.getKeyForDimensions_()),n&&n.length>0&&(this.tileUrlFunction=(0,l.FD)(n.map(this.createFromWMTSTemplate.bind(this))))}setUrls(t){this.urls=t;const e=t.join("\n");this.setTileUrlFunction((0,l.FD)(t.map(this.createFromWMTSTemplate.bind(this))),e)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const t=this.urls?this.urls.slice(0):[];for(const e in this.dimensions_)t.push(e+"-"+this.dimensions_[e]);return t.join("/")}updateDimensions(t){Object.assign(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(t){const e=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};"KVP"==e&&Object.assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t="KVP"==e?(0,u.LW)(t,i):t.replace(/\{(\w+?)\}/g,function(t,e){return e.toLowerCase()in i?i[e.toLowerCase()]:t});const n=this.tileGrid,r=this.dimensions_;return function(i,s,o){if(!i)return;const a={TileMatrix:n.getMatrixId(i[0]),TileCol:i[1],TileRow:i[2]};Object.assign(a,r);let l=t;return l="KVP"==e?(0,u.LW)(l,a):l.replace(/\{(\w+?)\}/g,function(t,e){return encodeURIComponent(a[e])}),l}}}var h=d;function f(t,e){const i=t["Contents"]["Layer"],s=i?.find(function(t){return t["Identifier"]==e["layer"]});if(!s)return null;const o=t["Contents"]["TileMatrixSet"];let l;l=s["TileMatrixSetLink"].length>1?"projection"in e?s["TileMatrixSetLink"].findIndex(function(t){const i=o.find(function(e){return e["Identifier"]==t["TileMatrixSet"]}),n=i["SupportedCRS"],s=(0,r.Jt)(n),a=(0,r.Jt)(e["projection"]);return s&&a?(0,r.tI)(s,a):n==e["projection"]}):s["TileMatrixSetLink"].findIndex(function(t){return t["TileMatrixSet"]==e["matrixSet"]}):0,l<0&&(l=0);const u=s["TileMatrixSetLink"][l]["TileMatrixSet"],c=s["TileMatrixSetLink"][l]["TileMatrixSetLimits"];let d=s["Format"][0];"format"in e&&(d=e["format"]),l=s["Style"].findIndex(function(t){return"style"in e?t["Title"]==e["style"]:t["isDefault"]}),l<0&&(l=0);const h=s["Style"][l]["Identifier"],f={};"Dimension"in s&&s["Dimension"].forEach(function(t,e,i){const n=t["Identifier"];let r=t["Default"];void 0===r&&(r=t["Value"][0]),f[n]=r});const p=t["Contents"]["TileMatrixSet"],m=p.find(function(t){return t["Identifier"]==u});let x;const g=m["SupportedCRS"];if(g&&(x=(0,r.Jt)(g)),"projection"in e){const t=(0,r.Jt)(e["projection"]);t&&(x&&!(0,r.tI)(t,x)||(x=t))}let T=!1;const S=x.getAxisOrientation().startsWith("ne");let M=m.TileMatrix[0],_={MinTileCol:0,MinTileRow:0,MaxTileCol:M.MatrixWidth-1,MaxTileRow:M.MatrixHeight-1};if(c){_=c[c.length-1];const t=m.TileMatrix.find(t=>t.Identifier===_.TileMatrix||m.Identifier+":"+t.Identifier===_.TileMatrix);t&&(M=t)}const C=28e-5*M.ScaleDenominator/x.getMetersPerUnit(),y=S?[M.TopLeftCorner[1],M.TopLeftCorner[0]]:M.TopLeftCorner,I=M.TileWidth*C,v=M.TileHeight*C;let w=m["BoundingBox"];w&&S&&(w=[w[1],w[0],w[3],w[2]]);let L=[y[0]+I*_.MinTileCol,y[1]-v*(1+_.MaxTileRow),y[0]+I*(1+_.MaxTileCol),y[1]-v*_.MinTileRow];if(void 0!==w&&!(0,n.ms)(w,L)){const t=s["WGS84BoundingBox"],e=(0,r.Jt)("EPSG:4326").getExtent();if(L=w,t)T=t[0]===e[0]&&t[2]===e[2];else{const t=(0,r.DI)(w,m["SupportedCRS"],"EPSG:4326");T=t[0]-1e-10<=e[0]&&t[2]+1e-10>=e[2]}}const E=a(m,L,c),b=[];let D=e["requestEncoding"];if(D=void 0!==D?D:"","OperationsMetadata"in t&&"GetTile"in t["OperationsMetadata"]){const e=t["OperationsMetadata"]["GetTile"]["DCP"]["HTTP"]["Get"];for(let t=0,i=e.length;t<i;++t)if(e[t]["Constraint"]){const i=e[t]["Constraint"].find(function(t){return"GetEncoding"==t["name"]}),n=i["AllowedValues"]["Value"];if(""===D&&(D=n[0]),"KVP"!==D)break;n.includes("KVP")&&b.push(e[t]["href"])}else e[t]["href"]&&(D="KVP",b.push(e[t]["href"]))}return 0===b.length&&(D="REST",s["ResourceURL"].forEach(function(t){"tile"===t["resourceType"]&&(d=t["format"],b.push(t["template"]))})),{urls:b,layer:e["layer"],matrixSet:u,format:d,projection:x,requestEncoding:D,tileGrid:E,style:h,dimensions:f,wrapX:T,crossOrigin:e["crossOrigin"]}}}}]);
//# sourceMappingURL=6181.bc7ac839.js.map