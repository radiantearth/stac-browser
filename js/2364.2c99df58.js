"use strict";(self["webpackChunk_radiantearth_stac_browser"]=self["webpackChunk_radiantearth_stac_browser"]||[]).push([[2364,2808,5360],{22808:function(e,t,s){s.r(t);var r=s(60764),i=s(45360);class a extends r["default"]{constructor(e){e=e||{};const t=Object.assign({},e),s=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=s,this.setPreload(void 0!==e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(i["default"].PRELOAD)}setPreload(e){this.set(i["default"].PRELOAD,e)}getUseInterimTilesOnError(){return this.get(i["default"].USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(i["default"].USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}t["default"]=a},45360:function(e,t,s){s.r(t),t["default"]={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"}},92364:function(e,t,s){s.r(t),s.d(t,{default:function(){return y}});var r=s(6837),i=s(70915),a=s(81450),n=s(65567),l=s(71259),h=s(9703),o=s(83954),_=s(20259),f=s(63722),u=s(89940),c=s(14693),d=s(90130),p=s(69049);class T extends p.A{constructor(e,t){super(e),this.batch_=new c.A,this.styleRenderers_=t,this.buffers=[],this.maskVertices=new _.Ay(d.H7,d.Ek),this.setTile(e.tile)}generateMaskBuffer_(){const e=this.tile.getSourceTiles()[0].extent;this.maskVertices.fromArray([e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]]),this.helper.flushBufferData(this.maskVertices)}uploadTile(){this.generateMaskBuffer_(),this.batch_.clear();const e=this.tile.getSourceTiles(),t=e.reduce((e,t)=>e.concat(t.getFeatures()),[]);this.batch_.addFeatures(t);const s=e[0].extent[0],r=e[0].extent[1],i=(0,h.Tl)((0,h.vt)(),-s,-r),a=this.styleRenderers_.map((e,t)=>e.generateBuffers(this.batch_,i).then(e=>{this.buffers[t]=e}));Promise.all(a).then(()=>{this.setReady()})}disposeInternal(){this.buffers.forEach(e=>{this.disposeBuffers(e)}),super.disposeInternal()}disposeBuffers(e){if(!e)return;const t=e=>{for(const t of e)t&&this.helper.deleteBuffer(t)};e.pointBuffers&&t(e.pointBuffers),e.lineStringBuffers&&t(e.lineStringBuffers),e.polygonBuffers&&t(e.polygonBuffers)}}var m=T,E=s(8001);const R={...E.gF,TILE_MASK_TEXTURE:"u_depthMask",TILE_ZOOM_LEVEL:"u_tileZoomLevel"},O={POSITION:"a_position"};class M extends E.Ay{constructor(e,t){super(e,{cacheSize:t.cacheSize,uniforms:{[R.PATTERN_ORIGIN]:[0,0],[R.TILE_MASK_TEXTURE]:()=>this.tileMaskTarget_.getTexture()}}),this.hitDetectionEnabled_=!t.disableHitDetection,this.styles_=[],this.styleVariables_=t.variables||{},this.styleRenderers_=[],this.currentFrameStateTransform_=(0,h.vt)(),this.tmpTransform_=(0,h.vt)(),this.tmpMat4_=(0,o.vt)(),this.tileMaskTarget_=null,this.tileMaskIndices_=new _.Ay(d.IP,d.Ek),this.tileMaskIndices_.fromArray([0,1,3,1,2,3]),this.tileMaskAttributes_=[{name:O.POSITION,size:2,type:f.jQ.FLOAT}],this.tileMaskProgram_,this.applyOptions_(t)}reset(e){super.reset(e),this.applyOptions_(e),this.helper&&(this.createRenderers_(),this.initTileMask_())}applyOptions_(e){this.styles_=(0,l.iA)(e.style)}createRenderers_(){function e(e){const t=e.getFragmentDiscardExpression(),s=`texture2D(${R.TILE_MASK_TEXTURE}, gl_FragCoord.xy / u_pixelRatio / u_viewportSizePx).r * 50. > ${R.TILE_ZOOM_LEVEL} + 0.5`;e.setFragmentDiscardExpression("false"!==t?`(${t}) || (${s})`:s),e.addUniform(R.TILE_MASK_TEXTURE,"sampler2D"),e.addUniform(R.TILE_ZOOM_LEVEL,"float")}this.styleRenderers_=this.styles_.map(t=>{const s="builder"in t;let r;if(s)e(t.builder),r=t;else{const s=(0,l.my)(t.style,this.styleVariables_,t.filter);e(s.builder),r={builder:s.builder,attributes:s.attributes,uniforms:s.uniforms}}return new n.A(r,this.styleVariables_,this.helper,this.hitDetectionEnabled_,"filter"in t?t.filter:null)})}initTileMask_(){this.tileMaskTarget_=new u.A(this.helper);const e=(new a.N).setFillColorExpression(`vec4(${R.TILE_ZOOM_LEVEL} / 50., 0., 0., 1.)`).addUniform(R.TILE_ZOOM_LEVEL,"float");this.tileMaskProgram_=this.helper.getProgram(e.getFillFragmentShader(),e.getFillVertexShader()),this.helper.flushBufferData(this.tileMaskIndices_)}afterHelperCreated(){this.createRenderers_(),this.initTileMask_()}createTileRepresentation(e){const t=new m(e,this.styleRenderers_),s=()=>{t.ready&&(this.getLayer().changed(),t.removeEventListener(r.A.CHANGE,s))};return t.addEventListener(r.A.CHANGE,s),t}beforeTilesRender(e,t){super.beforeTilesRender(e,!0),this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_)}beforeTilesMaskRender(e){this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_);const t=e.pixelRatio,s=e.size;return this.tileMaskTarget_.setSize([s[0]*t,s[1]*t]),this.helper.prepareDrawToRenderTarget(e,this.tileMaskTarget_,!0,!0),this.helper.useProgram(this.tileMaskProgram_,e),(0,h.k3)(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(R.PROJECTION_MATRIX,(0,o.Z1)(this.tmpMat4_,this.tmpTransform_)),(0,h.T9)(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(R.SCREEN_TO_WORLD_MATRIX,(0,o.Z1)(this.tmpMat4_,this.tmpTransform_)),!0}renderTileMask(e,t,s,r){if(!e.ready)return;this.helper.setUniformFloatValue(R.DEPTH,r),this.helper.setUniformFloatValue(R.TILE_ZOOM_LEVEL,t),this.helper.setUniformFloatVec4(R.RENDER_EXTENT,s),this.helper.setUniformFloatValue(R.GLOBAL_ALPHA,1),this.helper.bindBuffer(e.maskVertices),this.helper.bindBuffer(this.tileMaskIndices_),this.helper.enableAttributes(this.tileMaskAttributes_);const i=this.tileMaskIndices_.getSize();this.helper.drawElements(0,i)}applyUniforms_(e,t,s,r,i){(0,h.k3)(this.tmpTransform_,this.currentFrameStateTransform_),(0,h.lw)(this.tmpTransform_,s),this.helper.setUniformMatrixValue(R.PROJECTION_MATRIX,(0,o.Z1)(this.tmpMat4_,this.tmpTransform_)),(0,h.T9)(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(R.SCREEN_TO_WORLD_MATRIX,(0,o.Z1)(this.tmpMat4_,this.tmpTransform_)),this.helper.setUniformFloatValue(R.GLOBAL_ALPHA,e),this.helper.setUniformFloatValue(R.DEPTH,i),this.helper.setUniformFloatValue(R.TILE_ZOOM_LEVEL,r),this.helper.setUniformFloatVec4(R.RENDER_EXTENT,t)}renderTile(e,t,s,r,a,n,l,h,o,_,f){const u=(0,i._N)(h,r,h),c=e.tile.getTileCoord()[0];for(let i=0,d=this.styleRenderers_.length;i<d;i++){const t=this.styleRenderers_[i],r=e.buffers[i];r&&t.render(r,s,()=>{this.applyUniforms_(f,u,r.invertVerticesTransform,c,o)})}}renderDeclutter(e){}disposeInternal(){super.disposeInternal()}}var g=M,I=s(22808);class b extends I["default"]{constructor(e){const t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.style_=e.style,this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){return new g(this,{style:this.style_,variables:this.styleVariables_,disableHitDetection:this.hitDetectionDisabled_})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}setStyle(e){this.style_=e,this.clearRenderer(),this.changed()}}var y=b}}]);
//# sourceMappingURL=2364.2c99df58.js.map