"use strict";(self["webpackChunk_radiantearth_stac_browser"]=self["webpackChunk_radiantearth_stac_browser"]||[]).push([[1229],{11229:function(e,t,s){s.r(t),s.d(t,{default:function(){return A}});var r=s(62703),i=s(90588),a=s(9438),n=s(70915),h=s(8055),o=s(38599),l=s(14693),d=s(65567),_=s(32627),u=s(88280),c=s(9703),f=s(83954),p=s(63722),m=s(89940),T=s(60492),b=s(49189);const R={...p.M8,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"};class y extends T.A{constructor(e,t){const s={[R.RENDER_EXTENT]:[0,0,0,0],[R.PATTERN_ORIGIN]:[0,0],[R.GLOBAL_ALPHA]:1};super(e,{uniforms:s,postProcesses:t.postProcesses}),this.hitDetectionEnabled_=!t.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=(0,n.S5)(),this.currentTransform_=(0,c.vt)(),this.tmpCoords_=[0,0],this.tmpTransform_=(0,c.vt)(),this.tmpMat4_=(0,f.vt)(),this.currentFrameStateTransform_=(0,c.vt)(),this.styleVariables_={},this.styles_=[],this.styleRenderers_=[],this.buffers_=[],this.applyOptions_(t),this.batch_=new l.A,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(e){const t=this.getLayer().getSource(),s=(0,o.Tf)();let r;s&&(r=(0,o.FO)(s,e.viewState.projection)),this.batch_.addFeatures(t.getFeatures(),r),this.sourceListenKeys_=[(0,a.KT)(t,u["default"].ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,r)),(0,a.KT)(t,u["default"].CHANGEFEATURE,this.handleSourceFeatureChanged_,this),(0,a.KT)(t,u["default"].REMOVEFEATURE,this.handleSourceFeatureDelete_,this),(0,a.KT)(t,u["default"].CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(e){this.styleVariables_=e.variables,this.styles_=(0,_.iA)(e.style)}createRenderers_(){this.buffers_=[],this.styleRenderers_=this.styles_.map(e=>new d.A(e,this.styleVariables_,this.helper,this.hitDetectionEnabled_,"filter"in e?e.filter:null))}reset(e){this.applyOptions_(e),this.helper&&this.createRenderers_(),super.reset(e)}afterHelperCreated(){this.styleRenderers_.length?this.styleRenderers_.forEach((e,t)=>e.setHelper(this.helper,this.buffers_[t])):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new m.A(this.helper))}handleSourceFeatureAdded_(e,t){const s=t.feature;this.batch_.addFeature(s,e)}handleSourceFeatureChanged_(e){const t=e.feature;this.batch_.changeFeature(t)}handleSourceFeatureDelete_(e){const t=e.feature;this.batch_.removeFeature(t)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(e){(0,c.k3)(this.tmpTransform_,this.currentFrameStateTransform_),(0,c.lw)(this.tmpTransform_,e),this.helper.setUniformMatrixValue(R.PROJECTION_MATRIX,(0,f.Z1)(this.tmpMat4_,this.tmpTransform_)),(0,c.T9)(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(R.SCREEN_TO_WORLD_MATRIX,(0,f.Z1)(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,(0,c.T9)(this.tmpTransform_,e),(0,c.Bb)(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(R.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[s,r,i]=(0,b.v)(e,this.getLayer());this.helper.prepareDraw(e),this.renderWorlds(e,!1,s,r,i),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const a=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,s,r,i),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),a}prepareFrameInternal(e){this.initialFeaturesAdded_||(this.addInitialFeatures_(e),this.initialFeaturesAdded_=!0);const t=this.getLayer(),s=t.getSource(),i=e.viewState,a=!e.viewHints[r.A.ANIMATING]&&!e.viewHints[r.A.INTERACTING],l=!(0,n.aI)(this.previousExtent_,e.extent),d=this.sourceRevision_<s.getRevision();if(d&&(this.sourceRevision_=s.getRevision()),a&&(l||d)){const r=i.projection,a=i.resolution,l=t instanceof h["default"]?t.getRenderBuffer():0,d=(0,n.r)(e.extent,l*a),_=(0,o.Tf)();_?s.loadFeatures((0,o.JR)(d,_),(0,o.vN)(a,r),_):s.loadFeatures(d,a,r),this.ready=!1;const u=this.helper.makeProjectionTransform(e,(0,c.vt)()),f=this.styleRenderers_.map((e,t)=>e.generateBuffers(this.batch_,u).then(e=>{this.buffers_[t]&&this.disposeBuffers(this.buffers_[t]),this.buffers_[t]=e}));Promise.all(f).then(()=>{this.ready=!0,this.getLayer().changed()}),this.previousExtent_=e.extent.slice()}return!0}renderWorlds(e,t,s,r,i){let a=s;t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0));do{this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_),(0,c.Tl)(this.currentFrameStateTransform_,a*i,0);for(let s=0,r=this.styleRenderers_.length;s<r;s++){const r=this.styleRenderers_[s],i=this.buffers_[s];i&&r.render(i,e,()=>{this.applyUniforms_(i.invertVerticesTransform),this.helper.applyHitDetectionUniform(t)})}}while(++a<r)}forEachFeatureAtCoordinate(e,t,s,r,a){if((0,i.v)(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderers_.length||!this.hitDetectionEnabled_)return;const n=(0,c.Bb)(t.coordinateToPixelTransform,e.slice()),h=this.hitRenderTarget_.readPixel(n[0]/2,n[1]/2),o=[h[0]/255,h[1]/255,h[2]/255,h[3]/255],l=(0,_.LW)(o),d=this.batch_.getFeatureFromRef(l);return d?r(d,this.getLayer(),null):void 0}disposeBuffers(e){const t=e=>{for(const t of e)t&&this.helper.deleteBuffer(t)};e.pointBuffers&&t(e.pointBuffers),e.lineStringBuffers&&t(e.lineStringBuffers),e.polygonBuffers&&t(e.polygonBuffers)}disposeInternal(){this.buffers_.forEach(e=>{e&&this.disposeBuffers(e)}),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(e){(0,a.JH)(e)}),this.sourceListenKeys_=null),super.disposeInternal()}}var g=y,E=s(60764);class v extends E["default"]{constructor(e){const t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.style_=e.style,this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){return new g(this,{style:this.style_,variables:this.styleVariables_,disableHitDetection:this.hitDetectionDisabled_})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}setStyle(e){this.style=e,this.clearRenderer(),this.changed()}}var A=v},49189:function(e,t,s){s.d(t,{v:function(){return i}});var r=s(70915);function i(e,t){const s=e.viewState.projection,i=t.getSource(),a=i.getWrapX()&&s.canWrapX(),n=s.getExtent(),h=e.extent,o=a?(0,r.RG)(n):null,l=a?Math.ceil((h[2]-n[2])/o)+1:1,d=a?Math.floor((h[0]-n[0])/o):0;return[d,l,o]}}}]);
//# sourceMappingURL=1229.0f4c7010.js.map