"use strict";(self["webpackChunk_radiantearth_stac_browser"]=self["webpackChunk_radiantearth_stac_browser"]||[]).push([[1789],{41789:function(e,t,s){s.r(t);var r=s(68711),i=s(49825),a=s(27557),n=s(61597),h=s(81450),o=s(34835),l=s(83333),d=s(8055);const u={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},c=["#00f","#0ff","#0f0","#ff0","#f00"];class _ extends d["default"]{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.filter_=e.filter??!0,this.styleVariables_=e.variables||{},this.gradient_=null,this.addChangeListener(u.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:c),this.setBlur(void 0!==e.blur?e.blur:15),this.setRadius(void 0!==e.radius?e.radius:8);const s=e.weight?e.weight:"weight";this.weight_=s,this.setRenderOrder(null)}getBlur(){return this.get(u.BLUR)}getGradient(){return this.get(u.GRADIENT)}getRadius(){return this.get(u.RADIUS)}handleGradientChanged_(){this.gradient_=f(this.getGradient())}setBlur(e){const t=this.get(u.BLUR);this.set(u.BLUR,e),"number"!==typeof e||"number"!==typeof t?this.clearRenderer():this.changed()}setGradient(e){this.set(u.GRADIENT,e)}setRadius(e){const t=this.get(u.RADIUS);this.set(u.RADIUS,e),"number"!==typeof e||"number"!==typeof t?this.clearRenderer():this.changed()}setFilter(e){this.filter_=e,this.changed(),this.clearRenderer()}setWeight(e){this.weight_=e,this.changed(),this.clearRenderer()}createRenderer(){const e=new h.N,t=(0,a.z0)(),s=(0,o.s2)(t,this.filter_,i.T8);let r=(0,o.s2)(t,this.getRadius(),i.wl),d=(0,o.s2)(t,this.getBlur(),i.wl);const u={};"number"===typeof this.getBlur()&&(d="a_blur",u["a_blur"]=()=>this.getBlur(),e.addUniform("a_blur","float")),"number"===typeof this.getRadius()&&(r="a_radius",u["a_radius"]=()=>this.getRadius(),e.addUniform("a_radius","float"));const c={};let _=null;if("string"===typeof this.weight_||"function"===typeof this.weight_){const t="string"===typeof this.weight_?e=>e.get(this.weight_):this.weight_;c["prop_weight"]={size:1,callback:e=>{const s=t(e);return void 0!==s?(0,n.qE)(s,0,1):1}},_="a_prop_weight",e.addAttribute("a_prop_weight","float")}else{const e=["clamp",this.weight_,0,1];_=(0,o.s2)(t,e,i.wl)}e.addFragmentShaderFunction(`float getBlurSlope() {\n  float blur = max(1., ${d});\n  float radius = ${r};\n  return radius / blur;\n}`).setSymbolSizeExpression(`vec2(${r} + ${d}) * 2.`).setSymbolColorExpression(`vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * getBlurSlope()) * ${_})`).setStrokeColorExpression(`vec4(smoothstep(0., 1., (1. - length(currentRadiusPx * 2. / v_width)) * getBlurSlope()) * ${_})`).setStrokeWidthExpression(`(${r} + ${d}) * 2.`).setFillColorExpression(`vec4(${_})`).setFragmentDiscardExpression(`!${s}`),(0,o.mf)(e,t);const f=(0,o.mh)(t),p=(0,o.kc)(t,this.styleVariables_);return new l.A(this,{className:this.getClassName(),variables:this.styleVariables_,style:{builder:e,attributes:{...f,...c},uniforms:{...p,...u}},disableHitDetection:!1,postProcesses:[{fragmentShader:"\n            precision mediump float;\n\n            uniform sampler2D u_image;\n            uniform sampler2D u_gradientTexture;\n            uniform float u_opacity;\n\n            varying vec2 v_texCoord;\n\n            void main() {\n              vec4 color = texture2D(u_image, v_texCoord);\n              gl_FragColor.a = color.a * u_opacity;\n              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;\n              gl_FragColor.rgb *= gl_FragColor.a;\n            }",uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}renderDeclutter(){}}function f(e){const t=1,s=256,i=(0,r.Y)(t,s),a=i.createLinearGradient(0,0,t,s),n=1/(e.length-1);for(let r=0,h=e.length;r<h;++r)a.addColorStop(r*n,e[r]);return i.fillStyle=a,i.fillRect(0,0,t,s),i.canvas}t["default"]=_},49189:function(e,t,s){s.d(t,{v:function(){return i}});var r=s(70915);function i(e,t){const s=e.viewState.projection,i=t.getSource(),a=i.getWrapX()&&s.canWrapX(),n=s.getExtent(),h=e.extent,o=a?(0,r.RG)(n):null,l=a?Math.ceil((h[2]-n[2])/o)+1:1,d=a?Math.floor((h[0]-n[0])/o):0;return[d,l,o]}},83333:function(e,t,s){var r=s(62703),i=s(90588),a=s(9438),n=s(70915),h=s(8055),o=s(38599),l=s(14693),d=s(65567),u=s(3422),c=s(71259),_=s(88280),f=s(9703),p=s(83954),g=s(63722),m=s(89940),R=s(60492),b=s(49189);const T={...g.M8,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"};class y extends R.A{constructor(e,t){const s={[T.RENDER_EXTENT]:[0,0,0,0],[T.PATTERN_ORIGIN]:[0,0],[T.GLOBAL_ALPHA]:1};super(e,{uniforms:s,postProcesses:t.postProcesses}),this.hitDetectionEnabled_=!t.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=(0,n.S5)(),this.currentTransform_=(0,f.vt)(),this.tmpCoords_=[0,0],this.tmpTransform_=(0,f.vt)(),this.tmpMat4_=(0,p.vt)(),this.currentFrameStateTransform_=(0,f.vt)(),this.styleVariables_={},this.styles_=[],this.styleRenderers_=[],this.buffers_=[],this.applyOptions_(t),this.batch_=new l.A,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(e){const t=this.getLayer().getSource(),s=(0,o.Tf)();let r;s&&(r=(0,o.FO)(s,e.viewState.projection)),this.batch_.addFeatures(t.getFeatures(),r),this.sourceListenKeys_=[(0,a.KT)(t,_["default"].ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,r)),(0,a.KT)(t,_["default"].CHANGEFEATURE,this.handleSourceFeatureChanged_.bind(this,r),this),(0,a.KT)(t,_["default"].REMOVEFEATURE,this.handleSourceFeatureDelete_,this),(0,a.KT)(t,_["default"].CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(e){this.styleVariables_=e.variables,this.styles_=(0,c.iA)(e.style)}createRenderers_(){this.buffers_=[],this.styleRenderers_=this.styles_.map(e=>new d.A(e,this.styleVariables_,this.helper,this.hitDetectionEnabled_,"filter"in e?e.filter:null))}reset(e){this.applyOptions_(e),this.helper&&this.createRenderers_(),super.reset(e)}afterHelperCreated(){this.styleRenderers_.length?this.styleRenderers_.forEach((e,t)=>e.setHelper(this.helper,this.buffers_[t])):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new m.A(this.helper))}handleSourceFeatureAdded_(e,t){const s=t.feature;this.batch_.addFeature(s,e)}handleSourceFeatureChanged_(e,t){const s=t.feature;this.batch_.changeFeature(s,e)}handleSourceFeatureDelete_(e){const t=e.feature;this.batch_.removeFeature(t)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(e){(0,f.k3)(this.tmpTransform_,this.currentFrameStateTransform_),(0,f.lw)(this.tmpTransform_,e),this.helper.setUniformMatrixValue(T.PROJECTION_MATRIX,(0,p.Z1)(this.tmpMat4_,this.tmpTransform_)),(0,f.T9)(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(T.SCREEN_TO_WORLD_MATRIX,(0,p.Z1)(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,(0,f.T9)(this.tmpTransform_,e),(0,f.Bb)(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(T.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[s,r,i]=(0,b.v)(e,this.getLayer());this.helper.prepareDraw(e),this.renderWorlds(e,!1,s,r,i),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const a=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,s,r,i),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),a}prepareFrameInternal(e){this.initialFeaturesAdded_||(this.addInitialFeatures_(e),this.initialFeaturesAdded_=!0);const t=this.getLayer(),s=t.getSource(),i=e.viewState,a=!e.viewHints[r.A.ANIMATING]&&!e.viewHints[r.A.INTERACTING],l=!(0,n.aI)(this.previousExtent_,e.extent),d=this.sourceRevision_<s.getRevision();if(d&&(this.sourceRevision_=s.getRevision()),a&&(l||d)){const r=i.projection,a=i.resolution,l=t instanceof h["default"]?t.getRenderBuffer():0,d=(0,n.r)(e.extent,l*a),u=(0,o.Tf)();u?s.loadFeatures((0,o.JR)(d,u),(0,o.vN)(a,r),u):s.loadFeatures(d,a,r),this.ready=!1;const c=this.helper.makeProjectionTransform(e,(0,f.vt)()),_=this.styleRenderers_.map((e,t)=>e.generateBuffers(this.batch_,c).then(e=>{this.buffers_[t]&&this.disposeBuffers(this.buffers_[t]),this.buffers_[t]=e}));Promise.all(_).then(()=>{this.ready=!0,this.getLayer().changed()}),this.previousExtent_=e.extent.slice()}return!0}renderWorlds(e,t,s,r,i){let a=s;t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0));do{this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_),(0,f.Tl)(this.currentFrameStateTransform_,a*i,0);for(let s=0,r=this.styleRenderers_.length;s<r;s++){const r=this.styleRenderers_[s],i=this.buffers_[s];i&&r.render(i,e,()=>{this.applyUniforms_(i.invertVerticesTransform),this.helper.applyHitDetectionUniform(t)})}}while(++a<r)}forEachFeatureAtCoordinate(e,t,s,r,a){if((0,i.v)(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderers_.length||!this.hitDetectionEnabled_)return;const n=(0,f.Bb)(t.coordinateToPixelTransform,e.slice()),h=this.hitRenderTarget_.readPixel(n[0]/2,n[1]/2),o=[h[0]/255,h[1]/255,h[2]/255,h[3]/255],l=(0,u.L)(o),d=this.batch_.getFeatureFromRef(l);return d?r(d,this.getLayer(),null):void 0}disposeBuffers(e){const t=e=>{for(const t of e)t&&this.helper.deleteBuffer(t)};e.pointBuffers&&t(e.pointBuffers),e.lineStringBuffers&&t(e.lineStringBuffers),e.polygonBuffers&&t(e.polygonBuffers)}disposeInternal(){this.buffers_.forEach(e=>{e&&this.disposeBuffers(e)}),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(e){(0,a.JH)(e)}),this.sourceListenKeys_=null),super.disposeInternal()}renderDeclutter(){}}t.A=y}}]);
//# sourceMappingURL=1789.f449aec3.js.map