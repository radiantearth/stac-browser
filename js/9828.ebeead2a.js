"use strict";(self["webpackChunk_radiantearth_stac_browser"]=self["webpackChunk_radiantearth_stac_browser"]||[]).push([[5360,9828],{24029:function(e,t,i){var n=i(27607),o=i(40190),r=i(91110),s=i(11078),a=i(66514),l=i(70915),c=i(38599),h=i(97404),d=i(6782),u=i(14969),g=i(40186),f=i(9703),T=i(4087),p=i(96769);function m(e,t,i,n){return`${e},${(0,g.dp)(t,i,n)}`}function x(e,t,i){if(!(i in e))return e[i]=new Set([t]),!0;const n=e[i],o=n.has(t);return o||n.add(t),!o}function S(e,t,i){const n=e[i];return!!n&&n.delete(t)}function _(e,t){const i=e.layerStatesArray[e.layerIndex];i.extent&&(t=(0,l._N)(t,(0,c.SD)(i.extent,e.viewState.projection)));const n=i.layer.getRenderSource();if(!n.getWrapX()){const i=n.getTileGridForProjection(e.viewState.projection).getExtent();i&&(t=(0,l._N)(t,i))}return t}class R extends p.A{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision_,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=(0,l.S5)(),this.tempTileRange_=new r.A(0,0,0,0),this.tempTileCoord_=(0,g.N)(0,0,0);const i=void 0!==t.cacheSize?t.cacheSize:512;this.tileCache_=new u.A(i),this.maxStaleKeys=.5*i}getTileCache(){return this.tileCache_}getOrCreateTile(e,t,i,n){const o=this.tileCache_,r=this.getLayer(),s=r.getSource(),a=m(s.getKey(),e,t,i);let l;if(o.containsKey(a))l=o.get(a);else{if(l=s.getTile(e,t,i,n.pixelRatio,n.viewState.projection),!l)return null;o.set(a,l)}return l}getTile(e,t,i,n){const o=this.getOrCreateTile(e,t,i,n);return o||null}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),r=(0,f.Bb)(t.pixelToCoordinateTransform,e.slice()),a=i.getExtent();if(a&&!(0,l.Ym)(a,r))return null;const c=t.viewState,u=i.getRenderSource(),g=u.getTileGridForProjection(c.projection),T=u.getTilePixelRatio(t.pixelRatio);for(let l=g.getZForResolution(c.resolution);l>=g.getMinZoom();--l){const e=g.getTileCoordForCoordAndZ(r,l),i=this.getTile(l,e[1],e[2],t);if(!i||i.getState()!==s.A.LOADED)continue;const a=g.getOrigin(l),f=(0,d.xq)(g.getTileSize(l)),p=g.getResolution(l);let m;if(i instanceof o.A||i instanceof h.A)m=i.getImage();else{if(!(i instanceof n.Ay))continue;if(m=(0,n.xo)(i.getData()),!m)continue}const x=Math.floor(T*((r[0]-a[0])/p-e[1]*f[0])),S=Math.floor(T*((a[1]-r[1])/p-e[2]*f[1])),_=Math.round(T*u.getGutterForProjection(c.projection));return this.getImageData(m,x+_,S+_)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const i=t.getRevision();return this.renderedRevision_?this.renderedRevision_!==i&&(this.renderedRevision_=i,this.renderedSourceKey_===t.getKey()&&this.tileCache_.clear()):this.renderedRevision_=i,!0}enqueueTiles(e,t,i,n,o){const r=e.viewState,a=this.getLayer(),c=a.getRenderSource(),h=c.getTileGridForProjection(r.projection),d=(0,T.v6)(c);d in e.wantedTiles||(e.wantedTiles[d]={});const u=e.wantedTiles[d],f=a.getMapInternal(),p=Math.max(i-o,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),c.zDirection)),m=r.rotation,S=m?(0,l.Yw)(r.center,r.resolution,m,e.size):void 0;for(let l=i;l>=p;--l){const i=h.getTileRangeForExtentAndZ(t,l,this.tempTileRange_),o=h.getResolution(l);for(let t=i.minX;t<=i.maxX;++t)for(let r=i.minY;r<=i.maxY;++r){if(m&&!h.tileCoordIntersectsViewport([l,t,r],S))continue;const i=this.getTile(l,t,r,e);if(!i)continue;const a=x(n,i,l);if(!a)continue;const c=i.getKey();if(u[c]=!0,i.getState()===s.A.IDLE&&!e.tileQueue.isKeyQueued(c)){const n=(0,g.N)(l,t,r,this.tempTileCoord_);e.tileQueue.enqueue([i,d,h.getTileCoordCenter(n),o])}}}}findStaleTile_(e,t){const i=this.tileCache_,n=e[0],o=e[1],r=e[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){const e=m(a[l],n,o,r);if(i.containsKey(e)){const o=i.peek(e);if(o.getState()===s.A.LOADED)return o.endTransition((0,T.v6)(this)),x(t,o,n),!0}}return!1}findAltTiles_(e,t,i,n){const o=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!o)return!1;let r=!0;const a=this.tileCache_,l=this.getLayer().getRenderSource(),c=l.getKey();for(let h=o.minX;h<=o.maxX;++h)for(let e=o.minY;e<=o.maxY;++e){const t=m(c,i,h,e);let o=!1;if(a.containsKey(t)){const e=a.peek(t);e.getState()===s.A.LOADED&&(x(n,e,i),o=!0)}o||(r=!1)}return r}renderFrame(e,t){let i=!0;this.renderComplete=!0;const n=e.layerStatesArray[e.layerIndex],o=e.viewState,r=o.projection,h=o.resolution,d=o.center,u=e.pixelRatio,g=this.getLayer(),p=g.getSource(),m=p.getTileGridForProjection(r),x=m.getZForResolution(h,p.zDirection),R=m.getResolution(x),y=p.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==y&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=y):this.renderedSourceKey_=y;let C=e.extent;const A=p.getTilePixelRatio(u);this.prepareContainer(e,t);const v=this.context.canvas.width,w=this.context.canvas.height,E=n.extent&&(0,c.SD)(n.extent,r);E&&(C=(0,l._N)(C,(0,c.SD)(n.extent,r)));const j=R*v/2/A,D=R*w/2/A,M=[d[0]-j,d[1]-D,d[0]+j,d[1]+D],P={};this.renderedTiles.length=0;const I=g.getPreload();if(e.nextExtent){const t=m.getZForResolution(o.nextResolution,p.zDirection),i=_(e,e.nextExtent);this.enqueueTiles(e,i,t,P,I)}const K=_(e,C);if(this.enqueueTiles(e,K,x,P,0),I>0&&setTimeout(()=>{this.enqueueTiles(e,K,x-1,P,I-1)},0),!(x in P))return this.container;const F=(0,T.v6)(this),b=e.time;for(const a of P[x]){const t=a.getState();if(t===s.A.EMPTY)continue;const n=a.tileCoord;if(t===s.A.LOADED){const e=a.getAlpha(F,b);if(1===e){a.endTransition(F);continue}}t!==s.A.IDLE&&(i=!1),t!==s.A.ERROR&&(this.renderComplete=!1);const o=this.findStaleTile_(n,P);if(o){S(P,a,x),e.animate=!0;continue}const r=this.findAltTiles_(m,n,x+1,P);if(r)continue;const l=m.getMinZoom();for(let e=x-1;e>=l;--e){const t=this.findAltTiles_(m,n,e,P);if(t)break}}const L=R/h*u/A,O=this.getRenderContext(e);(0,f.Zz)(this.tempTransform,v/2,w/2,L,L,0,-v/2,-w/2),n.extent&&this.clipUnrotated(O,e,E),p.getInterpolate()||(O.imageSmoothingEnabled=!1),this.preRender(O,e);const Z=Object.keys(P).map(Number);let k;Z.sort(a.V_);const z=[],N=[];for(let a=Z.length-1;a>=0;--a){const t=Z[a],i=p.getTilePixelSize(t,u,r),n=m.getResolution(t),o=n/R,c=i[0]*o*L,h=i[1]*o*L,d=m.getTileCoordForCoordAndZ((0,l.Py)(M),t),g=m.getTileCoordExtent(d),T=(0,f.Bb)(this.tempTransform,[A*(g[0]-M[0])/R,A*(M[3]-g[3])/R]),x=A*p.getGutterForProjection(r);for(const r of P[t]){if(r.getState()!==s.A.LOADED)continue;const i=r.tileCoord,n=d[1]-i[1],o=Math.round(T[0]-(n-1)*c),a=d[2]-i[2],u=Math.round(T[1]-(a-1)*h),g=Math.round(T[0]-n*c),f=Math.round(T[1]-a*h),m=o-g,S=u-f,_=1===Z.length;let R=!1;k=[g,f,g+m,f,g+m,f+S,g,f+S];for(let e=0,r=z.length;e<r;++e)if(!_&&t<N[e]){const t=z[e];(0,l.HY)([g,f,g+m,f+S],[t[0],t[3],t[4],t[7]])&&(R||(O.save(),R=!0),O.beginPath(),O.moveTo(k[0],k[1]),O.lineTo(k[2],k[3]),O.lineTo(k[4],k[5]),O.lineTo(k[6],k[7]),O.moveTo(t[6],t[7]),O.lineTo(t[4],t[5]),O.lineTo(t[2],t[3]),O.lineTo(t[0],t[1]),O.clip())}z.push(k),N.push(t),this.drawTile(r,e,g,f,m,S,x,_),R&&O.restore(),this.renderedTiles.unshift(r),this.updateUsedTiles(e.usedTiles,p,r)}}if(this.renderedResolution=R,this.extentChanged=!this.renderedExtent_||!(0,l.aI)(this.renderedExtent_,M),this.renderedExtent_=M,this.renderedPixelRatio=u,this.postRender(this.context,e),n.extent&&O.restore(),O.imageSmoothingEnabled=!0,this.renderComplete){const t=(e,t)=>{const i=(0,T.v6)(p),n=t.wantedTiles[i],o=n?Object.keys(n).length:0;this.updateCacheSize(o),this.tileCache_.expireCache()};e.postRenderFunctions.push(t)}return this.renderComplete||i||(e.animate=!0),this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,2*e)}drawTile(e,t,i,o,r,s,a,l){let c;if(e instanceof n.Ay){if(c=(0,n.xo)(e.getData()),!c)throw new Error("Rendering array data is not yet supported")}else c=this.getTileImage(e);if(!c)return;const h=this.getRenderContext(t),d=(0,T.v6)(this),u=t.layerStatesArray[t.layerIndex],g=u.opacity*(l?e.getAlpha(d,t.time):1),f=g!==h.globalAlpha;f&&(h.save(),h.globalAlpha=g),h.drawImage(c,a,a,c.width-2*a,c.height-2*a,i,o,r,s),f&&h.restore(),g!==u.opacity?t.animate=!0:l&&e.endTransition(d)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){const n=(0,T.v6)(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}}t.A=R},45360:function(e,t,i){i.r(t),t["default"]={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"}}}]);
//# sourceMappingURL=9828.ebeead2a.js.map