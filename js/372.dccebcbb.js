"use strict";(self["webpackChunk_radiantearth_stac_browser"]=self["webpackChunk_radiantearth_stac_browser"]||[]).push([[372,2192,3440],{14969:function(e,t,s){var n=s(90025),i=s(90588);class r{constructor(e){this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof n.A&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){while(this.canExpireCache())this.deleteOldest()}clear(){while(this.oldest_)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;while(t)e(t.value_,t.key_,this),t=t.newer}get(e,t){const s=this.entries_[e];return(0,i.v)(void 0!==s,"Tried to get a value for a key that does not exist in the cache"),s===this.newest_||(s===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(s.newer.older=s.older,s.older.newer=s.newer),s.newer=null,s.older=this.newest_,this.newest_.newer=s,this.newest_=s),s.value_}remove(e){const t=this.entries_[e];return(0,i.v)(void 0!==t,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t,s=0;for(t=this.newest_;t;t=t.older)e[s++]=t.key_;return e}getValues(){const e=new Array(this.count_);let t,s=0;for(t=this.newest_;t;t=t.older)e[s++]=t.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){(0,i.v)(!(e in this.entries_),"Tried to set a value for a key that is used already");const s={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=s:this.oldest_=s,this.newest_=s,this.entries_[e]=s,++this.count_}setSize(e){this.highWaterMark=e}}t.A=r},27607:function(e,t,s){s.d(t,{$r:function(){return u},bL:function(){return a},xo:function(){return o}});var n=s(8143),i=s(11078),r=s(68711);function o(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}function a(e){return e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e instanceof DataView?e:null}const h=new Error("disposed");let l=null;function u(e){l||(l=(0,r.Y)(e.width,e.height,void 0,{willReadFrequently:!0}));const t=l.canvas,s=e.width;t.width!==s&&(t.width=s);const n=e.height;return t.height!==n&&(t.height=n),l.clearRect(0,0,s,n),l.drawImage(e,0,0),l.getImageData(0,0,s,n).data}const c=[256,256];class d extends n.A{constructor(e){const t=i.A.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=o(this.data_);return e?[e.width,e.height]:c}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==i.A.IDLE&&this.state!==i.A.ERROR)return;this.state=i.A.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=i.A.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=i.A.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(h),this.controller_=null),super.disposeInternal()}}t.Ay=d},34889:function(e,t,s){function n(e){return Array.isArray(e)?Math.min(...e):e}s.d(t,{m:function(){return n}})},42192:function(e,t,s){s.r(t),s.d(t,{DECIMALS:function(){return i},DEFAULT_WMS_VERSION:function(){return n}});const n="1.3.0",i=4},67238:function(e,t,s){var n=s(43938),i=s(6141);class r extends n.Ay{constructor(e,t,s,n,r){const o=void 0!==r?i.A.IDLE:i.A.LOADED;super(e,t,s,o),this.loader_=void 0!==r?r:null,this.canvas_=n,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=i.A.ERROR):this.state=i.A.LOADED,this.changed()}load(){this.state==i.A.IDLE&&(this.state=i.A.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}t.A=r},83440:function(e,t,s){s.r(t),s.d(t,{ImageSourceEvent:function(){return v},ImageSourceEventType:function(){return I},default:function(){return L},defaultImageLoadFunction:function(){return R},getRequestExtent:function(){return y}});var n=s(43938),i=s(6141),r=s(66514),o=s(1685),a=s(6837),h=s(70915),l=s(61597),u=s(38599),c=s(9438),d=s(33513),_=s(34889),g=s(52913),p=s(93101);class f extends n.Ay{constructor(e,t,s,n,r,o,a){let l=e.getExtent();l&&e.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let u=t.getExtent();u&&t.canWrapX()&&(u=u.slice(),u[0]=-1/0,u[2]=1/0);const c=u?(0,h._N)(s,u):s,_=(0,h.q1)(c),f=(0,d.KQ)(e,t,_,n),m=p.l,w=new g.A(e,t,c,l,f*m,n),A=w.calculateSourceExtent(),I=(0,h.Im)(A)?null:o(A,f,r),v=I?i.A.IDLE:i.A.EMPTY,E=I?I.getPixelRatio():1;super(s,n,E,v),this.targetProj_=t,this.maxSourceExtent_=l,this.triangulation_=w,this.targetResolution_=n,this.targetExtent_=s,this.sourceImage_=I,this.sourcePixelRatio_=E,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==i.A.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==i.A.LOADED){const e=(0,h.RG)(this.targetExtent_)/this.targetResolution_,t=(0,h.Oq)(this.targetExtent_)/this.targetResolution_;this.canvas_=(0,d.XX)(e,t,this.sourcePixelRatio_,(0,_.m)(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==i.A.IDLE){this.state=i.A.LOADING,this.changed();const e=this.sourceImage_.getState();e==i.A.LOADED||e==i.A.ERROR?this.reproject_():(this.sourceListenerKey_=(0,c.KT)(this.sourceImage_,a.A.CHANGE,e=>{const t=this.sourceImage_.getState();t!=i.A.LOADED&&t!=i.A.ERROR||(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){(0,c.JH)(this.sourceListenerKey_),this.sourceListenerKey_=null}}var m=f,w=s(16444),A=s(42192);const I={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class v extends o.Ay{constructor(e,t){super(e),this.image=t}}class E extends w["default"]{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:void 0===e.interpolate||e.interpolate}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=void 0!==e.resolutions?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=!!e.loader&&0===e.loader.length,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const s=(0,r.FT)(t,e,0);e=t[s]}return e}getImage(e,t,s,n){const i=this.getProjection();if(!i||!n||(0,u.tI)(i,n))return i&&(n=i),this.getImageInternal(e,t,s,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&(0,u.tI)(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==t&&(0,h.aI)(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new m(i,n,e,t,s,(e,t,s)=>this.getImageInternal(e,t,s,i),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,s,i){if(this.loader){const r=y(e,t,s,1),o=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===i&&(this.wantedExtent_&&(0,h.ms)(this.wantedExtent_,r)||(0,h.ms)(this.image.getExtent(),r))&&(this.wantedResolution_&&(0,_.m)(this.wantedResolution_)===o||(0,_.m)(this.image.getResolution())===o)))return this.image;this.wantedProjection_=i,this.wantedExtent_=r,this.wantedResolution_=o,this.image=new n.Ay(r,o,s,this.loader),this.image.addEventListener(a.A.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let s;switch(t.getState()){case i.A.LOADING:this.loading=!0,s=I.IMAGELOADSTART;break;case i.A.LOADED:this.loading=!1,s=I.IMAGELOADEND;break;case i.A.ERROR:this.loading=!1,s=I.IMAGELOADERROR;break;default:return}this.hasListener(s)&&this.dispatchEvent(new v(s,t))}}function R(e,t){e.getImage().src=t}function y(e,t,s,n){const i=t/s,r=(0,h.q1)(e),o=(0,l.mk)((0,h.RG)(e)/i,A.DECIMALS),a=(0,l.mk)((0,h.Oq)(e)/i,A.DECIMALS),u=(0,l.mk)((n-1)*o/2,A.DECIMALS),c=o+2*u,d=(0,l.mk)((n-1)*a/2,A.DECIMALS),_=a+2*d;return(0,h.Bg)(r,i,0,[c,_])}var L=E},90024:function(e,t,s){s.r(t),s.d(t,{Processor:function(){return v},RasterSourceEvent:function(){return R}});var n=s(90025),i=s(67238),r=s(44335),o=s(68711),a=s(1685),h=s(6837),l=s(70915),u=s(53820),c=s(30945),d=s(9703),_=s(4087),g=s(83440),p=s(16444),f=s(66017),m=s(48287)["hp"];function w(e){return function(t){const s=t["buffers"],n=t["meta"],i=t["imageOps"],r=t["width"],o=t["height"],a=s.length,h=s[0].byteLength;if(i){const t=new Array(a);for(let e=0;e<a;++e)t[e]=new ImageData(new Uint8ClampedArray(s[e]),r,o);const i=e(t,n).data;return i.buffer}const l=new Uint8ClampedArray(h),u=new Array(a),c=new Array(a);for(let e=0;e<a;++e)u[e]=new Uint8ClampedArray(s[e]),c[e]=[0,0,0,0];for(let d=0;d<h;d+=4){for(let e=0;e<a;++e){const t=u[e];c[e][0]=t[d],c[e][1]=t[d+1],c[e][2]=t[d+2],c[e][3]=t[d+3]}const t=e(c,n);l[d]=t[0],l[d+1]=t[1],l[d+2]=t[2],l[d+3]=t[3]}return l.buffer}}function A(e,t){const s=Object.keys(e.lib||{}).map(function(t){return"const "+t+" = "+e.lib[t].toString()+";"}),n=s.concat(["const __minion__ = ("+w.toString()+")(",e.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),i=new Worker("undefined"===typeof Blob?"data:text/javascript;base64,"+m.from(n.join("\n"),"binary").toString("base64"):URL.createObjectURL(new Blob(n,{type:"text/javascript"})));return i.addEventListener("message",t),i}function I(e,t){const s=w(e.operation);let n=!1;return{postMessage:function(e){setTimeout(function(){n||t({data:{buffer:s(e),meta:e["meta"]}})},0)},terminate:function(){n=!0}}}class v extends n.A{constructor(e){let t;super(),this.imageOps_=!!e.imageOps,t=0===e.threads?0:this.imageOps_?1:e.threads||1;const s=new Array(t);if(t)for(let n=0;n<t;++n)s[n]=A(e,this.onWorkerMessage_.bind(this,n));else s[0]=I(e,this.onWorkerMessage_.bind(this,0));this.workers_=s,this.queue_=[],this.maxQueueLength_=e.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(e,t,s){this.enqueue_({inputs:e,meta:t,callback:s}),this.dispatch_()}enqueue_(e){this.queue_.push(e);while(this.queue_.length>this.maxQueueLength_)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||0===this.queue_.length)return;const e=this.queue_.shift();this.job_=e;const t=e.inputs[0].width,s=e.inputs[0].height,n=e.inputs.map(function(e){return e.data.buffer}),i=this.workers_.length;if(this.running_=i,1===i)return void this.workers_[0].postMessage({buffers:n,meta:e.meta,imageOps:this.imageOps_,width:t,height:s},n);const r=e.inputs[0].data.length,o=4*Math.ceil(r/4/i);for(let a=0;a<i;++a){const i=a*o,r=[];for(let e=0,t=n.length;e<t;++e)r.push(n[e].slice(i,i+o));this.workers_[a].postMessage({buffers:r,meta:e.meta,imageOps:this.imageOps_,width:t,height:s},r)}}onWorkerMessage_(e,t){this.disposed||(this.dataLookup_[e]=t.data,--this.running_,0===this.running_&&this.resolveJob_())}resolveJob_(){const e=this.job_,t=this.workers_.length;let s,n;if(1===t)s=new Uint8ClampedArray(this.dataLookup_[0]["buffer"]),n=this.dataLookup_[0]["meta"];else{const i=e.inputs[0].data.length;s=new Uint8ClampedArray(i),n=new Array(t);const r=4*Math.ceil(i/4/t);for(let e=0;e<t;++e){const t=this.dataLookup_[e]["buffer"],i=e*r;s.set(new Uint8ClampedArray(t),i),n[e]=this.dataLookup_[e]["meta"]}}this.job_=null,this.dataLookup_={},e.callback(null,new ImageData(s,e.inputs[0].width,e.inputs[0].height),n),this.dispatch_()}disposeInternal(){for(let e=0;e<this.workers_.length;++e)this.workers_[e].terminate();this.workers_.length=0}}const E={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class R extends a.Ay{constructor(e,t,s){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=s}}class y extends g["default"]{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=void 0!==e.operationType?e.operationType:"pixel",this.threads_=void 0!==e.threads?e.threads:1,this.layers_=x(e.sources);const t=this.changed.bind(this);for(let s=0,n=this.layers_.length;s<n;++s)this.layers_[s].addEventListener(h.A.CHANGE,t);this.useResolutions_=null!==e.resolutions,this.tileQueue_=new r.A(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:(0,d.vt)(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:O(this.layers_),pixelRatio:1,pixelToCoordinateTransform:(0,d.vt)(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:(0,_.v6)(this),renderTargets:{}},this.setAttributions(function(t){const s=[];for(let n=0,i=e.sources.length;n<i;++n){const i=e.sources[n],r=i instanceof p["default"]?i:i.getSource();if(!r)continue;const o=r.getAttributions()?.(t);"string"===typeof o?s.push(o):void 0!==o&&s.push(...o)}return s}),void 0!==e.operation&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new v({operation:e,imageOps:"image"===this.operationType_,queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,s){const n=Object.assign({},this.frameState_);n.viewState=Object.assign({},n.viewState);const i=(0,l.q1)(e);n.size[0]=Math.ceil((0,l.RG)(e)/t),n.size[1]=Math.ceil((0,l.Oq)(e)/t),n.extent=[i[0]-n.size[0]*t/2,i[1]-n.size[1]*t/2,i[0]+n.size[0]*t/2,i[1]+n.size[1]*t/2],n.time=Date.now();const r=n.viewState;return r.center=i,r.projection=s,r.resolution=t,n}allSourcesReady_(){let e,t=!0;for(let s=0,n=this.layers_.length;s<n;++s)if(e=this.layers_[s].getSource(),!e||"ready"!==e.getState()){t=!1;break}return t}getImage(e,t,s,n){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const i=this.updateFrameState_(e,t,n);if(this.requestedFrameState_=i,this.renderedImageCanvas_){const e=this.renderedImageCanvas_.getResolution(),s=this.renderedImageCanvas_.getExtent();t===e&&(0,l.aI)(i.extent,s)||(this.renderedImageCanvas_=null)}return this.renderedImageCanvas_&&this.getRevision()===this.renderedRevision_||this.processSources_(),i.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,s=new Array(t);for(let i=0;i<t;++i){e.layerIndex=i,e.renderTargets={};const t=b(this.layers_[i],e);if(!t)return;s[i]=t}const n={};this.dispatchEvent(new R(E.BEFOREOPERATIONS,e,n)),this.processor_.process(s,n,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,s,n){if(t||!s)return;const r=e.extent,a=e.viewState.resolution;if(a!==this.requestedFrameState_.viewState.resolution||!(0,l.aI)(r,this.requestedFrameState_.extent))return;let h;if(this.renderedImageCanvas_)h=this.renderedImageCanvas_.getImage().getContext("2d");else{const e=Math.round((0,l.RG)(r)/a),t=Math.round((0,l.Oq)(r)/a);h=(0,o.Y)(e,t),this.renderedImageCanvas_=new i.A(r,a,1,h.canvas)}h.putImageData(s,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new R(E.AFTEROPERATIONS,e,n))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let s=0,n=this.layers_.length;s<n;++s){const n=this.layers_[s].getSource();if(t=n.getResolutions(e),t)break}return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}y.prototype.dispose;let L=null;function b(e,t){const s=e.getRenderer();if(!s)throw new Error("Unsupported layer type: "+e);if(!s.prepareFrame(t))return null;const n=t.size[0],i=t.size[1];if(0===n||0===i)return null;const r=s.renderFrame(t,null);let a;if(r instanceof HTMLCanvasElement)a=r;else{if(r&&(a=r.firstElementChild),!(a instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+a);if(a.width===n&&a.height===i){const e=a.getContext("2d");return e.getImageData(0,0,n,i)}}if(L){const e=L.canvas;e.width!==n||e.height!==i?L=(0,o.Y)(n,i,void 0,{willReadFrequently:!0}):L.clearRect(0,0,n,i)}else L=(0,o.Y)(n,i,void 0,{willReadFrequently:!0});return L.drawImage(a,0,0,n,i),L.getImageData(0,0,n,i)}function O(e){return e.map(function(e){return e.getLayerState()})}function x(e){const t=e.length,s=new Array(t);for(let n=0;n<t;++n)s[n]=S(e[n]);return s}function S(e){let t;return e instanceof p["default"]?e instanceof f["default"]?t=new c["default"]({source:e}):e instanceof g["default"]&&(t=new u["default"]({source:e})):t=e,t}t["default"]=y}}]);
//# sourceMappingURL=372.dccebcbb.js.map