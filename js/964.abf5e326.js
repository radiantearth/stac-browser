"use strict";(self["webpackChunk_radiantearth_stac_browser"]=self["webpackChunk_radiantearth_stac_browser"]||[]).push([[964,8807],{18056:function(e,t,r){r.r(t);var i=r(49825),s=r(27557),n=r(75332),a=r(34835),o=r(34799),l=r(22808);function c(e,t){const r=`\n    attribute vec2 ${o.eS.TEXTURE_COORD};\n    uniform mat4 ${o.gF.TILE_TRANSFORM};\n    uniform float ${o.gF.TEXTURE_PIXEL_WIDTH};\n    uniform float ${o.gF.TEXTURE_PIXEL_HEIGHT};\n    uniform float ${o.gF.TEXTURE_RESOLUTION};\n    uniform float ${o.gF.TEXTURE_ORIGIN_X};\n    uniform float ${o.gF.TEXTURE_ORIGIN_Y};\n    uniform float ${o.gF.DEPTH};\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n\n    void main() {\n      v_textureCoord = ${o.eS.TEXTURE_COORD};\n      v_mapCoord = vec2(\n        ${o.gF.TEXTURE_ORIGIN_X} + ${o.gF.TEXTURE_RESOLUTION} * ${o.gF.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],\n        ${o.gF.TEXTURE_ORIGIN_Y} - ${o.gF.TEXTURE_RESOLUTION} * ${o.gF.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]\n      );\n      gl_Position = ${o.gF.TILE_TRANSFORM} * vec4(${o.eS.TEXTURE_COORD}, ${o.gF.DEPTH}, 1.0);\n    }\n  `,n={...(0,s.z0)(),bandCount:t},l=[];if(void 0!==e.color){const t=(0,a.s2)(n,e.color,i.mE);l.push(`color = ${t};`)}if(void 0!==e.contrast){const t=(0,a.s2)(n,e.contrast,i.wl);l.push(`color.rgb = clamp((${t} + 1.0) * color.rgb - (${t} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(void 0!==e.exposure){const t=(0,a.s2)(n,e.exposure,i.wl);l.push(`color.rgb = clamp((${t} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(void 0!==e.saturation){const t=(0,a.s2)(n,e.saturation,i.wl);l.push(`\n      float saturation = ${t} + 1.0;\n      float sr = (1.0 - saturation) * 0.2126;\n      float sg = (1.0 - saturation) * 0.7152;\n      float sb = (1.0 - saturation) * 0.0722;\n      mat3 saturationMatrix = mat3(\n        sr + saturation, sr, sr,\n        sg, sg + saturation, sg,\n        sb, sb, sb + saturation\n      );\n      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n    `)}if(void 0!==e.gamma){const t=(0,a.s2)(n,e.gamma,i.wl);l.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${t}));`)}if(void 0!==e.brightness){const t=(0,a.s2)(n,e.brightness,i.wl);l.push(`color.rgb = clamp(color.rgb + ${t}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const c={},h=Object.keys(n.variables).length;if(h>1&&!e.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let i=0;i<h;++i){const t=n.variables[Object.keys(n.variables)[i]];if(!(t.name in e.variables))throw new Error(`Missing '${t.name}' in style variables`);const r=(0,s.Sl)(t.name);c[r]=function(){let r=e.variables[t.name];return"string"===typeof r&&(r=(0,s.Lm)(r)),void 0!==r?r:-9999999}}const u=Object.keys(c).map(function(e){return`uniform float ${e};`}),d=Math.ceil(t/4);u.push(`uniform sampler2D ${o.gF.TILE_TEXTURE_ARRAY}[${d}];`),n.paletteTextures&&u.push(`uniform sampler2D ${s.uZ}[${n.paletteTextures.length}];`);const g=Object.keys(n.functions).map(function(e){return n.functions[e]}),f=`\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n    uniform vec4 ${o.gF.RENDER_EXTENT};\n    uniform float ${o.gF.TRANSITION_ALPHA};\n    uniform float ${o.gF.TEXTURE_PIXEL_WIDTH};\n    uniform float ${o.gF.TEXTURE_PIXEL_HEIGHT};\n    uniform float ${o.gF.RESOLUTION};\n    uniform float ${o.gF.ZOOM};\n\n    ${u.join("\n")}\n\n    ${g.join("\n")}\n\n    void main() {\n      if (\n        v_mapCoord[0] < ${o.gF.RENDER_EXTENT}[0] ||\n        v_mapCoord[1] < ${o.gF.RENDER_EXTENT}[1] ||\n        v_mapCoord[0] > ${o.gF.RENDER_EXTENT}[2] ||\n        v_mapCoord[1] > ${o.gF.RENDER_EXTENT}[3]\n      ) {\n        discard;\n      }\n\n      vec4 color = texture2D(${o.gF.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);\n\n      ${l.join("\n")}\n\n      gl_FragColor = color;\n      gl_FragColor.rgb *= gl_FragColor.a;\n      gl_FragColor *= ${o.gF.TRANSITION_ALPHA};\n    }`;return{vertexShader:r,fragmentShader:f,uniforms:c,paletteTextures:n.paletteTextures}}class h extends l["default"]{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.styleVariables_=this.style_.variables||{},this.handleSourceUpdate_(),this.addChangeListener(n["default"].SOURCE,this.handleSourceUpdate_)}getSources(e,t){const r=this.getSource();return this.sources_?"function"===typeof this.sources_?this.sources_(e,t):this.sources_:r?[r]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache();const e=this.getSource();if(e)if("loading"===e.getState()){const t=()=>{"ready"===e.getState()&&(e.removeEventListener("change",t),this.setStyle(this.style_))};e.addEventListener("change",t)}else this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=c(this.style_,this.getSourceBandCount_());return new o.Ay(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.getCacheSize(),paletteTextures:e.paletteTextures})}renderSources(e,t){const r=this.getRenderer();let i;for(let s=0,n=t.length;s<n;++s)this.renderedSource_=t[s],r.prepareFrame(e)&&(i=r.renderFrame(e));return i}render(e,t){this.rendered=!0;const r=e.viewState,i=this.getSources(e.extent,r.resolution);let s=!0;for(let a=0,o=i.length;a<o;++a){const e=i[a],t=e.getState();if("loading"==t){const t=()=>{"ready"==e.getState()&&(e.removeEventListener("change",t),this.changed())};e.addEventListener("change",t)}s=s&&"ready"==t}const n=this.renderSources(e,i);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=r.resolution,n;if(this.renderedResolution_>.5*r.resolution){const t=this.getSources(e.extent,this.renderedResolution_).filter(e=>!i.includes(e));if(t.length>0)return this.renderSources(e,t)}return n}setStyle(e){if(this.styleVariables_=e.variables||{},this.style_=e,this.hasRenderer()){const e=c(this.style_,this.getSourceBandCount_()),t=this.getRenderer();t.reset({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,paletteTextures:e.paletteTextures}),this.changed()}}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}h.prototype.dispose,t["default"]=h},48807:function(e,t,r){r.r(t),r.d(t,{createLoader:function(){return n}});var i=r(43938),s=r(70915);function n(e){const t=e.load||i.D4,r=e.imageExtent,n=e.crossOrigin??null;return()=>{const i=new Image;return i.crossOrigin=n,t(i,e.url).then(e=>{const t=(0,s.RG)(r)/e.width,i=(0,s.Oq)(r)/e.height,n=t!==i?[t,i]:i;return{image:e,extent:r,resolution:n,pixelRatio:1}})}}},58262:function(e,t,r){r.r(t);var i=r(43938),s=r(6837),n=r(70915),a=r(38599),o=r(83440),l=r(48807);class c extends o["default"]{constructor(e){const t=void 0!==e.crossOrigin?e.crossOrigin:null,r=void 0!==e.imageLoadFunction?e.imageLoadFunction:o.defaultImageLoadFunction;super({attributions:e.attributions,interpolate:e.interpolate,projection:(0,a.Jt)(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new i.Ay(this.imageExtent_,void 0,1,(0,l.createLoader)({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(e,t)=>(this.image.setImage(e),r(this.image,t),(0,i.D4)(e))})),this.image.addEventListener(s.A.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,r,i){return(0,n.HY)(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}t["default"]=c},60964:function(e,t,r){r.r(t),r.d(t,{default:function(){return Ir}});r(18111),r(61701);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"map-container"},[t("div",{ref:"map",staticClass:"map",attrs:{id:e.mapId}},[t("LayerControl",{attrs:{map:e.map,maxZoom:e.maxZoom}}),e.empty?t("TextControl",{attrs:{map:e.map,text:e.$t("mapping.nodata")}}):e.hasBasemap?e._e():t("TextControl",{attrs:{map:e.map,text:e.$t("mapping.nobasemap")}})],1),t("div",{ref:"target",staticClass:"popover-target"}),e.popover&&e.selection?t("b-popover",{attrs:{show:"",placement:"auto",triggers:"manual",target:e.selection.target,container:e.container,"custom-class":"map-popover"}},[t("section",{staticClass:"popover-children"},["items"===e.selection.type?t("Items",{attrs:{stac:e.stac,items:e.selection.children}}):"collections"===e.selection.type?t("Catalogs",{attrs:{collectionsOnly:"",enforceCards:"",hideControls:"",stac:e.stac,catalogs:e.selection.children}}):t("Features",{attrs:{features:e.selection.children}})],1),t("div",{staticClass:"text-center"},[t("b-button",{attrs:{variant:"danger"},on:{click:e.resetSelection}},[e._v(e._s(e.$t("mapping.close")))])],1)]):e._e()],1)},s=[],n=(r(22489),r(3722)),a=r(3838),o=r(82209),l=r(95353),c=r(30278),h=r(50071),u=r(32135),d=r(86717),g=r(66514),f=r(1685),p=r(58704),m=r(74238),y=r(82986),_=r(43530),v=r(29276),w=r(4087),b=r(71603);const T={SELECT:"select"};class E extends f.Ay{constructor(e,t,r,i){super(e),this.selected=t,this.deselected=r,this.mapBrowserEvent=i}}const x={};class A extends b.Ay{constructor(e){let t;if(super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:p.t5,this.addCondition_=e.addCondition?e.addCondition:p.Zm,this.removeCondition_=e.removeCondition?e.removeCondition:p.Zm,this.toggleCondition_=e.toggleCondition?e.toggleCondition:p.Kg,this.multi_=!!e.multi&&e.multi,this.filter_=e.filter?e.filter:m.rT,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=void 0!==e.style?e.style:S(),this.features_=e.features||new h.A,e.layers)if("function"===typeof e.layers)t=e.layers;else{const r=e.layers;t=function(e){return r.includes(e)}}else t=m.rT;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[(0,w.v6)(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[(0,w.v6)(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){const t=this.getMap();t&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(u.A.ADD,this.boundAddFeature_),this.features_.addEventListener(u.A.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(u.A.ADD,this.boundAddFeature_),this.features_.removeEventListener(u.A.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const e=this.getMap().getAllLayers().find(function(e){if(e instanceof y["default"]&&e.getSource()&&e.getSource().hasFeature(t))return e});e&&this.addFeatureLayerAssociation_(t,e)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=(0,w.v6)(e);t in x||(x[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let i=t.length-1;i>=0;--i){const r=t[i];if(r!==this&&r instanceof A&&r.getStyle()&&-1!==r.getFeatures().getArray().lastIndexOf(e))return void e.setStyle(r.getStyle())}const r=(0,w.v6)(e);e.setStyle(x[r]),delete x[r]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[(0,w.v6)(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),r=this.removeCondition_(e),i=this.toggleCondition_(e),s=!t&&!r&&!i,n=e.map,a=this.getFeatures(),o=[],l=[];if(s){(0,_.I)(this.featureLayerAssociation_),n.forEachFeatureAtPixel(e.pixel,(e,t)=>{if(e instanceof d.A&&this.filter_(e,t))return this.addFeatureLayerAssociation_(e,t),l.push(e),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=a.getLength()-1;e>=0;--e){const t=a.item(e),r=l.indexOf(t);r>-1?l.splice(r,1):(a.remove(t),o.push(t))}0!==l.length&&a.extend(l)}else{n.forEachFeatureAtPixel(e.pixel,(e,s)=>{if(e instanceof d.A&&this.filter_(e,s))return!t&&!i||a.getArray().includes(e)?(r||i)&&a.getArray().includes(e)&&(o.push(e),this.removeFeatureLayerAssociation_(e)):(this.addFeatureLayerAssociation_(e,s),l.push(e)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=o.length-1;e>=0;--e)a.remove(o[e]);a.extend(l)}return(l.length>0||o.length>0)&&this.dispatchEvent(new E(T.SELECT,l,o,e)),!0}}function S(){const e=(0,v.mY)();return(0,g.X$)(e["Polygon"],e["LineString"]),(0,g.X$)(e["GeometryCollection"],e["LineString"]),function(t){return t.getGeometry()?e[t.getGeometry().getType()]:null}}var R=A,F=r(70915),O=r(73354),C=r(29297),I=r(35598),M=r(53820),P=r(30945),U=r(65544),$=r(18056),j=r(38599),D=r(58262),G=r(19551),k=r(82728),N=r(42457),B=r(75522),z=r(36181),Z=r(10702),H=r(22615),V=r(11078),W=r(60032),X=r(4863),K=Uint8Array,J=Uint16Array,Y=Int32Array,q=new K([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Q=new K([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ee=new K([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),te=function(e,t){for(var r=new J(31),i=0;i<31;++i)r[i]=t+=1<<e[i-1];var s=new Y(r[30]);for(i=1;i<30;++i)for(var n=r[i];n<r[i+1];++n)s[n]=n-r[i]<<5|i;return{b:r,r:s}},re=te(q,2),ie=re.b,se=re.r;ie[28]=258,se[258]=28;for(var ne=te(Q,0),ae=ne.b,oe=(ne.r,new J(32768)),le=0;le<32768;++le){var ce=(43690&le)>>1|(21845&le)<<1;ce=(52428&ce)>>2|(13107&ce)<<2,ce=(61680&ce)>>4|(3855&ce)<<4,oe[le]=((65280&ce)>>8|(255&ce)<<8)>>1}var he=function(e,t,r){for(var i=e.length,s=0,n=new J(t);s<i;++s)e[s]&&++n[e[s]-1];var a,o=new J(t);for(s=1;s<t;++s)o[s]=o[s-1]+n[s-1]<<1;if(r){a=new J(1<<t);var l=15-t;for(s=0;s<i;++s)if(e[s])for(var c=s<<4|e[s],h=t-e[s],u=o[e[s]-1]++<<h,d=u|(1<<h)-1;u<=d;++u)a[oe[u]>>l]=c}else for(a=new J(i),s=0;s<i;++s)e[s]&&(a[s]=oe[o[e[s]-1]++]>>15-e[s]);return a},ue=new K(288);for(le=0;le<144;++le)ue[le]=8;for(le=144;le<256;++le)ue[le]=9;for(le=256;le<280;++le)ue[le]=7;for(le=280;le<288;++le)ue[le]=8;var de=new K(32);for(le=0;le<32;++le)de[le]=5;var ge=he(ue,9,1),fe=he(de,5,1),pe=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},me=function(e,t,r){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&r},ye=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},_e=function(e){return(e+7)/8|0},ve=function(e,t,r){return(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length),new K(e.subarray(t,r))},we=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],be=function(e,t,r){var i=new Error(t||we[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,be),!r)throw i;return i},Te=function(e,t,r,i){var s=e.length,n=i?i.length:0;if(!s||t.f&&!t.l)return r||new K(0);var a=!r,o=a||2!=t.i,l=t.i;a&&(r=new K(3*s));var c=function(e){var t=r.length;if(e>t){var i=new K(Math.max(2*t,e));i.set(r),r=i}},h=t.f||0,u=t.p||0,d=t.b||0,g=t.l,f=t.d,p=t.m,m=t.n,y=8*s;do{if(!g){h=me(e,u,1);var _=me(e,u+1,3);if(u+=3,!_){var v=_e(u)+4,w=e[v-4]|e[v-3]<<8,b=v+w;if(b>s){l&&be(0);break}o&&c(d+w),r.set(e.subarray(v,b),d),t.b=d+=w,t.p=u=8*b,t.f=h;continue}if(1==_)g=ge,f=fe,p=9,m=5;else if(2==_){var T=me(e,u,31)+257,E=me(e,u+10,15)+4,L=T+me(e,u+5,31)+1;u+=14;for(var x=new K(L),A=new K(19),S=0;S<E;++S)A[ee[S]]=me(e,u+3*S,7);u+=3*E;var R=pe(A),F=(1<<R)-1,O=he(A,R,1);for(S=0;S<L;){var C=O[me(e,u,F)];u+=15&C;v=C>>4;if(v<16)x[S++]=v;else{var I=0,M=0;16==v?(M=3+me(e,u,3),u+=2,I=x[S-1]):17==v?(M=3+me(e,u,7),u+=3):18==v&&(M=11+me(e,u,127),u+=7);while(M--)x[S++]=I}}var P=x.subarray(0,T),U=x.subarray(T);p=pe(P),m=pe(U),g=he(P,p,1),f=he(U,m,1)}else be(1);if(u>y){l&&be(0);break}}o&&c(d+131072);for(var $=(1<<p)-1,j=(1<<m)-1,D=u;;D=u){I=g[ye(e,u)&$];var G=I>>4;if(u+=15&I,u>y){l&&be(0);break}if(I||be(2),G<256)r[d++]=G;else{if(256==G){D=u,g=null;break}var k=G-254;if(G>264){S=G-257;var N=q[S];k=me(e,u,(1<<N)-1)+ie[S],u+=N}var B=f[ye(e,u)&j],z=B>>4;B||be(3),u+=15&B;U=ae[z];if(z>3){N=Q[z];U+=ye(e,u)&(1<<N)-1,u+=N}if(u>y){l&&be(0);break}o&&c(d+131072);var Z=d+k;if(d<U){var H=n-U,V=Math.min(U,Z);for(H+d<0&&be(3);d<V;++d)r[d]=i[H+d]}for(;d<Z;++d)r[d]=r[d-U]}}t.l=g,t.p=D,t.b=d,t.f=h,g&&(h=1,t.m=p,t.d=f,t.n=m)}while(!h);return d!=r.length&&a?ve(r,0,d):r.subarray(0,d)},Ee=new K(0),Le=function(e){31==e[0]&&139==e[1]&&8==e[2]||be(6,"invalid gzip data");var t=e[3],r=10;4&t&&(r+=2+(e[10]|e[11]<<8));for(var i=(t>>3&1)+(t>>4&1);i>0;i-=!e[r++]);return r+(2&t)},xe=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Ae=function(e,t){return(8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31)&&be(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&be(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),2+(e[1]>>3&4)};function Se(e,t){return Te(e,{i:2},t&&t.out,t&&t.dictionary)}function Re(e,t){var r=Le(e);return r+8>e.length&&be(6,"invalid gzip data"),Te(e.subarray(r,-8),{i:2},t&&t.out||new K(xe(e)),t&&t.dictionary)}function Fe(e,t){return Te(e.subarray(Ae(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}function Oe(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?Re(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Se(e,t):Fe(e,t)}var Ce="undefined"!=typeof TextDecoder&&new TextDecoder;try{Ce.decode(Ee,{stream:!0})}catch(Mr){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;var Ie=Object.defineProperty,Me=Math.pow,Pe=(e,t)=>Ie(e,"name",{value:t,configurable:!0}),Ue=(e,t,r)=>new Promise((i,s)=>{var n=e=>{try{o(r.next(e))}catch(t){s(t)}},a=e=>{try{o(r.throw(e))}catch(t){s(t)}},o=e=>e.done?i(e.value):Promise.resolve(e.value).then(n,a);o((r=r.apply(e,t)).next())}),$e=(Pe((e,t)=>{let r=!1,i="",s=L.GridLayer.extend({createTile:Pe((t,s)=>{let n=document.createElement("img"),a=new AbortController,o=a.signal;return n.cancel=()=>{a.abort()},r||(e.getHeader().then(e=>{1===e.tileType?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):2===e.tileType?i="image/png":3===e.tileType?i="image/jpeg":4===e.tileType?i="image/webp":5===e.tileType&&(i="image/avif")}),r=!0),e.getZxy(t.z,t.x,t.y,o).then(e=>{if(e){let t=new Blob([e.data],{type:i}),r=window.URL.createObjectURL(t);n.src=r,n.cancel=void 0,s(void 0,n)}}).catch(e=>{if("AbortError"!==e.name)throw e}),n},"createTile"),_removeTile:Pe(function(e){let t=this._tiles[e];t&&(t.el.cancel&&t.el.cancel(),t.el.width=0,t.el.height=0,t.el.deleted=!0,L.DomUtil.remove(t.el),delete this._tiles[e],this.fire("tileunload",{tile:t.el,coords:this._keyToTileCoords(e)}))},"_removeTile")});return new s(t)},"leafletRasterLayer"),Pe(e=>(t,r)=>{if(r instanceof AbortController)return e(t,r);let i=new AbortController;return e(t,i).then(e=>r(void 0,e.data,e.cacheControl||"",e.expires||""),e=>r(e)).catch(e=>r(e)),{cancel:Pe(()=>i.abort(),"cancel")}},"v3compat")),je=class{constructor(e){this.tilev4=Pe((e,t)=>Ue(this,null,function*(){if("json"===e.type){let t=e.url.substr(10),r=this.tiles.get(t);if(r||(r=new dt(t),this.tiles.set(t,r)),this.metadata)return{data:yield r.getTileJson(e.url)};let i=yield r.getHeader();return(i.minLon>=i.maxLon||i.minLat>=i.maxLat)&&console.error(`Bounds of PMTiles archive ${i.minLon},${i.minLat},${i.maxLon},${i.maxLat} are not valid.`),{data:{tiles:[`${e.url}/{z}/{x}/{y}`],minzoom:i.minZoom,maxzoom:i.maxZoom,bounds:[i.minLon,i.minLat,i.maxLon,i.maxLat]}}}let r=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),i=e.url.match(r);if(!i)throw new Error("Invalid PMTiles protocol URL");let s=i[1],n=this.tiles.get(s);n||(n=new dt(s),this.tiles.set(s,n));let a=i[2],o=i[3],l=i[4],c=yield n.getHeader(),h=yield null==n?void 0:n.getZxy(+a,+o,+l,t.signal);if(h)return{data:new Uint8Array(h.data),cacheControl:h.cacheControl,expires:h.expires};if(1===c.tileType){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=$e(this.tilev4),this.tiles=new Map,this.metadata=(null==e?void 0:e.metadata)||!1,this.errorOnMissingTile=(null==e?void 0:e.errorOnMissingTile)||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};Pe(je,"Protocol");function De(e,t){return 4294967296*(t>>>0)+(e>>>0)}function Ge(e,t){let r=t.buf,i=r[t.pos++],s=(112&i)>>4;if(i<128||(i=r[t.pos++],s|=(127&i)<<3,i<128)||(i=r[t.pos++],s|=(127&i)<<10,i<128)||(i=r[t.pos++],s|=(127&i)<<17,i<128)||(i=r[t.pos++],s|=(127&i)<<24,i<128)||(i=r[t.pos++],s|=(1&i)<<31,i<128))return De(e,s);throw new Error("Expected varint not more than 10 bytes")}function ke(e){let t=e.buf,r=t[e.pos++],i=127&r;return r<128||(r=t[e.pos++],i|=(127&r)<<7,r<128)||(r=t[e.pos++],i|=(127&r)<<14,r<128)||(r=t[e.pos++],i|=(127&r)<<21,r<128)?i:(r=t[e.pos],i|=(15&r)<<28,Ge(i,e))}function Ne(e,t,r,i){if(0===i){1===r&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);let i=t[0];t[0]=t[1],t[1]=i}}function Be(e,t){let r=Me(2,e),i=t,s=t,n=t,a=[0,0],o=1;for(;o<r;)i=1&n/2,s=1&(n^i),Ne(o,a,i,s),a[0]+=o*i,a[1]+=o*s,n/=4,o*=2;return[e,a[0],a[1]]}Pe(De,"toNum"),Pe(Ge,"readVarintRemainder"),Pe(ke,"readVarint"),Pe(Ne,"rotate"),Pe(Be,"idOnLevel");var ze=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Ze(e,t,r){if(e>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(t>Me(2,e)-1||r>Me(2,e)-1)throw new Error("tile x/y outside zoom level bounds");let i=ze[e],s=Me(2,e),n=0,a=0,o=0,l=[t,r],c=s/2;for(;c>0;)n=(l[0]&c)>0?1:0,a=(l[1]&c)>0?1:0,o+=c*c*(3*n^a),Ne(c,l,n,a),c/=2;return i+o}function He(e){let t=0;for(let r=0;r<27;r++){let i=(1<<r)*(1<<r);if(t+i>e)return Be(r,e-t);t+=i}throw new Error("Tile zoom level exceeds max safe number limit (26)")}Pe(Ze,"zxyToTileId"),Pe(He,"tileIdToZxy");var Ve=(e=>(e[e.Unknown=0]="Unknown",e[e.None=1]="None",e[e.Gzip=2]="Gzip",e[e.Brotli=3]="Brotli",e[e.Zstd=4]="Zstd",e))(Ve||{});function We(e,t){return Ue(this,null,function*(){if(1===t||0===t)return e;if(2===t){if("undefined"==typeof globalThis.DecompressionStream)return Oe(new Uint8Array(e));let t=new Response(e).body;if(!t)throw new Error("Failed to read response stream");let r=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}throw new Error("Compression method not supported")})}Pe(We,"defaultDecompress");var Xe=(e=>(e[e.Unknown=0]="Unknown",e[e.Mvt=1]="Mvt",e[e.Png=2]="Png",e[e.Jpeg=3]="Jpeg",e[e.Webp=4]="Webp",e[e.Avif=5]="Avif",e))(Xe||{});function Ke(e){return 1===e?".mvt":2===e?".png":3===e?".jpg":4===e?".webp":5===e?".avif":""}Pe(Ke,"tileTypeExt");var Je=127;function Ye(e,t){let r=0,i=e.length-1;for(;r<=i;){let s=i+r>>1,n=t-e[s].tileId;if(n>0)r=s+1;else{if(!(n<0))return e[s];i=s-1}}return i>=0&&(0===e[i].runLength||t-e[i].tileId<e[i].runLength)?e[i]:null}Pe(Ye,"findTile");var qe=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return Ue(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};Pe(qe,"FileSource");var Qe=class{constructor(e,t=new Headers){this.url=e,this.customHeaders=t,this.mustReload=!1;let r="";"navigator"in globalThis&&(r=globalThis.navigator.userAgent||"");let i=r.indexOf("Windows")>-1,s=/Chrome|Chromium|Edg|OPR|Brave/.test(r);this.chromeWindowsNoCache=!1,i&&s&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,r,i){return Ue(this,null,function*(){let s,n;r?n=r:(s=new AbortController,n=s.signal);let a,o=new Headers(this.customHeaders);o.set("range",`bytes=${e}-${e+t-1}`),this.mustReload?a="reload":this.chromeWindowsNoCache&&(a="no-store");let l=yield fetch(this.url,{signal:n,cache:a,headers:o});if(0===e&&416===l.status){let e=l.headers.get("Content-Range");if(!e||!e.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let t=+e.substr(8);l=yield fetch(this.url,{signal:n,cache:"reload",headers:{range:"bytes=0-"+(t-1)}})}let c=l.headers.get("Etag");if(null!=c&&c.startsWith("W/")&&(c=null),416===l.status||i&&c&&c!==i)throw this.mustReload=!0,new nt(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(l.status>=300)throw new Error(`Bad response code: ${l.status}`);let h=l.headers.get("Content-Length");if(200===l.status&&(!h||+h>t))throw s&&s.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield l.arrayBuffer(),etag:c||void 0,cacheControl:l.headers.get("Cache-Control")||void 0,expires:l.headers.get("Expires")||void 0}})}};Pe(Qe,"FetchSource");var et=Qe;function tt(e,t){let r=e.getUint32(t+4,!0),i=e.getUint32(t+0,!0);return r*Me(2,32)+i}function rt(e,t){let r=new DataView(e),i=r.getUint8(7);if(i>3)throw new Error(`Archive is spec version ${i} but this library supports up to spec version 3`);return{specVersion:i,rootDirectoryOffset:tt(r,8),rootDirectoryLength:tt(r,16),jsonMetadataOffset:tt(r,24),jsonMetadataLength:tt(r,32),leafDirectoryOffset:tt(r,40),leafDirectoryLength:tt(r,48),tileDataOffset:tt(r,56),tileDataLength:tt(r,64),numAddressedTiles:tt(r,72),numTileEntries:tt(r,80),numTileContents:tt(r,88),clustered:1===r.getUint8(96),internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:t}}function it(e){let t={buf:new Uint8Array(e),pos:0},r=ke(t),i=[],s=0;for(let n=0;n<r;n++){let e=ke(t);i.push({tileId:s+e,offset:0,length:0,runLength:1}),s+=e}for(let n=0;n<r;n++)i[n].runLength=ke(t);for(let n=0;n<r;n++)i[n].length=ke(t);for(let n=0;n<r;n++){let e=ke(t);i[n].offset=0===e&&n>0?i[n-1].offset+i[n-1].length:e-1}return i}Pe(tt,"getUint64"),Pe(rt,"bytesToHeader"),Pe(it,"deserializeIndex");var st=class extends Error{};Pe(st,"EtagMismatch");var nt=st;function at(e,t){return Ue(this,null,function*(){let r=yield e.getBytes(0,16384);if(19792!==new DataView(r.data).getUint16(0,!0))throw new Error("Wrong magic number for PMTiles archive");let i=r.data.slice(0,Je),s=rt(i,r.etag),n=r.data.slice(s.rootDirectoryOffset,s.rootDirectoryOffset+s.rootDirectoryLength),a=`${e.getKey()}|${s.etag||""}|${s.rootDirectoryOffset}|${s.rootDirectoryLength}`,o=it(yield t(n,s.internalCompression));return[s,[a,o.length,o]]})}function ot(e,t,r,i,s){return Ue(this,null,function*(){let n=yield e.getBytes(r,i,void 0,s.etag),a=yield t(n.data,s.internalCompression),o=it(a);if(0===o.length)throw new Error("Empty directory is invalid");return o})}Pe(at,"getHeaderAndRoot"),Pe(ot,"getDirectory");var lt=class{constructor(e=100,t=!0,r=We){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return Ue(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,r.data;let i=yield at(e,this.decompress);return i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:i[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:i[0]}),this.prune(),i[0]})}getDirectory(e,t,r,i){return Ue(this,null,function*(){let s=`${e.getKey()}|${i.etag||""}|${t}|${r}`,n=this.cache.get(s);if(n)return n.lastUsed=this.counter++,n.data;let a=yield ot(e,this.decompress,t,r,i);return this.cache.set(s,{lastUsed:this.counter++,data:a}),this.prune(),a})}prune(){if(this.cache.size>this.maxCacheEntries){let e,t=1/0;this.cache.forEach((r,i)=>{r.lastUsed<t&&(t=r.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(e){return Ue(this,null,function*(){this.cache.delete(e.getKey())})}};Pe(lt,"ResolvedValueCache");var ct=class{constructor(e=100,t=!0,r=We){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return Ue(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,yield r.data;let i=new Promise((t,r)=>{at(e,this.decompress).then(e=>{e[1]&&this.cache.set(e[1][0],{lastUsed:this.counter++,data:Promise.resolve(e[1][2])}),t(e[0]),this.prune()}).catch(e=>{r(e)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getDirectory(e,t,r,i){return Ue(this,null,function*(){let s=`${e.getKey()}|${i.etag||""}|${t}|${r}`,n=this.cache.get(s);if(n)return n.lastUsed=this.counter++,yield n.data;let a=new Promise((s,n)=>{ot(e,this.decompress,t,r,i).then(e=>{s(e),this.prune()}).catch(e=>{n(e)})});return this.cache.set(s,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let e,t=1/0;this.cache.forEach((r,i)=>{r.lastUsed<t&&(t=r.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(e){return Ue(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let r=new Promise((r,i)=>{this.getHeader(e).then(e=>{r(),this.invalidations.delete(t)}).catch(e=>{i(e)})});this.invalidations.set(t,r)})}};Pe(ct,"SharedPromiseCache");var ht=ct,ut=class{constructor(e,t,r){this.source="string"==typeof e?new et(e):e,this.decompress=r||We,this.cache=t||new ht}getHeader(){return Ue(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,r,i){return Ue(this,null,function*(){let s=Ze(e,t,r),n=yield this.cache.getHeader(this.source);if(e<n.minZoom||e>n.maxZoom)return;let a=n.rootDirectoryOffset,o=n.rootDirectoryLength;for(let e=0;e<=3;e++){let e=yield this.cache.getDirectory(this.source,a,o,n),t=Ye(e,s);if(!t)return;if(t.runLength>0){let e=yield this.source.getBytes(n.tileDataOffset+t.offset,t.length,i,n.etag);return{data:yield this.decompress(e.data,n.tileCompression),cacheControl:e.cacheControl,expires:e.expires}}a=n.leafDirectoryOffset+t.offset,o=t.length}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,r,i){return Ue(this,null,function*(){try{return yield this.getZxyAttempt(e,t,r,i)}catch(s){if(s instanceof nt)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,r,i);throw s}})}getMetadataAttempt(){return Ue(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),r=yield this.decompress(t.data,e.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(r))})}getMetadata(){return Ue(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(Mr){if(Mr instanceof nt)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw Mr}})}getTileJson(e){return Ue(this,null,function*(){let t=yield this.getHeader(),r=yield this.getMetadata(),i=Ke(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${i}`],vector_layers:r.vector_layers,attribution:r.attribution,description:r.description,name:r.name,version:r.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};Pe(ut,"PMTiles");var dt=ut,gt=Object.defineProperty,ft=Object.getOwnPropertySymbols,pt=Object.prototype.hasOwnProperty,mt=Object.prototype.propertyIsEnumerable,yt=(e,t,r)=>t in e?gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_t=(e,t)=>{for(var r in t||(t={}))pt.call(t,r)&&yt(e,r,t[r]);if(ft)for(var r of ft(t))mt.call(t,r)&&yt(e,r,t[r]);return e},vt=(e,t)=>gt(e,"name",{value:t,configurable:!0}),wt=(e,t,r)=>new Promise((i,s)=>{var n=e=>{try{o(r.next(e))}catch(Mr){s(Mr)}},a=e=>{try{o(r.throw(e))}catch(Mr){s(Mr)}},o=e=>e.done?i(e.value):Promise.resolve(e.value).then(n,a);o((r=r.apply(e,t)).next())}),bt=class extends H["default"]{constructor(e){super(_t(_t({},e),{state:"loading"})),this.loadImage=vt(e=>new Promise((t,r)=>{const i=new Image;i.addEventListener("load",()=>t(i)),i.addEventListener("error",()=>r(new Error("load failed"))),i.src=e}),"loadImage");const t=new dt(e.url);t.getHeader().then(r=>{const i=void 0===e.projection?"EPSG:3857":e.projection;this.tileGrid=e.tileGrid||(0,X.EN)({extent:(0,X.kZ)(i),maxResolution:e.maxResolution,minZoom:r.minZoom,maxZoom:r.maxZoom,tileSize:e.tileSize}),this.setLoader((e,r,i)=>wt(this,null,function*(){const s=yield t.getZxy(e,r,i);if(!s)return new Uint8Array;const n=URL.createObjectURL(new Blob([s.data])),a=yield this.loadImage(n);return URL.revokeObjectURL(n),a})),this.setState("ready")})}};vt(bt,"PMTilesRasterSource");var Tt=bt,Et=class extends B["default"]{constructor(e){super(_t(_t({},e),{state:"loading",url:"pmtiles://{z}/{x}/{y}",format:e.format||new W.A})),this.tileLoadFunction=vt((e,t)=>{const r=e,i=new RegExp(/pmtiles:\/\/(\d+)\/(\d+)\/(\d+)/),s=t.match(i);if(!(s&&s.length>=4))throw Error("Could not parse tile URL");const n=+s[1],a=+s[2],o=+s[3];r.setLoader((e,t,i)=>{this.pmtiles_.getZxy(n,a,o).then(t=>{if(t){const s=r.getFormat();r.setFeatures(s.readFeatures(t.data,{extent:e,featureProjection:i})),r.setState(V.A.LOADED)}else r.setFeatures([]),r.setState(V.A.EMPTY)}).catch(e=>{r.setFeatures([]),r.setState(V.A.ERROR)})})},"tileLoadFunction"),this.pmtiles_=new dt(e.url),this.pmtiles_.getHeader().then(t=>{const r=e.projection||"EPSG:3857",i=e.extent||(0,X.kZ)(r);this.tileGrid=e.tileGrid||(0,X.EN)({extent:i,maxResolution:e.maxResolution,maxZoom:void 0!==e.maxZoom?e.maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:e.tileSize||512}),this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}};vt(Et,"PMTilesVectorSource");var Lt=Et,xt=r(49194),At=r(34533),St=r(88319),Rt=r(20537),Ft=r(6837);class Ot extends f.Ay{constructor(e){super(Ft.A.ERROR),this.error=e}}var Ct=Ot,It=r(98622),Mt=r(27630),Pt=r(25e3),Ut=r(54422),$t=r(61597),jt=r(8100),Dt=r(56758),Gt=r(9703),kt=r(84078),Nt=r(27733),Bt=r(13628),zt=r(953);const Zt="https://stac-extensions.github.io/label/v1.*/schema.json",Ht=new Bt.A({color:"rgba(0,0,0,0)"});function Vt(e,t,r="rgba(255,255,255,0.4)",i=5){let s=Ht;r&&(s=new Bt.A({color:r}));const n=new zt.A({color:e,width:t});return new v.Ay({image:new Nt.A({fill:s,stroke:n,radius:i}),fill:s,stroke:n})}const Wt=Vt("#3399CC",3),Xt=Vt("#ff9933",2,null);async function Kt(e,t=null,r=null,i=0){const s=new Set;return e.map.forEachFeatureAtPixel(e.pixel,(e,t)=>{r&&r.push(e),s.add(t.get("stac"))},{hitTolerance:i,layerFilter(e){if(e instanceof y["default"]&&!0===e.get("bounds")){const r=e.get("stac");if(r instanceof xt.O7&&(!t||!r.equals(t)))return!0}return!1}}),[...s]}function Jt(e,t){const r={url:e.getAbsoluteUrl()};let i=e,s=e.getBands();1===s.length&&(i=s[0],s=[]);const{minimum:n,maximum:a}=i.getMinMaxValues();if("number"===typeof n&&(r.min=n),"number"===typeof a&&(r.max=a),"number"!==typeof r.min&&"number"!==typeof r.max&&s.length>1)for(const l of s){const{minimum:e,maximum:t}=l.getMinMaxValues();"number"===typeof e&&("undefined"===typeof r.min||e<r.min)&&(r.min=e),"number"===typeof t&&("undefined"===typeof r.max||t>r.max)&&(r.max=t)}const o=i.getNoDataValues();if(o.length>0)r.nodata=o[0];else if(s.length>1){let e;for(const t of s){const r=t.getNoDataValues();if(r.length>0)if("undefined"===typeof e)e=r[0];else if(e!==r[0]){e=void 0;break}}"undefined"!==typeof e&&(r.nodata=e)}if(t.length>0)r.bands=t;else{const t=e.findVisualBands();t&&(r.bands=[t.red.getIndex()+1,t.green.getIndex()+1,t.blue.getIndex()+1])}return r}async function Yt(e){try{const{fromProjectionCode:t,fromEPSGCode:i}=await Promise.resolve().then(r.bind(r,84078));return"function"===typeof t?await t(e):await i(e)}catch(Ke){return null}}async function qt(e,t=void 0){let r;if((0,kt.zN)()){const t=e.getMetadata("proj:code");t&&(r=await Yt(t))}return r||t}function Qt(e,t){const r=e.clone();return t.hasOnlyBounds()||r.setFill(Ht),r}function er(e){let t=e.href;if(t.includes("{s}")){if(!(Array.isArray(e["href:servers"])&&e["href:servers"].length>0))return null;{const r=Math.random()*e["href:servers"].length|0;t=t.replace("{s}",e["href:servers"][r])}}return t}function tr(e){return"string"===typeof e||"number"===typeof e||"boolean"===typeof e}function rr(e){const t=e.fileDirectory,r=t.NewSubfileType||0;return 4===(4&r)}function ir(e,t){if(!e)return!1;if(!0===e)return!0;if(3!==t.getSamplesPerPixel())return!1;const r=t.fileDirectory.PhotometricInterpretation,i=It.ub;return r===i.CMYK||r===i.YCbCr||r===i.CIELab||r===i.ICCLab}const sr="STATISTICS_MAXIMUM",nr="STATISTICS_MINIMUM",ar=256;let or;function lr(){return or||(or=new Mt.A),or}function cr(e){try{return e.getBoundingBox(!0)}catch(re){return[0,0,e.getWidth(),e.getHeight()]}}function hr(e){try{return e.getOrigin().slice(0,2)}catch(re){return[0,e.getHeight()]}}function ur(e,t){try{return e.getResolution(t)}catch(re){return[t.getWidth()/e.getWidth(),t.getHeight()/e.getHeight()]}}async function dr(e,t,r,i){const s=e[t];if(s&&32767!==s){const t="EPSG:"+s;let n=(0,j.Jt)(t);if(!n&&i&&(n=await Yt(t)),!n){const i=(0,jt.q)(e[r]);i&&(n=new j.MF({code:t,units:i}))}return n||null}}async function gr(e,t){const r=e.geoKeys;if(!r)return null;const i=await dr(r,"ProjectedCSTypeGeoKey","ProjLinearUnitsGeoKey",t);return i||await dr(r,"GeographicTypeGeoKey","GeogAngularUnitsGeoKey",t)}function fr(e){return e.getImageCount().then(function(t){const r=new Array(t);for(let i=0;i<t;++i)r[i]=e.getImage(i);return Promise.all(r)})}function pr(e,t){let r;return r=e.blob?(0,Pt._F)(e.blob):e.overviews?(0,Pt.Vj)(e.url,e.overviews,t):(0,Pt.uz)(e.url,t),r.then(fr)}function mr(e,t,r,i,s){if(Array.isArray(e)){const n=e.length;if(!Array.isArray(t)||n!=t.length){const e=new Error(i);throw s(e),e}for(let a=0;a<n;++a)mr(e[a],t[a],r,i,s);return}if(Math.abs(e-t)>r*e)throw new Error(i)}function yr(e){return e instanceof Int8Array?-128:e instanceof Int16Array?-32768:e instanceof Int32Array?-2147483648:e instanceof Float32Array?12e-39:0}function _r(e){return e instanceof Int8Array?127:e instanceof Uint8Array||e instanceof Uint8ClampedArray?255:e instanceof Int16Array?32767:e instanceof Uint16Array?65535:e instanceof Int32Array?2147483647:e instanceof Uint32Array?4294967295:e instanceof Float32Array?34e37:255}class vr extends H["default"]{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,transition:e.transition,interpolate:!1!==e.interpolate,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=!1!==e.normalize,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.loadMissingProjection_=e.loadMissingProjection||!1,this.setKey(this.sourceInfo_.map(e=>e.url).join(","));const r=this,i=new Array(t);for(let s=0;s<t;++s)i[s]=pr(this.sourceInfo_[s],this.sourceOptions_);Promise.all(i).then(function(e){return r.configure_(e)}).catch(function(e){(0,Ut.z3)(e),r.error_=e,r.setState("error")})}getError(){return this.error_}async determineProjection(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const e=t[r],i=await gr(e,this.loadMissingProjection_);if(i){this.projection=i;break}}}determineTransformMatrix(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const e=t[r],i=e.fileDirectory.ModelTransformation;if(i){const[e,t,r,s,n,a,o,l]=i,c=(0,Gt.lw)((0,Gt.lw)([1/Math.sqrt(e*e+n*n),0,0,-1/Math.sqrt(t*t+a*a),s,l],[e,n,t,a,0,0]),[1,0,0,1,-s,-l]);this.transformMatrix=c,this.addAlpha_=!0;break}}}async configure_(e){let t,r,i,s,n;const a=new Array(e.length),o=new Array(e.length),l=new Array(e.length);let c=0;const h=e.length;for(let p=0;p<h;++p){const h=[],u=[];e[p].forEach(e=>{rr(e)?u.push(e):h.push(e)});const d=h.length;if(u.length>0&&u.length!==d)throw new Error(`Expected one mask per image found ${u.length} masks and ${d} images`);let g,f;const m=new Array(d),y=new Array(d),_=new Array(d);o[p]=new Array(d),l[p]=new Array(d);for(let e=0;e<d;++e){const t=h[e],r=t.getGDALNoData();l[p][e]=t.getGDALMetadata(0),o[p][e]=r;const i=this.sourceInfo_[p].bands;a[p]=i?i.length:t.getSamplesPerPixel();const s=d-(e+1);g||(g=cr(t)),f||(f=hr(t));const n=ur(t,h[0]);_[s]=n[0];const c=[t.getTileWidth(),t.getTileHeight()];c[0]!==c[1]&&c[1]<ar&&(c[0]=ar,c[1]=ar),m[s]=c;const u=n[0]/Math.abs(n[1]);y[s]=[c[0],c[1]/u]}if(t?(0,F._N)(t,g,t):t=g,r){const e=`Origin mismatch for source ${p}, got [${f}] but expected [${r}]`;mr(r,f,0,e,this.viewRejector)}else r=f;if(n){n.length-c>_.length&&(c=n.length-_.length);const e=n[n.length-1]/_[_.length-1];this.resolutionFactors_[p]=e;const t=_.map(t=>t*e),r=`Resolution mismatch for source ${p}, got [${t}] but expected [${n}]`;mr(n.slice(c,n.length),t,.02,r,this.viewRejector)}else n=_,this.resolutionFactors_[p]=1;i?mr(i.slice(c,i.length),y,.01,`Tile size mismatch for source ${p}`,this.viewRejector):i=y,s?mr(s.slice(c,s.length),m,0,`Tile size mismatch for source ${p}`,this.viewRejector):s=m,this.sourceImagery_[p]=h.reverse(),this.sourceMasks_[p]=u.reverse()}for(let p=0,m=this.sourceImagery_.length;p<m;++p){const e=this.sourceImagery_[p];while(e.length<n.length)e.unshift(void 0)}this.getProjection()||await this.determineProjection(e),this.determineTransformMatrix(e),this.samplesPerPixel_=a,this.nodataValues_=o,this.metadata_=l;e:for(let p=0;p<h;++p){if(void 0!==this.sourceInfo_[p].nodata){this.addAlpha_=!0;break}if(this.sourceMasks_[p].length){this.addAlpha_=!0;break}const e=o[p],t=this.sourceInfo_[p].bands;if(t){for(let r=0;r<t.length;++r)if(null!==e[t[r]-1]){this.addAlpha_=!0;break e}}else for(let r=0;r<e.length;++r)if(null!==e[r]){this.addAlpha_=!0;break e}}let u=this.addAlpha_?1:0;for(let p=0;p<h;++p)u+=a[p];this.bandCount=u;const d=new Dt.A({extent:t,minZoom:c,origin:r,resolutions:n,tileSizes:i});this.tileGrid=d,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const g=1;2===n.length?n=[n[0],n[1],n[1]/2]:1===n.length&&(n=[2*n[0],n[0],n[0]/2]);let f=t;if(this.transformMatrix){const e=(0,Gt.T9)((0,Gt.vt)(),this.transformMatrix.slice()),r=(0,j.HU)(t=>(0,Gt.Bb)(e,t));f=(0,F.NW)(t,r)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:n,center:(0,j.te)((0,F.q1)(f),this.projection),extent:(0,j.JR)(f,this.projection),zoom:g})}loadTile_(e,t,r,i){const s=this.getTileSize(e),n=this.sourceImagery_.length,a=new Array(2*n),o=this.nodataValues_,l=this.sourceInfo_,c=lr();for(let h=0;h<n;++h){const u=l[h],d=this.resolutionFactors_[h],g=[Math.round(t*(s[0]*d)),Math.round(r*(s[1]*d)),Math.round((t+1)*(s[0]*d)),Math.round((r+1)*(s[1]*d))],f=this.sourceImagery_[h][e];let p,m;u.bands&&(p=u.bands.map(function(e){return e-1})),m="nodata"in u&&null!==u.nodata?u.nodata:p?p.map(function(e){return o[h][e]}):o[h];const y={window:g,width:s[0],height:s[1],samples:p,fillValue:m,pool:c,interleave:!1,signal:i.signal};ir(this.convertToRGB_,f)?a[h]=f.readRGB(y):a[h]=f.readRasters(y);const _=n+h,v=this.sourceMasks_[h][e];v?a[_]=v.readRasters({window:g,width:s[0],height:s[1],samples:[0],pool:c,interleave:!1}):a[_]=Promise.resolve(null)}return Promise.all(a).then(this.composeTile_.bind(this,s)).catch(function(e){throw(0,Ut.z3)(e),e})}composeTile_(e,t){const r=this.metadata_,i=this.sourceInfo_,s=this.sourceImagery_.length,n=this.bandCount,a=this.samplesPerPixel_,o=this.nodataValues_,l=this.normalize_,c=this.addAlpha_,h=e[0]*e[1],u=h*n;let d;d=l?new Uint8Array(u):new Float32Array(u);let g=0;for(let f=0;f<h;++f){let e=c;for(let n=0;n<s;++n){const h=i[n];let u,p,m=h.min,y=h.max;if(l){const e=r[n][0];void 0===m&&(m=e&&nr in e?parseFloat(e[nr]):yr(t[n][0])),void 0===y&&(y=e&&sr in e?parseFloat(e[sr]):_r(t[n][0])),u=255/(y-m),p=-m*u}for(let r=0;r<a[n];++r){const i=t[n][r][f];let s;if(s=l?(0,$t.qE)(u*i+p,0,255):i,c){let t=h.nodata;if(void 0===t){let e;e=h.bands?h.bands[r]-1:r,t=o[n][e]}const a=isNaN(t);(!a&&i!==t||a&&!isNaN(i))&&(e=!1,d[g]=s)}else d[g]=s;g++}if(!e){const r=s+n,i=t[r];i&&!i[0][f]&&(e=!0)}}c&&(e||(d[g]=255),g++)}return d}}vr.prototype.getView;var wr=vr;class br{constructor(e){this.name=e}toString(){return this.name}}br.GeoTIFF=new br("GeoTIFF"),br.ImageStatic=new br("ImageStatic"),br.PMTilesRaster=new br("PMTilesRaster"),br.PMTilesVector=new br("PMTilesVector"),br.TileJSON=new br("TileJSON"),br.TileWMS=new br("TileWMS"),br.WMTS=new br("WMTS"),br.XYZ=new br("XYZ");var Tr=br;class Er extends I["default"]{constructor(e){const t={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(r=>t[r]=e[r]),super(t),this.getSourceOptions_=e.getSourceOptions,this.children_=null,this.childrenOptions_=e.childrenOptions||{},this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=!1!==e.displayFootprint,this.displayGeoTiffByDefault_=Boolean(e.displayGeoTiffByDefault),this.displayPreview_=Boolean(e.displayPreview),this.displayOverview_=!1!==e.displayOverview,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||Wt,this.collectionStyle_=e.collectionStyle||Xt,this.boundsLayer_=null,this.disableMigration_=e.disableMigration||!1,this.map_=null,this.eventQueue_=[],e.httpRequestFn&&(this.fetch_=e.httpRequestFn),e.data)try{this.configure_(e.data,e.url,e.children,e.assets,e.bands)}catch(r){this.handleError_(r)}else{if(!e.url)throw new Error("Either url or data must be provided");this.fetch_(e.url).then(t=>this.configure_(t,e.url,e.children,e.assets,e.bands)).catch(e=>this.handleError_(e))}}async fetch_(e,t="json"){const r=await fetch(e);if(!r.ok)throw new Error(`Unexpected response from ${e}: ${r.status}`);return"json"===t?await r.json():"text"===t?await r.text():null}getBoundsLayer(){return this.boundsLayer_}isEmpty(){var e;const t=this.getLayers().getLength();if(t>1)return!1;const r=null===(e=this.getData())||void 0===e?void 0:e.getBoundingBox();return!(r&&!(0,F.Im)(r))||(!this.boundsLayer_||!this.displayFootprint_)}handleError_(e){this.dispatch_(new Ct(e))}configure_(e,t=null,r=null,i=null,s=[]){let n;e instanceof xt.Vd||e instanceof xt.O7?n=e:(n=(0,xt["default"])(e,!this.disableMigration_),t&&t.includes("://")&&n.setAbsoluteUrl(t)),this.set("stac",n),this.bands_=s,this.boundsLayer_=this.addFootprint_();const a=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(Qt(this.boundsStyle_,this))};this.getLayers().on("add",a),this.getLayers().on("remove",a);const o=e=>this.handleError_(e),l=[];r&&l.push(this.setChildren(r,null,!1).catch(o)),i&&l.push(this.setAssets(i,!1).catch(o)),Promise.all(l).then(()=>this.updateLayers().catch(o)),this.dispatch_("sourceready")}dispatch_(e){this.eventQueue_.push(e),this.flush_()}flush_(){if(this.map_){for(const e of this.eventQueue_)this.dispatchEvent(e);this.eventQueue_=[]}}setMap_(e){this.map_!==e&&(this.map_=e,this.flush_())}async addChildren_(e,t={}){const r=e.map(e=>{const r={data:e,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_,useTileLayerAsFallback:this.useTileLayerAsFallback_,buildTileUrlTemplate:this.buildTileUrlTemplate_},i=new Er(Object.assign(r,t));return i.on("sourceready",()=>{i.map_&&this.setMap_(i.map_)}),this.addLayer_(i,null),i});return await Promise.all(r)}async addPreviewImage_(e){const t=await qt(e,"EPSG:4326"),r=e.getContext().getBoundingBoxes();if(1!==r.length)return;const i=r[0];let s={url:e.getAbsoluteUrl(),projection:t,imageExtent:(0,j.DI)(i,"EPSG:4326",t),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(s=await this.getSourceOptions_(Tr.ImageStatic,s,e));const n=new M["default"]({source:new D["default"](s)});return this.addLayer_(n,e),n}async addLayerForLink(e){const t=er(e);if(!t)return;const r={attributions:e.getMetadata("attribution")||this.getData().getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:t},i=async(t,r)=>(this.getSourceOptions_&&(r=await this.getSourceOptions_(t,r,e)),r),s=[];switch(e.rel){case"pmtiles":const n=new dt(r.url),a=await n.getHeader();let o;switch(a.tileType){case Xe.Mvt:o=new Lt(await i(Tr.PMTilesVector,r));break;case Xe.Avif:case Xe.Jpeg:case Xe.Png:case Xe.Webp:o=new Tt(await i(Tr.PMTilesRaster,r));break;default:return}s.push(o);break;case"tilejson":s.push(new G["default"](await i(Tr.TileJSON,r)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const t in e["wms:layers"]){const n=e["wms:layers"][t]||"";let a="";Array.isArray(e["wms:styles"])&&"string"===typeof e["wms:styles"][t]&&(a=e["wms:styles"][t]);const o=Object.assign({LAYERS:n,STYLES:a},e["wms:dimensions"]);"boolean"===typeof e["wms:transparent"]&&(o.TRANSPARENT=String(e["wms:transparent"])),"string"===typeof e.type&&e.type.startsWith("image/")&&(o.FORMAT=e.type);const l=await i(Tr.TileWMS,Object.assign({},r,{params:o}));s.push(new k["default"](l))}break;case"wmts":const l=await this.getWmtsCapabilities_(t,e["wmts:encoding"]);if(!l)return;let c=[];Array.isArray(e["wmts:layer"])?c=e["wmts:layer"]:"string"===typeof e["wmts:layer"]&&(c=[e["wmts:layer"]]);for(const t of c){let n=Object.assign({},r,{layer:t,requestEncoding:"rest"===e["wmts:encoding"]?"REST":"KVP"});"string"===typeof e.type&&e.type.startsWith("image/")&&(n.format=e.type),n=await i(Tr.WMTS,n);const a=(0,z.optionsFromCapabilities)(l,n);if(null!==a){if("string"===typeof e.uriTemplate){let t=e.uriTemplate;const r=(0,Rt.Gv)(e.variables)?e.variables:{};for(const e in r){const i=r[e];let s;tr(i.const)?s=i.const:tr(i.default)?s=i.default:Array.isArray(i.enum)&&i.enum.length>0&&(s=i.enum[0]),"undefined"!==typeof s&&(t=t.replaceAll(`{${e}}`,String(s)))}delete a.urls,a.url=t}s.push(new z["default"](a))}}break;case"xyz":s.push(new Z["default"](await i(Tr.XYZ,r)));break;default:return}return s.map(t=>{let r;return r=t instanceof B["default"]?new U["default"]({source:t,declutter:!0}):t instanceof Tt?new $["default"]({source:t}):new P["default"]({source:t}),this.addLayer_(r,e),r})}async addGeoTiff_(e){if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);const t=Jt(e,this.bands_);let r={sources:[t],convertToRGB:"auto",loadMissingProjection:!0};const i=await qt(e);i&&(r.projection=i),this.getSourceOptions_&&(r=await this.getSourceOptions_(Tr.GeoTIFF,r,e));const s=new wr(r),n=new Promise((e,t)=>{s.on("error",t),s.on("change",()=>{"error"===s.getState()?t(s.getError()):e()})});try{await n;const t=new $["default"]({source:s});return this.addLayer_(t,e),t}catch(a){if(this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);this.handleError_(a)}}async addTileLayerForImagery_(e){let t=this.buildTileUrlTemplate_(e);t instanceof Promise&&(t=await t);let r={crossOrigin:this.crossOrigin_,url:t};this.getSourceOptions_&&(r=await this.getSourceOptions_(Tr.XYZ,r,e));const i=new P["default"]({source:new Z["default"](r)});return this.addLayer_(i,e),i}addLayer_(e,t=null,r=0){t&&e.set("stac",t),e.setZIndex(r),this.getLayers().push(e)}addFootprint_(){let e=null;const t=this.getData();if(e=t.isItemCollection()||t.isCollectionCollection()?(0,At.Jx)(t.getBoundingBox()):t.toGeoJSON(),e){const r=this.createGeoJsonLayer_(e,Qt(this.boundsStyle_,this),this.displayFootprint_);return r.set("bounds",!0),r.on("change",()=>this.setMap_(r.getMapInternal())),this.addLayer_(r,t,1),r}return null}async addGeoJson_(e){try{const t=await this.fetch_(e.getAbsoluteUrl()),r=this.createGeoJsonLayer_(t);return this.addLayer_(r,e),r}catch(t){this.handleError_(t)}}createGeoJsonLayer_(e,t=null,r=!0){const i=new O.A,s=new N["default"]({format:i,loader:(t,r,n)=>{e=(0,At.z)(e);const a=i.readFeatures(e,{featureProjection:n});s.addFeatures(a)}});return t||(t=Xt),new y["default"]({source:s,style:t,visible:r})}async addLabelExtension_(){const e=this.getData();if(!(e instanceof xt.q7))return;let t,r=e.getAssetsWithRoles(["labels","labels-vector"],!0);r.length>1&&(t=r.find(e=>e.roles.includes("labels-vector"))),t||(t=e.getAsset("vector_labels")),t||(r=e.getAssets().filter(e=>e.type===St.oV&&!e.roles),1===r.length&&(t=r[0]));const i=e.getLinksWithRels(["source"]);if(t&&i.length>0){const e=i.map(async e=>{try{const t=await this.fetch_(e.getAbsoluteUrl()),r=(0,xt["default"])(t);return r}catch(t){return this.handleError_(t),null}}),t=(await Promise.all(e)).filter(e=>e instanceof xt.O7);await this.addChildren_(t,{displayFootprint:!1})}try{await this.addGeoJson_(t)}catch(s){this.handleError_(s)}}async updateLayers(e=!0){const t=this.getLayers();for(let s=t.getLength()-1;s>=0;s--){const e=t.item(s);e.get("stac")&&!e.get("bounds")&&t.removeAt(s)}const r=this.getData();if(Array.isArray(this.displayWebMapLink_)){const e=this.getWebMapLinks().map(async e=>await this.addLayerForLink(e));await Promise.all(e)}this.children_&&await this.addChildren_(this.children_,this.childrenOptions_);const i=this.getAssets();if(i){const e=i.map(async e=>{if(e)return e.type===St.oV?await this.addGeoJson_(e):e.isGeoTIFF()?await this.addGeoTiff_(e):e.canBrowserDisplayImage()?await this.addPreviewImage_(e):void 0});await Promise.all(e)}if(this.hasOnlyBounds())if(r instanceof xt.Ly)await this.addChildren_(r.getAll(),this.childrenOptions_);else if(r instanceof xt.O7){if(r.isItem()&&r.supportsExtension(Zt)&&"vector"===r.getMetadata("label:type"))return await this.addLabelExtension_(),void(e&&this.dispatch_("layersready"));const t=this.getWebMapLinks();if(t.length>0)await this.addLayerForLink(t[0]);else{const e=r.getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);let t;if(e&&this.displayOverview_&&(t=await this.addGeoTiff_(e)),this.displayPreview_&&(!e||!t)){const e=r.getThumbnails(!0,"overview");e.length>0&&await this.addPreviewImage_(e[0])}}}e&&this.dispatch_("layersready")}hasOnlyBounds(){const e=this.getBoundsLayer(),t=this.getLayersArray().find(t=>t!==e);return"undefined"===typeof t}getWebMapLinks(){const e=this.getData();if(e instanceof xt.Vd)return[];let t=["xyz","tilejson","pmtiles","wmts","wms"];"string"===typeof this.displayWebMapLink_&&(t=[this.displayWebMapLink_]);let r=e.getLinksWithRels(t);return Array.isArray(this.displayWebMapLink_)?r=this.displayWebMapLink_.map(e=>{if("string"===typeof e){const t=r.find(t=>t.id===e);return t||null}return e}).filter(e=>!!e):r.sort((e,r)=>{const i=t.indexOf(e.rel),s=t.indexOf(r.rel);return i-s}),r}async setAssets(e,t=!0){if(e!==this.assets_){if(Array.isArray(e)){const t=this.getData();this.assets_=e.map(e=>t instanceof xt.O7&&"string"===typeof e?t.getAsset(e):e instanceof xt.Vd?e:new xt.Vd(e))}else this.assets_=null;t&&await this.updateLayers()}}async setChildren(e,t=null,r=!0){e instanceof xt.iJ||e instanceof xt.B_?this.children_=e.getAll():(0,Rt.Gv)(e)&&"FeatureCollection"===e.type?this.children_=(0,xt["default"])(e,!this.disableMigration_).getAll():Array.isArray(e)?this.children_=e.map(e=>e instanceof xt.O7?e:(0,xt["default"])(e,!this.disableMigration_)):this.children_=null,this.children_&&0===this.children_.length&&(this.children_=null),this.children_&&(0,Rt.Gv)(t)&&(this.childrenOptions_=t),r&&await this.updateLayers()}getData(){return this.get("stac")}getChildren(){return this.children_}getAssets(){return this.assets_}getExtent(){if(!this.map_)return;const e=this.map_.getView();if(!e)return;let t;const r=this.getData();r&&(t=r.getBoundingBox());const i=this.getChildren();if(i){const e=i.map(e=>e.getBoundingBox());t=(0,At.l6)(e)}return t?(0,j.DI)(t,"EPSG:4326",e.getProjection()):void 0}getLayerState(){const e=super.getLayerState();return e.extent=void 0,e}getAttributions(){const e=[],t=this.getData();if(t){const e=t.getMetadata("attribution");e&&e.push(e)}return e}getSource(){return null}async getWmtsCapabilities_(e,t="kvp"){try{const r=new URL(e);"rest"!==t&&(r.searchParams.set("service","wmts"),r.searchParams.set("request","GetCapabilities"));const i=await this.fetch_(r.toString(),"text");return(new C["default"]).read(i)}catch(Ke){return null}}}var Lr=Er,xr=r(33567);const Ar=Vt("#ff0000",2,null);let Sr=0;var Rr={name:"Map",components:{BPopover:c.u,Catalogs:()=>Promise.resolve().then(r.bind(r,17046)),Features:()=>r.e(7530).then(r.bind(r,17530)),Items:()=>Promise.resolve().then(r.bind(r,2882)),LayerControl:a.A,TextControl:o.A},mixins:[n.A],props:{stac:{type:Object,default:null},assets:{type:Array,default:null},children:{type:Object,default:null},onfocusOnly:{type:Boolean,default:!1},popover:{type:Boolean,default:!1}},data(){return{stacLayer:null,selection:null,empty:!1,selector:null,mapId:"map-"+ ++Sr}},computed:{...(0,l.L8)(["getStac"]),container(){return this.isFullScreen?"#"+this.mapId:"#stac-browser"},childrenOptions(){return{displayPreview:this.children&&this.children.isItemCollection()}}},watch:{async stac(){await this.showStacLayer()},async assets(){this.stacLayer&&await this.stacLayer.setAssets(this.assets)},async children(){this.stacLayer&&(await this.stacLayer.setAssets(null,!1),await this.stacLayer.setChildren(this.children,this.childrenOptions,!1),await this.stacLayer.updateLayers(),this.fit())},empty(e){e&&this.$emit("empty")},selection(e){!e&&this.selector&&this.selector.getFeatures().clear()}},async mounted(){await this.showStacLayer()},methods:{async showStacLayer(){this.map=null,this.stacLayer=null,await this.createMap(this.$refs.map,this.stac,this.onfocusOnly),this.stac&&await this.addStacLayer()},async addStacLayer(){let e=Object.assign({},this.stacLayerOptions,{data:this.stac,children:this.children,assets:this.assets||null,displayWebMapLink:!0,disableMigration:!0,childrenOptions:this.childrenOptions});this.stacLayer=new Lr(e),this.stacLayer.on("error",e=>{console.warn(e),this.fit()}),this.stacLayer.on("sourceready",this.fit),this.stacLayer.on("layersready",()=>{this.empty=this.stacLayer.isEmpty(),this.$emit("changed",this.getShownData())}),this.map.addLayer(this.stacLayer),this.popover&&(this.selector=new R({multi:!0,style:Ar,layers:e=>{if(this.children)return!1;{const t=e.get("stac");return t&&t.isAsset()}}}),this.selector.on("select",e=>{this.selection=null,this.setTargetPosition(e.mapBrowserEvent);const t=this.selector.getFeatures();if(t.getLength()>0){const e=new O.A;this.selection={target:this.$refs.target,type:"features",items:t.getArray().map(t=>e.writeFeatureObject(t))}}}),this.map.addInteraction(this.selector),this.map.on("singleclick",async e=>{if(this.selection=null,this.children){this.setTargetPosition(e),this.selector.getFeatures().clear();const t=this.selector.getFeatures(),r=this.stacLayer.getData(),i=await Kt(e,r,t,5);i.length>0&&(this.selection={target:this.$refs.target,type:this.children.isCollectionCollection()?"collections":"items",children:i})}}),this.map.on("change",()=>this.selection=null),this.map.on("movestart",()=>this.selection=null))},setTargetPosition(e){this.$refs.target.style.left=e.pixel[0]+"px",this.$refs.target.style.top=e.pixel[1]+"px"},fit(){const e=this.stacLayer.getExtent();e&&(this.map.updateSize(),this.map.getView().fit(e,{padding:[50,50,50,50],maxZoom:this.maxZoom}))},resetSelection(){this.selection=null},getShownData(){return this.stacLayer?this.stacLayer.getLayers().getArray().filter(e=>xr.A.isLayerVisible(e)).map(e=>e.get("stac")).filter(e=>e instanceof xt.VJ):null}}},Fr=Rr,Or=r(81656),Cr=(0,Or.A)(Fr,i,s,!1,null,null,null),Ir=Cr.exports},82728:function(e,t,r){r.r(t);var i=r(70915),s=r(61597),n=r(38599),a=r(33513),o=r(82806),l=r(40186),c=r(14465),h=r(28512),u=r(7500);class d extends h["default"]{constructor(e){e=e||{};const t=Object.assign({},e.params);super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.gutter_=void 0!==e.gutter?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=void 0===e.hidpi||e.hidpi,this.tmpExtent_=(0,i.S5)(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,r,s){const o=(0,n.Jt)(r),l=this.getProjection()||o;let c=this.getTileGrid();c||(c=this.getTileGridForProjection(l));const h=(0,n.pd)(e,o,l),d=(0,a.KQ)(l,o,e,t),g=c.getZForResolution(d,this.zDirection),f=c.getResolution(g),p=c.getTileCoordForCoordAndZ(h,g);if(c.getResolutions().length<=p[0])return;let m=c.getTileCoordExtent(p,this.tmpExtent_);const y=this.gutter_;0!==y&&(m=(0,i.r)(m,f*y,m));const _={QUERY_LAYERS:this.params_["LAYERS"]};Object.assign(_,(0,u.getRequestParams)(this.params_,"GetFeatureInfo"),s);const v=Math.floor((h[0]-m[0])/f),w=Math.floor((m[3]-h[1])/f);return _[this.v13_?"I":"X"]=v,_[this.v13_?"J":"Y"]=w,this.getRequestUrl_(p,m,1,l||o,_)}getLegendUrl(e,t){if(void 0===this.urls[0])return;const r={SERVICE:"WMS",VERSION:u.DEFAULT_VERSION,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===t||void 0===t["LAYER"]){const e=this.params_.LAYERS,t=!Array.isArray(e)||1===e.length;if(!t)return;r["LAYER"]=e}if(void 0!==e){const t=this.getProjection()?this.getProjection().getMetersPerUnit():1,i=28e-5;r["SCALE"]=e*t/i}return Object.assign(r,t),(0,c.LW)(this.urls[0],r)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,r,i,n){const a=this.urls;if(!a)return;let o;if(1==a.length)o=a[0];else{const t=(0,s.xP)((0,l.tW)(e),a.length);o=a[t]}return(0,u.getImageSrc)(t,(this.tileGrid||this.getTileGridForProjection(i)).getResolution(e[0]),r,i,o,n,this.serverType_)}getTilePixelRatio(e){return this.hidpi_&&void 0!==this.serverType_?e:1}getKeyForParams_(){let e=0;const t=[];for(const r in this.params_)t[e++]=r+"-"+this.params_[r];return t.join("/")}setParams_(e){this.params_=e,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(e){this.setParams_(Object.assign({},e))}updateParams(e){this.setParams_(Object.assign(this.params_,e))}updateV13_(){const e=this.params_["VERSION"]||u.DEFAULT_VERSION;this.v13_=(0,o.Z)(e,"1.3")>=0}tileUrlFunction(e,t,r){let s=this.getTileGrid();if(s||(s=this.getTileGridForProjection(r)),s.getResolutions().length<=e[0])return;1==t||this.hidpi_&&void 0!==this.serverType_||(t=1);const n=s.getResolution(e[0]);let a=s.getTileCoordExtent(e,this.tmpExtent_);const o=this.gutter_;0!==o&&(a=(0,i.r)(a,n*o,a));const l=Object.assign({},(0,u.getRequestParams)(this.params_,"GetMap"));return this.getRequestUrl_(e,a,t,r,l)}}t["default"]=d}}]);
//# sourceMappingURL=964.abf5e326.js.map