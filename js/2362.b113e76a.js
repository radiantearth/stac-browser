"use strict";(self["webpackChunk_radiantearth_stac_browser"]=self["webpackChunk_radiantearth_stac_browser"]||[]).push([[2362],{12362:function(e,t,r){r.r(t),r.d(t,{default:function(){return S}});var s=r(71259),i=r(62703),a=r(90588),n=r(9438),h=r(70915),o=r(8055),u=r(38599),f=r(835),c=r(3422),l=r(88280),d=r(9703),_=r(4087),p=r(20259),g=r(63722),b=r(89940),m=r(90130),T=r(35339),v=r(60492),C=r(49189);class y extends v.A{constructor(e,t){const r=t.uniforms||{},s=(0,d.vt)();r[g.M8.PROJECTION_MATRIX]=s,super(e,{uniforms:r,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new p.Ay(m.H7,m.Be),this.indicesBuffer_=new p.Ay(m.IP,m.Be),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=t.hitDetectionEnabled??!0;const i=t.attributes?t.attributes.map(function(e){return{name:"a_"+e.name,size:1,type:g.jQ.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:g.jQ.FLOAT},{name:"a_index",size:1,type:g.jQ.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_hitColor",size:4,type:g.jQ.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:g.jQ.FLOAT})),this.attributes.push(...i),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=(0,h.S5)(),this.currentTransform_=s,this.renderTransform_=(0,d.vt)(),this.invertRenderTransform_=(0,d.vt)(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=(0,T.v)(),this.worker_.addEventListener("message",e=>{const t=e.data;if(t.type===f.x.GENERATE_POINT_BUFFERS){const r=t.projectionTransform;this.verticesBuffer_.fromArrayBuffer(t.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(t.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=r,(0,d.T9)(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(e.data.renderInstructions),t.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const a=this.getLayer().getSource();this.sourceListenKeys_=[(0,n.KT)(a,l["default"].ADDFEATURE,this.handleSourceFeatureAdded_,this),(0,n.KT)(a,l["default"].CHANGEFEATURE,this.handleSourceFeatureChanged_,this),(0,n.KT)(a,l["default"].REMOVEFEATURE,this.handleSourceFeatureDelete_,this),(0,n.KT)(a,l["default"].CLEAR,this.handleSourceFeatureClear_,this)],a.forEachFeature(e=>{const t=e.getGeometry();t&&"Point"===t.getType()&&(this.featureCache_[(0,_.v6)(e)]={feature:e,properties:e.getProperties(),flatCoordinates:t.getFlatCoordinates()},this.featureCount_++)})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new b.A(this.helper)),this.verticesBuffer_.getArray()&&this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.getArray()&&this.helper.flushBufferData(this.indicesBuffer_)}handleSourceFeatureAdded_(e){const t=e.feature,r=t.getGeometry();r&&"Point"===r.getType()&&(this.featureCache_[(0,_.v6)(t)]={feature:t,properties:t.getProperties(),flatCoordinates:r.getFlatCoordinates()},this.featureCount_++)}handleSourceFeatureChanged_(e){const t=e.feature,r=(0,_.v6)(t),s=this.featureCache_[r],i=t.getGeometry();s?i&&"Point"===i.getType()?(s.properties=t.getProperties(),s.flatCoordinates=i.getFlatCoordinates()):(delete this.featureCache_[r],this.featureCount_--):i&&"Point"===i.getType()&&(this.featureCache_[r]={feature:t,properties:t.getProperties(),flatCoordinates:i.getFlatCoordinates()},this.featureCount_++)}handleSourceFeatureDelete_(e){const t=e.feature,r=(0,_.v6)(t);r in this.featureCache_&&(delete this.featureCache_[r],this.featureCount_--)}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[r,s,i]=(0,C.v)(e,this.getLayer());this.renderWorlds(e,!1,r,s,i),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,r,s,i),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e);const a=this.helper.getCanvas();return a}prepareFrameInternal(e){const t=this.getLayer(),r=t.getSource(),s=e.viewState,a=!e.viewHints[i.A.ANIMATING]&&!e.viewHints[i.A.INTERACTING],n=!(0,h.aI)(this.previousExtent_,e.extent),u=this.sourceRevision_<r.getRevision();if(u&&(this.sourceRevision_=r.getRevision()),a&&(n||u)){const i=s.projection,a=s.resolution,n=t instanceof o["default"]?t.getRenderBuffer():0,u=(0,h.r)(e.extent,n*a);r.loadFeatures(u,a,i),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const t=(0,d.vt)();this.helper.makeProjectionTransform(e,t);const r=(0,u.Tf)(),s=this.hitDetectionEnabled_?7:2,i=s+this.customAttributes.length,a=i*this.featureCount_,n=this.renderInstructions_&&this.renderInstructions_.length===a?this.renderInstructions_:new Float32Array(a);this.renderInstructions_=null;let h=[];const o=[];let l=-1;const _=e.viewState.projection;for(const f in this.featureCache_){const e=this.featureCache_[f];if(r?h=(0,u.Ad)(e.flatCoordinates,_):(h[0]=e.flatCoordinates[0],h[1]=e.flatCoordinates[1]),(0,d.Bb)(t,h),n[++l]=h[0],n[++l]=h[1],this.hitDetectionEnabled_){const e=(0,c.b)(l+5,o);n[++l]=e[0],n[++l]=e[1],n[++l]=e[2],n[++l]=e[3],n[++l]=Number(f)}for(let t=0;t<this.customAttributes.length;t++){const r=this.customAttributes[t].callback(e.feature,e.properties);n[++l]=r}}const p={id:++this.lastSentId,type:f.x.GENERATE_POINT_BUFFERS,renderInstructions:n.buffer,customAttributesSize:i-2};p["projectionTransform"]=t,this.ready=!1,this.worker_.postMessage(p,[n.buffer])}forEachFeatureAtCoordinate(e,t,r,s,i){if((0,a.v)(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const n=(0,d.Bb)(t.coordinateToPixelTransform,e.slice()),h=this.hitRenderTarget_.readPixel(n[0]/2,n[1]/2),o=[h[0]/255,h[1]/255,h[2]/255,h[3]/255],u=(0,c.L)(o),f=this.renderInstructions_[u],l=Math.floor(f).toString(),_=this.getLayer().getSource(),p=_.getFeatureByUid(l);return p?s(p,this.getLayer(),null):void 0}renderWorlds(e,t,r,s,i){let a=r;this.helper.useProgram(this.program_,e),t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),(0,d.Tl)(this.currentTransform_,a*i,0),(0,d.lw)(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(t);const r=this.indicesBuffer_.getSize();this.helper.drawElements(0,r)}while(++a<s)}disposeInternal(){this.worker_.terminate(),this.sourceListenKeys_.forEach(function(e){(0,n.JH)(e)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}var A=y,E=r(60764);class R extends E["default"]{constructor(e){const t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.parseResult_=(0,s.my)(e.style,this.styleVariables_,e.filter),this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){const e=Object.keys(this.parseResult_.attributes).map(e=>({name:e,...this.parseResult_.attributes[e]}));return new A(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:e})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}var S=R},49189:function(e,t,r){r.d(t,{v:function(){return i}});var s=r(70915);function i(e,t){const r=e.viewState.projection,i=t.getSource(),a=i.getWrapX()&&r.canWrapX(),n=r.getExtent(),h=e.extent,o=a?(0,s.RG)(n):null,u=a?Math.ceil((h[2]-n[2])/o)+1:1,f=a?Math.floor((h[0]-n[0])/o):0;return[f,u,o]}}}]);
//# sourceMappingURL=2362.b113e76a.js.map