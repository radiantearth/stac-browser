"use strict";(self["webpackChunk_radiantearth_stac_browser"]=self["webpackChunk_radiantearth_stac_browser"]||[]).push([[4835],{8001:function(e,t,r){r.d(t,{et:function(){return A},gF:function(){return T}});var n=r(91110),i=r(11078),s=r(66514),o=r(70915),a=r(38599),l=r(6782),h=r(14969),u=r(40186),c=r(9703),f=r(4087),_=r(83954),d=r(60492);const T={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};function E(e){return 1/(e+2)}function g(){return{tileIds:new Set,representationsByZ:{}}}function p(e,t){return e.tileIds.has((0,f.v6)(t))}function m(e,t,r){const n=e.representationsByZ;r in n||(n[r]=new Set),n[r].add(t),e.tileIds.add((0,f.v6)(t.tile))}function R(e,t){const r=e.layerStatesArray[e.layerIndex];r.extent&&(t=(0,o._N)(t,(0,a.SD)(r.extent,e.viewState.projection)));const n=r.layer.getRenderSource();if(!n.getWrapX()){const r=n.getTileGridForProjection(e.viewState.projection).getExtent();r&&(t=(0,o._N)(t,r))}return t}function A(e,t){return`${(0,f.v6)(e)},${e.getKey()},${e.getRevision()},${(0,u.i7)(t)}`}class x extends d.A{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=(0,c.vt)(),this.tempMat4=(0,_.vt)(),this.tempTileRange_=new n.A(0,0,0,0),this.tempTileCoord_=(0,u.N)(0,0,0),this.tempSize_=[0,0];const r=void 0!==t.cacheSize?t.cacheSize:512;this.tileRepresentationCache=new h.A(r),this.frameState=null,this.renderedProjection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}prepareFrameInternal(e){this.renderedProjection_?e.viewState.projection!==this.renderedProjection_&&(this.clearCache(),this.renderedProjection_=e.viewState.projection):this.renderedProjection_=e.viewState.projection;const t=this.getLayer(),r=t.getRenderSource();return!!r&&(!(0,o.Im)(R(e,e.extent))&&"ready"===r.getState())}createTileRepresentation(e){return(0,f.b0)()}enqueueTiles(e,t,r,n,s){const a=e.viewState,l=this.getLayer(),h=l.getRenderSource(),c=h.getTileGridForProjection(a.projection),_=h.getGutterForProjection(a.projection),d=(0,f.v6)(h);d in e.wantedTiles||(e.wantedTiles[d]={});const T=e.wantedTiles[d],E=this.tileRepresentationCache,g=l.getMapInternal(),R=Math.max(r-s,c.getMinZoom(),c.getZForResolution(Math.min(l.getMaxResolution(),g?g.getView().getResolutionForZoom(Math.max(l.getMinZoom(),0)):c.getResolution(0)),h.zDirection)),x=a.rotation,v=x?(0,o.Yw)(a.center,a.resolution,x,e.size):void 0;for(let o=r;o>=R;--o){const r=c.getTileRangeForExtentAndZ(t,o,this.tempTileRange_),s=c.getResolution(o);for(let t=r.minX;t<=r.maxX;++t)for(let l=r.minY;l<=r.maxY;++l){if(x&&!c.tileCoordIntersectsViewport([o,t,l],v))continue;const r=(0,u.N)(o,t,l,this.tempTileCoord_),f=A(h,r);let g,R;if(E.containsKey(f)&&(g=E.get(f),R=g.tile),(!g||g.tile.key!==h.getKey())&&(R=h.getTile(o,t,l,e.pixelRatio,a.projection),!R))continue;if(p(n,R))continue;g?g.setTile(R):(g=this.createTileRepresentation({tile:R,grid:c,helper:this.helper,gutter:_}),E.set(f,g)),m(n,g,o);const y=R.getKey();T[y]=!0,R.getState()===i.A.IDLE&&(e.tileQueue.isKeyQueued(y)||e.tileQueue.enqueue([R,d,c.getTileCoordCenter(r),s]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,r,n,i,s,o,a,l,h,u){}renderTileMask(e,t,r,n){}drawTile_(e,t,r,n,i,s,o){if(!t.ready)return;const a=t.tile,h=a.tileCoord,f=(0,u.i7)(h),_=f in s?s[f]:1,d=o.getResolution(r),T=(0,l.xq)(o.getTileSize(r),this.tempSize_),g=o.getOrigin(r),p=o.getTileCoordExtent(h),m=_<1?-1:E(r);_<1&&(e.animate=!0);const R=e.viewState,A=R.center[0],x=R.center[1],v=T[0]+2*n,y=T[1]+2*n,D=v/y,L=(A-g[0])/(T[0]*d),S=(g[1]-x)/(T[1]*d),P=R.resolution/d,b=h[1],U=h[2];(0,c.cL)(this.tileTransform_),(0,c.hs)(this.tileTransform_,2/(e.size[0]*P/v),-2/(e.size[1]*P/v)),(0,c.e$)(this.tileTransform_,R.rotation),(0,c.hs)(this.tileTransform_,1,1/D),(0,c.Tl)(this.tileTransform_,(T[0]*(b-L)-n)/v,(T[1]*(U-S)-n)/y),this.renderTile(t,this.tileTransform_,e,i,d,T,g,p,m,n,_)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const r=e.viewState,n=this.getLayer(),o=n.getRenderSource(),a=o.getTileGridForProjection(r.projection),l=o.getGutterForProjection(r.projection),h=R(e,e.extent),c=a.getZForResolution(r.resolution,o.zDirection),_=g(),d=n.getPreload();if(e.nextExtent){const t=a.getZForResolution(r.nextResolution,o.zDirection),n=R(e,e.nextExtent);this.enqueueTiles(e,n,t,_,d)}this.enqueueTiles(e,h,c,_,0),d>0&&setTimeout(()=>{this.enqueueTiles(e,h,c-1,_,d-1)},0);const T={};let p=!1;const m=_.representationsByZ;if(c in m){const t=(0,f.v6)(this),r=e.time;for(const e of m[c]){const n=e.tile;if(n.getState()===i.A.EMPTY)continue;const s=n.tileCoord;if(e.ready){const e=n.getAlpha(t,r);if(1===e){n.endTransition(t);continue}p=!0;const i=(0,u.i7)(s);T[i]=e}this.renderComplete=!1;const o=this.findAltTiles_(a,s,c+1,_);if(o)continue;const l=a.getMinZoom();for(let e=c-1;e>=l;--e){const t=this.findAltTiles_(a,s,e,_);if(t)break}}}const A=Object.keys(m).map(Number).sort(s.rG),x=this.beforeTilesMaskRender(e);if(x)for(let i=0,s=A.length;i<s;++i){const e=A[i];for(const t of m[e]){const r=t.tile.tileCoord,n=(0,u.i7)(r);if(n in T)continue;const i=a.getTileCoordExtent(r);this.renderTileMask(t,e,i,E(e))}}this.beforeTilesRender(e,p);for(let i=0,s=A.length;i<s;++i){const t=A[i];for(const r of m[t]){const n=r.tile.tileCoord,i=(0,u.i7)(n);i in T||this.drawTile_(e,r,t,l,h,T,a)}}if(c in m)for(const i of m[c]){const t=i.tile.tileCoord,r=(0,u.i7)(t);r in T&&this.drawTile_(e,i,c,l,h,T,a)}this.beforeFinalize(e),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const v=this.helper.getCanvas(),y=this.tileRepresentationCache;while(y.canExpireCache()){const e=y.pop();e.dispose()}return this.postRender(t,e),v}beforeFinalize(e){}findAltTiles_(e,t,r,n){const i=e.getTileRangeForTileCoordAndZ(t,r,this.tempTileRange_);if(!i)return!1;let s=!0;const o=this.tileRepresentationCache,a=this.getLayer().getRenderSource();for(let l=i.minX;l<=i.maxX;++l)for(let e=i.minY;e<=i.maxY;++e){const t=A(a,[r,l,e]);let i=!1;if(o.containsKey(t)){const e=o.get(t);e.ready&&!p(n,e.tile)&&(m(n,e,r),i=!0)}i||(s=!1)}return s}clearCache(){super.clearCache();const e=this.tileRepresentationCache;e.forEach(e=>e.dispose()),e.clear()}afterHelperCreated(){super.afterHelperCreated(),this.tileRepresentationCache.forEach(e=>e.setHelper(this.helper))}disposeInternal(){super.disposeInternal(),delete this.frameState}}t.Ay=x},14969:function(e,t,r){var n=r(90025),i=r(90588);class s{constructor(e){this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof n.A&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){while(this.canExpireCache())this.deleteOldest()}clear(){while(this.oldest_)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;while(t)e(t.value_,t.key_,this),t=t.newer}get(e,t){const r=this.entries_[e];return(0,i.v)(void 0!==r,"Tried to get a value for a key that does not exist in the cache"),r===this.newest_||(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r),r.value_}remove(e){const t=this.entries_[e];return(0,i.v)(void 0!==t,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t,r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.key_;return e}getValues(){const e=new Array(this.count_);let t,r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){(0,i.v)(!(e in this.entries_),"Tried to set a value for a key that is used already");const r={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[e]=r,++this.count_}setSize(e){this.highWaterMark=e}}t.A=s},20259:function(e,t,r){var n=r(90588),i=r(90130);const s={STATIC_DRAW:i.Ek,STREAM_DRAW:i.Ss,DYNAMIC_DRAW:i.Be};class o{constructor(e,t){this.array_=null,this.type_=e,(0,n.v)(e===i.H7||e===i.IP,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=void 0!==t?t:s.STATIC_DRAW}ofSize(e){return this.array_=new(a(this.type_))(e),this}fromArray(e){return this.array_=a(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(a(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}setArray(e){const t=a(this.type_);if(!(e instanceof t))throw new Error(`Expected ${t}`);this.array_=e}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function a(e){switch(e){case i.H7:return Float32Array;case i.IP:return Uint32Array;default:return Float32Array}}t.Ay=o},27557:function(e,t,r){r.d(t,{L$:function(){return x},M7:function(){return v},uZ:function(){return A},t7:function(){return y},nR:function(){return D},VO:function(){return f},Lm:function(){return E},z0:function(){return m},$R:function(){return u},Tl:function(){return g},Sl:function(){return p}});var n=r(89352),i=r(34799),s=r(6782);class o{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}delete(e){this.texture_&&e.deleteTexture(this.texture_),this.texture_=null}}var a=o,l=r(49825);function h(e,t){return`operator_${e}_${Object.keys(t.functions).length}`}function u(e){const t=e.toString();return t.includes(".")?t:t+".0"}function c(e){if(e.length<2||e.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${e.length}(${e.map(u).join(", ")})`}function f(e){const t=(0,n._j)(e),r=t.length>3?t[3]:1;return c([t[0]/255,t[1]/255,t[2]/255,r])}function _(e){const t=(0,s.xq)(e);return c(t)}const d={};let T=0;function E(e){return e in d||(d[e]=T++),d[e]}function g(e){return u(E(e))}function p(e){return"u_var_"+e}function m(){return{variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}const R="getBandValue",A="u_paletteTextures",x="featureId",v="geometryType",y=-9999999;function D(e,t,r,n){const i=(0,l.qg)(e,t,r);return P(i,t,n)}function L(e){return(t,r,n)=>{const i=r.args.length,s=new Array(i);for(let e=0;e<i;++e)s[e]=P(r.args[e],n,t);return e(s,t)}}const S={[l.ZD.Get]:(e,t)=>{const r=t.args[0],n=r.value,i=n in e.properties;return i||(e.properties[n]={name:n,type:t.type}),"a_prop_"+n},[l.ZD.Id]:e=>(e.featureId=!0,"a_"+x),[l.ZD.GeometryType]:e=>(e.geometryType=!0,"a_"+v),[l.ZD.LineMetric]:()=>"currentLineMetric",[l.ZD.Var]:(e,t)=>{const r=t.args[0],n=r.value,i=n in e.variables;return i||(e.variables[n]={name:n,type:t.type}),p(n)},[l.ZD.Has]:(e,t)=>{const r=t.args[0],n=r.value,i=n in e.properties;return i||(e.properties[n]={name:n,type:t.type}),`(a_prop_${n} != ${u(y)})`},[l.ZD.Resolution]:()=>"u_resolution",[l.ZD.Zoom]:()=>"u_zoom",[l.ZD.Time]:()=>"u_time",[l.ZD.Any]:L(e=>`(${e.join(" || ")})`),[l.ZD.All]:L(e=>`(${e.join(" && ")})`),[l.ZD.Not]:L(([e])=>`(!${e})`),[l.ZD.Equal]:L(([e,t])=>`(${e} == ${t})`),[l.ZD.NotEqual]:L(([e,t])=>`(${e} != ${t})`),[l.ZD.GreaterThan]:L(([e,t])=>`(${e} > ${t})`),[l.ZD.GreaterThanOrEqualTo]:L(([e,t])=>`(${e} >= ${t})`),[l.ZD.LessThan]:L(([e,t])=>`(${e} < ${t})`),[l.ZD.LessThanOrEqualTo]:L(([e,t])=>`(${e} <= ${t})`),[l.ZD.Multiply]:L(e=>`(${e.join(" * ")})`),[l.ZD.Divide]:L(([e,t])=>`(${e} / ${t})`),[l.ZD.Add]:L(e=>`(${e.join(" + ")})`),[l.ZD.Subtract]:L(([e,t])=>`(${e} - ${t})`),[l.ZD.Clamp]:L(([e,t,r])=>`clamp(${e}, ${t}, ${r})`),[l.ZD.Mod]:L(([e,t])=>`mod(${e}, ${t})`),[l.ZD.Pow]:L(([e,t])=>`pow(${e}, ${t})`),[l.ZD.Abs]:L(([e])=>`abs(${e})`),[l.ZD.Floor]:L(([e])=>`floor(${e})`),[l.ZD.Ceil]:L(([e])=>`ceil(${e})`),[l.ZD.Round]:L(([e])=>`floor(${e} + 0.5)`),[l.ZD.Sin]:L(([e])=>`sin(${e})`),[l.ZD.Cos]:L(([e])=>`cos(${e})`),[l.ZD.Atan]:L(([e,t])=>void 0!==t?`atan(${e}, ${t})`:`atan(${e})`),[l.ZD.Sqrt]:L(([e])=>`sqrt(${e})`),[l.ZD.Match]:L(e=>{const t=e[0],r=e[e.length-1];let n=null;for(let i=e.length-3;i>=1;i-=2){const s=e[i],o=e[i+1];n=`(${t} == ${s} ? ${o} : ${n||r})`}return n}),[l.ZD.Between]:L(([e,t,r])=>`(${e} >= ${t} && ${e} <= ${r})`),[l.ZD.Interpolate]:L(([e,t,...r])=>{let n="";for(let i=0;i<r.length-2;i+=2){const s=r[i],o=n||r[i+1],a=r[i+2],l=r[i+3];let h;h=e===u(1)?`(${t} - ${s}) / (${a} - ${s})`:`(pow(${e}, (${t} - ${s})) - 1.0) / (pow(${e}, (${a} - ${s})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${h}, 0.0, 1.0))`}return n}),[l.ZD.Case]:L(e=>{const t=e[e.length-1];let r=null;for(let n=e.length-3;n>=0;n-=2){const i=e[n],s=e[n+1];r=`(${i} ? ${s} : ${r||t})`}return r}),[l.ZD.In]:L(([e,...t],r)=>{const n=h("in",r),i=[];for(let s=0;s<t.length;s+=1)i.push(`  if (inputValue == ${t[s]}) { return true; }`);return r.functions[n]=`bool ${n}(float inputValue) {\n${i.join("\n")}\n  return false;\n}`,`${n}(${e})`}),[l.ZD.Array]:L(e=>`vec${e.length}(${e.join(", ")})`),[l.ZD.Color]:L(e=>{if(1===e.length)return`vec4(vec3(${e[0]} / 255.0), 1.0)`;if(2===e.length)return`vec4(vec3(${e[0]} / 255.0), ${e[1]})`;const t=e.slice(0,3).map(e=>`${e} / 255.0`);if(3===e.length)return`vec4(${t.join(", ")}, 1.0)`;const r=e[3];return`vec4(${t.join(", ")}, ${r})`}),[l.ZD.Band]:L(([e,t,r],n)=>{if(!(R in n.functions)){let e="";const t=n.bandCount||1;for(let r=0;r<t;r++){const n=Math.floor(r/4);let s=r%4;r===t-1&&1===s&&(s=3);const o=`${i.gF.TILE_TEXTURE_ARRAY}[${n}]`;e+=`  if (band == ${r+1}.0) {\n    return texture2D(${o}, v_textureCoord + vec2(dx, dy))[${s}];\n  }\n`}n.functions[R]=`float getBandValue(float band, float xOffset, float yOffset) {\n  float dx = xOffset / ${i.gF.TEXTURE_PIXEL_WIDTH};\n  float dy = yOffset / ${i.gF.TEXTURE_PIXEL_HEIGHT};\n${e}\n}`}return`${R}(${e}, ${t??"0.0"}, ${r??"0.0"})`}),[l.ZD.Palette]:(e,t)=>{const[r,...i]=t.args,s=i.length,o=new Uint8Array(4*s);for(let a=0;a<i.length;a++){const e=i[a].value,t=(0,n._j)(e),r=4*a;o[r]=t[0],o[r+1]=t[1],o[r+2]=t[2],o[r+3]=255*t[3]}e.paletteTextures||(e.paletteTextures=[]);const h=`${A}[${e.paletteTextures.length}]`,u=new a(h,o);e.paletteTextures.push(u);const c=P(r,l.wl,e);return`texture2D(${h}, vec2((${c} + 0.5) / ${s}.0, 0.5))`}};function P(e,t,r){if(e instanceof l.DG){const n=S[e.operator];if(void 0===n)throw new Error(`No compiler defined for this operator: ${JSON.stringify(e.operator)}`);return n(r,e,t)}if((e.type&l.wl)>0)return u(e.value);if((e.type&l.T8)>0)return e.value.toString();if((e.type&l.cT)>0)return g(e.value.toString());if((e.type&l.mE)>0)return f(e.value);if((e.type&l.Fq)>0)return c(e.value);if((e.type&l.qA)>0)return _(e.value);throw new Error(`Unexpected expression ${e.value} (expected type ${(0,l.go)(t)})`)}},27607:function(e,t,r){r.d(t,{$r:function(){return u},bL:function(){return a},xo:function(){return o}});var n=r(8143),i=r(11078),s=r(68711);function o(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}function a(e){return e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e instanceof DataView?e:null}const l=new Error("disposed");let h=null;function u(e){h||(h=(0,s.Y)(e.width,e.height,void 0,{willReadFrequently:!0}));const t=h.canvas,r=e.width;t.width!==r&&(t.width=r);const n=e.height;return t.height!==n&&(t.height=n),h.clearRect(0,0,r,n),h.drawImage(e,0,0),h.getImageData(0,0,r,n).data}const c=[256,256];class f extends n.A{constructor(e){const t=i.A.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=o(this.data_);return e?[e.width,e.height]:c}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==i.A.IDLE&&this.state!==i.A.ERROR)return;this.state=i.A.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=i.A.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=i.A.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(l),this.controller_=null),super.disposeInternal()}}t.Ay=f},34799:function(e,t,r){r.d(t,{eS:function(){return L},gF:function(){return D},Ay:function(){return b}});var n=r(11078),i=r(70915),s=r(38599),o=r(6782),a=r(9703),l=r(83954),h=r(20259),u=r(63722),c=r(27607),f=r(40190),_=r(68711),d=r(97404),T=r(90130),E=r(69049);function g(e,t,r){const n=r?e.LINEAR:e.NEAREST;e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n)}function p(e,t,r,n){g(e,t,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}function m(e,t,r,n,i,s){const o=e.getGL();let a,l;if(r instanceof Float32Array){a=o.FLOAT,e.getExtension("OES_texture_float");const t=e.getExtension("OES_texture_float_linear");l=null!==t}else a=o.UNSIGNED_BYTE,l=!0;g(o,t,s&&l);const h=r.byteLength/n[1];let u,c=1;switch(h%8===0?c=8:h%4===0?c=4:h%2===0&&(c=2),i){case 1:u=o.LUMINANCE;break;case 2:u=o.LUMINANCE_ALPHA;break;case 3:u=o.RGB;break;case 4:u=o.RGBA;break;default:throw new Error(`Unsupported number of bands: ${i}`)}const f=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,c),o.texImage2D(o.TEXTURE_2D,0,u,n[0],n[1],0,u,a,r),o.pixelStorei(o.UNPACK_ALIGNMENT,f)}let R=null;function A(){R=(0,_.Y)(1,1,void 0,{willReadFrequently:!0})}class x extends E.A{constructor(e){super(e),this.textures=[],this.renderSize_=(0,o.xq)(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new h.Ay(T.H7,T.Ek);t.fromArray([0,1,1,1,1,0,0,0]),this.helper.flushBufferData(t),this.coords=t,this.setTile(e.tile)}setHelper(e){const t=this.helper?.getGL();if(t){this.helper.deleteBuffer(this.coords);for(let e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e])}super.setHelper(e),e&&e.flushBufferData(this.coords)}uploadTile(){const e=this.helper,t=e.getGL(),r=this.tile;let n;this.textures.length=0,n=r instanceof f.A||r instanceof d.A?r.getImage():r.getData();const i=(0,c.xo)(n);if(i){const e=t.createTexture();return this.textures.push(e),this.bandCount=4,p(t,e,i,r.interpolate),void this.setReady()}n=(0,c.bL)(n);const s=r.getSize(),o=[s[0]+2*this.gutter,s[1]+2*this.gutter],a=n instanceof Float32Array,l=o[0]*o[1],h=a?Float32Array:Uint8Array,u=h.BYTES_PER_ELEMENT,_=n.byteLength/o[1];this.bandCount=Math.floor(_/u/o[0]);const T=Math.ceil(this.bandCount/4);if(1===T){const i=t.createTexture();return this.textures.push(i),m(e,i,n,o,this.bandCount,r.interpolate),void this.setReady()}const E=new Array(T);for(let c=0;c<T;++c){const e=t.createTexture();this.textures.push(e);const r=c<T-1?4:(this.bandCount-1)%4+1;E[c]=new h(l*r)}let g=0,R=0;const A=o[0]*this.bandCount;for(let c=0;c<o[1];++c){for(let e=0;e<A;++e){const t=n[R+e],r=Math.floor(g/this.bandCount),i=e%this.bandCount,s=Math.floor(i/4),o=E[s],a=o.length/l,h=i%4;o[r*a+h]=t,++g}R+=_/u}for(let c=0;c<T;++c){const t=this.textures[c],n=E[c],i=n.length/l;m(e,t,n,o,i,r.interpolate)}this.setReady()}getImagePixelData_(e,t,r){const n=this.gutter,i=this.renderSize_[0],s=this.renderSize_[1];R||A(),R.clearRect(0,0,1,1);const o=e.width,a=e.height,l=o-2*n,h=a-2*n,u=n+Math.floor(l*(t/i)),c=n+Math.floor(h*(r/s));let f;try{R.drawImage(e,u,c,1,1,0,0,1,1),f=R.getImageData(0,0,1,1).data}catch{return R=null,null}return f}getArrayPixelData_(e,t,r,n){const i=this.gutter,s=this.renderSize_[0],o=this.renderSize_[1],a=t[0],l=t[1],h=a+2*i,u=l+2*i,c=i+Math.floor(a*(r/s)),f=i+Math.floor(l*(n/o));if(e instanceof DataView){const t=e.byteLength/(h*u),r=t*(f*h+c),n=e.buffer.slice(r,r+t);return new DataView(n)}const _=this.bandCount*(f*h+c);return e.slice(_,_+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof c.Ay){const r=this.tile.getData(),n=(0,c.bL)(r);if(n){const r=this.tile.getSize();return this.getArrayPixelData_(n,r,e,t)}return this.getImagePixelData_((0,c.xo)(r),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}var v=x,y=r(8001);const D={...y.gF,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},L={TEXTURE_COORD:"a_textureCoord"},S=[{name:L.TEXTURE_COORD,size:2,type:u.jQ.FLOAT}];class P extends y.Ay{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new h.Ay(T.IP,T.Ek),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){if(super.reset(e),this.helper){const e=this.helper.getGL();for(const t of this.paletteTextures_)t.delete(e)}if(this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_);const e=this.helper.getGL();for(const t of this.paletteTextures_)t.getTexture(e)}}afterHelperCreated(){super.afterHelperCreated();const e=this.helper.getGL();for(const t of this.paletteTextures_)t.getTexture(e);this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){const e=this.helper.getGL();for(const t of this.paletteTextures_)t.delete(e)}super.removeHelper()}createTileRepresentation(e){return new v(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,r,n,s,o,a,h,u,c,f){const _=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(S);let d=0;while(d<e.textures.length){const t=`${D.TILE_TEXTURE_ARRAY}[${d}]`;this.helper.bindTexture(e.textures[d],d,t),++d}for(let i=0;i<this.paletteTextures_.length;++i){const e=this.paletteTextures_[i],t=e.getTexture(_);this.helper.bindTexture(t,d,e.name),++d}const T=r.viewState,E=o[0]+2*c,g=o[1]+2*c,p=e.tile,m=p.tileCoord,R=m[1],A=m[2];this.helper.setUniformMatrixValue(D.TILE_TRANSFORM,(0,l.Z1)(this.tempMat4,t)),this.helper.setUniformFloatValue(D.TRANSITION_ALPHA,f),this.helper.setUniformFloatValue(D.DEPTH,u);let x=n;c>0&&(x=h,(0,i._N)(x,n,x)),this.helper.setUniformFloatVec4(D.RENDER_EXTENT,x),this.helper.setUniformFloatValue(D.RESOLUTION,T.resolution),this.helper.setUniformFloatValue(D.ZOOM,T.zoom),this.helper.setUniformFloatValue(D.TEXTURE_PIXEL_WIDTH,E),this.helper.setUniformFloatValue(D.TEXTURE_PIXEL_HEIGHT,g),this.helper.setUniformFloatValue(D.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(D.TEXTURE_ORIGIN_X,a[0]+R*o[0]*s-c*s),this.helper.setUniformFloatValue(D.TEXTURE_ORIGIN_Y,a[1]-A*o[1]*s+c*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){const t=this.helper.getGL();if(!t)return null;const r=this.frameState;if(!r)return null;const l=this.getLayer(),h=(0,a.Bb)(r.pixelToCoordinateTransform,e.slice()),u=r.viewState,c=l.getExtent();if(c&&!(0,i.Ym)((0,s.SD)(c,u.projection),h))return null;const f=l.getSources((0,i.Tr)([h]),u.resolution);let _,d,T;for(_=f.length-1;_>=0;--_)if(d=f[_],"ready"===d.getState()){if(T=d.getTileGridForProjection(u.projection),d.getWrapX())break;const e=T.getExtent();if(!e||(0,i.Ym)(e,h))break}if(_<0)return null;const E=this.tileRepresentationCache;for(let i=T.getZForResolution(u.resolution);i>=T.getMinZoom();--i){const e=T.getTileCoordForCoordAndZ(h,i),t=(0,y.et)(d,e);if(!E.containsKey(t))continue;const r=E.get(t),s=r.tile;if(s.getState()===n.A.EMPTY)return null;if(!r.loaded)continue;const a=T.getOrigin(i),l=(0,o.xq)(T.getTileSize(i)),u=T.getResolution(i),c=(h[0]-a[0])/u-e[1]*l[0],f=(a[1]-h[1])/u-e[2]*l[1];return r.getPixelData(c,f)}return null}disposeInternal(){const e=this.helper;if(e){const t=e.getGL();for(const e of this.paletteTextures_)e.delete(t);this.paletteTextures_.length=0,t.deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}var b=P},34835:function(e,t,r){r.d(t,{Qi:function(){return h},T0:function(){return u},kc:function(){return f},mf:function(){return c},mh:function(){return _},s2:function(){return o}});var n=r(89352),i=r(49825),s=r(27557);function o(e,t,r){const n=(0,i.SR)();return(0,s.nR)(t,r,n,e)}function a(e){const t=(0,n._j)(e),r=256*t[0],i=t[1],s=256*t[2],o=Math.round(255*t[3]);return[r+i,s+o]}const l="vec4 unpackColor(vec2 packedColor) {\n  return vec4(\n    fract(floor(packedColor[0] / 256.0) / 256.0),\n    fract(packedColor[0] / 256.0),\n    fract(floor(packedColor[1] / 256.0) / 256.0),\n    fract(packedColor[1] / 256.0)\n  );\n}";function h(e){return e===i.mE||e===i.qA?2:e===i.Fq?4:1}function u(e){const t=h(e);return t>1?`vec${t}`:"float"}function c(e,t){for(const r in t.variables){const n=t.variables[r],o=(0,s.Sl)(n.name);let a=u(n.type);n.type===i.mE&&(a="vec4"),e.addUniform(o,a)}for(const r in t.properties){const n=t.properties[r],s=u(n.type),o=`a_prop_${n.name}`;n.type===i.mE?(e.addAttribute(o,s,`unpackColor(${o})`,"vec4"),e.addVertexShaderFunction(l)):e.addAttribute(o,s)}for(const r in t.functions)e.addVertexShaderFunction(t.functions[r]),e.addFragmentShaderFunction(t.functions[r])}function f(e,t){const r={};for(const o in e.variables){const a=e.variables[o],l=(0,s.Sl)(a.name);r[l]=()=>{const e=t[a.name];if("number"===typeof e)return e;if("boolean"===typeof e)return e?1:0;if(a.type===i.mE){const t=[...(0,n._j)(e||"#eee")];return t[0]/=255,t[1]/=255,t[2]/=255,t[3]??=1,t}return"string"===typeof e?(0,s.Lm)(e):e}}return r}function _(e){const t={};for(const r in e.properties){const o=e.properties[r],l=e=>{const t=e.get(o.name);return o.type===i.mE?a([...(0,n._j)(t||"#eee")]):"string"===typeof t?(0,s.Lm)(t):"boolean"===typeof t?t?1:0:t};t[`prop_${o.name}`]={size:h(o.type),callback:l}}return t}},60492:function(e,t,r){var n=r(75332),i=r(9960),s=r(83984),o=r(9703),a=r(63722),l=r(5986);class h extends l.A{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=(0,o.vt)(),this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},e.addChangeListener(n["default"].MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(s.A.PRECOMPOSE)){const n=new i.A(s.A.PRECOMPOSE,void 0,t,e);r.dispatchEvent(n)}}dispatchPostComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(s.A.POSTCOMPOSE)){const n=new i.A(s.A.POSTCOMPOSE,void 0,t,e);r.dispatchEvent(n)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t,r=!0,n=-1;for(let s=0,o=e.layerStatesArray.length;s<o;s++){const i=e.layerStatesArray[s].layer,o=i.getRenderer();if(!(o instanceof h)){r=!0;continue}const a=i.getClassName();if((r||a!==t)&&(n+=1,r=!1),t=a,o===this)break}const i="map/"+e.mapId+"/group/"+n;this.helper&&this.helper.canvasCacheKeyMatches(i)&&!this.helper.needsToBeRecreated()||(this.removeHelper(),this.helper=new a.Ay({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:i}),t&&(this.helper.getCanvas().className=t),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}clearCache(){}disposeInternal(){this.clearCache(),this.removeHelper(),this.getLayer()?.removeChangeListener(n["default"].MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(e,t,r){const n=this.getLayer();if(n.hasListener(e)){(0,o.Zz)(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);const s=new i.A(e,this.inversePixelTransform_,r,t);n.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(s.A.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(s.A.POSTRENDER,e,t)}}t.A=h},63722:function(e,t,r){r.d(t,{jQ:function(){return T},M8:function(){return d},Ay:function(){return D}});var n=r(90025),i=r(43530),s=r(9703),o=r(4087),a=r(83954),l={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},h=r(90130);const u="\n  precision mediump float;\n\n  attribute vec2 a_position;\n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n\n  uniform vec2 u_screenSize;\n\n  void main() {\n    v_texCoord = a_position * 0.5 + 0.5;\n    v_screenCoord = v_texCoord * u_screenSize;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n  }\n",c="\n  precision mediump float;\n\n  uniform sampler2D u_image;\n  uniform float u_opacity;\n\n  varying vec2 v_texCoord;\n\n  void main() {\n    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n  }\n";class f{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e.vertexShader||u),t.compileShader(r);const n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,e.fragmentShader||c),t.compileShader(n),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,r),t.attachShader(this.renderTargetProgram_,n),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const i=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(r=>{this.uniforms_.push({value:e.uniforms[r],location:t.getUniformLocation(this.renderTargetProgram_,r)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(e){const t=this.getGL(),r=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,r[0],r[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;const e=0,n=t.RGBA,i=0,s=t.RGBA,o=t.UNSIGNED_BYTE,a=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,e,n,r[0],r[1],i,s,o,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,r[0],r[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,r,n){const i=this.getGL(),s=e.size;if(i.bindFramebuffer(i.FRAMEBUFFER,t?t.getFrameBuffer():null),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.renderTargetTexture_),!t){const t=(0,o.v6)(i.canvas);if(!e.renderTargets[t]){const r=i.getContextAttributes();r&&r.preserveDrawingBuffer&&(i.clearColor(0,0,0,0),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)),e.renderTargets[t]=!0}}i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),i.bindBuffer(i.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),i.useProgram(this.renderTargetProgram_),i.enableVertexAttribArray(this.renderTargetAttribLocation_),i.vertexAttribPointer(this.renderTargetAttribLocation_,2,i.FLOAT,!1,0,0),i.uniform2f(this.renderTargetUniformLocation_,s[0],s[1]),i.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;i.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),r&&r(i,e),i.drawArrays(i.TRIANGLES,0,6),n&&n(i,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let r,n=1;this.uniforms_.forEach(function(i){if(r="function"===typeof i.value?i.value(e):i.value,r instanceof HTMLCanvasElement||r instanceof ImageData)i.texture||(i.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${n}`]),t.bindTexture(t.TEXTURE_2D,i.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,r.width,r.height,0,t.UNSIGNED_BYTE,new Uint8Array(r.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.uniform1i(i.location,n++);else if(Array.isArray(r))switch(r.length){case 2:return void t.uniform2f(i.location,r[0],r[1]);case 3:return void t.uniform3f(i.location,r[0],r[1],r[2]);case 4:return void t.uniform4f(i.location,r[0],r[1],r[2],r[3]);default:return}else"number"===typeof r&&t.uniform1f(i.location,r)})}}var _=f;const d={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},T={UNSIGNED_BYTE:h.l4,UNSIGNED_SHORT:h.JL,UNSIGNED_INT:h.UD,FLOAT:h.zH},E={};function g(e){return"shared/"+e}let p=0;function m(){const e="unique/"+p;return p+=1,e}function R(e){let t=E[e];if(!t){const r=document.createElement("canvas");r.width=1,r.height=1,r.style.position="absolute",r.style.left="0";const n=(0,h.SD)(r);t={users:0,context:n},E[e]=t}return t.users+=1,t.context}function A(e){const t=E[e];if(!t)return;if(t.users-=1,t.users>0)return;const r=t.context,n=r.getExtension("WEBGL_lose_context");n&&n.loseContext();const i=r.canvas;i.width=1,i.height=1,delete E[e]}class x extends n.A{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?g(e.canvasCacheKey):m(),this.gl_=R(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(l.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(l.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=(0,s.vt)(),this.offsetScaleMatrix_=(0,s.vt)(),this.tmpMat4_=(0,a.vt)(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(e=>new _({webGlContext:this.gl_,scaleRatio:e.scaleRatio,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms})):[new _({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now(),this.maxAttributeCount_=this.gl_.getParameter(this.gl_.MAX_VERTEX_ATTRIBS)}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===g(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,r=(0,o.v6)(e);let n=this.bufferCache_[r];if(!n){const i=t.createBuffer();n={buffer:e,webGlBuffer:i},this.bufferCache_[r]=n}t.bindBuffer(e.getType(),n.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=(0,o.v6)(e);delete this.bufferCache_[t]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(l.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(l.RESTORED,this.boundHandleWebGLContextRestored_),A(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,r){const n=this.gl_,i=this.getCanvas(),s=e.size,o=e.pixelRatio;i.width===s[0]*o&&i.height===s[1]*o||(i.width=s[0]*o,i.height=s[1]*o,i.style.width=s[0]+"px",i.style.height=s[1]+"px");for(let a=this.postProcessPasses_.length-1;a>=0;a--)this.postProcessPasses_[a].init(e);n.bindTexture(n.TEXTURE_2D,null),n.clearColor(0,0,0,0),n.depthRange(0,1),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,t?n.ZERO:n.ONE_MINUS_SRC_ALPHA),r?(n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL)):n.disable(n.DEPTH_TEST)}bindFrameBuffer(e,t){const r=this.getGL();r.bindFramebuffer(r.FRAMEBUFFER,e),t&&r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)}bindInitialFrameBuffer(){const e=this.getGL(),t=this.postProcessPasses_[0].getFrameBuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);const r=this.postProcessPasses_[0].getRenderTargetTexture();e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0)}bindTexture(e,t,r){const n=this.gl_;n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,e),n.uniform1i(this.getUniformLocation(r),t)}bindAttribute(e,t,r){const n=this.getGL();this.bindBuffer(e);const i=this.getAttributeLocation(t);n.enableVertexAttribArray(i),n.vertexAttribPointer(i,r,n.FLOAT,!1,0,0)}prepareDrawToRenderTarget(e,t,r,n){const i=this.gl_,s=t.getSize();i.bindFramebuffer(i.FRAMEBUFFER,t.getFramebuffer()),i.bindRenderbuffer(i.RENDERBUFFER,t.getDepthbuffer()),i.viewport(0,0,s[0],s[1]),i.bindTexture(i.TEXTURE_2D,t.getTexture()),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,r?i.ZERO:i.ONE_MINUS_SRC_ALPHA),n?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}drawElements(e,t){const r=this.gl_;this.getExtension("OES_element_index_uint");const n=r.UNSIGNED_INT,i=4,s=t-e,o=e*i;r.drawElements(r.TRIANGLES,s,n,o)}finalizeDraw(e,t,r){for(let n=0,i=this.postProcessPasses_.length;n<i;n++)n===i-1?this.postProcessPasses_[n].apply(e,null,t,r):this.postProcessPasses_[n].apply(e,this.postProcessPasses_[n+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,r=e.viewState.rotation,n=e.pixelRatio;this.setUniformFloatValue(d.TIME,.001*(Date.now()-this.startTime_)),this.setUniformFloatValue(d.ZOOM,e.viewState.zoom),this.setUniformFloatValue(d.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(d.PIXEL_RATIO,n),this.setUniformFloatVec2(d.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(d.ROTATION,r)}applyHitDetectionUniform(e){const t=this.getUniformLocation(d.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(d.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let r,n=0;this.uniforms_.forEach(i=>{if(r="function"===typeof i.value?i.value(e):i.value,r instanceof HTMLCanvasElement||r instanceof HTMLImageElement||r instanceof ImageData||r instanceof WebGLTexture){r instanceof WebGLTexture&&!i.texture?(i.prevValue=void 0,i.texture=r):i.texture||(i.prevValue=void 0,i.texture=t.createTexture()),this.bindTexture(i.texture,n,i.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const e=!(r instanceof HTMLImageElement)||r.complete;r instanceof WebGLTexture||!e||i.prevValue===r||(i.prevValue=r,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)),n++}else if(Array.isArray(r)&&6===r.length)this.setUniformMatrixValue(i.name,(0,a.Z1)(this.tmpMat4_,r));else if(Array.isArray(r)&&r.length<=4)switch(r.length){case 2:return void t.uniform2f(this.getUniformLocation(i.name),r[0],r[1]);case 3:return void t.uniform3f(this.getUniformLocation(i.name),r[0],r[1],r[2]);case 4:return void t.uniform4f(this.getUniformLocation(i.name),r[0],r[1],r[2],r[3]);default:return}else"number"===typeof r&&t.uniform1f(this.getUniformLocation(i.name),r)})}useProgram(e,t){this.disableAllAttributes_();const r=this.gl_;r.useProgram(e),this.currentProgram_=e,t&&(this.applyFrameState(t),this.applyUniforms(t))}compileShader(e,t){const r=this.gl_,n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),n}getProgram(e,t){const r=this.gl_,n=this.compileShader(e,r.FRAGMENT_SHADER),i=this.compileShader(t,r.VERTEX_SHADER),s=r.createProgram();if(r.attachShader(s,n),r.attachShader(s,i),r.linkProgram(s),!r.getShaderParameter(n,r.COMPILE_STATUS)){const e=`Fragment shader compilation failed: ${r.getShaderInfoLog(n)}`;throw new Error(e)}if(r.deleteShader(n),!r.getShaderParameter(i,r.COMPILE_STATUS)){const e=`Vertex shader compilation failed: ${r.getShaderInfoLog(i)}`;throw new Error(e)}if(r.deleteShader(i),!r.getProgramParameter(s,r.LINK_STATUS)){const e=`GL program linking failed: ${r.getProgramInfoLog(s)}`;throw new Error(e)}return s}getUniformLocation(e){const t=(0,o.v6)(this.currentProgram_);return void 0===this.uniformLocationsByProgram_[t]&&(this.uniformLocationsByProgram_[t]={}),void 0===this.uniformLocationsByProgram_[t][e]&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=(0,o.v6)(this.currentProgram_);return void 0===this.attribLocationsByProgram_[t]&&(this.attribLocationsByProgram_[t]={}),void 0===this.attribLocationsByProgram_[t][e]&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const r=e.size,n=e.viewState.rotation,i=e.viewState.resolution,o=e.viewState.center;return(0,s.Zz)(t,0,0,2/(i*r[0]),2/(i*r[1]),-n,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}disableAllAttributes_(){for(let e=0;e<this.maxAttributeCount_;e++)this.gl_.disableVertexAttribArray(e)}enableAttributeArray_(e,t,r,n,i){const s=this.getAttributeLocation(e);s<0||(this.gl_.enableVertexAttribArray(s),this.gl_.vertexAttribPointer(s,t,r,!1,n,i))}enableAttributes(e){const t=v(e);let r=0;for(let n=0;n<e.length;n++){const i=e[n];this.enableAttributeArray_(i.name,i.size,i.type||h.zH,t,r),r+=i.size*y(i.type)}}handleWebGLContextLost(e){(0,i.I)(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,r,n){const i=this.gl_;r=r||i.createTexture();const s=n?i.NEAREST:i.LINEAR;i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE);const o=0,a=i.RGBA,l=0,h=i.RGBA,u=i.UNSIGNED_BYTE;return t instanceof Uint8Array?i.texImage2D(i.TEXTURE_2D,o,a,e[0],e[1],l,h,u,t):t?i.texImage2D(i.TEXTURE_2D,o,a,h,u,t):i.texImage2D(i.TEXTURE_2D,o,a,e[0],e[1],l,h,u,null),r}}function v(e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];t+=n.size*y(n.type)}return t}function y(e){switch(e){case T.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case T.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case T.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case T.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}var D=x},69049:function(e,t,r){var n=r(40190),i=r(11078),s=r(6837),o=r(79332),a=r(4087);class l extends o.A{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter=e.gutter||0,this.helper=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(s.A.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===i.A.LOADED,this.loaded)this.uploadTile();else{if(e instanceof n.A){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(s.A.CHANGE,this.handleTileChange_)}}uploadTile(){(0,a.b0)()}setReady(){this.ready=!0,this.dispatchEvent(s.A.CHANGE)}handleTileChange_(){this.tile.getState()===i.A.LOADED&&(this.loaded=!0,this.uploadTile())}setHelper(e){this.helper=e,this.helper&&this.loaded&&this.uploadTile()}disposeInternal(){this.setHelper(null),this.tile.removeEventListener(s.A.CHANGE,this.handleTileChange_)}}t.A=l},83954:function(e,t,r){function n(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function i(e,t){return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}function s(e,t,r,i,s,o,a){a=a??n();const l=1/(e-t),h=1/(r-i),u=1/(s-o);return a[0]=-2*l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*h,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*u,a[11]=0,a[12]=(e+t)*l,a[13]=(i+r)*h,a[14]=(o+s)*u,a[15]=1,a}function o(e,t,r,i,s){return s=s??n(),s[0]=e[0]*t,s[1]=e[1]*t,s[2]=e[2]*t,s[3]=e[3]*t,s[4]=e[4]*r,s[5]=e[5]*r,s[6]=e[6]*r,s[7]=e[7]*r,s[8]=e[8]*i,s[9]=e[9]*i,s[10]=e[10]*i,s[11]=e[11]*i,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s}function a(e,t,r,i,s){let o,a,l,h,u,c,f,_,d,T,E,g;return s=s??n(),e===s?(s[12]=e[0]*t+e[4]*r+e[8]*i+e[12],s[13]=e[1]*t+e[5]*r+e[9]*i+e[13],s[14]=e[2]*t+e[6]*r+e[10]*i+e[14],s[15]=e[3]*t+e[7]*r+e[11]*i+e[15]):(o=e[0],a=e[1],l=e[2],h=e[3],u=e[4],c=e[5],f=e[6],_=e[7],d=e[8],T=e[9],E=e[10],g=e[11],s[0]=o,s[1]=a,s[2]=l,s[3]=h,s[4]=u,s[5]=c,s[6]=f,s[7]=_,s[8]=d,s[9]=T,s[10]=E,s[11]=g,s[12]=o*t+u*r+d*i+e[12],s[13]=a*t+c*r+T*i+e[13],s[14]=l*t+f*r+E*i+e[14],s[15]=h*t+_*r+g*i+e[15]),s}function l(e,t,r,i){return i=i??n(),i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=e,i[13]=t,i[14]=r,i[15]=1,i}r.d(t,{Tl:function(){return a},Z1:function(){return i},hs:function(){return o},j0:function(){return s},vt:function(){return n},wT:function(){return l}})},90130:function(e,t,r){r.d(t,{Be:function(){return l},Ek:function(){return a},H7:function(){return i},IP:function(){return s},JL:function(){return u},SD:function(){return d},Ss:function(){return o},UD:function(){return c},l4:function(){return h},zH:function(){return f}});var n=r(7771);const i=34962,s=34963,o=35040,a=35044,l=35048,h=5121,u=5123,c=5125,f=5126,_=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function d(e,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!n.oF},t);const r=_.length;for(let n=0;n<r;++n)try{const r=e.getContext(_[n],t);if(r)return r}catch{}return null}}}]);
//# sourceMappingURL=4835.cb7332da.js.map