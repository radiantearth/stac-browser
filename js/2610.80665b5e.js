"use strict";(self["webpackChunk_radiantearth_stac_browser"]=self["webpackChunk_radiantearth_stac_browser"]||[]).push([[2610,8807],{12610:function(e,t,r){r.r(t),r.d(t,{default:function(){return ir}});r(18111),r(61701);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"map-container"},[t("div",{ref:"map",staticClass:"map",attrs:{id:e.mapId}},[t("LayerControl",{attrs:{map:e.map,maxZoom:e.maxZoom}}),e.empty?t("TextControl",{attrs:{map:e.map,text:e.$t("mapping.nodata")}}):e.hasBasemap?e._e():t("TextControl",{attrs:{map:e.map,text:e.$t("mapping.nobasemap")}})],1),t("div",{ref:"target",staticClass:"popover-target"}),e.popover&&e.selection?t("b-popover",{attrs:{show:"",placement:"auto",triggers:"manual",target:e.selection.target,container:e.container,"custom-class":"map-popover"}},[t("section",{staticClass:"popover-items"},["items"===e.selection.type?t("Items",{attrs:{stac:e.stac,items:e.selection.items}}):t("Features",{attrs:{features:e.selection.items}})],1),t("div",{staticClass:"text-center"},[t("b-button",{attrs:{target:"_blank",variant:"danger"},on:{click:e.resetSelection}},[e._v(e._s(e.$t("mapping.close")))])],1)]):e._e()],1)},i=[],n=(r(22489),r(37089)),a=r(3838),o=r(82209),l=r(95353),c=r(30278),h=r(50071),u=r(32135),d=r(86717),g=r(66514),f=r(1685),m=r(58704),p=r(74238),y=r(82986),_=r(43530),v=r(29276),w=r(4087),b=r(71603);const T={SELECT:"select"};class E extends f.Ay{constructor(e,t,r,s){super(e),this.selected=t,this.deselected=r,this.mapBrowserEvent=s}}const x={};class S extends b.Ay{constructor(e){let t;if(super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:m.t5,this.addCondition_=e.addCondition?e.addCondition:m.Zm,this.removeCondition_=e.removeCondition?e.removeCondition:m.Zm,this.toggleCondition_=e.toggleCondition?e.toggleCondition:m.Kg,this.multi_=!!e.multi&&e.multi,this.filter_=e.filter?e.filter:p.rT,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=void 0!==e.style?e.style:A(),this.features_=e.features||new h.A,e.layers)if("function"===typeof e.layers)t=e.layers;else{const r=e.layers;t=function(e){return r.includes(e)}}else t=p.rT;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[(0,w.v6)(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[(0,w.v6)(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){const t=this.getMap();t&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(u.A.ADD,this.boundAddFeature_),this.features_.addEventListener(u.A.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(u.A.ADD,this.boundAddFeature_),this.features_.removeEventListener(u.A.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const e=this.getMap().getAllLayers().find(function(e){if(e instanceof y["default"]&&e.getSource()&&e.getSource().hasFeature(t))return e});e&&this.addFeatureLayerAssociation_(t,e)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=(0,w.v6)(e);t in x||(x[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let s=t.length-1;s>=0;--s){const r=t[s];if(r!==this&&r instanceof S&&r.getStyle()&&-1!==r.getFeatures().getArray().lastIndexOf(e))return void e.setStyle(r.getStyle())}const r=(0,w.v6)(e);e.setStyle(x[r]),delete x[r]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[(0,w.v6)(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),r=this.removeCondition_(e),s=this.toggleCondition_(e),i=!t&&!r&&!s,n=e.map,a=this.getFeatures(),o=[],l=[];if(i){(0,_.I)(this.featureLayerAssociation_),n.forEachFeatureAtPixel(e.pixel,(e,t)=>{if(e instanceof d.A&&this.filter_(e,t))return this.addFeatureLayerAssociation_(e,t),l.push(e),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=a.getLength()-1;e>=0;--e){const t=a.item(e),r=l.indexOf(t);r>-1?l.splice(r,1):(a.remove(t),o.push(t))}0!==l.length&&a.extend(l)}else{n.forEachFeatureAtPixel(e.pixel,(e,i)=>{if(e instanceof d.A&&this.filter_(e,i))return!t&&!s||a.getArray().includes(e)?(r||s)&&a.getArray().includes(e)&&(o.push(e),this.removeFeatureLayerAssociation_(e)):(this.addFeatureLayerAssociation_(e,i),l.push(e)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=o.length-1;e>=0;--e)a.remove(o[e]);a.extend(l)}return(l.length>0||o.length>0)&&this.dispatchEvent(new E(T.SELECT,l,o,e)),!0}}function A(){const e=(0,v.mY)();return(0,g.X$)(e["Polygon"],e["LineString"]),(0,g.X$)(e["GeometryCollection"],e["LineString"]),function(t){return t.getGeometry()?e[t.getGeometry().getType()]:null}}var F=S,R=Uint8Array,O=Uint16Array,C=Int32Array,I=new R([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),P=new R([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),M=new R([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),U=function(e,t){for(var r=new O(31),s=0;s<31;++s)r[s]=t+=1<<e[s-1];var i=new C(r[30]);for(s=1;s<30;++s)for(var n=r[s];n<r[s+1];++n)i[n]=n-r[s]<<5|s;return{b:r,r:i}},$=U(I,2),D=$.b,j=$.r;D[28]=258,j[258]=28;for(var k=U(P,0),G=k.b,N=(k.r,new O(32768)),B=0;B<32768;++B){var Z=(43690&B)>>1|(21845&B)<<1;Z=(52428&Z)>>2|(13107&Z)<<2,Z=(61680&Z)>>4|(3855&Z)<<4,N[B]=((65280&Z)>>8|(255&Z)<<8)>>1}var z=function(e,t,r){for(var s=e.length,i=0,n=new O(t);i<s;++i)e[i]&&++n[e[i]-1];var a,o=new O(t);for(i=1;i<t;++i)o[i]=o[i-1]+n[i-1]<<1;if(r){a=new O(1<<t);var l=15-t;for(i=0;i<s;++i)if(e[i])for(var c=i<<4|e[i],h=t-e[i],u=o[e[i]-1]++<<h,d=u|(1<<h)-1;u<=d;++u)a[N[u]>>l]=c}else for(a=new O(s),i=0;i<s;++i)e[i]&&(a[i]=N[o[e[i]-1]++]>>15-e[i]);return a},H=new R(288);for(B=0;B<144;++B)H[B]=8;for(B=144;B<256;++B)H[B]=9;for(B=256;B<280;++B)H[B]=7;for(B=280;B<288;++B)H[B]=8;var W=new R(32);for(B=0;B<32;++B)W[B]=5;var X=z(H,9,1),V=z(W,5,1),J=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},Y=function(e,t,r){var s=t/8|0;return(e[s]|e[s+1]<<8)>>(7&t)&r},K=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},q=function(e){return(e+7)/8|0},Q=function(e,t,r){return(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length),new R(e.subarray(t,r))},ee=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],te=function(e,t,r){var s=new Error(t||ee[e]);if(s.code=e,Error.captureStackTrace&&Error.captureStackTrace(s,te),!r)throw s;return s},re=function(e,t,r,s){var i=e.length,n=s?s.length:0;if(!i||t.f&&!t.l)return r||new R(0);var a=!r,o=a||2!=t.i,l=t.i;a&&(r=new R(3*i));var c=function(e){var t=r.length;if(e>t){var s=new R(Math.max(2*t,e));s.set(r),r=s}},h=t.f||0,u=t.p||0,d=t.b||0,g=t.l,f=t.d,m=t.m,p=t.n,y=8*i;do{if(!g){h=Y(e,u,1);var _=Y(e,u+1,3);if(u+=3,!_){var v=q(u)+4,w=e[v-4]|e[v-3]<<8,b=v+w;if(b>i){l&&te(0);break}o&&c(d+w),r.set(e.subarray(v,b),d),t.b=d+=w,t.p=u=8*b,t.f=h;continue}if(1==_)g=X,f=V,m=9,p=5;else if(2==_){var T=Y(e,u,31)+257,E=Y(e,u+10,15)+4,L=T+Y(e,u+5,31)+1;u+=14;for(var x=new R(L),S=new R(19),A=0;A<E;++A)S[M[A]]=Y(e,u+3*A,7);u+=3*E;var F=J(S),O=(1<<F)-1,C=z(S,F,1);for(A=0;A<L;){var U=C[Y(e,u,O)];u+=15&U;v=U>>4;if(v<16)x[A++]=v;else{var $=0,j=0;16==v?(j=3+Y(e,u,3),u+=2,$=x[A-1]):17==v?(j=3+Y(e,u,7),u+=3):18==v&&(j=11+Y(e,u,127),u+=7);while(j--)x[A++]=$}}var k=x.subarray(0,T),N=x.subarray(T);m=J(k),p=J(N),g=z(k,m,1),f=z(N,p,1)}else te(1);if(u>y){l&&te(0);break}}o&&c(d+131072);for(var B=(1<<m)-1,Z=(1<<p)-1,H=u;;H=u){$=g[K(e,u)&B];var W=$>>4;if(u+=15&$,u>y){l&&te(0);break}if($||te(2),W<256)r[d++]=W;else{if(256==W){H=u,g=null;break}var ee=W-254;if(W>264){A=W-257;var re=I[A];ee=Y(e,u,(1<<re)-1)+D[A],u+=re}var se=f[K(e,u)&Z],ie=se>>4;se||te(3),u+=15&se;N=G[ie];if(ie>3){re=P[ie];N+=K(e,u)&(1<<re)-1,u+=re}if(u>y){l&&te(0);break}o&&c(d+131072);var ne=d+ee;if(d<N){var ae=n-N,oe=Math.min(N,ne);for(ae+d<0&&te(3);d<oe;++d)r[d]=s[ae+d]}for(;d<ne;++d)r[d]=r[d-N]}}t.l=g,t.p=H,t.b=d,t.f=h,g&&(h=1,t.m=m,t.d=f,t.n=p)}while(!h);return d!=r.length&&a?Q(r,0,d):r.subarray(0,d)},se=new R(0),ie=function(e){31==e[0]&&139==e[1]&&8==e[2]||te(6,"invalid gzip data");var t=e[3],r=10;4&t&&(r+=2+(e[10]|e[11]<<8));for(var s=(t>>3&1)+(t>>4&1);s>0;s-=!e[r++]);return r+(2&t)},ne=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},ae=function(e,t){return(8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31)&&te(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&te(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),2+(e[1]>>3&4)};function oe(e,t){return re(e,{i:2},t&&t.out,t&&t.dictionary)}function le(e,t){var r=ie(e);return r+8>e.length&&te(6,"invalid gzip data"),re(e.subarray(r,-8),{i:2},t&&t.out||new R(ne(e)),t&&t.dictionary)}function ce(e,t){return re(e.subarray(ae(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}function he(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?le(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?oe(e,t):ce(e,t)}var ue="undefined"!=typeof TextDecoder&&new TextDecoder;try{ue.decode(se,{stream:!0})}catch(nr){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;var de=Object.defineProperty,ge=Math.pow,fe=(e,t)=>de(e,"name",{value:t,configurable:!0}),me=(e,t,r)=>new Promise((s,i)=>{var n=e=>{try{o(r.next(e))}catch(t){i(t)}},a=e=>{try{o(r.throw(e))}catch(t){i(t)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,a);o((r=r.apply(e,t)).next())}),pe=(fe((e,t)=>{let r=!1,s="",i=L.GridLayer.extend({createTile:fe((t,i)=>{let n=document.createElement("img"),a=new AbortController,o=a.signal;return n.cancel=()=>{a.abort()},r||(e.getHeader().then(e=>{1===e.tileType?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):2===e.tileType?s="image/png":3===e.tileType?s="image/jpeg":4===e.tileType?s="image/webp":5===e.tileType&&(s="image/avif")}),r=!0),e.getZxy(t.z,t.x,t.y,o).then(e=>{if(e){let t=new Blob([e.data],{type:s}),r=window.URL.createObjectURL(t);n.src=r,n.cancel=void 0,i(void 0,n)}}).catch(e=>{if("AbortError"!==e.name)throw e}),n},"createTile"),_removeTile:fe(function(e){let t=this._tiles[e];t&&(t.el.cancel&&t.el.cancel(),t.el.width=0,t.el.height=0,t.el.deleted=!0,L.DomUtil.remove(t.el),delete this._tiles[e],this.fire("tileunload",{tile:t.el,coords:this._keyToTileCoords(e)}))},"_removeTile")});return new i(t)},"leafletRasterLayer"),fe(e=>(t,r)=>{if(r instanceof AbortController)return e(t,r);let s=new AbortController;return e(t,s).then(e=>r(void 0,e.data,e.cacheControl||"",e.expires||""),e=>r(e)).catch(e=>r(e)),{cancel:fe(()=>s.abort(),"cancel")}},"v3compat")),ye=class{constructor(e){this.tilev4=fe((e,t)=>me(this,null,function*(){if("json"===e.type){let t=e.url.substr(10),r=this.tiles.get(t);if(r||(r=new We(t),this.tiles.set(t,r)),this.metadata)return{data:yield r.getTileJson(e.url)};let s=yield r.getHeader();return(s.minLon>=s.maxLon||s.minLat>=s.maxLat)&&console.error(`Bounds of PMTiles archive ${s.minLon},${s.minLat},${s.maxLon},${s.maxLat} are not valid.`),{data:{tiles:[`${e.url}/{z}/{x}/{y}`],minzoom:s.minZoom,maxzoom:s.maxZoom,bounds:[s.minLon,s.minLat,s.maxLon,s.maxLat]}}}let r=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=e.url.match(r);if(!s)throw new Error("Invalid PMTiles protocol URL");let i=s[1],n=this.tiles.get(i);n||(n=new We(i),this.tiles.set(i,n));let a=s[2],o=s[3],l=s[4],c=yield n.getHeader(),h=yield null==n?void 0:n.getZxy(+a,+o,+l,t.signal);if(h)return{data:new Uint8Array(h.data),cacheControl:h.cacheControl,expires:h.expires};if(1===c.tileType){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=pe(this.tilev4),this.tiles=new Map,this.metadata=(null==e?void 0:e.metadata)||!1,this.errorOnMissingTile=(null==e?void 0:e.errorOnMissingTile)||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};fe(ye,"Protocol");function _e(e,t){return 4294967296*(t>>>0)+(e>>>0)}function ve(e,t){let r=t.buf,s=r[t.pos++],i=(112&s)>>4;if(s<128||(s=r[t.pos++],i|=(127&s)<<3,s<128)||(s=r[t.pos++],i|=(127&s)<<10,s<128)||(s=r[t.pos++],i|=(127&s)<<17,s<128)||(s=r[t.pos++],i|=(127&s)<<24,s<128)||(s=r[t.pos++],i|=(1&s)<<31,s<128))return _e(e,i);throw new Error("Expected varint not more than 10 bytes")}function we(e){let t=e.buf,r=t[e.pos++],s=127&r;return r<128||(r=t[e.pos++],s|=(127&r)<<7,r<128)||(r=t[e.pos++],s|=(127&r)<<14,r<128)||(r=t[e.pos++],s|=(127&r)<<21,r<128)?s:(r=t[e.pos],s|=(15&r)<<28,ve(s,e))}function be(e,t,r,s){if(0===s){1===r&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);let s=t[0];t[0]=t[1],t[1]=s}}function Te(e,t){let r=ge(2,e),s=t,i=t,n=t,a=[0,0],o=1;for(;o<r;)s=1&n/2,i=1&(n^s),be(o,a,s,i),a[0]+=o*s,a[1]+=o*i,n/=4,o*=2;return[e,a[0],a[1]]}fe(_e,"toNum"),fe(ve,"readVarintRemainder"),fe(we,"readVarint"),fe(be,"rotate"),fe(Te,"idOnLevel");var Ee=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Le(e,t,r){if(e>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(t>ge(2,e)-1||r>ge(2,e)-1)throw new Error("tile x/y outside zoom level bounds");let s=Ee[e],i=ge(2,e),n=0,a=0,o=0,l=[t,r],c=i/2;for(;c>0;)n=(l[0]&c)>0?1:0,a=(l[1]&c)>0?1:0,o+=c*c*(3*n^a),be(c,l,n,a),c/=2;return s+o}function xe(e){let t=0;for(let r=0;r<27;r++){let s=(1<<r)*(1<<r);if(t+s>e)return Te(r,e-t);t+=s}throw new Error("Tile zoom level exceeds max safe number limit (26)")}fe(Le,"zxyToTileId"),fe(xe,"tileIdToZxy");var Se=(e=>(e[e.Unknown=0]="Unknown",e[e.None=1]="None",e[e.Gzip=2]="Gzip",e[e.Brotli=3]="Brotli",e[e.Zstd=4]="Zstd",e))(Se||{});function Ae(e,t){return me(this,null,function*(){if(1===t||0===t)return e;if(2===t){if("undefined"==typeof globalThis.DecompressionStream)return he(new Uint8Array(e));let t=new Response(e).body;if(!t)throw new Error("Failed to read response stream");let r=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}throw new Error("Compression method not supported")})}fe(Ae,"defaultDecompress");var Fe=(e=>(e[e.Unknown=0]="Unknown",e[e.Mvt=1]="Mvt",e[e.Png=2]="Png",e[e.Jpeg=3]="Jpeg",e[e.Webp=4]="Webp",e[e.Avif=5]="Avif",e))(Fe||{});function Re(e){return 1===e?".mvt":2===e?".png":3===e?".jpg":4===e?".webp":5===e?".avif":""}fe(Re,"tileTypeExt");var Oe=127;function Ce(e,t){let r=0,s=e.length-1;for(;r<=s;){let i=s+r>>1,n=t-e[i].tileId;if(n>0)r=i+1;else{if(!(n<0))return e[i];s=i-1}}return s>=0&&(0===e[s].runLength||t-e[s].tileId<e[s].runLength)?e[s]:null}fe(Ce,"findTile");var Ie=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return me(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};fe(Ie,"FileSource");var Pe=class{constructor(e,t=new Headers){this.url=e,this.customHeaders=t,this.mustReload=!1;let r="";"navigator"in globalThis&&(r=globalThis.navigator.userAgent||"");let s=r.indexOf("Windows")>-1,i=/Chrome|Chromium|Edg|OPR|Brave/.test(r);this.chromeWindowsNoCache=!1,s&&i&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,r,s){return me(this,null,function*(){let i,n;r?n=r:(i=new AbortController,n=i.signal);let a,o=new Headers(this.customHeaders);o.set("range",`bytes=${e}-${e+t-1}`),this.mustReload?a="reload":this.chromeWindowsNoCache&&(a="no-store");let l=yield fetch(this.url,{signal:n,cache:a,headers:o});if(0===e&&416===l.status){let e=l.headers.get("Content-Range");if(!e||!e.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let t=+e.substr(8);l=yield fetch(this.url,{signal:n,cache:"reload",headers:{range:"bytes=0-"+(t-1)}})}let c=l.headers.get("Etag");if(null!=c&&c.startsWith("W/")&&(c=null),416===l.status||s&&c&&c!==s)throw this.mustReload=!0,new ke(`Server returned non-matching ETag ${s} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(l.status>=300)throw new Error(`Bad response code: ${l.status}`);let h=l.headers.get("Content-Length");if(200===l.status&&(!h||+h>t))throw i&&i.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield l.arrayBuffer(),etag:c||void 0,cacheControl:l.headers.get("Cache-Control")||void 0,expires:l.headers.get("Expires")||void 0}})}};fe(Pe,"FetchSource");var Me=Pe;function Ue(e,t){let r=e.getUint32(t+4,!0),s=e.getUint32(t+0,!0);return r*ge(2,32)+s}function $e(e,t){let r=new DataView(e),s=r.getUint8(7);if(s>3)throw new Error(`Archive is spec version ${s} but this library supports up to spec version 3`);return{specVersion:s,rootDirectoryOffset:Ue(r,8),rootDirectoryLength:Ue(r,16),jsonMetadataOffset:Ue(r,24),jsonMetadataLength:Ue(r,32),leafDirectoryOffset:Ue(r,40),leafDirectoryLength:Ue(r,48),tileDataOffset:Ue(r,56),tileDataLength:Ue(r,64),numAddressedTiles:Ue(r,72),numTileEntries:Ue(r,80),numTileContents:Ue(r,88),clustered:1===r.getUint8(96),internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:t}}function De(e){let t={buf:new Uint8Array(e),pos:0},r=we(t),s=[],i=0;for(let n=0;n<r;n++){let e=we(t);s.push({tileId:i+e,offset:0,length:0,runLength:1}),i+=e}for(let n=0;n<r;n++)s[n].runLength=we(t);for(let n=0;n<r;n++)s[n].length=we(t);for(let n=0;n<r;n++){let e=we(t);s[n].offset=0===e&&n>0?s[n-1].offset+s[n-1].length:e-1}return s}fe(Ue,"getUint64"),fe($e,"bytesToHeader"),fe(De,"deserializeIndex");var je=class extends Error{};fe(je,"EtagMismatch");var ke=je;function Ge(e,t){return me(this,null,function*(){let r=yield e.getBytes(0,16384);if(19792!==new DataView(r.data).getUint16(0,!0))throw new Error("Wrong magic number for PMTiles archive");let s=r.data.slice(0,Oe),i=$e(s,r.etag),n=r.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),a=`${e.getKey()}|${i.etag||""}|${i.rootDirectoryOffset}|${i.rootDirectoryLength}`,o=De(yield t(n,i.internalCompression));return[i,[a,o.length,o]]})}function Ne(e,t,r,s,i){return me(this,null,function*(){let n=yield e.getBytes(r,s,void 0,i.etag),a=yield t(n.data,i.internalCompression),o=De(a);if(0===o.length)throw new Error("Empty directory is invalid");return o})}fe(Ge,"getHeaderAndRoot"),fe(Ne,"getDirectory");var Be=class{constructor(e=100,t=!0,r=Ae){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return me(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,r.data;let s=yield Ge(e,this.decompress);return s[1]&&this.cache.set(s[1][0],{lastUsed:this.counter++,data:s[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:s[0]}),this.prune(),s[0]})}getDirectory(e,t,r,s){return me(this,null,function*(){let i=`${e.getKey()}|${s.etag||""}|${t}|${r}`,n=this.cache.get(i);if(n)return n.lastUsed=this.counter++,n.data;let a=yield Ne(e,this.decompress,t,r,s);return this.cache.set(i,{lastUsed:this.counter++,data:a}),this.prune(),a})}prune(){if(this.cache.size>this.maxCacheEntries){let e,t=1/0;this.cache.forEach((r,s)=>{r.lastUsed<t&&(t=r.lastUsed,e=s)}),e&&this.cache.delete(e)}}invalidate(e){return me(this,null,function*(){this.cache.delete(e.getKey())})}};fe(Be,"ResolvedValueCache");var Ze=class{constructor(e=100,t=!0,r=Ae){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return me(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,yield r.data;let s=new Promise((t,r)=>{Ge(e,this.decompress).then(e=>{e[1]&&this.cache.set(e[1][0],{lastUsed:this.counter++,data:Promise.resolve(e[1][2])}),t(e[0]),this.prune()}).catch(e=>{r(e)})});return this.cache.set(t,{lastUsed:this.counter++,data:s}),s})}getDirectory(e,t,r,s){return me(this,null,function*(){let i=`${e.getKey()}|${s.etag||""}|${t}|${r}`,n=this.cache.get(i);if(n)return n.lastUsed=this.counter++,yield n.data;let a=new Promise((i,n)=>{Ne(e,this.decompress,t,r,s).then(e=>{i(e),this.prune()}).catch(e=>{n(e)})});return this.cache.set(i,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let e,t=1/0;this.cache.forEach((r,s)=>{r.lastUsed<t&&(t=r.lastUsed,e=s)}),e&&this.cache.delete(e)}}invalidate(e){return me(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let r=new Promise((r,s)=>{this.getHeader(e).then(e=>{r(),this.invalidations.delete(t)}).catch(e=>{s(e)})});this.invalidations.set(t,r)})}};fe(Ze,"SharedPromiseCache");var ze=Ze,He=class{constructor(e,t,r){this.source="string"==typeof e?new Me(e):e,this.decompress=r||Ae,this.cache=t||new ze}getHeader(){return me(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,r,s){return me(this,null,function*(){let i=Le(e,t,r),n=yield this.cache.getHeader(this.source);if(e<n.minZoom||e>n.maxZoom)return;let a=n.rootDirectoryOffset,o=n.rootDirectoryLength;for(let e=0;e<=3;e++){let e=yield this.cache.getDirectory(this.source,a,o,n),t=Ce(e,i);if(!t)return;if(t.runLength>0){let e=yield this.source.getBytes(n.tileDataOffset+t.offset,t.length,s,n.etag);return{data:yield this.decompress(e.data,n.tileCompression),cacheControl:e.cacheControl,expires:e.expires}}a=n.leafDirectoryOffset+t.offset,o=t.length}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,r,s){return me(this,null,function*(){try{return yield this.getZxyAttempt(e,t,r,s)}catch(i){if(i instanceof ke)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,r,s);throw i}})}getMetadataAttempt(){return me(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),r=yield this.decompress(t.data,e.internalCompression),s=new TextDecoder("utf-8");return JSON.parse(s.decode(r))})}getMetadata(){return me(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(nr){if(nr instanceof ke)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw nr}})}getTileJson(e){return me(this,null,function*(){let t=yield this.getHeader(),r=yield this.getMetadata(),s=Re(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${s}`],vector_layers:r.vector_layers,attribution:r.attribution,description:r.description,name:r.name,version:r.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};fe(He,"PMTiles");var We=He,Xe=r(6837);class Ve extends f.Ay{constructor(e){super(Xe.A.ERROR),this.error=e}}var Je=Ve,Ye=r(73354),Ke=r(5255),qe=r(53820),Qe=r(35598);class et{constructor(e){this.name=e}toString(){return this.name}}et.GeoTIFF=new et("GeoTIFF"),et.ImageStatic=new et("ImageStatic"),et.PMTilesRaster=new et("PMTilesRaster"),et.PMTilesVector=new et("PMTilesVector"),et.TileJSON=new et("TileJSON"),et.TileWMS=new et("TileWMS"),et.WMTS=new et("WMTS"),et.XYZ=new et("XYZ");var tt=et,rt=r(58262),st=r(19551),it=r(30945),nt=r(42457),at=r(65544),ot=r(75522),lt=r(82728),ct=r(36181),ht=r(29297),ut=r(18056),dt=r(10702),gt=r(49194),ft=r(27733),mt=r(13628),pt=r(953),yt=r(84078);const _t="https://stac-extensions.github.io/label/v1.*/schema.json",vt=new mt.A({color:"rgba(0,0,0,0)"});function wt(e,t,r="rgba(255,255,255,0.4)",s=5){let i=vt;r&&(i=new mt.A({color:r}));const n=new pt.A({color:e,width:t});return new v.Ay({image:new ft.A({fill:i,stroke:n,radius:s}),fill:i,stroke:n})}const bt=wt("#3399CC",3),Tt=wt("#ff9933",2,null);async function Et(e,t=null,r=null,s=0){const i=new Set;return e.map.forEachFeatureAtPixel(e.pixel,(e,t)=>{r&&r.push(e),i.add(t.get("stac"))},{hitTolerance:s,layerFilter(e){if(e instanceof y["default"]&&!0===e.get("bounds")){const r=e.get("stac");if(r instanceof gt.O7&&(!t||!r.equals(t)))return!0}return!1}}),[...i]}function Lt(e,t){const r={url:e.getAbsoluteUrl()};let s=e,i=e.getBands();1===i.length&&(s=i[0],i=[]);const{minimum:n,maximum:a}=s.getMinMaxValues();if("number"===typeof n&&(r.min=n),"number"===typeof a&&(r.max=a),"number"!==typeof r.min&&"number"!==typeof r.max&&i.length>1)for(const l of i){const{minimum:e,maximum:t}=l.getMinMaxValues();"number"===typeof e&&("undefined"===typeof r.min||e<r.min)&&(r.min=e),"number"===typeof t&&("undefined"===typeof r.max||t>r.max)&&(r.max=t)}const o=s.getNoDataValues();if(o.length>0)r.nodata=o[0];else if(i.length>1){let e;for(const t of i){const r=t.getNoDataValues();if(r.length>0)if("undefined"===typeof e)e=r[0];else if(e!==r[0]){e=void 0;break}}"undefined"!==typeof e&&(r.nodata=e)}if(t.length>0)r.bands=t;else{const t=e.findVisualBands();t&&(r.bands=[t.red.getIndex()+1,t.green.getIndex()+1,t.blue.getIndex()+1])}return r}async function xt(e,t=void 0){let r=t;if((0,yt.zN)()){const t=e.getMetadata("proj:code");if(t)try{if(t.startsWith("EPSG:")){const e=parseInt(t.replace("EPSG:",""),10);r=await(0,yt.N1)(e)}}catch(Re){}}return r}function St(e,t){const r=e.clone();return t.hasOnlyBounds()||r.setFill(vt),r}function At(e){let t=e.href;if(t.includes("{s}")){if(!(Array.isArray(e["href:servers"])&&e["href:servers"].length>0))return null;{const r=Math.random()*e["href:servers"].length|0;t=t.replace("{s}",e["href:servers"][r])}}return t}var Ft=r(22615),Rt=r(11078),Ot=r(60032),Ct=r(4863),It=Object.defineProperty,Pt=Object.getOwnPropertySymbols,Mt=Object.prototype.hasOwnProperty,Ut=Object.prototype.propertyIsEnumerable,$t=(e,t,r)=>t in e?It(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Dt=(e,t)=>{for(var r in t||(t={}))Mt.call(t,r)&&$t(e,r,t[r]);if(Pt)for(var r of Pt(t))Ut.call(t,r)&&$t(e,r,t[r]);return e},jt=(e,t)=>It(e,"name",{value:t,configurable:!0}),kt=(e,t,r)=>new Promise((s,i)=>{var n=e=>{try{o(r.next(e))}catch(nr){i(nr)}},a=e=>{try{o(r.throw(e))}catch(nr){i(nr)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,a);o((r=r.apply(e,t)).next())}),Gt=class extends Ft["default"]{constructor(e){super(Dt(Dt({},e),{state:"loading"})),this.loadImage=jt(e=>new Promise((t,r)=>{const s=new Image;s.addEventListener("load",()=>t(s)),s.addEventListener("error",()=>r(new Error("load failed"))),s.src=e}),"loadImage");const t=new We(e.url);t.getHeader().then(r=>{const s=void 0===e.projection?"EPSG:3857":e.projection;this.tileGrid=e.tileGrid||(0,Ct.EN)({extent:(0,Ct.kZ)(s),maxResolution:e.maxResolution,minZoom:r.minZoom,maxZoom:r.maxZoom,tileSize:e.tileSize}),this.setLoader((e,r,s)=>kt(this,null,function*(){const i=yield t.getZxy(e,r,s);if(!i)return new Uint8Array;const n=URL.createObjectURL(new Blob([i.data])),a=yield this.loadImage(n);return URL.revokeObjectURL(n),a})),this.setState("ready")})}};jt(Gt,"PMTilesRasterSource");var Nt=Gt,Bt=class extends ot["default"]{constructor(e){super(Dt(Dt({},e),{state:"loading",url:"pmtiles://{z}/{x}/{y}",format:e.format||new Ot.A})),this.tileLoadFunction=jt((e,t)=>{const r=e,s=new RegExp(/pmtiles:\/\/(\d+)\/(\d+)\/(\d+)/),i=t.match(s);if(!(i&&i.length>=4))throw Error("Could not parse tile URL");const n=+i[1],a=+i[2],o=+i[3];r.setLoader((e,t,s)=>{this.pmtiles_.getZxy(n,a,o).then(t=>{if(t){const i=r.getFormat();r.setFeatures(i.readFeatures(t.data,{extent:e,featureProjection:s})),r.setState(Rt.A.LOADED)}else r.setFeatures([]),r.setState(Rt.A.EMPTY)}).catch(e=>{r.setFeatures([]),r.setState(Rt.A.ERROR)})})},"tileLoadFunction"),this.pmtiles_=new We(e.url),this.pmtiles_.getHeader().then(t=>{const r=e.projection||"EPSG:3857",s=e.extent||(0,Ct.kZ)(r);this.tileGrid=e.tileGrid||(0,Ct.EN)({extent:s,maxResolution:e.maxResolution,maxZoom:void 0!==e.maxZoom?e.maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:e.tileSize||512}),this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}};jt(Bt,"PMTilesVectorSource");var Zt=Bt,zt=r(34533),Ht=r(88319),Wt=r(70915),Xt=r(20537),Vt=r(38599);class Jt extends Qe["default"]{constructor(e){const t={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(r=>t[r]=e[r]),super(t),this.getSourceOptions_=e.getSourceOptions,this.children_=null,this.childrenOptions_=e.childrenOptions||{},this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=!1!==e.displayFootprint,this.displayGeoTiffByDefault_=Boolean(e.displayGeoTiffByDefault),this.displayPreview_=Boolean(e.displayPreview),this.displayOverview_=!1!==e.displayOverview,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||bt,this.collectionStyle_=e.collectionStyle||Tt,this.boundsLayer_=null,this.disableMigration_=e.disableMigration||!1,this.map_=null,this.eventQueue_=[],e.httpRequestFn&&(this.fetch_=e.httpRequestFn),e.data)try{this.configure_(e.data,e.url,e.children,e.assets,e.bands)}catch(r){this.handleError_(r)}else{if(!e.url)throw new Error("Either url or data must be provided");this.fetch_(e.url).then(t=>this.configure_(t,e.url,e.children,e.assets,e.bands)).catch(e=>this.handleError_(e))}}async fetch_(e,t="json"){const r=await fetch(e);if(!r.ok)throw new Error(`Unexpected response from ${e}: ${r.status}`);return"json"===t?await r.json():"text"===t?await r.text():null}getBoundsLayer(){return this.boundsLayer_}isEmpty(){var e;const t=this.getLayers().getLength();if(t>1)return!1;const r=null===(e=this.getData())||void 0===e?void 0:e.getBoundingBox();return!(r&&!(0,Wt.Im)(r))||(!this.boundsLayer_||!this.displayFootprint_)}handleError_(e){this.dispatch_(new Je(e))}configure_(e,t=null,r=null,s=null,i=[]){let n;e instanceof gt.Vd||e instanceof gt.O7?n=e:(n=(0,gt["default"])(e,!this.disableMigration_),t&&t.includes("://")&&n.setAbsoluteUrl(t)),this.set("stac",n),this.bands_=i,this.boundsLayer_=this.addFootprint_();const a=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(St(this.boundsStyle_,this))};this.getLayers().on("add",a),this.getLayers().on("remove",a);const o=e=>this.handleError_(e),l=[];r&&l.push(this.setChildren(r,null,!1).catch(o)),s&&l.push(this.setAssets(s,!1).catch(o)),Promise.all(l).then(()=>this.updateLayers().catch(o)),this.dispatch_("sourceready")}dispatch_(e){this.eventQueue_.push(e),this.flush_()}flush_(){if(this.map_){for(const e of this.eventQueue_)this.dispatchEvent(e);this.eventQueue_=[]}}setMap_(e){this.map_!==e&&(this.map_=e,this.flush_())}async addChildren_(e,t={}){const r=e.map(e=>{const r={data:e,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_,useTileLayerAsFallback:this.useTileLayerAsFallback_,buildTileUrlTemplate:this.buildTileUrlTemplate_},s=new Jt(Object.assign(r,t));return s.on("sourceready",()=>{s.map_&&this.setMap_(s.map_)}),this.addLayer_(s,null),s});return await Promise.all(r)}async addPreviewImage_(e){const t=await xt(e,"EPSG:4326"),r=e.getContext().getBoundingBoxes();if(1!==r.length)return;const s=r[0];let i={url:e.getAbsoluteUrl(),projection:t,imageExtent:(0,Vt.DI)(s,"EPSG:4326",t),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(i=await this.getSourceOptions_(tt.ImageStatic,i,e));const n=new qe["default"]({source:new rt["default"](i)});return this.addLayer_(n,e),n}async addLayerForLink(e){const t=At(e);if(!t)return;const r={attributions:e.getMetadata("attribution")||this.getData().getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:t},s=async(t,r)=>(this.getSourceOptions_&&(r=await this.getSourceOptions_(t,r,e)),r),i=[];switch(e.rel){case"pmtiles":const n=new We(r.url),a=await n.getHeader();let o;switch(a.tileType){case Fe.Mvt:o=new Zt(await s(tt.PMTilesVector,r));break;case Fe.Avif:case Fe.Jpeg:case Fe.Png:case Fe.Webp:o=new Nt(await s(tt.PMTilesRaster,r));break;default:return}i.push(o);break;case"tilejson":i.push(new st["default"](await s(tt.TileJSON,r)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const t in e["wms:layers"]){const n=e["wms:layers"][t]||"";let a="";Array.isArray(e["wms:styles"])&&"string"===typeof e["wms:styles"][t]&&(a=e["wms:styles"][t]);const o=Object.assign({LAYERS:n,STYLES:a},e["wms:dimensions"]);"boolean"===typeof e["wms:transparent"]&&(o.TRANSPARENT=String(e["wms:transparent"])),"string"===typeof e["type"]&&e["type"].startsWith("image/")&&(o.FORMAT=e["type"]);const l=await s(tt.TileWMS,Object.assign({},r,{params:o}));i.push(new lt["default"](l))}break;case"wmts":const l=await this.getWmtsCapabilities_(t);if(!l)return;let c=[];Array.isArray(e["wmts:layer"])?c=e["wmts:layer"]:"string"===typeof e["wmts:layer"]&&(c=[e["wmts:layer"]]);for(const t of c){let n=Object.assign({},r,{layer:t});"string"===typeof e["type"]&&e["type"].startsWith("image/")&&(n.format=e["type"]),n=await s(tt.WMTS,n);const a=(0,ct.optionsFromCapabilities)(l,n);null!==a&&i.push(new ct["default"](a))}break;case"xyz":i.push(new dt["default"](await s(tt.XYZ,r)));break;default:return}return i.map(t=>{let r;return r=t instanceof ot["default"]?new at["default"]({source:t,declutter:!0}):t instanceof Nt?new ut["default"]({source:t}):new it["default"]({source:t}),this.addLayer_(r,e),r})}async addGeoTiff_(e){if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);const t=Lt(e,this.bands_);let r={sources:[t],convertToRGB:"auto"};const s=await xt(e);s&&(r.projection=s),this.getSourceOptions_&&(r=await this.getSourceOptions_(tt.GeoTIFF,r,e));const i=new Ke["default"](r),n=new Promise((e,t)=>{i.on("error",t),i.on("change",()=>{"error"===i.getState()?t(i.getError()):e()})});try{await n;const t=new ut["default"]({source:i});return this.addLayer_(t,e),t}catch(a){if(this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);this.handleError_(a)}}async addTileLayerForImagery_(e){let t=this.buildTileUrlTemplate_(e);t instanceof Promise&&(t=await t);let r={crossOrigin:this.crossOrigin_,url:t};this.getSourceOptions_&&(r=await this.getSourceOptions_(tt.XYZ,r,e));const s=new it["default"]({source:new dt["default"](r)});return this.addLayer_(s,e),s}addLayer_(e,t=null,r=0){t&&e.set("stac",t),e.setZIndex(r),this.getLayers().push(e)}addFootprint_(){let e=null;const t=this.getData();if(e=t.isItemCollection()||t.isCollectionCollection()?(0,zt.Jx)(t.getBoundingBox()):t.toGeoJSON(),e){const r=this.createGeoJsonLayer_(e,St(this.boundsStyle_,this),this.displayFootprint_);return r.set("bounds",!0),r.on("change",()=>this.setMap_(r.getMapInternal())),this.addLayer_(r,t,1),r}return null}async addGeoJson_(e){try{const t=await this.fetch_(e.getAbsoluteUrl()),r=this.createGeoJsonLayer_(t);return this.addLayer_(r,e),r}catch(t){this.handleError_(t)}}createGeoJsonLayer_(e,t=null,r=!0){const s=new Ye.A,i=new nt["default"]({format:s,loader:(t,r,n)=>{e=(0,zt.z)(e);const a=s.readFeatures(e,{featureProjection:n});i.addFeatures(a)}});return t||(t=Tt),new y["default"]({source:i,style:t,visible:r})}async addLabelExtension_(){const e=this.getData();if(!(e instanceof gt.q7))return;let t,r=e.getAssetsWithRoles(["labels","labels-vector"],!0);r.length>1&&(t=r.find(e=>e.roles.includes("labels-vector"))),t||(t=e.getAsset("vector_labels")),t||(r=e.getAssets().filter(e=>e.type===Ht.oV&&!e.roles),1===r.length&&(t=r[0]));const s=e.getLinksWithRels(["source"]);if(t&&s.length>0){const e=s.map(async e=>{try{const t=await this.fetch_(e.getAbsoluteUrl()),r=(0,gt["default"])(t);return r}catch(t){return this.handleError_(t),null}}),t=(await Promise.all(e)).filter(e=>e instanceof gt.O7);await this.addChildren_(t,{displayFootprint:!1})}try{await this.addGeoJson_(t)}catch(i){this.handleError_(i)}}async updateLayers(e=!0){const t=this.getLayers();for(let i=t.getLength()-1;i>=0;i--){const e=t.item(i);e.get("stac")&&!e.get("bounds")&&t.removeAt(i)}const r=this.getData();if(Array.isArray(this.displayWebMapLink_)){const e=this.getWebMapLinks().map(async e=>await this.addLayerForLink(e));await Promise.all(e)}this.children_&&await this.addChildren_(this.children_,this.childrenOptions_);const s=this.getAssets();if(s){const e=s.map(async e=>{if(e)return e.type===Ht.oV?await this.addGeoJson_(e):e.isGeoTIFF()?await this.addGeoTiff_(e):e.canBrowserDisplayImage()?await this.addPreviewImage_(e):void 0});await Promise.all(e)}if(this.hasOnlyBounds())if(r instanceof gt.Ly)await this.addChildren_(r.getAll(),this.childrenOptions_);else if(r instanceof gt.O7){if(r.isItem()&&r.supportsExtension(_t)&&"vector"===r.getMetadata("label:type"))return await this.addLabelExtension_(),void(e&&this.dispatch_("layersready"));const t=this.getWebMapLinks();if(t.length>0)await this.addLayerForLink(t[0]);else{const e=r.getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);let t;if(e&&this.displayOverview_&&(t=await this.addGeoTiff_(e)),this.displayPreview_&&(!e||!t)){const e=r.getThumbnails(!0,"overview");e.length>0&&await this.addPreviewImage_(e[0])}}}e&&this.dispatch_("layersready")}hasOnlyBounds(){const e=this.getBoundsLayer(),t=this.getLayersArray().find(t=>t!==e);return"undefined"===typeof t}getWebMapLinks(){const e=this.getData();if(e instanceof gt.Vd)return[];let t=["xyz","tilejson","pmtiles","wmts","wms"];"string"===typeof this.displayWebMapLink_&&(t=[this.displayWebMapLink_]);let r=e.getLinksWithRels(t);return Array.isArray(this.displayWebMapLink_)?r=this.displayWebMapLink_.map(e=>{if("string"===typeof e){const t=r.find(t=>t.id===e);return t||null}return e}).filter(e=>!!e):r.sort((e,r)=>{const s=t.indexOf(e.rel),i=t.indexOf(r.rel);return s-i}),r}async setAssets(e,t=!0){if(e!==this.assets_){if(Array.isArray(e)){const t=this.getData();this.assets_=e.map(e=>t instanceof gt.O7&&"string"===typeof e?t.getAsset(e):e instanceof gt.Vd?e:new gt.Vd(e))}else this.assets_=null;t&&await this.updateLayers()}}async setChildren(e,t=null,r=!0){e instanceof gt.iJ?this.children_=e.getAll():(0,Xt.Gv)(e)&&"FeatureCollection"===e.type?this.children_=(0,gt["default"])(e,!this.disableMigration_).getAll():Array.isArray(e)?this.children_=e.map(e=>e instanceof gt.O7?e:(0,gt["default"])(e,!this.disableMigration_)):this.children_=null,this.children_&&0===this.children_.length&&(this.children_=null),this.children_&&(0,Xt.Gv)(t)&&(this.childrenOptions_=t),r&&await this.updateLayers()}getData(){return this.get("stac")}getChildren(){return this.children_}getAssets(){return this.assets_}getExtent(){if(!this.map_)return;const e=this.map_.getView();if(!e)return;let t;const r=this.getData();r&&(t=r.getBoundingBox());const s=this.getChildren();if(s){const e=s.map(e=>e.getBoundingBox());t=(0,zt.l6)(e)}return t?(0,Vt.DI)(t,"EPSG:4326",e.getProjection()):void 0}getLayerState(){const e=super.getLayerState();return e.extent=void 0,e}getAttributions(){const e=[],t=this.getData();if(t){const e=t.getMetadata("attribution");e&&e.push(e)}return e}getSource(){return null}async getWmtsCapabilities_(e){try{const t=new URL(e);t.searchParams.set("service","wmts"),t.searchParams.set("request","GetCapabilities");const r=await this.fetch_(t.toString(),"text");return(new ht["default"]).read(r)}catch(t){return null}}}var Yt=Jt,Kt=r(33567);const qt=wt("#ff0000",2,null);let Qt=0;var er={name:"Map",components:{BPopover:c.u,Features:()=>r.e(1953).then(r.bind(r,11953)),Items:()=>Promise.resolve().then(r.bind(r,9066)),LayerControl:a.A,TextControl:o.A},mixins:[n.A],props:{stac:{type:Object,default:null},assets:{type:Array,default:null},items:{type:Object,default:null},onfocusOnly:{type:Boolean,default:!1},popover:{type:Boolean,default:!1}},data(){return{stacLayer:null,selection:null,empty:!1,selector:null,mapId:"map-"+ ++Qt}},computed:{...(0,l.L8)(["getStac"]),container(){return this.isFullScreen?"#"+this.mapId:"#stac-browser"}},watch:{async stac(){await this.showStacLayer()},async assets(){this.stacLayer&&await this.stacLayer.setAssets(this.assets)},async items(){this.stacLayer&&(await this.stacLayer.setAssets(null,!1),await this.stacLayer.setChildren(this.items,{displayPreview:!0},!1),await this.stacLayer.updateLayers(),this.fit())},empty(e){e&&this.$emit("empty")},selection(e){!e&&this.selector&&this.selector.getFeatures().clear()}},async mounted(){await this.showStacLayer()},methods:{async showStacLayer(){this.map=null,this.stacLayer=null,await this.createMap(this.$refs.map,this.stac,this.onfocusOnly),this.stac&&await this.addStacLayer()},async addStacLayer(){let e=Object.assign({},this.stacLayerOptions,{data:this.stac,children:this.items,assets:this.assets||null,displayWebMapLink:!0,disableMigration:!0});this.stacLayer=new Yt(e),this.stacLayer.on("error",e=>{console.warn(e),this.fit()}),this.stacLayer.on("sourceready",this.fit),this.stacLayer.on("layersready",()=>{this.empty=this.stacLayer.isEmpty(),this.$emit("changed",this.getShownData())}),this.map.addLayer(this.stacLayer),this.popover&&(this.selector=new F({multi:!0,style:qt,layers:e=>{if(this.items)return!1;{const t=e.get("stac");return t&&t.isAsset()}}}),this.selector.on("select",e=>{this.selection=null,this.setTargetPosition(e.mapBrowserEvent);const t=this.selector.getFeatures();if(t.getLength()>0){const e=new Ye.A;this.selection={target:this.$refs.target,type:"features",items:t.getArray().map(t=>e.writeFeatureObject(t))}}}),this.map.addInteraction(this.selector),this.map.on("singleclick",async e=>{if(this.selection=null,this.items){this.setTargetPosition(e),this.selector.getFeatures().clear();const t=this.selector.getFeatures(),r=this.stacLayer.getData(),s=await Et(e,r,t,5);s.length>0&&(this.selection={target:this.$refs.target,type:"items",items:s})}}),this.map.on("change",()=>this.selection=null),this.map.on("movestart",()=>this.selection=null))},setTargetPosition(e){this.$refs.target.style.left=e.pixel[0]+"px",this.$refs.target.style.top=e.pixel[1]+"px"},fit(){const e=this.stacLayer.getExtent();e&&(this.map.updateSize(),this.map.getView().fit(e,{padding:[50,50,50,50],maxZoom:this.maxZoom}))},resetSelection(){this.selection=null},getShownData(){return this.stacLayer?this.stacLayer.getLayers().getArray().filter(e=>Kt.A.isLayerVisible(e)).map(e=>e.get("stac")).filter(e=>e instanceof gt.VJ):null}}},tr=er,rr=r(81656),sr=(0,rr.A)(tr,s,i,!1,null,null,null),ir=sr.exports},18056:function(e,t,r){r.r(t);var s=r(49825),i=r(27557),n=r(75332),a=r(34835),o=r(34799),l=r(22808);function c(e,t){const r=`\n    attribute vec2 ${o.eS.TEXTURE_COORD};\n    uniform mat4 ${o.gF.TILE_TRANSFORM};\n    uniform float ${o.gF.TEXTURE_PIXEL_WIDTH};\n    uniform float ${o.gF.TEXTURE_PIXEL_HEIGHT};\n    uniform float ${o.gF.TEXTURE_RESOLUTION};\n    uniform float ${o.gF.TEXTURE_ORIGIN_X};\n    uniform float ${o.gF.TEXTURE_ORIGIN_Y};\n    uniform float ${o.gF.DEPTH};\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n\n    void main() {\n      v_textureCoord = ${o.eS.TEXTURE_COORD};\n      v_mapCoord = vec2(\n        ${o.gF.TEXTURE_ORIGIN_X} + ${o.gF.TEXTURE_RESOLUTION} * ${o.gF.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],\n        ${o.gF.TEXTURE_ORIGIN_Y} - ${o.gF.TEXTURE_RESOLUTION} * ${o.gF.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]\n      );\n      gl_Position = ${o.gF.TILE_TRANSFORM} * vec4(${o.eS.TEXTURE_COORD}, ${o.gF.DEPTH}, 1.0);\n    }\n  `,n={...(0,i.z0)(),bandCount:t},l=[];if(void 0!==e.color){const t=(0,a.s2)(n,e.color,s.mE);l.push(`color = ${t};`)}if(void 0!==e.contrast){const t=(0,a.s2)(n,e.contrast,s.wl);l.push(`color.rgb = clamp((${t} + 1.0) * color.rgb - (${t} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(void 0!==e.exposure){const t=(0,a.s2)(n,e.exposure,s.wl);l.push(`color.rgb = clamp((${t} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(void 0!==e.saturation){const t=(0,a.s2)(n,e.saturation,s.wl);l.push(`\n      float saturation = ${t} + 1.0;\n      float sr = (1.0 - saturation) * 0.2126;\n      float sg = (1.0 - saturation) * 0.7152;\n      float sb = (1.0 - saturation) * 0.0722;\n      mat3 saturationMatrix = mat3(\n        sr + saturation, sr, sr,\n        sg, sg + saturation, sg,\n        sb, sb, sb + saturation\n      );\n      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n    `)}if(void 0!==e.gamma){const t=(0,a.s2)(n,e.gamma,s.wl);l.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${t}));`)}if(void 0!==e.brightness){const t=(0,a.s2)(n,e.brightness,s.wl);l.push(`color.rgb = clamp(color.rgb + ${t}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const c={},h=Object.keys(n.variables).length;if(h>1&&!e.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let s=0;s<h;++s){const t=n.variables[Object.keys(n.variables)[s]];if(!(t.name in e.variables))throw new Error(`Missing '${t.name}' in style variables`);const r=(0,i.Sl)(t.name);c[r]=function(){let r=e.variables[t.name];return"string"===typeof r&&(r=(0,i.Lm)(r)),void 0!==r?r:-9999999}}const u=Object.keys(c).map(function(e){return`uniform float ${e};`}),d=Math.ceil(t/4);u.push(`uniform sampler2D ${o.gF.TILE_TEXTURE_ARRAY}[${d}];`),n.paletteTextures&&u.push(`uniform sampler2D ${i.uZ}[${n.paletteTextures.length}];`);const g=Object.keys(n.functions).map(function(e){return n.functions[e]}),f=`\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n    uniform vec4 ${o.gF.RENDER_EXTENT};\n    uniform float ${o.gF.TRANSITION_ALPHA};\n    uniform float ${o.gF.TEXTURE_PIXEL_WIDTH};\n    uniform float ${o.gF.TEXTURE_PIXEL_HEIGHT};\n    uniform float ${o.gF.RESOLUTION};\n    uniform float ${o.gF.ZOOM};\n\n    ${u.join("\n")}\n\n    ${g.join("\n")}\n\n    void main() {\n      if (\n        v_mapCoord[0] < ${o.gF.RENDER_EXTENT}[0] ||\n        v_mapCoord[1] < ${o.gF.RENDER_EXTENT}[1] ||\n        v_mapCoord[0] > ${o.gF.RENDER_EXTENT}[2] ||\n        v_mapCoord[1] > ${o.gF.RENDER_EXTENT}[3]\n      ) {\n        discard;\n      }\n\n      vec4 color = texture2D(${o.gF.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);\n\n      ${l.join("\n")}\n\n      gl_FragColor = color;\n      gl_FragColor.rgb *= gl_FragColor.a;\n      gl_FragColor *= ${o.gF.TRANSITION_ALPHA};\n    }`;return{vertexShader:r,fragmentShader:f,uniforms:c,paletteTextures:n.paletteTextures}}class h extends l["default"]{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.styleVariables_=this.style_.variables||{},this.handleSourceUpdate_(),this.addChangeListener(n["default"].SOURCE,this.handleSourceUpdate_)}getSources(e,t){const r=this.getSource();return this.sources_?"function"===typeof this.sources_?this.sources_(e,t):this.sources_:r?[r]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache();const e=this.getSource();if(e)if("loading"===e.getState()){const t=()=>{"ready"===e.getState()&&(e.removeEventListener("change",t),this.setStyle(this.style_))};e.addEventListener("change",t)}else this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=c(this.style_,this.getSourceBandCount_());return new o.Ay(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.getCacheSize(),paletteTextures:e.paletteTextures})}renderSources(e,t){const r=this.getRenderer();let s;for(let i=0,n=t.length;i<n;++i)this.renderedSource_=t[i],r.prepareFrame(e)&&(s=r.renderFrame(e));return s}render(e,t){this.rendered=!0;const r=e.viewState,s=this.getSources(e.extent,r.resolution);let i=!0;for(let a=0,o=s.length;a<o;++a){const e=s[a],t=e.getState();if("loading"==t){const t=()=>{"ready"==e.getState()&&(e.removeEventListener("change",t),this.changed())};e.addEventListener("change",t)}i=i&&"ready"==t}const n=this.renderSources(e,s);if(this.getRenderer().renderComplete&&i)return this.renderedResolution_=r.resolution,n;if(this.renderedResolution_>.5*r.resolution){const t=this.getSources(e.extent,this.renderedResolution_).filter(e=>!s.includes(e));if(t.length>0)return this.renderSources(e,t)}return n}setStyle(e){if(this.styleVariables_=e.variables||{},this.style_=e,this.hasRenderer()){const e=c(this.style_,this.getSourceBandCount_()),t=this.getRenderer();t.reset({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,paletteTextures:e.paletteTextures}),this.changed()}}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}h.prototype.dispose,t["default"]=h},48807:function(e,t,r){r.r(t),r.d(t,{createLoader:function(){return n}});var s=r(43938),i=r(70915);function n(e){const t=e.load||s.D4,r=e.imageExtent,n=e.crossOrigin??null;return()=>{const s=new Image;return s.crossOrigin=n,t(s,e.url).then(e=>{const t=(0,i.RG)(r)/e.width,s=(0,i.Oq)(r)/e.height,n=t!==s?[t,s]:s;return{image:e,extent:r,resolution:n,pixelRatio:1}})}}},58262:function(e,t,r){r.r(t);var s=r(43938),i=r(6837),n=r(70915),a=r(38599),o=r(83440),l=r(48807);class c extends o["default"]{constructor(e){const t=void 0!==e.crossOrigin?e.crossOrigin:null,r=void 0!==e.imageLoadFunction?e.imageLoadFunction:o.defaultImageLoadFunction;super({attributions:e.attributions,interpolate:e.interpolate,projection:(0,a.Jt)(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new s.Ay(this.imageExtent_,void 0,1,(0,l.createLoader)({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(e,t)=>(this.image.setImage(e),r(this.image,t),(0,s.D4)(e))})),this.image.addEventListener(i.A.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,r,s){return(0,n.HY)(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}t["default"]=c},82728:function(e,t,r){r.r(t);var s=r(70915),i=r(61597),n=r(38599),a=r(33513),o=r(82806),l=r(40186),c=r(14465),h=r(28512),u=r(7500);class d extends h["default"]{constructor(e){e=e||{};const t=Object.assign({},e.params);super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.gutter_=void 0!==e.gutter?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=void 0===e.hidpi||e.hidpi,this.tmpExtent_=(0,s.S5)(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,r,i){const o=(0,n.Jt)(r),l=this.getProjection()||o;let c=this.getTileGrid();c||(c=this.getTileGridForProjection(l));const h=(0,n.pd)(e,o,l),d=(0,a.KQ)(l,o,e,t),g=c.getZForResolution(d,this.zDirection),f=c.getResolution(g),m=c.getTileCoordForCoordAndZ(h,g);if(c.getResolutions().length<=m[0])return;let p=c.getTileCoordExtent(m,this.tmpExtent_);const y=this.gutter_;0!==y&&(p=(0,s.r)(p,f*y,p));const _={QUERY_LAYERS:this.params_["LAYERS"]};Object.assign(_,(0,u.getRequestParams)(this.params_,"GetFeatureInfo"),i);const v=Math.floor((h[0]-p[0])/f),w=Math.floor((p[3]-h[1])/f);return _[this.v13_?"I":"X"]=v,_[this.v13_?"J":"Y"]=w,this.getRequestUrl_(m,p,1,l||o,_)}getLegendUrl(e,t){if(void 0===this.urls[0])return;const r={SERVICE:"WMS",VERSION:u.DEFAULT_VERSION,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===t||void 0===t["LAYER"]){const e=this.params_.LAYERS,t=!Array.isArray(e)||1===e.length;if(!t)return;r["LAYER"]=e}if(void 0!==e){const t=this.getProjection()?this.getProjection().getMetersPerUnit():1,s=28e-5;r["SCALE"]=e*t/s}return Object.assign(r,t),(0,c.LW)(this.urls[0],r)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,r,s,n){const a=this.urls;if(!a)return;let o;if(1==a.length)o=a[0];else{const t=(0,i.xP)((0,l.tW)(e),a.length);o=a[t]}return(0,u.getImageSrc)(t,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(e[0]),r,s,o,n,this.serverType_)}getTilePixelRatio(e){return this.hidpi_&&void 0!==this.serverType_?e:1}getKeyForParams_(){let e=0;const t=[];for(const r in this.params_)t[e++]=r+"-"+this.params_[r];return t.join("/")}setParams_(e){this.params_=e,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(e){this.setParams_(Object.assign({},e))}updateParams(e){this.setParams_(Object.assign(this.params_,e))}updateV13_(){const e=this.params_["VERSION"]||u.DEFAULT_VERSION;this.v13_=(0,o.Z)(e,"1.3")>=0}tileUrlFunction(e,t,r){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(r)),i.getResolutions().length<=e[0])return;1==t||this.hidpi_&&void 0!==this.serverType_||(t=1);const n=i.getResolution(e[0]);let a=i.getTileCoordExtent(e,this.tmpExtent_);const o=this.gutter_;0!==o&&(a=(0,s.r)(a,n*o,a));const l=Object.assign({},(0,u.getRequestParams)(this.params_,"GetMap"));return this.getRequestUrl_(e,a,t,r,l)}}t["default"]=d}}]);
//# sourceMappingURL=2610.80665b5e.js.map