"use strict";(self["webpackChunk_radiantearth_stac_browser"]=self["webpackChunk_radiantearth_stac_browser"]||[]).push([[5360,9828],{24029:function(e,t,i){var n=i(27607),o=i(40190),r=i(91110),s=i(11078),a=i(66514),l=i(70915),c=i(38599),h=i(97404),d=i(6782),u=i(14969),g=i(40186),f=i(9703),T=i(4087),p=i(96769);function S(e,t,i,n,o){return`${(0,T.v6)(e)},${t},${(0,g.dp)(i,n,o)}`}function m(e,t,i){if(!(i in e))return e[i]=new Set([t]),!0;const n=e[i],o=n.has(t);return o||n.add(t),!o}function x(e,t,i){const n=e[i];return!!n&&n.delete(t)}function _(e,t){const i=e.layerStatesArray[e.layerIndex];i.extent&&(t=(0,l._N)(t,(0,c.SD)(i.extent,e.viewState.projection)));const n=i.layer.getRenderSource();if(!n.getWrapX()){const i=n.getTileGridForProjection(e.viewState.projection).getExtent();i&&(t=(0,l._N)(t,i))}return t}class R extends p.A{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=(0,l.S5)(),this.tempTileRange_=new r.A(0,0,0,0),this.tempTileCoord_=(0,g.N)(0,0,0);const i=void 0!==t.cacheSize?t.cacheSize:512;this.tileCache_=new u.A(i),this.maxStaleKeys=.5*i}getTileCache(){return this.tileCache_}getOrCreateTile(e,t,i,n){const o=this.tileCache_,r=this.getLayer(),s=r.getSource(),a=S(s,s.getKey(),e,t,i);let l;if(o.containsKey(a))l=o.get(a);else{if(l=s.getTile(e,t,i,n.pixelRatio,n.viewState.projection),!l)return null;o.set(a,l)}return l}getTile(e,t,i,n){const o=this.getOrCreateTile(e,t,i,n);return o||null}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),r=(0,f.Bb)(t.pixelToCoordinateTransform,e.slice()),a=i.getExtent();if(a&&!(0,l.Ym)(a,r))return null;const c=t.viewState,u=i.getRenderSource(),g=u.getTileGridForProjection(c.projection),T=u.getTilePixelRatio(t.pixelRatio);for(let l=g.getZForResolution(c.resolution);l>=g.getMinZoom();--l){const e=g.getTileCoordForCoordAndZ(r,l),i=this.getTile(l,e[1],e[2],t);if(!i||i.getState()!==s.A.LOADED)continue;const a=g.getOrigin(l),f=(0,d.xq)(g.getTileSize(l)),p=g.getResolution(l);let S;if(i instanceof o.A||i instanceof h.A)S=i.getImage();else{if(!(i instanceof n.Ay))continue;if(S=(0,n.xo)(i.getData()),!S)continue}const m=Math.floor(T*((r[0]-a[0])/p-e[1]*f[0])),x=Math.floor(T*((a[1]-r[1])/p-e[2]*f[1])),_=Math.round(T*u.getGutterForProjection(c.projection));return this.getImageData(S,m+_,x+_)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const i=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==i&&(this.renderedSourceRevision_=i,this.renderedSourceKey_===t.getKey()&&this.tileCache_.clear()):this.renderedSourceRevision_=i,!0}enqueueTiles(e,t,i,n,o){const r=e.viewState,a=this.getLayer(),c=a.getRenderSource(),h=c.getTileGridForProjection(r.projection),d=(0,T.v6)(c);d in e.wantedTiles||(e.wantedTiles[d]={});const u=e.wantedTiles[d],f=a.getMapInternal(),p=Math.max(i-o,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),c.zDirection)),S=r.rotation,x=S?(0,l.Yw)(r.center,r.resolution,S,e.size):void 0;for(let l=i;l>=p;--l){const i=h.getTileRangeForExtentAndZ(t,l,this.tempTileRange_),o=h.getResolution(l);for(let t=i.minX;t<=i.maxX;++t)for(let r=i.minY;r<=i.maxY;++r){if(S&&!h.tileCoordIntersectsViewport([l,t,r],x))continue;const i=this.getTile(l,t,r,e);if(!i)continue;const a=m(n,i,l);if(!a)continue;const c=i.getKey();if(u[c]=!0,i.getState()===s.A.IDLE&&!e.tileQueue.isKeyQueued(c)){const n=(0,g.N)(l,t,r,this.tempTileCoord_);e.tileQueue.enqueue([i,d,h.getTileCoordCenter(n),o])}}}}findStaleTile_(e,t){const i=this.tileCache_,n=e[0],o=e[1],r=e[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){const e=S(this.getLayer().getSource(),a[l],n,o,r);if(i.containsKey(e)){const o=i.peek(e);if(o.getState()===s.A.LOADED)return o.endTransition((0,T.v6)(this)),m(t,o,n),!0}}return!1}findAltTiles_(e,t,i,n){const o=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!o)return!1;let r=!0;const a=this.tileCache_,l=this.getLayer().getRenderSource(),c=l.getKey();for(let h=o.minX;h<=o.maxX;++h)for(let e=o.minY;e<=o.maxY;++e){const t=S(l,c,i,h,e);let o=!1;if(a.containsKey(t)){const e=a.peek(t);e.getState()===s.A.LOADED&&(m(n,e,i),o=!0)}o||(r=!1)}return r}renderFrame(e,t){this.renderComplete=!0;const i=e.layerStatesArray[e.layerIndex],n=e.viewState,o=n.projection,r=n.resolution,h=n.center,d=e.pixelRatio,u=this.getLayer(),g=u.getSource(),p=g.getTileGridForProjection(o),S=p.getZForResolution(r,g.zDirection),m=p.getResolution(S),R=g.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==R&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=R):this.renderedSourceKey_=R;let y=e.extent;const C=g.getTilePixelRatio(d);this.prepareContainer(e,t);const A=this.context.canvas.width,v=this.context.canvas.height,w=i.extent&&(0,c.SD)(i.extent,o);w&&(y=(0,l._N)(y,(0,c.SD)(i.extent,o)));const E=m*A/2/C,j=m*v/2/C,D=[h[0]-E,h[1]-j,h[0]+E,h[1]+j],M={};this.renderedTiles.length=0;const P=u.getPreload();if(e.nextExtent){const t=p.getZForResolution(n.nextResolution,g.zDirection),i=_(e,e.nextExtent);this.enqueueTiles(e,i,t,M,P)}const K=_(e,y);if(this.enqueueTiles(e,K,S,M,0),P>0&&setTimeout(()=>{this.enqueueTiles(e,K,S-1,M,P-1)},0),!(S in M))return this.container;const I=(0,T.v6)(this),F=e.time;for(const a of M[S]){const t=a.getState();if(t===s.A.EMPTY)continue;const i=a.tileCoord;if(t===s.A.LOADED){const e=a.getAlpha(I,F);if(1===e){a.endTransition(I);continue}}t!==s.A.ERROR&&(this.renderComplete=!1);const n=this.findStaleTile_(i,M);if(n){x(M,a,S),e.animate=!0;continue}const o=this.findAltTiles_(p,i,S+1,M);if(o)continue;const r=p.getMinZoom();for(let e=S-1;e>=r;--e){const t=this.findAltTiles_(p,i,e,M);if(t)break}}const b=m/r*d/C,L=this.getRenderContext(e);(0,f.Zz)(this.tempTransform,A/2,v/2,b,b,0,-A/2,-v/2),i.extent&&this.clipUnrotated(L,e,w),g.getInterpolate()||(L.imageSmoothingEnabled=!1),this.preRender(L,e);const O=Object.keys(M).map(Number);let Z;O.sort(a.V_);const k=[],z=[];for(let a=O.length-1;a>=0;--a){const t=O[a],i=g.getTilePixelSize(t,d,o),n=p.getResolution(t),r=n/m,c=i[0]*r*b,h=i[1]*r*b,u=p.getTileCoordForCoordAndZ((0,l.Py)(D),t),T=p.getTileCoordExtent(u),S=(0,f.Bb)(this.tempTransform,[C*(T[0]-D[0])/m,C*(D[3]-T[3])/m]),x=C*g.getGutterForProjection(o);for(const o of M[t]){if(o.getState()!==s.A.LOADED)continue;const i=o.tileCoord,n=u[1]-i[1],r=Math.round(S[0]-(n-1)*c),a=u[2]-i[2],d=Math.round(S[1]-(a-1)*h),f=Math.round(S[0]-n*c),T=Math.round(S[1]-a*h),p=r-f,m=d-T,_=1===O.length;let R=!1;Z=[f,T,f+p,T,f+p,T+m,f,T+m];for(let e=0,o=k.length;e<o;++e)if(!_&&t<z[e]){const t=k[e];(0,l.HY)([f,T,f+p,T+m],[t[0],t[3],t[4],t[7]])&&(R||(L.save(),R=!0),L.beginPath(),L.moveTo(Z[0],Z[1]),L.lineTo(Z[2],Z[3]),L.lineTo(Z[4],Z[5]),L.lineTo(Z[6],Z[7]),L.moveTo(t[6],t[7]),L.lineTo(t[4],t[5]),L.lineTo(t[2],t[3]),L.lineTo(t[0],t[1]),L.clip())}k.push(Z),z.push(t),this.drawTile(o,e,f,T,p,m,x,_),R&&L.restore(),this.renderedTiles.unshift(o),this.updateUsedTiles(e.usedTiles,g,o)}}if(this.renderedResolution=m,this.extentChanged=!this.renderedExtent_||!(0,l.aI)(this.renderedExtent_,D),this.renderedExtent_=D,this.renderedPixelRatio=d,this.postRender(this.context,e),i.extent&&L.restore(),L.imageSmoothingEnabled=!0,this.renderComplete){const t=(e,t)=>{const i=(0,T.v6)(g),n=t.wantedTiles[i],o=n?Object.keys(n).length:0;this.updateCacheSize(o),this.tileCache_.expireCache()};e.postRenderFunctions.push(t)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,2*e)}drawTile(e,t,i,o,r,s,a,l){let c;if(e instanceof n.Ay){if(c=(0,n.xo)(e.getData()),!c)throw new Error("Rendering array data is not yet supported")}else c=this.getTileImage(e);if(!c)return;const h=this.getRenderContext(t),d=(0,T.v6)(this),u=t.layerStatesArray[t.layerIndex],g=u.opacity*(l?e.getAlpha(d,t.time):1),f=g!==h.globalAlpha;f&&(h.save(),h.globalAlpha=g),h.drawImage(c,a,a,c.width-2*a,c.height-2*a,i,o,r,s),f&&h.restore(),g!==u.opacity?t.animate=!0:l&&e.endTransition(d)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){const n=(0,T.v6)(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}}t.A=R},45360:function(e,t,i){i.r(t),t["default"]={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"}}}]);
//# sourceMappingURL=9828.b00fbc59.js.map