"use strict";(self["webpackChunk_radiantearth_stac_browser"]=self["webpackChunk_radiantearth_stac_browser"]||[]).push([[5544],{65544:function(e,t,r){r.r(t),r.d(t,{default:function(){return E}});var o=r(90588),n=r(11078),i=r(62703),s=r(66514),l=r(6933),a=r(70915),d=r(70587),c=r(35146),g=r(40808),h=r(13663),u=r(6782),p=r(9703),T=r(4087),f=r(73608),R=r(24029);const x={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},v={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class y extends R.A{constructor(e,t){super(e,t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=(0,p.vt)(),this.tileClipContexts_=null}drawTile(e,t,r,o,n,i,s,l){this.updateExecutorGroup_(e,t.pixelRatio,t.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,t),super.drawTile(e,t,r,o,n,i,s,l)}getTile(e,t,r,o){const n=this.getOrCreateTile(e,t,r,o);if(!n)return null;const s=o.viewState,l=s.resolution,a=o.viewHints,d=!(a[i.A.ANIMATING]||a[i.A.INTERACTING]);return!d&&n.wantedResolution||(n.wantedResolution=l),n}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,r){const o=this.getLayer(),i=o.getRevision(),s=o.getRenderOrder()||null,l=e.wantedResolution,g=e.getReplayState(o);if(!g.dirty&&g.renderedResolution===l&&g.renderedRevision==i&&g.renderedRenderOrder==s)return;const h=o.getSource(),u=!!o.getDeclutter(),p=h.getTileGrid(),R=h.getTileGridForProjection(r),x=R.getTileCoordExtent(e.wrappedTileCoord),v=h.getSourceTiles(t,r,e),y=(0,T.v6)(o);delete e.hitDetectionImageData[y],e.executorGroups[y]=[],g.dirty=!1;for(let T=0,C=v.length;T<C;++T){const r=v[T];if(r.getState()!=n.A.LOADED)continue;const i=r.tileCoord,R=p.getTileCoordExtent(i),C=(0,a._N)(x,R),S=(0,a.r)(C,o.getRenderBuffer()*l,this.tempExtent),m=(0,a.aI)(R,C)?null:S,_=new d.A(0,C,l,t),E=(0,f.j)(l,t),I=function(e,t){let r;const n=e.getStyleFunction()||o.getStyleFunction();if(n&&(r=n(e,l)),r){const o=this.renderFeature(e,E,r,_,u,t);g.dirty=g.dirty||o}},w=r.getFeatures();s&&s!==g.renderedRenderOrder&&w.sort(s);for(let e=0,t=w.length;e<t;++e){const t=w[e];m&&!(0,a.HY)(m,t.getGeometry().getExtent())||I.call(this,t,e)}const A=_.finish(),F="vector"!==o.getRenderMode()&&u&&1===v.length?null:C,b=new c.Ay(F,l,t,h.getOverlaps(),A,o.getRenderBuffer(),!0);e.executorGroups[y].push(b)}g.renderedRevision=i,g.renderedRenderOrder=s,g.renderedResolution=l}forEachFeatureAtCoordinate(e,t,r,o,n){const i=t.viewState.resolution,s=t.viewState.rotation;r=void 0==r?0:r;const l=this.getLayer(),d=l.getSource(),c=d.getTileGridForProjection(t.viewState.projection),g=(0,a.Tr)([e]);(0,a.r)(g,i*r,g);const h={},u=function(e,t,r){let i=e.getId();void 0===i&&(i=(0,T.v6)(e));const s=h[i];if(s){if(!0!==s&&r<s.distanceSq){if(0===r)return h[i]=!0,n.splice(n.lastIndexOf(s),1),o(e,l,t);s.geometry=t,s.distanceSq=r}}else{if(0===r)return h[i]=!0,o(e,l,t);n.push(h[i]={feature:e,layer:l,geometry:t,distanceSq:r,callback:o})}},p=this.renderedTiles,f=(0,T.v6)(l),R=l.getDeclutter(),x=R?t.declutter?.[R]?.all().map(e=>e.value):null;let v;e:for(let T=0,y=p.length;T<y;++T){const t=p[T],o=c.getTileCoordExtent(t.wrappedTileCoord);if(!(0,a.HY)(o,g))continue;const n=t.executorGroups[f];for(let l=0,a=n.length;l<a;++l)if(v=n[l].forEachFeatureAtCoordinate(e,i,s,r,u,x),v)break e}return v}getFeatures(e){return 0===this.renderedTiles.length?Promise.resolve([]):new Promise((t,r)=>{const o=this.getLayer(),i=o.getSource(),s=this.renderedProjection,d=s.getExtent(),c=this.renderedResolution,g=i.getTileGridForProjection(s),f=(0,p.Bb)(this.renderedPixelToCoordinateTransform_,e.slice()),R=g.getTileCoordForCoordAndResolution(f,c).toString(),x=this.renderedTiles.find(e=>e.tileCoord.toString()===R&&e.getState()===n.A.LOADED);if(!x||x.loadingSourceTiles>0)return void t([]);i.getWrapX()&&s.canWrapX()&&!(0,a.ms)(d,g.getTileCoordExtent(x.tileCoord))&&(0,l.Li)(f,s);const v=(0,T.v6)(o),y=g.getTileCoordExtent(x.wrappedTileCoord),C=(0,a.Py)(y),S=[(f[0]-C[0])/c,(C[1]-f[1])/c],m=x.getSourceTiles().reduce((e,t)=>e.concat(t.getFeatures()),[]);let _=x.hitDetectionImageData[v];if(!_){const e=(0,u.xq)(g.getTileSize(g.getZForResolution(c,i.zDirection))),t=this.renderedRotation_,r=[this.getRenderTransform(g.getTileCoordCenter(x.wrappedTileCoord),c,0,h.tF,e[0]*h.tF,e[1]*h.tF,0)];_=(0,h._7)(e,r,m,o.getStyleFunction(),g.getTileCoordExtent(x.wrappedTileCoord),x.getReplayState(o).renderedResolution,t),x.hitDetectionImageData[v]=_}t((0,h.F8)(S,m,_))})}getFeaturesInExtent(e){const t=[],r=this.getTileCache();if(0===r.getCount())return t;const o=this.getLayer().getSource(),i=o.getTileGridForProjection(this.frameState.viewState.projection),s=i.getZForResolution(this.renderedResolution),l={};return r.forEach(r=>{if(r.tileCoord[0]!==s||r.getState()!==n.A.LOADED)return;const o=r.getSourceTiles();for(let n=0,s=o.length;n<s;++n){const r=o[n],s=r.getKey();if(s in l)continue;l[s]=!0;const d=r.tileCoord;if((0,a.HY)(e,i.getTileCoordExtent(d))){const o=r.getFeatures();if(o)for(let r=0,n=o.length;r<n;++r){const n=o[r],i=n.getGeometry();(0,a.HY)(e,i.getExtent())&&t.push(n)}}}}),t}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){const r=this.context,o=r.globalAlpha;r.globalAlpha=t.opacity;const n=e.viewHints,s=!(n[i.A.ANIMATING]||n[i.A.INTERACTING]),l=[this.context.canvas.width,this.context.canvas.height],a=this.getLayer().getDeclutter(),d=a?e.declutter?.[a]:void 0,g=(0,T.v6)(this.getLayer()),h=this.renderedTiles;for(let i=0,u=h.length;i<u;++i){const t=h[i],r=t.executorGroups[g];if(r)for(let o=r.length-1;o>=0;--o)r[o].execute(this.context,l,this.getTileRenderTransform(t,e),e.viewState.rotation,s,c.$i,d)}r.globalAlpha=o}renderDeferredInternal(e){const t=this.renderedTiles,r=(0,T.v6)(this.getLayer()),o=t.reduce((e,t,o)=>(t.executorGroups[r].forEach(t=>e.push({executorGroup:t,index:o})),e),[]),n=o.map(({executorGroup:e})=>e.getDeferredZIndexContexts()),i={};for(let s=0,a=o.length;s<a;++s){const e=o[s].executorGroup.getDeferredZIndexContexts();for(const t in e)i[t]=!0}const l=Object.keys(i).map(Number).sort(s.V_);l.forEach(e=>{n.forEach((t,r)=>{t[e]&&(t[e].forEach(e=>{const{executorGroup:t,index:n}=o[r],i=t.getRenderedContext(),s=i.globalAlpha;i.globalAlpha=this.renderedOpacity_;const l=this.tileClipContexts_[n];l&&l.draw(i),e.draw(i),l&&i.restore(),i.globalAlpha=s,e.clear()}),t[e].length=0)})})}getTileRenderTransform(e,t){const r=t.pixelRatio,o=t.viewState,n=o.center,i=o.resolution,s=o.rotation,l=t.size,a=Math.round(l[0]*r),d=Math.round(l[1]*r),c=this.getLayer().getSource(),g=c.getTileGridForProjection(t.viewState.projection),h=e.tileCoord,u=g.getTileCoordExtent(e.wrappedTileCoord),T=g.getTileCoordExtent(h,this.tempExtent)[0]-u[0],f=(0,p.lw)((0,p.hs)(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(n,i,s,r,a,d,T));return f}postRender(e,t){const r=t.viewHints,o=!(r[i.A.ANIMATING]||r[i.A.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;const n=this.getLayer(),s=n.getRenderMode(),l=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;const d=n.getDeclutter(),h=d?v[s].filter(e=>!c.$i.includes(e)):v[s],u=t.viewState,p=u.rotation,f=n.getSource(),R=f.getTileGridForProjection(u.projection),x=R.getZForResolution(u.resolution,f.zDirection),y=this.renderedTiles,C=[],S=[],m=[],_=(0,T.v6)(n);let E=!0;for(let i=y.length-1;i>=0;--i){const r=y[i];E=E&&!r.getReplayState(n).dirty;const s=r.executorGroups[_].filter(e=>e.hasExecutors(h));if(0===s.length)continue;const l=this.getTileRenderTransform(r,t),c=r.tileCoord[0];let u=!1;const T=s[0].getClipCoords(l);let f,R=e;if(T){f=new g.A,R=f.getContext();for(let e=0,t=C.length;e<t;++e)if(x!==c&&c<S[e]){const t=C[e];(0,a.HY)([T[0],T[3],T[4],T[7]],[t[0],t[3],t[4],t[7]])&&(u||(R.save(),u=!0),R.beginPath(),R.moveTo(T[0],T[1]),R.lineTo(T[2],T[3]),R.lineTo(T[4],T[5]),R.lineTo(T[6],T[7]),R.moveTo(t[6],t[7]),R.lineTo(t[4],t[5]),R.lineTo(t[2],t[3]),R.lineTo(t[0],t[1]),R.clip())}C.push(T),S.push(c)}for(let n=0,i=s.length;n<i;++n){const r=s[n];r.execute(e,[e.canvas.width,e.canvas.height],l,p,o,h,t.declutter?.[d])}u&&(R===e?R.restore():m[i]=f)}e.globalAlpha=l,this.ready=E,this.tileClipContexts_=m,t.declutter||this.renderDeferredInternal(t),super.postRender(e,t)}renderFeature(e,t,r,o,n,i){if(!r)return!1;let s=!1;if(Array.isArray(r))for(let l=0,a=r.length;l<a;++l)s=(0,f.nl)(o,e,r[l],t,this.boundHandleStyleImageChange_,void 0,n,i)||s;else s=(0,f.nl)(o,e,r,t,this.boundHandleStyleImageChange_,void 0,n,i);return s}tileImageNeedsRender_(e){const t=this.getLayer();if("vector"===t.getRenderMode())return!1;const r=e.getReplayState(t),o=t.getRevision(),n=e.wantedResolution;return r.renderedTileResolution!==n||r.renderedTileRevision!==o}renderTileImage_(e,t){const r=this.getLayer(),o=e.getReplayState(r),n=r.getRevision(),i=e.executorGroups[(0,T.v6)(r)];o.renderedTileRevision=n;const s=e.wrappedTileCoord,l=s[0],a=r.getSource();let d=t.pixelRatio;const c=t.viewState,g=c.projection,h=a.getTileGridForProjection(g),u=h.getResolution(e.tileCoord[0]),f=t.pixelRatio/e.wantedResolution*u,R=h.getResolution(l),v=e.getContext();d=Math.round(Math.max(d,f/d));const y=a.getTilePixelSize(l,d,g);v.canvas.width=y[0],v.canvas.height=y[1];const C=d/f;if(1!==C){const e=(0,p.cL)(this.tmpTransform_);(0,p.hs)(e,C,C),v.setTransform.apply(v,e)}const S=h.getTileCoordExtent(s,this.tempExtent),m=f/R,_=(0,p.cL)(this.tmpTransform_);(0,p.hs)(_,m,-m),(0,p.Tl)(_,-S[0],-S[3]);for(let p=0,T=i.length;p<T;++p){const e=i[p];e.execute(v,[v.canvas.width*C,v.canvas.height*C],_,0,!0,x[r.getRenderMode()],null)}o.renderedTileResolution=e.wantedResolution}}var C=y,S=r(8055),m=r(45360);class _ extends S["default"]{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload;const r=void 0===e.cacheSize?0:e.cacheSize;delete e.cacheSize,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=r;const n=e.renderMode||"hybrid";(0,o.v)("hybrid"==n||"vector"==n,"`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=n,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError),this.getBackground,this.setBackground}createRenderer(){return new C(this,{cacheSize:this.cacheSize_})}getFeatures(e){return super.getFeatures(e)}getFeaturesInExtent(e){return this.getRenderer().getFeaturesInExtent(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(m["default"].PRELOAD)}getUseInterimTilesOnError(){return this.get(m["default"].USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(m["default"].PRELOAD,e)}setUseInterimTilesOnError(e){this.set(m["default"].USE_INTERIM_TILES_ON_ERROR,e)}}var E=_}}]);
//# sourceMappingURL=5544.025b8c21.js.map