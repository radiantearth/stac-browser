"use strict";(self["webpackChunk_radiantearth_stac_browser"]=self["webpackChunk_radiantearth_stac_browser"]||[]).push([[2410,8290],{33897:function(t,e,i){i.r(e),i.d(e,{default:function(){return f}});var a=function(){var t=this,e=t._self._c;return e("main",{staticClass:"search d-flex flex-column"},[t.parent?t.searchLink?e("b-row",[e("b-col",{staticClass:"left"},[e("b-tabs",{model:{value:t.activeSearch,callback:function(e){t.activeSearch=e},expression:"activeSearch"}},[t.collectionSearch?e("b-tab",{attrs:{title:t.$t("search.tabs.collections")}},[e("SearchFilter",{attrs:{parent:t.parent,title:"",value:t.collectionFilters,type:"Collections"},on:{input:t.setFilters}})],1):t._e(),t.itemSearch?e("b-tab",{attrs:{title:t.$t("search.tabs.items")}},[e("SearchFilter",{attrs:{parent:t.parent,title:"",value:t.itemFilters,type:"Global"},on:{input:t.setFilters}})],1):t._e()],1)],1),e("b-col",{staticClass:"right"},[t.loading?e("Loading",{attrs:{fill:"",top:""}}):t.error?e("b-alert",{attrs:{variant:"error",show:""}},[t._v(t._s(t.error))]):null===t.data?e("b-alert",{attrs:{variant:"info",show:""}},[t._v(t._s(t.$t("search.modifyCriteria")))]):0===t.results.length&&t.noFurtherItems?e("b-alert",{attrs:{variant:"info",show:""}},[t._v(t._s(t.$t("search.noFurtherItemsFound")))]):0===t.results.length?e("b-alert",{attrs:{variant:"warning",show:""}},[t._v(t._s(t.$t("search.noItemsFound")))]):[t.itemCollection?e("div",{attrs:{id:"search-map"}},[e("Map",{attrs:{stac:t.parent,items:t.itemCollection,onfocusOnly:"",popover:""}})],1):t._e(),t.isCollectionSearch?e("Catalogs",{attrs:{catalogs:t.results,collectionsOnly:"",pagination:t.pagination,loading:t.loading,count:t.totalCount,apiFilters:t.collectionFilters},on:{paginate:t.loadResults},scopedSlots:t._u([{key:"catalogFooter",fn:function(i){return[t.itemSearch||t.canFilterItems(i.data)?e("b-button-group",{attrs:{vertical:"",size:"sm"}},[t.itemSearch?e("b-button",{attrs:{variant:"outline-primary",pressed:t.selectedCollections[i.data.id]},on:{click:function(e){return t.selectForItemSearch(i.data)}}},[t.selectedCollections[i.data.id]?e("b-icon-check-square"):e("b-icon-square"),e("span",{staticClass:"ml-2"},[t._v(t._s(t.$t("search.selectForItemSearch")))])],1):t._e(),e("StacLink",{attrs:{button:{variant:"outline-primary",disabled:!t.canFilterItems(i.data)},data:i.data,title:t.$t("search.filterCollection"),state:{itemFilterOpen:1}}})],1):t._e()]}}],null,!1,970447694)}):e("Items",{attrs:{stac:t.parent,items:t.results,api:!0,allowFilter:!1,pagination:t.pagination,loading:t.loading,count:t.totalCount,apiFilters:t.itemFilters},on:{paginate:t.loadResults}})]],2)],1):e("b-alert",{attrs:{variant:"danger",show:""}},[t._v(t._s(t.$t("search.notSupported")))]):e("Loading",{attrs:{stretch:""}}),t.selectedCollectionCount>0?e("b-alert",{staticClass:"selected-collections-action",attrs:{show:"",variant:"dark"}},[e("b-button",{attrs:{variant:"primary",size:"lg"},on:{click:t.openItemSearch}},[t._v(" "+t._s(t.$tc("search.useInItemSearch",t.selectedCollectionCount,{count:t.selectedCollectionCount}))+" ")])],1):t._e()],1)},s=[],r=(i(18111),i(22489),i(61701),i(95353)),l=i(2566),n=i(28383),o=i(39773),c=i(31831),h=i(40221),u=i(82948),d=i(63405),p=i(95050),m=i(33484),g={name:"Search",components:{BIconCheckSquare:u.z68,BIconSquare:u.Hcz,BTab:d.a,BTabs:p.r,Catalogs:()=>Promise.resolve().then(i.bind(i,64111)),Loading:o.A,Items:()=>Promise.resolve().then(i.bind(i,58224)),Map:()=>Promise.all([i.e(4421),i.e(6758),i.e(8843),i.e(3918),i.e(4835),i.e(2615),i.e(702),i.e(9828),i.e(7500),i.e(180),i.e(3252),i.e(5255),i.e(5544),i.e(6181),i.e(8056),i.e(6307),i.e(4941)]).then(i.bind(i,96307)),SearchFilter:n["default"],StacLink:()=>Promise.resolve().then(i.bind(i,18268))},props:{loadParent:{type:String,default:null}},data(){return{parent:null,error:null,link:null,loading:!1,data:null,itemFilters:{},collectionFilters:{},activeSearch:0,selectedCollections:{}}},computed:{...(0,r.aH)(["catalogUrl","catalogTitle","itemsPerPage"]),...(0,r.L8)(["canSearchItems","canSearchCollections","getStac","root","collectionLink","parentLink","fromBrowserPath","toBrowserPath"]),selectedCollectionCount(){return l.Ay.size(this.selectedCollections)},totalCount(){return"number"===typeof this.data.numberMatched?this.data.numberMatched:null},searchLink(){return this.isCollectionSearch?this.collectionSearch:this.itemSearch},collectionSearch(){return this.canSearchCollections&&this.parent&&this.parent.getApiCollectionsLink()},itemSearch(){return this.canSearchItems&&this.parent&&this.parent.getSearchLink()},itemCollection(){return this.isCollectionSearch?null:{type:"FeatureCollection",features:this.results,links:[]}},results(){if(0===l.Ay.size(this.data))return[];let t=this.isCollectionSearch?this.data.collections:this.data.features,e=this.isCollectionSearch?"Collection":"Feature";return Array.isArray(t)?t.map(t=>{try{if(!l.Ay.isObject(t)||t.type!==e)return null;let i,a=l.Ay.getLinkWithRel(t.links,"self");null!==a&&void 0!==a&&a.href&&(i=l.Ay.toAbsolute(a.href,this.link.href));let s=(0,c.wc)(t,i,this.toBrowserPath(i));return s=(0,m.Pj)(this.$store.state,s),s}catch(i){return console.error(i),null}}).filter(t=>t instanceof h.O7):[]},pagination(){return l.Ay.getPaginationLinks(this.data)},filters(){return this.isCollectionSearch?this.collectionFilters:this.itemFilters},isCollectionSearch(){return this.collectionSearch&&0===this.activeSearch},pageDescription(){let t=(0,c.Jd)([this.collectionLink,this.parentLink,this.root],this.catalogTitle);return this.$t("search.metaDescription",{title:t})},noFurtherItems(){return this.link&&"next"===this.link.rel}},watch:{activeSearch(){this.data=null},searchLink:{immediate:!0,handler(){this.searchLink&&this.showPage()}}},async created(){let t=this.catalogUrl;this.loadParent?(t=this.fromBrowserPath(this.loadParent),this.parent=this.getStac(t)):this.parent=this.root,this.parent||(await this.$store.dispatch("load",{url:t}),this.root||await this.$store.dispatch("config",{catalogUrl:t}),this.parent=this.getStac(t),this.showPage()),this.$root.$on("uiLanguageChanged",()=>{this.$store.commit("setPageMetadata",{title:this.$t("search.title"),description:this.pageDescription})})},methods:{openItemSearch(){this.$set(this.itemFilters,"collections",Object.keys(this.selectedCollections)),this.activeSearch=1,this.selectedCollections={}},selectForItemSearch(t){this.selectedCollections[t.id]?this.$delete(this.selectedCollections,t.id):this.$set(this.selectedCollections,t.id,!0)},canFilterItems(t){return t instanceof h.O7&&Boolean(t.getApiItemsLink())},async loadResults(t){this.error=null,this.loading=!0;try{this.link=l.Ay.addFiltersToLink(t,this.filters,this.itemsPerPage);let e=this.isCollectionSearch?"collections":"features",i=await(0,m.FF)(this.$store,this.link);i&&this.showPage(i.config.url),l.Ay.isObject(i.data)&&Array.isArray(i.data[e])?this.data=i.data:(this.data={},this.error=this.$t(this.isCollectionSearch?"errors.invalidStacCollections":"errors.invalidStacItems"))}catch(e){this.data={},this.error=e.message}finally{this.loading=!1}},async setFilters(t,e=!1){this.isCollectionSearch?this.collectionFilters=t:this.itemFilters=t,e?this.data=null:await this.loadResults(this.searchLink)},showPage(t){this.$store.commit("showPage",{title:this.$t("search.title"),description:this.pageDescription,url:t})}}},C=g,S=i(81656),b=(0,S.A)(C,a,s,!1,null,null,null),f=b.exports}}]);
//# sourceMappingURL=8290.552d404b.js.map