"use strict";(self["webpackChunk_radiantearth_stac_browser"]=self["webpackChunk_radiantearth_stac_browser"]||[]).push([[107,372,2192,3440,3820,6017],{4863:function(e,t,i){i.d(t,{EN:function(){return c},Li:function(){return h},kZ:function(){return _},pr:function(){return l}});var s=i(70915),n=i(38599),r=i(6782),o=i(56758),a=i(57115);function l(e){let t=e.getDefaultTileGrid();return t||(t=g(e),e.setDefaultTileGrid(t)),t}function h(e,t,i){const n=t[0],r=e.getTileCoordCenter(t),o=_(i);if(!(0,s.Ym)(o,r)){const t=(0,s.RG)(o),i=Math.ceil((o[0]-r[0])/t);return r[0]+=t*i,e.getTileCoordForCoordAndZ(r,n)}return t}function u(e,t,i,n){n=void 0!==n?n:"top-left";const r=d(e,t,i);return new o.A({extent:e,origin:(0,s.qF)(e,n),resolutions:r,tileSize:i})}function c(e){const t=e||{},i=t.extent||(0,n.Jt)("EPSG:3857").getExtent(),s={extent:i,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:d(i,t.maxZoom,t.tileSize,t.maxResolution)};return new o.A(s)}function d(e,t,i,n){t=void 0!==t?t:a.L,i=(0,r.xq)(void 0!==i?i:a.R);const o=(0,s.Oq)(e),l=(0,s.RG)(e);n=n>0?n:Math.max(l/i[0],o/i[1]);const h=t+1,u=new Array(h);for(let s=0;s<h;++s)u[s]=n/Math.pow(2,s);return u}function g(e,t,i,s){const n=_(e);return u(n,t,i,s)}function _(e){e=(0,n.Jt)(e);let t=e.getExtent();if(!t){const i=180*n.Ig.degrees/e.getMetersPerUnit();t=(0,s.N)(-i,-i,i,i)}return t}},14969:function(e,t,i){var s=i(90025),n=i(90588);class r{constructor(e){this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof s.A&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){while(this.canExpireCache())this.deleteOldest()}clear(){while(this.oldest_)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;while(t)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return(0,n.v)(void 0!==i,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return(0,n.v)(void 0!==t,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t,i=0;for(t=this.newest_;t;t=t.older)e[i++]=t.key_;return e}getValues(){const e=new Array(this.count_);let t,i=0;for(t=this.newest_;t;t=t.older)e[i++]=t.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){(0,n.v)(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}t.A=r},22808:function(e,t,i){i.r(t);var s=i(60764),n=i(45360);class r extends s["default"]{constructor(e){e=e||{};const t=Object.assign({},e),i=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(void 0!==e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(n["default"].PRELOAD)}setPreload(e){this.set(n["default"].PRELOAD,e)}getUseInterimTilesOnError(){return this.get(n["default"].USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(n["default"].USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}t["default"]=r},27607:function(e,t,i){i.d(t,{$r:function(){return u},bL:function(){return a},xo:function(){return o}});var s=i(8143),n=i(11078),r=i(68711);function o(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}function a(e){return e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e instanceof DataView?e:null}const l=new Error("disposed");let h=null;function u(e){h||(h=(0,r.Y)(e.width,e.height,void 0,{willReadFrequently:!0}));const t=h.canvas,i=e.width;t.width!==i&&(t.width=i);const s=e.height;return t.height!==s&&(t.height=s),h.clearRect(0,0,i,s),h.drawImage(e,0,0),h.getImageData(0,0,i,s).data}const c=[256,256];class d extends s.A{constructor(e){const t=n.A.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=o(this.data_);return e?[e.width,e.height]:c}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==n.A.IDLE&&this.state!==n.A.ERROR)return;this.state=n.A.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=n.A.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=n.A.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(l),this.controller_=null),super.disposeInternal()}}t.Ay=d},30945:function(e,t,i){i.r(t);var s=i(24029),n=i(22808);class r extends n["default"]{constructor(e){super(e)}createRenderer(){return new s.A(this,{cacheSize:this.getCacheSize()})}}t["default"]=r},34889:function(e,t,i){function s(e){return Array.isArray(e)?Math.min(...e):e}i.d(t,{m:function(){return s}})},42192:function(e,t,i){i.r(t),i.d(t,{DECIMALS:function(){return n},DEFAULT_WMS_VERSION:function(){return s}});const s="1.3.0",n=4},53820:function(e,t,i){i.r(t);var s=i(69796),n=i(70107);class r extends n["default"]{constructor(e){super(e)}createRenderer(){return new s.A(this)}getData(e){return super.getData(e)}}t["default"]=r},66017:function(e,t,i){i.r(t),i.d(t,{TileSourceEvent:function(){return u}});var s=i(1685),n=i(6782),r=i(40186),o=i(4863),a=i(4087),l=i(16444);class h extends l["default"]{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1,this.tileGrid=void 0!==e.tileGrid?e.tileGrid:null;const t=[256,256];this.tileGrid&&(0,n.xq)(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||(0,a.v6)(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,s,n){return(0,a.b0)()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:(0,o.pr)(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const s=this.getTileGridForProjection(i),r=this.getTilePixelRatio(t),o=(0,n.xq)(s.getTileSize(e),this.tmpSize);return 1==r?o:(0,n.hs)(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){const i=void 0!==t?t:this.getProjection(),s=void 0!==t?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(e=(0,o.Li)(s,e,i)),(0,r.N5)(e,s)?e:null}clear(){}refresh(){this.clear(),super.refresh()}}class u extends s.Ay{constructor(e,t){super(e),this.tile=t}}t["default"]=h},67238:function(e,t,i){var s=i(43938),n=i(6141);class r extends s.Ay{constructor(e,t,i,s,r){const o=void 0!==r?n.A.IDLE:n.A.LOADED;super(e,t,i,o),this.loader_=void 0!==r?r:null,this.canvas_=s,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=n.A.ERROR):this.state=n.A.LOADED,this.changed()}load(){this.state==n.A.IDLE&&(this.state=n.A.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}t.A=r},69796:function(e,t,i){var s=i(6141),n=i(62703),r=i(70915),o=i(38599),a=i(9703),l=i(96769);class h extends l.A{constructor(e){super(e),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],i=e.pixelRatio,a=e.viewState,l=a.resolution,h=this.getLayer().getSource(),u=e.viewHints;let c=e.extent;if(void 0!==t.extent&&(c=(0,r._N)(c,(0,o.SD)(t.extent,a.projection))),!u[n.A.ANIMATING]&&!u[n.A.INTERACTING]&&!(0,r.Im)(c))if(h){const e=a.projection,t=h.getImage(c,l,i,e);t&&(this.loadImage(t)?this.image=t:t.getState()===s.A.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),s=(0,a.Bb)(t.pixelToCoordinateTransform,e.slice()),n=i.getExtent();if(n&&!(0,r.Ym)(n,s))return null;const o=this.image.getExtent(),l=this.image.getImage(),h=(0,r.RG)(o),u=Math.floor(l.width*((s[0]-o[0])/h));if(u<0||u>=l.width)return null;const c=(0,r.Oq)(o),d=Math.floor(l.height*((o[3]-s[1])/c));return d<0||d>=l.height?null:this.getImageData(l,u,d)}renderFrame(e,t){const i=this.image,s=i.getExtent(),n=i.getResolution(),[l,h]=Array.isArray(n)?n:[n,n],u=i.getPixelRatio(),c=e.layerStatesArray[e.layerIndex],d=e.pixelRatio,g=e.viewState,_=g.center,f=g.resolution,p=d*l/(f*u),m=d*h/(f*u);this.prepareContainer(e,t);const w=this.context.canvas.width,A=this.context.canvas.height,I=this.getRenderContext(e);let R=!1,v=!0;if(c.extent){const t=(0,o.SD)(c.extent,g.projection);v=(0,r.HY)(t,e.extent),R=v&&!(0,r.ms)(t,e.extent),R&&this.clipUnrotated(I,e,t)}const E=i.getImage(),x=(0,a.Zz)(this.tempTransform,w/2,A/2,p,m,0,u*(s[0]-_[0])/l,u*(_[1]-s[3])/h);this.renderedResolution=h*d/u;const y=E.width*x[0],S=E.height*x[3];if(this.getLayer().getSource().getInterpolate()||(I.imageSmoothingEnabled=!1),this.preRender(I,e),v&&y>=.5&&S>=.5){const e=x[4],t=x[5],i=c.opacity;1!==i&&(I.save(),I.globalAlpha=i),I.drawImage(E,0,0,+E.width,+E.height,e,t,y,S),1!==i&&I.restore()}return this.postRender(this.context,e),R&&I.restore(),I.imageSmoothingEnabled=!0,this.container}}t.A=h},70107:function(e,t,i){i.r(t);var s=i(60764);class n extends s["default"]{constructor(e){e=e||{},super(e)}}t["default"]=n},83440:function(e,t,i){i.r(t),i.d(t,{ImageSourceEvent:function(){return R},ImageSourceEventType:function(){return I},default:function(){return y},defaultImageLoadFunction:function(){return E},getRequestExtent:function(){return x}});var s=i(43938),n=i(6141),r=i(66514),o=i(1685),a=i(6837),l=i(70915),h=i(61597),u=i(38599),c=i(9438),d=i(33513),g=i(34889),_=i(52913),f=i(93101);class p extends s.Ay{constructor(e,t,i,s,r,o,a){let h=e.getExtent();h&&e.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);let u=t.getExtent();u&&t.canWrapX()&&(u=u.slice(),u[0]=-1/0,u[2]=1/0);const c=u?(0,l._N)(i,u):i,g=(0,l.q1)(c),p=(0,d.KQ)(e,t,g,s),m=f.l,w=new _.A(e,t,c,h,p*m,s),A=w.calculateSourceExtent(),I=(0,l.Im)(A)?null:o(A,p,r),R=I?n.A.IDLE:n.A.EMPTY,v=I?I.getPixelRatio():1;super(i,s,v,R),this.targetProj_=t,this.maxSourceExtent_=h,this.triangulation_=w,this.targetResolution_=s,this.targetExtent_=i,this.sourceImage_=I,this.sourcePixelRatio_=v,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==n.A.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==n.A.LOADED){const e=(0,l.RG)(this.targetExtent_)/this.targetResolution_,t=(0,l.Oq)(this.targetExtent_)/this.targetResolution_;this.canvas_=(0,d.XX)(e,t,this.sourcePixelRatio_,(0,g.m)(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==n.A.IDLE){this.state=n.A.LOADING,this.changed();const e=this.sourceImage_.getState();e==n.A.LOADED||e==n.A.ERROR?this.reproject_():(this.sourceListenerKey_=(0,c.KT)(this.sourceImage_,a.A.CHANGE,e=>{const t=this.sourceImage_.getState();t!=n.A.LOADED&&t!=n.A.ERROR||(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){(0,c.JH)(this.sourceListenerKey_),this.sourceListenerKey_=null}}var m=p,w=i(16444),A=i(42192);const I={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class R extends o.Ay{constructor(e,t){super(e),this.image=t}}class v extends w["default"]{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:void 0===e.interpolate||e.interpolate}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=void 0!==e.resolutions?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=!!e.loader&&0===e.loader.length,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const i=(0,r.FT)(t,e,0);e=t[i]}return e}getImage(e,t,i,s){const n=this.getProjection();if(!n||!s||(0,u.tI)(n,s))return n&&(s=n),this.getImageInternal(e,t,i,s);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&(0,u.tI)(this.reprojectedImage_.getProjection(),s)&&this.reprojectedImage_.getResolution()==t&&(0,l.aI)(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new m(n,s,e,t,i,(e,t,i)=>this.getImageInternal(e,t,i,n),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,i,n){if(this.loader){const r=x(e,t,i,1),o=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===n&&(this.wantedExtent_&&(0,l.ms)(this.wantedExtent_,r)||(0,l.ms)(this.image.getExtent(),r))&&(this.wantedResolution_&&(0,g.m)(this.wantedResolution_)===o||(0,g.m)(this.image.getResolution())===o)))return this.image;this.wantedProjection_=n,this.wantedExtent_=r,this.wantedResolution_=o,this.image=new s.Ay(r,o,i,this.loader),this.image.addEventListener(a.A.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let i;switch(t.getState()){case n.A.LOADING:this.loading=!0,i=I.IMAGELOADSTART;break;case n.A.LOADED:this.loading=!1,i=I.IMAGELOADEND;break;case n.A.ERROR:this.loading=!1,i=I.IMAGELOADERROR;break;default:return}this.hasListener(i)&&this.dispatchEvent(new R(i,t))}}function E(e,t){e.getImage().src=t}function x(e,t,i,s){const n=t/i,r=(0,l.q1)(e),o=(0,h.mk)((0,l.RG)(e)/n,A.DECIMALS),a=(0,h.mk)((0,l.Oq)(e)/n,A.DECIMALS),u=(0,h.mk)((s-1)*o/2,A.DECIMALS),c=o+2*u,d=(0,h.mk)((s-1)*a/2,A.DECIMALS),g=a+2*d;return(0,l.Bg)(r,n,0,[c,g])}var y=v},90024:function(e,t,i){i.r(t),i.d(t,{Processor:function(){return R},RasterSourceEvent:function(){return E}});var s=i(90025),n=i(67238),r=i(44335),o=i(68711),a=i(1685),l=i(6837),h=i(70915),u=i(53820),c=i(30945),d=i(9703),g=i(4087),_=i(83440),f=i(16444),p=i(66017),m=i(48287)["Buffer"];function w(e){return function(t){const i=t["buffers"],s=t["meta"],n=t["imageOps"],r=t["width"],o=t["height"],a=i.length,l=i[0].byteLength;if(n){const t=new Array(a);for(let e=0;e<a;++e)t[e]=new ImageData(new Uint8ClampedArray(i[e]),r,o);const n=e(t,s).data;return n.buffer}const h=new Uint8ClampedArray(l),u=new Array(a),c=new Array(a);for(let e=0;e<a;++e)u[e]=new Uint8ClampedArray(i[e]),c[e]=[0,0,0,0];for(let d=0;d<l;d+=4){for(let e=0;e<a;++e){const t=u[e];c[e][0]=t[d],c[e][1]=t[d+1],c[e][2]=t[d+2],c[e][3]=t[d+3]}const t=e(c,s);h[d]=t[0],h[d+1]=t[1],h[d+2]=t[2],h[d+3]=t[3]}return h.buffer}}function A(e,t){const i=Object.keys(e.lib||{}).map(function(t){return"const "+t+" = "+e.lib[t].toString()+";"}),s=i.concat(["const __minion__ = ("+w.toString()+")(",e.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),n=new Worker("undefined"===typeof Blob?"data:text/javascript;base64,"+m.from(s.join("\n"),"binary").toString("base64"):URL.createObjectURL(new Blob(s,{type:"text/javascript"})));return n.addEventListener("message",t),n}function I(e,t){const i=w(e.operation);let s=!1;return{postMessage:function(e){setTimeout(function(){s||t({data:{buffer:i(e),meta:e["meta"]}})},0)},terminate:function(){s=!0}}}class R extends s.A{constructor(e){let t;super(),this.imageOps_=!!e.imageOps,t=0===e.threads?0:this.imageOps_?1:e.threads||1;const i=new Array(t);if(t)for(let s=0;s<t;++s)i[s]=A(e,this.onWorkerMessage_.bind(this,s));else i[0]=I(e,this.onWorkerMessage_.bind(this,0));this.workers_=i,this.queue_=[],this.maxQueueLength_=e.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(e,t,i){this.enqueue_({inputs:e,meta:t,callback:i}),this.dispatch_()}enqueue_(e){this.queue_.push(e);while(this.queue_.length>this.maxQueueLength_)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||0===this.queue_.length)return;const e=this.queue_.shift();this.job_=e;const t=e.inputs[0].width,i=e.inputs[0].height,s=e.inputs.map(function(e){return e.data.buffer}),n=this.workers_.length;if(this.running_=n,1===n)return void this.workers_[0].postMessage({buffers:s,meta:e.meta,imageOps:this.imageOps_,width:t,height:i},s);const r=e.inputs[0].data.length,o=4*Math.ceil(r/4/n);for(let a=0;a<n;++a){const n=a*o,r=[];for(let e=0,t=s.length;e<t;++e)r.push(s[e].slice(n,n+o));this.workers_[a].postMessage({buffers:r,meta:e.meta,imageOps:this.imageOps_,width:t,height:i},r)}}onWorkerMessage_(e,t){this.disposed||(this.dataLookup_[e]=t.data,--this.running_,0===this.running_&&this.resolveJob_())}resolveJob_(){const e=this.job_,t=this.workers_.length;let i,s;if(1===t)i=new Uint8ClampedArray(this.dataLookup_[0]["buffer"]),s=this.dataLookup_[0]["meta"];else{const n=e.inputs[0].data.length;i=new Uint8ClampedArray(n),s=new Array(t);const r=4*Math.ceil(n/4/t);for(let e=0;e<t;++e){const t=this.dataLookup_[e]["buffer"],n=e*r;i.set(new Uint8ClampedArray(t),n),s[e]=this.dataLookup_[e]["meta"]}}this.job_=null,this.dataLookup_={},e.callback(null,new ImageData(i,e.inputs[0].width,e.inputs[0].height),s),this.dispatch_()}disposeInternal(){for(let e=0;e<this.workers_.length;++e)this.workers_[e].terminate();this.workers_.length=0}}const v={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class E extends a.Ay{constructor(e,t,i){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=i}}class x extends _["default"]{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=void 0!==e.operationType?e.operationType:"pixel",this.threads_=void 0!==e.threads?e.threads:1,this.layers_=b(e.sources);const t=this.changed.bind(this);for(let i=0,s=this.layers_.length;i<s;++i)this.layers_[i].addEventListener(l.A.CHANGE,t);this.useResolutions_=null!==e.resolutions,this.tileQueue_=new r.A(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:(0,d.vt)(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:O(this.layers_),pixelRatio:1,pixelToCoordinateTransform:(0,d.vt)(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:(0,g.v6)(this),renderTargets:{}},this.setAttributions(function(t){const i=[];for(let s=0,n=e.sources.length;s<n;++s){const n=e.sources[s],r=n instanceof f["default"]?n:n.getSource();if(!r)continue;const o=r.getAttributions()?.(t);"string"===typeof o?i.push(o):void 0!==o&&i.push(...o)}return i}),void 0!==e.operation&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new R({operation:e,imageOps:"image"===this.operationType_,queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,i){const s=Object.assign({},this.frameState_);s.viewState=Object.assign({},s.viewState);const n=(0,h.q1)(e);s.size[0]=Math.ceil((0,h.RG)(e)/t),s.size[1]=Math.ceil((0,h.Oq)(e)/t),s.extent=[n[0]-s.size[0]*t/2,n[1]-s.size[1]*t/2,n[0]+s.size[0]*t/2,n[1]+s.size[1]*t/2],s.time=Date.now();const r=s.viewState;return r.center=n,r.projection=i,r.resolution=t,s}allSourcesReady_(){let e,t=!0;for(let i=0,s=this.layers_.length;i<s;++i)if(e=this.layers_[i].getSource(),!e||"ready"!==e.getState()){t=!1;break}return t}getImage(e,t,i,s){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const n=this.updateFrameState_(e,t,s);if(this.requestedFrameState_=n,this.renderedImageCanvas_){const e=this.renderedImageCanvas_.getResolution(),i=this.renderedImageCanvas_.getExtent();t===e&&(0,h.aI)(n.extent,i)||(this.renderedImageCanvas_=null)}return this.renderedImageCanvas_&&this.getRevision()===this.renderedRevision_||this.processSources_(),n.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,i=new Array(t);for(let n=0;n<t;++n){e.layerIndex=n,e.renderTargets={};const t=S(this.layers_[n],e);if(!t)return;i[n]=t}const s={};this.dispatchEvent(new E(v.BEFOREOPERATIONS,e,s)),this.processor_.process(i,s,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,i,s){if(t||!i)return;const r=e.extent,a=e.viewState.resolution;if(a!==this.requestedFrameState_.viewState.resolution||!(0,h.aI)(r,this.requestedFrameState_.extent))return;let l;if(this.renderedImageCanvas_)l=this.renderedImageCanvas_.getImage().getContext("2d");else{const e=Math.round((0,h.RG)(r)/a),t=Math.round((0,h.Oq)(r)/a);l=(0,o.Y)(e,t),this.renderedImageCanvas_=new n.A(r,a,1,l.canvas)}l.putImageData(i,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new E(v.AFTEROPERATIONS,e,s))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let i=0,s=this.layers_.length;i<s;++i){const s=this.layers_[i].getSource();if(t=s.getResolutions(e),t)break}return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}x.prototype.dispose;let y=null;function S(e,t){const i=e.getRenderer();if(!i)throw new Error("Unsupported layer type: "+e);if(!i.prepareFrame(t))return null;const s=t.size[0],n=t.size[1];if(0===s||0===n)return null;const r=i.renderFrame(t,null);let a;if(r instanceof HTMLCanvasElement)a=r;else{if(r&&(a=r.firstElementChild),!(a instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+a);if(a.width===s&&a.height===n){const e=a.getContext("2d");return e.getImageData(0,0,s,n)}}if(y){const e=y.canvas;e.width!==s||e.height!==n?y=(0,o.Y)(s,n,void 0,{willReadFrequently:!0}):y.clearRect(0,0,s,n)}else y=(0,o.Y)(s,n,void 0,{willReadFrequently:!0});return y.drawImage(a,0,0,s,n),y.getImageData(0,0,s,n)}function O(e){return e.map(function(e){return e.getLayerState()})}function b(e){const t=e.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=L(e[s]);return i}function L(e){let t;return e instanceof f["default"]?e instanceof p["default"]?t=new c["default"]({source:e}):e instanceof _["default"]&&(t=new u["default"]({source:e})):t=e,t}t["default"]=x}}]);
//# sourceMappingURL=372.b1868bc2.js.map