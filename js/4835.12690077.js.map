{"version":3,"file":"js/4835.12690077.js","mappings":"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","sources":["webpack://@radiantearth/stac-browser/./node_modules/ol/DataTile.js","webpack://@radiantearth/stac-browser/./node_modules/ol/webgl/PaletteTexture.js","webpack://@radiantearth/stac-browser/./node_modules/ol/expr/gpu.js","webpack://@radiantearth/stac-browser/./node_modules/ol/render/webgl/compileUtil.js","webpack://@radiantearth/stac-browser/./node_modules/ol/renderer/webgl/Layer.js","webpack://@radiantearth/stac-browser/./node_modules/ol/webgl/TileTexture.js","webpack://@radiantearth/stac-browser/./node_modules/ol/renderer/webgl/TileLayer.js","webpack://@radiantearth/stac-browser/./node_modules/ol/renderer/webgl/TileLayerBase.js","webpack://@radiantearth/stac-browser/./node_modules/ol/structs/LRUCache.js","webpack://@radiantearth/stac-browser/./node_modules/ol/vec/mat4.js","webpack://@radiantearth/stac-browser/./node_modules/ol/webgl.js","webpack://@radiantearth/stac-browser/./node_modules/ol/webgl/BaseTileRepresentation.js","webpack://@radiantearth/stac-browser/./node_modules/ol/webgl/Buffer.js","webpack://@radiantearth/stac-browser/./node_modules/ol/webgl/ContextEventType.js","webpack://@radiantearth/stac-browser/./node_modules/ol/webgl/PostProcessingPass.js","webpack://@radiantearth/stac-browser/./node_modules/ol/webgl/Helper.js"],"sourcesContent":["/**\n * @module ol/DataTile\n */\nimport Tile from './Tile.js';\nimport TileState from './TileState.js';\nimport {createCanvasContext2D} from './dom.js';\n\n/**\n * @typedef {HTMLImageElement|HTMLCanvasElement|HTMLVideoElement|ImageBitmap} ImageLike\n */\n\n/**\n * @typedef {Uint8Array|Uint8ClampedArray|Float32Array|DataView} ArrayLike\n */\n\n/**\n * Data that can be used with a DataTile.\n * @typedef {ArrayLike|ImageLike} Data\n */\n\n/**\n * @param {Data} data Tile data.\n * @return {ImageLike|null} The image-like data.\n */\nexport function asImageLike(data) {\n  return data instanceof Image ||\n    data instanceof HTMLCanvasElement ||\n    data instanceof HTMLVideoElement ||\n    data instanceof ImageBitmap\n    ? data\n    : null;\n}\n\n/**\n * @param {Data} data Tile data.\n * @return {ArrayLike|null} The array-like data.\n */\nexport function asArrayLike(data) {\n  return data instanceof Uint8Array ||\n    data instanceof Uint8ClampedArray ||\n    data instanceof Float32Array ||\n    data instanceof DataView\n    ? data\n    : null;\n}\n\n/**\n * This is set as the cancellation reason when a tile is disposed.\n */\nexport const disposedError = new Error('disposed');\n\n/**\n * @type {CanvasRenderingContext2D|null}\n */\nlet sharedContext = null;\n\n/**\n * @param {ImageLike} image The image.\n * @return {Uint8ClampedArray} The data.\n */\nexport function toArray(image) {\n  if (!sharedContext) {\n    sharedContext = createCanvasContext2D(\n      image.width,\n      image.height,\n      undefined,\n      {willReadFrequently: true},\n    );\n  }\n  const canvas = sharedContext.canvas;\n  const width = image.width;\n  if (canvas.width !== width) {\n    canvas.width = width;\n  }\n  const height = image.height;\n  if (canvas.height !== height) {\n    canvas.height = height;\n  }\n  sharedContext.clearRect(0, 0, width, height);\n  sharedContext.drawImage(image, 0, 0);\n  return sharedContext.getImageData(0, 0, width, height).data;\n}\n\n/**\n * @type {import('./size.js').Size}\n */\nconst defaultSize = [256, 256];\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n * @property {function(): Promise<Data>} loader Data loader.  For loaders that generate images,\n * the promise should not resolve until the image is loaded.\n * @property {number} [transition=250] A duration for tile opacity\n * transitions in milliseconds. A duration of 0 disables the opacity transition.\n * @property {boolean} [interpolate=false] Use interpolated values when resampling.  By default,\n * the nearest neighbor is used when resampling.\n * @property {import('./size.js').Size} [size=[256, 256]] Tile size.\n * @property {AbortController} [controller] An abort controller.\n * @api\n */\n\nclass DataTile extends Tile {\n  /**\n   * @param {Options} options Tile options.\n   */\n  constructor(options) {\n    const state = TileState.IDLE;\n\n    super(options.tileCoord, state, {\n      transition: options.transition,\n      interpolate: options.interpolate,\n    });\n\n    /**\n     * @type {function(): Promise<Data>}\n     * @private\n     */\n    this.loader_ = options.loader;\n\n    /**\n     * @type {Data}\n     * @private\n     */\n    this.data_ = null;\n\n    /**\n     * @type {Error}\n     * @private\n     */\n    this.error_ = null;\n\n    /**\n     * @type {import('./size.js').Size|null}\n     * @private\n     */\n    this.size_ = options.size || null;\n\n    /**\n     * @type {AbortController|null}\n     * @private\n     */\n    this.controller_ = options.controller || null;\n  }\n\n  /**\n   * Get the tile size.\n   * @return {import('./size.js').Size} Tile size.\n   */\n  getSize() {\n    if (this.size_) {\n      return this.size_;\n    }\n    const imageData = asImageLike(this.data_);\n    if (imageData) {\n      return [imageData.width, imageData.height];\n    }\n    return defaultSize;\n  }\n\n  /**\n   * Get the data for the tile.\n   * @return {Data} Tile data.\n   * @api\n   */\n  getData() {\n    return this.data_;\n  }\n\n  /**\n   * Get any loading error.\n   * @return {Error} Loading error.\n   * @api\n   */\n  getError() {\n    return this.error_;\n  }\n\n  /**\n   * Load the tile data.\n   * @api\n   * @override\n   */\n  load() {\n    if (this.state !== TileState.IDLE && this.state !== TileState.ERROR) {\n      return;\n    }\n    this.state = TileState.LOADING;\n    this.changed();\n\n    const self = this;\n    this.loader_()\n      .then(function (data) {\n        self.data_ = data;\n        self.state = TileState.LOADED;\n        self.changed();\n      })\n      .catch(function (error) {\n        self.error_ = error;\n        self.state = TileState.ERROR;\n        self.changed();\n      });\n  }\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    if (this.controller_) {\n      this.controller_.abort(disposedError);\n      this.controller_ = null;\n    }\n    super.disposeInternal();\n  }\n}\n\nexport default DataTile;\n","/**\n * @module ol/webgl/PaletteTexture\n */\n\nclass PaletteTexture {\n  /**\n   * @param {string} name The name of the texture.\n   * @param {Uint8Array} data The texture data.\n   */\n  constructor(name, data) {\n    this.name = name;\n    this.data = data;\n\n    /**\n     * @type {WebGLTexture|null}\n     * @private\n     */\n    this.texture_ = null;\n  }\n\n  /**\n   * @param {WebGLRenderingContext} gl Rendering context.\n   * @return {WebGLTexture} The texture.\n   */\n  getTexture(gl) {\n    if (!this.texture_) {\n      const texture = gl.createTexture();\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        0,\n        gl.RGBA,\n        this.data.length / 4,\n        1,\n        0,\n        gl.RGBA,\n        gl.UNSIGNED_BYTE,\n        this.data,\n      );\n      this.texture_ = texture;\n    }\n    return this.texture_;\n  }\n\n  /**\n   * @param {WebGLRenderingContext} gl Rendering context.\n   */\n  delete(gl) {\n    if (this.texture_) {\n      gl.deleteTexture(this.texture_);\n    }\n    this.texture_ = null;\n  }\n}\n\nexport default PaletteTexture;\n","/**\n * @module ol/expr/gpu\n */\nimport {asArray} from '../color.js';\nimport {Uniforms} from '../renderer/webgl/TileLayer.js';\nimport {toSize} from '../size.js';\nimport PaletteTexture from '../webgl/PaletteTexture.js';\nimport {\n  BooleanType,\n  CallExpression,\n  ColorType,\n  NumberArrayType,\n  NumberType,\n  Ops,\n  SizeType,\n  StringType,\n  parse,\n  typeName,\n} from './expression.js';\n\n/**\n * @param {string} operator Operator\n * @param {CompilationContext} context Compilation context\n * @return {string} A function name based on the operator, unique in the given context\n */\nfunction computeOperatorFunctionName(operator, context) {\n  return `operator_${operator}_${Object.keys(context.functions).length}`;\n}\n\n/**\n * Will return the number as a float with a dot separator, which is required by GLSL.\n * @param {number} v Numerical value.\n * @return {string} The value as string.\n */\nexport function numberToGlsl(v) {\n  const s = v.toString();\n  return s.includes('.') ? s : s + '.0';\n}\n\n/**\n * Will return the number array as a float with a dot separator, concatenated with ', '.\n * @param {Array<number>} array Numerical values array.\n * @return {string} The array as a vector, e. g.: `vec3(1.0, 2.0, 3.0)`.\n */\nexport function arrayToGlsl(array) {\n  if (array.length < 2 || array.length > 4) {\n    throw new Error(\n      '`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.',\n    );\n  }\n  return `vec${array.length}(${array.map(numberToGlsl).join(', ')})`;\n}\n\n/**\n * Will normalize and converts to string a `vec4` color array compatible with GLSL.\n * @param {string|import(\"../color.js\").Color} color Color either in string format or [r, g, b, a] array format,\n * with RGB components in the 0..255 range and the alpha component in the 0..1 range.\n * Note that the final array will always have 4 components.\n * @return {string} The color expressed in the `vec4(1.0, 1.0, 1.0, 1.0)` form.\n */\nexport function colorToGlsl(color) {\n  const array = asArray(color);\n  const alpha = array.length > 3 ? array[3] : 1;\n  return arrayToGlsl([array[0] / 255, array[1] / 255, array[2] / 255, alpha]);\n}\n\n/**\n * Normalizes and converts a number or array toa `vec2` array compatible with GLSL.\n * @param {number|import('../size.js').Size} size Size.\n * @return {string} The color expressed in the `vec4(1.0, 1.0, 1.0, 1.0)` form.\n */\nexport function sizeToGlsl(size) {\n  const array = toSize(size);\n  return arrayToGlsl(array);\n}\n\n/** @type {Object<string, number>} */\nconst stringToFloatMap = {};\nlet stringToFloatCounter = 0;\n\n/**\n * Returns a stable equivalent number for the string literal.\n * @param {string} string String literal value\n * @return {number} Number equivalent\n */\nexport function getStringNumberEquivalent(string) {\n  if (!(string in stringToFloatMap)) {\n    stringToFloatMap[string] = stringToFloatCounter++;\n  }\n  return stringToFloatMap[string];\n}\n\n/**\n * Returns a stable equivalent number for the string literal, for use in shaders. This number is then\n * converted to be a GLSL-compatible string.\n * Note: with a float precision of `mediump`, the amount of unique strings supported is 16,777,216\n * @param {string} string String literal value\n * @return {string} GLSL-compatible string containing a number\n */\nexport function stringToGlsl(string) {\n  return numberToGlsl(getStringNumberEquivalent(string));\n}\n\n/**\n * Get the uniform name given a variable name.\n * @param {string} variableName The variable name.\n * @return {string} The uniform name.\n */\nexport function uniformNameForVariable(variableName) {\n  return 'u_var_' + variableName;\n}\n\n/**\n * @typedef {import('./expression.js').ParsingContext} ParsingContext\n */\n/**\n *\n * @typedef {import(\"./expression.js\").Expression} Expression\n */\n/**\n *\n * @typedef {import(\"./expression.js\").LiteralExpression} LiteralExpression\n */\n\n/**\n * @typedef {Object} CompilationContextProperty\n * @property {string} name Name\n * @property {number} type Resolved property type\n */\n\n/**\n * @typedef {Object} CompilationContextVariable\n * @property {string} name Name\n * @property {number} type Resolved variable type\n */\n\n/**\n * @typedef {Object} CompilationContext\n * @property {Object<string, CompilationContextProperty>} properties The values for properties used in 'get' expressions.\n * @property {Object<string, CompilationContextVariable>} variables The values for variables used in 'var' expressions.\n * @property {Object<string, string>} functions Lookup of functions used by the style.\n * @property {number} [bandCount] Number of bands per pixel.\n * @property {Array<PaletteTexture>} [paletteTextures] List of palettes used by the style.\n * @property {boolean} featureId Whether the feature ID is used in the expression\n * @property {boolean} geometryType Whether the geometry type is used in the expression\n */\n\n/**\n * @return {CompilationContext} A new compilation context.\n */\nexport function newCompilationContext() {\n  return {\n    variables: {},\n    properties: {},\n    functions: {},\n    bandCount: 0,\n    featureId: false,\n    geometryType: false,\n  };\n}\n\nconst GET_BAND_VALUE_FUNC = 'getBandValue';\n\nexport const PALETTE_TEXTURE_ARRAY = 'u_paletteTextures';\n\nexport const FEATURE_ID_PROPERTY_NAME = 'featureId';\nexport const GEOMETRY_TYPE_PROPERTY_NAME = 'geometryType';\n\n/**\n * The value `-9999999` will be used to indicate that a property on a feature is not defined, similar to a \"no data\" value.\n */\nexport const UNDEFINED_PROP_VALUE = -9999999;\n\n/**\n * @typedef {string} CompiledExpression\n */\n\n/**\n * @typedef {function(CompilationContext, CallExpression, number): string} Compiler\n * Third argument is the expected value types\n */\n\n/**\n * @param {import('./expression.js').EncodedExpression} encoded The encoded expression.\n * @param {number} type The expected type.\n * @param {import('./expression.js').ParsingContext} parsingContext The parsing context.\n * @param {CompilationContext} compilationContext An existing compilation context\n * @return {CompiledExpression} The compiled expression.\n */\nexport function buildExpression(\n  encoded,\n  type,\n  parsingContext,\n  compilationContext,\n) {\n  const expression = parse(encoded, type, parsingContext);\n  return compile(expression, type, compilationContext);\n}\n\n/**\n * @param {function(Array<CompiledExpression>, CompilationContext): string} output Function that takes in parsed arguments and returns a string\n * @return {function(CompilationContext, import(\"./expression.js\").CallExpression, number): string} Compiler for the call expression\n */\nfunction createCompiler(output) {\n  return (context, expression, type) => {\n    const length = expression.args.length;\n    const args = new Array(length);\n    for (let i = 0; i < length; ++i) {\n      args[i] = compile(expression.args[i], type, context);\n    }\n    return output(args, context);\n  };\n}\n\n/**\n * @type {Object<string, Compiler>}\n */\nconst compilers = {\n  [Ops.Get]: (context, expression) => {\n    const firstArg = /** @type {LiteralExpression} */ (expression.args[0]);\n    const propName = /** @type {string} */ (firstArg.value);\n    const isExisting = propName in context.properties;\n    if (!isExisting) {\n      context.properties[propName] = {\n        name: propName,\n        type: expression.type,\n      };\n    }\n    return 'a_prop_' + propName;\n  },\n  [Ops.Id]: (context) => {\n    context.featureId = true;\n    return 'a_' + FEATURE_ID_PROPERTY_NAME;\n  },\n  [Ops.GeometryType]: (context) => {\n    context.geometryType = true;\n    return 'a_' + GEOMETRY_TYPE_PROPERTY_NAME;\n  },\n  [Ops.LineMetric]: () => 'currentLineMetric', // this variable is assumed to always be present in shaders, default is 0.\n  [Ops.Var]: (context, expression) => {\n    const firstArg = /** @type {LiteralExpression} */ (expression.args[0]);\n    const varName = /** @type {string} */ (firstArg.value);\n    const isExisting = varName in context.variables;\n    if (!isExisting) {\n      context.variables[varName] = {\n        name: varName,\n        type: expression.type,\n      };\n    }\n    return uniformNameForVariable(varName);\n  },\n  [Ops.Has]: (context, expression) => {\n    const firstArg = /** @type {LiteralExpression} */ (expression.args[0]);\n    const propName = /** @type {string} */ (firstArg.value);\n    const isExisting = propName in context.properties;\n    if (!isExisting) {\n      context.properties[propName] = {\n        name: propName,\n        type: expression.type,\n      };\n    }\n    return `(a_prop_${propName} != ${numberToGlsl(UNDEFINED_PROP_VALUE)})`;\n  },\n  [Ops.Resolution]: () => 'u_resolution',\n  [Ops.Zoom]: () => 'u_zoom',\n  [Ops.Time]: () => 'u_time',\n  [Ops.Any]: createCompiler((compiledArgs) => `(${compiledArgs.join(` || `)})`),\n  [Ops.All]: createCompiler((compiledArgs) => `(${compiledArgs.join(` && `)})`),\n  [Ops.Not]: createCompiler(([value]) => `(!${value})`),\n  [Ops.Equal]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} == ${secondValue})`,\n  ),\n  [Ops.NotEqual]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} != ${secondValue})`,\n  ),\n  [Ops.GreaterThan]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} > ${secondValue})`,\n  ),\n  [Ops.GreaterThanOrEqualTo]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} >= ${secondValue})`,\n  ),\n  [Ops.LessThan]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} < ${secondValue})`,\n  ),\n  [Ops.LessThanOrEqualTo]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} <= ${secondValue})`,\n  ),\n  [Ops.Multiply]: createCompiler(\n    (compiledArgs) => `(${compiledArgs.join(' * ')})`,\n  ),\n  [Ops.Divide]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} / ${secondValue})`,\n  ),\n  [Ops.Add]: createCompiler((compiledArgs) => `(${compiledArgs.join(' + ')})`),\n  [Ops.Subtract]: createCompiler(\n    ([firstValue, secondValue]) => `(${firstValue} - ${secondValue})`,\n  ),\n  [Ops.Clamp]: createCompiler(\n    ([value, min, max]) => `clamp(${value}, ${min}, ${max})`,\n  ),\n  [Ops.Mod]: createCompiler(([value, modulo]) => `mod(${value}, ${modulo})`),\n  [Ops.Pow]: createCompiler(([value, power]) => `pow(${value}, ${power})`),\n  [Ops.Abs]: createCompiler(([value]) => `abs(${value})`),\n  [Ops.Floor]: createCompiler(([value]) => `floor(${value})`),\n  [Ops.Ceil]: createCompiler(([value]) => `ceil(${value})`),\n  [Ops.Round]: createCompiler(([value]) => `floor(${value} + 0.5)`),\n  [Ops.Sin]: createCompiler(([value]) => `sin(${value})`),\n  [Ops.Cos]: createCompiler(([value]) => `cos(${value})`),\n  [Ops.Atan]: createCompiler(([firstValue, secondValue]) => {\n    return secondValue !== undefined\n      ? `atan(${firstValue}, ${secondValue})`\n      : `atan(${firstValue})`;\n  }),\n  [Ops.Sqrt]: createCompiler(([value]) => `sqrt(${value})`),\n  [Ops.Match]: createCompiler((compiledArgs) => {\n    const input = compiledArgs[0];\n    const fallback = compiledArgs[compiledArgs.length - 1];\n    let result = null;\n    for (let i = compiledArgs.length - 3; i >= 1; i -= 2) {\n      const match = compiledArgs[i];\n      const output = compiledArgs[i + 1];\n      result = `(${input} == ${match} ? ${output} : ${result || fallback})`;\n    }\n    return result;\n  }),\n  [Ops.Between]: createCompiler(\n    ([value, min, max]) => `(${value} >= ${min} && ${value} <= ${max})`,\n  ),\n  [Ops.Interpolate]: createCompiler(([exponent, input, ...compiledArgs]) => {\n    let result = '';\n    for (let i = 0; i < compiledArgs.length - 2; i += 2) {\n      const stop1 = compiledArgs[i];\n      const output1 = result || compiledArgs[i + 1];\n      const stop2 = compiledArgs[i + 2];\n      const output2 = compiledArgs[i + 3];\n      let ratio;\n      if (exponent === numberToGlsl(1)) {\n        ratio = `(${input} - ${stop1}) / (${stop2} - ${stop1})`;\n      } else {\n        ratio = `(pow(${exponent}, (${input} - ${stop1})) - 1.0) / (pow(${exponent}, (${stop2} - ${stop1})) - 1.0)`;\n      }\n      result = `mix(${output1}, ${output2}, clamp(${ratio}, 0.0, 1.0))`;\n    }\n    return result;\n  }),\n  [Ops.Case]: createCompiler((compiledArgs) => {\n    const fallback = compiledArgs[compiledArgs.length - 1];\n    let result = null;\n    for (let i = compiledArgs.length - 3; i >= 0; i -= 2) {\n      const condition = compiledArgs[i];\n      const output = compiledArgs[i + 1];\n      result = `(${condition} ? ${output} : ${result || fallback})`;\n    }\n    return result;\n  }),\n  [Ops.In]: createCompiler(([needle, ...haystack], context) => {\n    const funcName = computeOperatorFunctionName('in', context);\n    const tests = [];\n    for (let i = 0; i < haystack.length; i += 1) {\n      tests.push(`  if (inputValue == ${haystack[i]}) { return true; }`);\n    }\n    context.functions[funcName] = `bool ${funcName}(float inputValue) {\n${tests.join('\\n')}\n  return false;\n}`;\n    return `${funcName}(${needle})`;\n  }),\n  [Ops.Array]: createCompiler(\n    (args) => `vec${args.length}(${args.join(', ')})`,\n  ),\n  [Ops.Color]: createCompiler((compiledArgs) => {\n    if (compiledArgs.length === 1) {\n      //grayscale\n      return `vec4(vec3(${compiledArgs[0]} / 255.0), 1.0)`;\n    }\n    if (compiledArgs.length === 2) {\n      //grayscale with alpha\n      return `vec4(vec3(${compiledArgs[0]} / 255.0), ${compiledArgs[1]})`;\n    }\n    const rgb = compiledArgs.slice(0, 3).map((color) => `${color} / 255.0`);\n    if (compiledArgs.length === 3) {\n      return `vec4(${rgb.join(', ')}, 1.0)`;\n    }\n    const alpha = compiledArgs[3];\n    return `vec4(${rgb.join(', ')}, ${alpha})`;\n  }),\n  [Ops.Band]: createCompiler(([band, xOffset, yOffset], context) => {\n    if (!(GET_BAND_VALUE_FUNC in context.functions)) {\n      let ifBlocks = '';\n      const bandCount = context.bandCount || 1;\n      for (let i = 0; i < bandCount; i++) {\n        const colorIndex = Math.floor(i / 4);\n        let bandIndex = i % 4;\n        if (i === bandCount - 1 && bandIndex === 1) {\n          // LUMINANCE_ALPHA - band 1 assigned to rgb and band 2 assigned to alpha\n          bandIndex = 3;\n        }\n        const textureName = `${Uniforms.TILE_TEXTURE_ARRAY}[${colorIndex}]`;\n        ifBlocks += `  if (band == ${i + 1}.0) {\n    return texture2D(${textureName}, v_textureCoord + vec2(dx, dy))[${bandIndex}];\n  }\n`;\n      }\n\n      context.functions[GET_BAND_VALUE_FUNC] =\n        `float getBandValue(float band, float xOffset, float yOffset) {\n  float dx = xOffset / ${Uniforms.TEXTURE_PIXEL_WIDTH};\n  float dy = yOffset / ${Uniforms.TEXTURE_PIXEL_HEIGHT};\n${ifBlocks}\n}`;\n    }\n\n    return `${GET_BAND_VALUE_FUNC}(${band}, ${xOffset ?? '0.0'}, ${\n      yOffset ?? '0.0'\n    })`;\n  }),\n  [Ops.Palette]: (context, expression) => {\n    const [index, ...colors] = expression.args;\n    const numColors = colors.length;\n    const palette = new Uint8Array(numColors * 4);\n    for (let i = 0; i < colors.length; i++) {\n      const parsedValue = /** @type {string | Array<number>} */ (\n        /** @type {LiteralExpression} */ (colors[i]).value\n      );\n      const color = asArray(parsedValue);\n      const offset = i * 4;\n      palette[offset] = color[0];\n      palette[offset + 1] = color[1];\n      palette[offset + 2] = color[2];\n      palette[offset + 3] = color[3] * 255;\n    }\n    if (!context.paletteTextures) {\n      context.paletteTextures = [];\n    }\n    const paletteName = `${PALETTE_TEXTURE_ARRAY}[${context.paletteTextures.length}]`;\n    const paletteTexture = new PaletteTexture(paletteName, palette);\n    context.paletteTextures.push(paletteTexture);\n    const compiledIndex = compile(index, NumberType, context);\n    return `texture2D(${paletteName}, vec2((${compiledIndex} + 0.5) / ${numColors}.0, 0.5))`;\n  },\n  // TODO: unimplemented\n  // Ops.Number\n  // Ops.String\n  // Ops.Coalesce\n  // Ops.Concat\n  // Ops.ToString\n};\n\n/**\n * @param {Expression} expression The expression.\n * @param {number} returnType The expected return type.\n * @param {CompilationContext} context The compilation context.\n * @return {CompiledExpression} The compiled expression\n */\nfunction compile(expression, returnType, context) {\n  // operator\n  if (expression instanceof CallExpression) {\n    const compiler = compilers[expression.operator];\n    if (compiler === undefined) {\n      throw new Error(\n        `No compiler defined for this operator: ${JSON.stringify(\n          expression.operator,\n        )}`,\n      );\n    }\n    return compiler(context, expression, returnType);\n  }\n\n  if ((expression.type & NumberType) > 0) {\n    return numberToGlsl(/** @type {number} */ (expression.value));\n  }\n\n  if ((expression.type & BooleanType) > 0) {\n    return expression.value.toString();\n  }\n\n  if ((expression.type & StringType) > 0) {\n    return stringToGlsl(expression.value.toString());\n  }\n\n  if ((expression.type & ColorType) > 0) {\n    return colorToGlsl(\n      /** @type {Array<number> | string} */ (expression.value),\n    );\n  }\n\n  if ((expression.type & NumberArrayType) > 0) {\n    return arrayToGlsl(/** @type {Array<number>} */ (expression.value));\n  }\n\n  if ((expression.type & SizeType) > 0) {\n    return sizeToGlsl(\n      /** @type {number|import('../size.js').Size} */ (expression.value),\n    );\n  }\n\n  throw new Error(\n    `Unexpected expression ${expression.value} (expected type ${typeName(\n      returnType,\n    )})`,\n  );\n}\n","/**\n * Utilities for compiling expressions and turning them into WebGL concepts\n * @module ol/render/webgl/compileUtil\n */\n\nimport {asArray} from '../../color.js';\nimport {\n  ColorType,\n  NumberArrayType,\n  SizeType,\n  newParsingContext,\n} from '../../expr/expression.js';\nimport {\n  buildExpression,\n  getStringNumberEquivalent,\n  uniformNameForVariable,\n} from '../../expr/gpu.js';\n\n/**\n * Recursively parses a style expression and outputs a GLSL-compatible string. Takes in a compilation context that\n * will be read and modified during the parsing operation.\n * @param {import(\"../../expr/gpu.js\").CompilationContext} compilationContext Compilation context\n * @param {import(\"../../expr/expression.js\").EncodedExpression} value Value\n * @param {number} [expectedType] Expected final type (can be several types combined)\n * @return {string} GLSL-compatible output\n */\nexport function expressionToGlsl(compilationContext, value, expectedType) {\n  const parsingContext = newParsingContext();\n  return buildExpression(\n    value,\n    expectedType,\n    parsingContext,\n    compilationContext,\n  );\n}\n\n/**\n * Packs all components of a color into a two-floats array\n * @param {import(\"../../color.js\").Color|string} color Color as array of numbers or string\n * @return {Array<number>} Vec2 array containing the color in compressed form\n */\nexport function packColor(color) {\n  const array = asArray(color);\n  const r = array[0] * 256;\n  const g = array[1];\n  const b = array[2] * 256;\n  const a = Math.round(array[3] * 255);\n  return [r + g, b + a];\n}\n\nexport const UNPACK_COLOR_FN = `vec4 unpackColor(vec2 packedColor) {\n  return vec4(\n    fract(floor(packedColor[0] / 256.0) / 256.0),\n    fract(packedColor[0] / 256.0),\n    fract(floor(packedColor[1] / 256.0) / 256.0),\n    fract(packedColor[1] / 256.0)\n  );\n}`;\n\n/**\n * @param {number} type Value type\n * @return {1|2|3|4} The amount of components for this value\n */\nexport function getGlslSizeFromType(type) {\n  if (type === ColorType || type === SizeType) {\n    return 2;\n  }\n  if (type === NumberArrayType) {\n    return 4;\n  }\n  return 1;\n}\n\n/**\n * @param {number} type Value type\n * @return {'float'|'vec2'|'vec3'|'vec4'} The corresponding GLSL type for this value\n */\nexport function getGlslTypeFromType(type) {\n  const size = getGlslSizeFromType(type);\n  if (size > 1) {\n    return /** @type {'vec2'|'vec3'|'vec4'} */ (`vec${size}`);\n  }\n  return 'float';\n}\n\n/**\n * Applies the properties and variables collected in a compilation context to a ShaderBuilder instance:\n * properties will show up as attributes in shaders, and variables will show up as uniforms.\n * @param {import(\"./ShaderBuilder.js\").ShaderBuilder} builder Shader builder\n * @param {import(\"../../expr/gpu.js\").CompilationContext} context Compilation context\n */\nexport function applyContextToBuilder(builder, context) {\n  // define one uniform per variable\n  for (const varName in context.variables) {\n    const variable = context.variables[varName];\n    const uniformName = uniformNameForVariable(variable.name);\n    let glslType = getGlslTypeFromType(variable.type);\n    if (variable.type === ColorType) {\n      // we're not packing colors when they're passed as uniforms\n      glslType = 'vec4';\n    }\n    builder.addUniform(uniformName, glslType);\n  }\n\n  // for each feature attribute used in the fragment shader, define a varying that will be used to pass data\n  // from the vertex to the fragment shader, as well as an attribute in the vertex shader (if not already present)\n  for (const propName in context.properties) {\n    const property = context.properties[propName];\n    const glslType = getGlslTypeFromType(property.type);\n    const attributeName = `a_prop_${property.name}`;\n    if (property.type === ColorType) {\n      builder.addAttribute(\n        attributeName,\n        glslType,\n        `unpackColor(${attributeName})`,\n        'vec4',\n      );\n      builder.addVertexShaderFunction(UNPACK_COLOR_FN);\n    } else {\n      builder.addAttribute(attributeName, glslType);\n    }\n  }\n\n  // add functions that were collected in the compilation contexts\n  for (const functionName in context.functions) {\n    builder.addVertexShaderFunction(context.functions[functionName]);\n    builder.addFragmentShaderFunction(context.functions[functionName]);\n  }\n}\n\n/**\n * Generates a set of uniforms from variables collected in a compilation context,\n * to be fed to a WebGLHelper instance\n * @param {import(\"../../expr/gpu.js\").CompilationContext} context Compilation context\n * @param {import('../../style/flat.js').StyleVariables} [variables] Style variables.\n * @return {Object<string,import(\"../../webgl/Helper\").UniformValue>} Uniforms\n */\nexport function generateUniformsFromContext(context, variables) {\n  /** @type {Object<string,import(\"../../webgl/Helper\").UniformValue>} */\n  const uniforms = {};\n\n  // define one uniform per variable\n  for (const varName in context.variables) {\n    const variable = context.variables[varName];\n    const uniformName = uniformNameForVariable(variable.name);\n\n    uniforms[uniformName] = () => {\n      const value = variables[variable.name];\n      if (typeof value === 'number') {\n        return value;\n      }\n      if (typeof value === 'boolean') {\n        return value ? 1 : 0;\n      }\n      if (variable.type === ColorType) {\n        const color = [...asArray(value || '#eee')];\n        color[0] /= 255;\n        color[1] /= 255;\n        color[2] /= 255;\n        color[3] ??= 1;\n        return color;\n      }\n      if (typeof value === 'string') {\n        return getStringNumberEquivalent(value);\n      }\n      return value;\n    };\n  }\n\n  return uniforms;\n}\n\n/**\n * Generates a set of attributes from properties collected in a compilation context,\n * to be fed to a WebGLHelper instance\n * @param {import(\"../../expr/gpu.js\").CompilationContext} context Compilation context\n * @return {import('./VectorStyleRenderer.js').AttributeDefinitions} Attributes\n */\nexport function generateAttributesFromContext(context) {\n  /**\n   * @type {import('./VectorStyleRenderer.js').AttributeDefinitions}\n   */\n  const attributes = {};\n\n  // Define attributes with their callback for each property used in the vertex shader\n  for (const propName in context.properties) {\n    const property = context.properties[propName];\n    const callback = (feature) => {\n      const value = feature.get(property.name);\n      if (property.type === ColorType) {\n        return packColor([...asArray(value || '#eee')]);\n      }\n      if (typeof value === 'string') {\n        return getStringNumberEquivalent(value);\n      }\n      if (typeof value === 'boolean') {\n        return value ? 1 : 0;\n      }\n      return value;\n    };\n\n    attributes[`prop_${property.name}`] = {\n      size: getGlslSizeFromType(property.type),\n      callback,\n    };\n  }\n  return attributes;\n}\n","/**\n * @module ol/renderer/webgl/Layer\n */\nimport LayerProperty from '../../layer/Property.js';\nimport RenderEvent from '../../render/Event.js';\nimport RenderEventType from '../../render/EventType.js';\nimport {\n  compose as composeTransform,\n  create as createTransform,\n} from '../../transform.js';\nimport WebGLHelper from '../../webgl/Helper.js';\nimport LayerRenderer from '../Layer.js';\n\n/**\n * @typedef {Object} PostProcessesOptions\n * @property {number} [scaleRatio] Scale ratio; if < 1, the post process will render to a texture smaller than\n * the main canvas that will then be sampled up (useful for saving resource on blur steps).\n * @property {string} [vertexShader] Vertex shader source\n * @property {string} [fragmentShader] Fragment shader source\n * @property {Object<string,import(\"../../webgl/Helper\").UniformValue>} [uniforms] Uniform definitions for the post process step\n */\n\n/**\n * @typedef {Object} Options\n * @property {Object<string,import(\"../../webgl/Helper\").UniformValue>} [uniforms] Uniform definitions for the post process steps\n * @property {Array<PostProcessesOptions>} [postProcesses] Post-processes definitions\n */\n\n/**\n * @classdesc\n * Base WebGL renderer class.\n * Holds all logic related to data manipulation & some common rendering logic\n * @template {import(\"../../layer/Layer.js\").default} LayerType\n * @extends {LayerRenderer<LayerType>}\n */\nclass WebGLLayerRenderer extends LayerRenderer {\n  /**\n   * @param {LayerType} layer Layer.\n   * @param {Options} [options] Options.\n   */\n  constructor(layer, options) {\n    super(layer);\n\n    options = options || {};\n\n    /**\n     * The transform for viewport CSS pixels to rendered pixels.  This transform is only\n     * set before dispatching rendering events.\n     * @private\n     * @type {import(\"../../transform.js\").Transform}\n     */\n    this.inversePixelTransform_ = createTransform();\n\n    /**\n     * @private\n     */\n    this.postProcesses_ = options.postProcesses;\n\n    /**\n     * @private\n     */\n    this.uniforms_ = options.uniforms;\n\n    /**\n     * @type {WebGLHelper}\n     * @protected\n     */\n    this.helper;\n\n    this.onMapChanged_ = () => {\n      this.clearCache();\n      this.removeHelper();\n    };\n\n    layer.addChangeListener(LayerProperty.MAP, this.onMapChanged_);\n\n    this.dispatchPreComposeEvent = this.dispatchPreComposeEvent.bind(this);\n    this.dispatchPostComposeEvent = this.dispatchPostComposeEvent.bind(this);\n  }\n\n  /**\n   * @param {WebGLRenderingContext} context The WebGL rendering context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @protected\n   */\n  dispatchPreComposeEvent(context, frameState) {\n    const layer = this.getLayer();\n    if (layer.hasListener(RenderEventType.PRECOMPOSE)) {\n      const event = new RenderEvent(\n        RenderEventType.PRECOMPOSE,\n        undefined,\n        frameState,\n        context,\n      );\n      layer.dispatchEvent(event);\n    }\n  }\n\n  /**\n   * @param {WebGLRenderingContext} context The WebGL rendering context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @protected\n   */\n  dispatchPostComposeEvent(context, frameState) {\n    const layer = this.getLayer();\n    if (layer.hasListener(RenderEventType.POSTCOMPOSE)) {\n      const event = new RenderEvent(\n        RenderEventType.POSTCOMPOSE,\n        undefined,\n        frameState,\n        context,\n      );\n      layer.dispatchEvent(event);\n    }\n  }\n\n  /**\n   * Reset options (only handles uniforms).\n   * @param {Options} options Options.\n   */\n  reset(options) {\n    this.uniforms_ = options.uniforms;\n    if (this.helper) {\n      this.helper.setUniforms(this.uniforms_);\n    }\n  }\n\n  /**\n   * @protected\n   */\n  removeHelper() {\n    if (this.helper) {\n      this.helper.dispose();\n      delete this.helper;\n    }\n  }\n\n  /**\n   * Determine whether renderFrame should be called.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {boolean} Layer is ready to be rendered.\n   * @override\n   */\n  prepareFrame(frameState) {\n    if (this.getLayer().getRenderSource()) {\n      let incrementGroup = true;\n      let groupNumber = -1;\n      let className;\n      for (let i = 0, ii = frameState.layerStatesArray.length; i < ii; i++) {\n        const layer = frameState.layerStatesArray[i].layer;\n        const renderer = layer.getRenderer();\n        if (!(renderer instanceof WebGLLayerRenderer)) {\n          incrementGroup = true;\n          continue;\n        }\n        const layerClassName = layer.getClassName();\n        if (incrementGroup || layerClassName !== className) {\n          groupNumber += 1;\n          incrementGroup = false;\n        }\n        className = layerClassName;\n        if (renderer === this) {\n          break;\n        }\n      }\n\n      const canvasCacheKey =\n        'map/' + frameState.mapId + '/group/' + groupNumber;\n\n      if (\n        !this.helper ||\n        !this.helper.canvasCacheKeyMatches(canvasCacheKey) ||\n        this.helper.needsToBeRecreated()\n      ) {\n        this.removeHelper();\n\n        this.helper = new WebGLHelper({\n          postProcesses: this.postProcesses_,\n          uniforms: this.uniforms_,\n          canvasCacheKey: canvasCacheKey,\n        });\n\n        if (className) {\n          this.helper.getCanvas().className = className;\n        }\n\n        this.afterHelperCreated();\n      }\n    }\n\n    return this.prepareFrameInternal(frameState);\n  }\n\n  /**\n   * @protected\n   */\n  afterHelperCreated() {}\n\n  /**\n   * Determine whether renderFrame should be called.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {boolean} Layer is ready to be rendered.\n   * @protected\n   */\n  prepareFrameInternal(frameState) {\n    return true;\n  }\n\n  /**\n   * @protected\n   */\n  clearCache() {}\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    this.clearCache();\n    this.removeHelper();\n    this.getLayer()?.removeChangeListener(\n      LayerProperty.MAP,\n      this.onMapChanged_,\n    );\n    super.disposeInternal();\n  }\n\n  /**\n   * @param {import(\"../../render/EventType.js\").default} type Event type.\n   * @param {WebGLRenderingContext} context The rendering context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @private\n   */\n  dispatchRenderEvent_(type, context, frameState) {\n    const layer = this.getLayer();\n    if (layer.hasListener(type)) {\n      composeTransform(\n        this.inversePixelTransform_,\n        0,\n        0,\n        frameState.pixelRatio,\n        -frameState.pixelRatio,\n        0,\n        0,\n        -frameState.size[1],\n      );\n\n      const event = new RenderEvent(\n        type,\n        this.inversePixelTransform_,\n        frameState,\n        context,\n      );\n      layer.dispatchEvent(event);\n    }\n  }\n\n  /**\n   * @param {WebGLRenderingContext} context The rendering context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @protected\n   */\n  preRender(context, frameState) {\n    this.dispatchRenderEvent_(RenderEventType.PRERENDER, context, frameState);\n  }\n\n  /**\n   * @param {WebGLRenderingContext} context The rendering context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @protected\n   */\n  postRender(context, frameState) {\n    this.dispatchRenderEvent_(RenderEventType.POSTRENDER, context, frameState);\n  }\n}\n\nexport default WebGLLayerRenderer;\n","/**\n * @module ol/webgl/TileTexture\n */\n\nimport DataTile, {asArrayLike, asImageLike} from '../DataTile.js';\nimport ImageTile from '../ImageTile.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport ReprojTile from '../reproj/Tile.js';\nimport {toSize} from '../size.js';\nimport {ARRAY_BUFFER, STATIC_DRAW} from '../webgl.js';\nimport BaseTileRepresentation from './BaseTileRepresentation.js';\nimport WebGLArrayBuffer from './Buffer.js';\n\n/**\n * @param {WebGLRenderingContext} gl The WebGL context.\n * @param {WebGLTexture} texture The texture.\n * @param {boolean} interpolate Interpolate when resampling.\n */\nfunction bindAndConfigure(gl, texture, interpolate) {\n  const resampleFilter = interpolate ? gl.LINEAR : gl.NEAREST;\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, resampleFilter);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, resampleFilter);\n}\n\n/**\n * @param {WebGLRenderingContext} gl The WebGL context.\n * @param {WebGLTexture} texture The texture.\n * @param {import(\"../DataTile.js\").ImageLike} image The image.\n * @param {boolean} interpolate Interpolate when resampling.\n */\nfunction uploadImageTexture(gl, texture, image, interpolate) {\n  bindAndConfigure(gl, texture, interpolate);\n\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n}\n\n/**\n * @param {import(\"./Helper.js\").default} helper The WebGL helper.\n * @param {WebGLTexture} texture The texture.\n * @param {import(\"../DataTile.js\").ArrayLike} data The pixel data.\n * @param {import(\"../size.js\").Size} size The pixel size.\n * @param {number} bandCount The band count.\n * @param {boolean} interpolate Interpolate when resampling.\n */\nfunction uploadDataTexture(\n  helper,\n  texture,\n  data,\n  size,\n  bandCount,\n  interpolate,\n) {\n  const gl = helper.getGL();\n  let textureType;\n  let canInterpolate;\n  if (data instanceof Float32Array) {\n    textureType = gl.FLOAT;\n    helper.getExtension('OES_texture_float');\n    const extension = helper.getExtension('OES_texture_float_linear');\n    canInterpolate = extension !== null;\n  } else {\n    textureType = gl.UNSIGNED_BYTE;\n    canInterpolate = true;\n  }\n  bindAndConfigure(gl, texture, interpolate && canInterpolate);\n\n  const bytesPerRow = data.byteLength / size[1];\n  let unpackAlignment = 1;\n  if (bytesPerRow % 8 === 0) {\n    unpackAlignment = 8;\n  } else if (bytesPerRow % 4 === 0) {\n    unpackAlignment = 4;\n  } else if (bytesPerRow % 2 === 0) {\n    unpackAlignment = 2;\n  }\n\n  let format;\n  switch (bandCount) {\n    case 1: {\n      format = gl.LUMINANCE;\n      break;\n    }\n    case 2: {\n      format = gl.LUMINANCE_ALPHA;\n      break;\n    }\n    case 3: {\n      format = gl.RGB;\n      break;\n    }\n    case 4: {\n      format = gl.RGBA;\n      break;\n    }\n    default: {\n      throw new Error(`Unsupported number of bands: ${bandCount}`);\n    }\n  }\n\n  const oldUnpackAlignment = gl.getParameter(gl.UNPACK_ALIGNMENT);\n  gl.pixelStorei(gl.UNPACK_ALIGNMENT, unpackAlignment);\n  gl.texImage2D(\n    gl.TEXTURE_2D,\n    0,\n    format,\n    size[0],\n    size[1],\n    0,\n    format,\n    textureType,\n    data,\n  );\n  gl.pixelStorei(gl.UNPACK_ALIGNMENT, oldUnpackAlignment);\n}\n\n/**\n * @type {CanvasRenderingContext2D}\n */\nlet pixelContext = null;\n\nfunction createPixelContext() {\n  pixelContext = createCanvasContext2D(1, 1, undefined, {\n    willReadFrequently: true,\n  });\n}\n\n/**\n * @typedef {import(\"../DataTile.js\").default|ImageTile|ReprojTile} TileType\n */\n\n/**\n * @extends {BaseTileRepresentation<TileType>}\n */\nclass TileTexture extends BaseTileRepresentation {\n  /**\n   * @param {import(\"./BaseTileRepresentation.js\").TileRepresentationOptions<TileType>} options The tile texture options.\n   */\n  constructor(options) {\n    super(options);\n\n    /**\n     * @type {Array<WebGLTexture>}\n     */\n    this.textures = [];\n\n    /**\n     * @type {import(\"../size.js\").Size}\n     * @private\n     */\n    this.renderSize_ = toSize(\n      options.grid.getTileSize(options.tile.tileCoord[0]),\n    );\n\n    /**\n     * @type {number}\n     */\n    this.bandCount = NaN;\n\n    const coords = new WebGLArrayBuffer(ARRAY_BUFFER, STATIC_DRAW);\n    coords.fromArray([\n      0, // P0\n      1,\n      1, // P1\n      1,\n      1, // P2\n      0,\n      0, // P3\n      0,\n    ]);\n    this.helper.flushBufferData(coords);\n\n    /**\n     * @type {WebGLArrayBuffer}\n     */\n    this.coords = coords;\n\n    this.setTile(options.tile);\n  }\n\n  /**\n   * @override\n   * @param {import(\"./Helper.js\").default} helper The WebGL helper.\n   */\n  setHelper(helper) {\n    const gl = this.helper?.getGL();\n    if (gl) {\n      this.helper.deleteBuffer(this.coords);\n      for (let i = 0; i < this.textures.length; ++i) {\n        gl.deleteTexture(this.textures[i]);\n      }\n    }\n\n    super.setHelper(helper);\n\n    if (helper) {\n      helper.flushBufferData(this.coords);\n    }\n  }\n\n  /**\n   * @override\n   */\n  uploadTile() {\n    const helper = this.helper;\n    const gl = helper.getGL();\n    const tile = this.tile;\n\n    this.textures.length = 0;\n\n    /**\n     * @type {import(\"../DataTile.js\").Data}\n     */\n    let data;\n\n    if (tile instanceof ImageTile || tile instanceof ReprojTile) {\n      data = tile.getImage();\n    } else {\n      data = tile.getData();\n    }\n\n    const image = asImageLike(data);\n    if (image) {\n      const texture = gl.createTexture();\n      this.textures.push(texture);\n      this.bandCount = 4;\n      uploadImageTexture(gl, texture, image, tile.interpolate);\n      this.setReady();\n      return;\n    }\n\n    data = asArrayLike(data);\n\n    const sourceTileSize = /** @type {DataTile} */ (tile).getSize();\n    const pixelSize = [\n      sourceTileSize[0] + 2 * this.gutter,\n      sourceTileSize[1] + 2 * this.gutter,\n    ];\n    const isFloat = data instanceof Float32Array;\n    const pixelCount = pixelSize[0] * pixelSize[1];\n    const DataType = isFloat ? Float32Array : Uint8Array;\n    const bytesPerElement = DataType.BYTES_PER_ELEMENT;\n    const bytesPerRow = data.byteLength / pixelSize[1];\n\n    this.bandCount = Math.floor(bytesPerRow / bytesPerElement / pixelSize[0]);\n    const textureCount = Math.ceil(this.bandCount / 4);\n\n    if (textureCount === 1) {\n      const texture = gl.createTexture();\n      this.textures.push(texture);\n      uploadDataTexture(\n        helper,\n        texture,\n        data,\n        pixelSize,\n        this.bandCount,\n        tile.interpolate,\n      );\n      this.setReady();\n      return;\n    }\n\n    const textureDataArrays = new Array(textureCount);\n    for (let textureIndex = 0; textureIndex < textureCount; ++textureIndex) {\n      const texture = gl.createTexture();\n      this.textures.push(texture);\n\n      const bandCount =\n        textureIndex < textureCount - 1 ? 4 : ((this.bandCount - 1) % 4) + 1;\n      textureDataArrays[textureIndex] = new DataType(pixelCount * bandCount);\n    }\n\n    let dataIndex = 0;\n    let rowOffset = 0;\n    const colCount = pixelSize[0] * this.bandCount;\n    for (let rowIndex = 0; rowIndex < pixelSize[1]; ++rowIndex) {\n      for (let colIndex = 0; colIndex < colCount; ++colIndex) {\n        const dataValue = data[rowOffset + colIndex];\n\n        const pixelIndex = Math.floor(dataIndex / this.bandCount);\n        const bandIndex = colIndex % this.bandCount;\n        const textureIndex = Math.floor(bandIndex / 4);\n        const textureData = textureDataArrays[textureIndex];\n        const bandCount = textureData.length / pixelCount;\n        const textureBandIndex = bandIndex % 4;\n        textureData[pixelIndex * bandCount + textureBandIndex] = dataValue;\n\n        ++dataIndex;\n      }\n      rowOffset += bytesPerRow / bytesPerElement;\n    }\n\n    for (let textureIndex = 0; textureIndex < textureCount; ++textureIndex) {\n      const texture = this.textures[textureIndex];\n      const textureData = textureDataArrays[textureIndex];\n      const bandCount = textureData.length / pixelCount;\n      uploadDataTexture(\n        helper,\n        texture,\n        textureData,\n        pixelSize,\n        bandCount,\n        tile.interpolate,\n      );\n    }\n\n    this.setReady();\n  }\n\n  /**\n   * @param {import(\"../DataTile.js\").ImageLike} image The image.\n   * @param {number} renderCol The column index (in rendered tile space).\n   * @param {number} renderRow The row index (in rendered tile space).\n   * @return {Uint8ClampedArray|null} The data.\n   * @private\n   */\n  getImagePixelData_(image, renderCol, renderRow) {\n    const gutter = this.gutter;\n    const renderWidth = this.renderSize_[0];\n    const renderHeight = this.renderSize_[1];\n\n    if (!pixelContext) {\n      createPixelContext();\n    }\n    pixelContext.clearRect(0, 0, 1, 1);\n\n    const sourceWidth = image.width;\n    const sourceHeight = image.height;\n\n    const sourceWidthWithoutGutter = sourceWidth - 2 * gutter;\n    const sourceHeightWithoutGutter = sourceHeight - 2 * gutter;\n\n    const sourceCol =\n      gutter + Math.floor(sourceWidthWithoutGutter * (renderCol / renderWidth));\n\n    const sourceRow =\n      gutter +\n      Math.floor(sourceHeightWithoutGutter * (renderRow / renderHeight));\n\n    let data;\n    try {\n      pixelContext.drawImage(image, sourceCol, sourceRow, 1, 1, 0, 0, 1, 1);\n      data = pixelContext.getImageData(0, 0, 1, 1).data;\n    } catch {\n      pixelContext = null;\n      return null;\n    }\n    return data;\n  }\n\n  /**\n   * @param {import(\"../DataTile.js\").ArrayLike} data The data.\n   * @param {import(\"../size.js\").Size} sourceSize The size.\n   * @param {number} renderCol The column index (in rendered tile space).\n   * @param {number} renderRow The row index (in rendered tile space).\n   * @return {import(\"../DataTile.js\").ArrayLike|null} The data.\n   * @private\n   */\n  getArrayPixelData_(data, sourceSize, renderCol, renderRow) {\n    const gutter = this.gutter;\n    const renderWidth = this.renderSize_[0];\n    const renderHeight = this.renderSize_[1];\n\n    const sourceWidthWithoutGutter = sourceSize[0];\n    const sourceHeightWithoutGutter = sourceSize[1];\n    const sourceWidth = sourceWidthWithoutGutter + 2 * gutter;\n    const sourceHeight = sourceHeightWithoutGutter + 2 * gutter;\n\n    const sourceCol =\n      gutter + Math.floor(sourceWidthWithoutGutter * (renderCol / renderWidth));\n\n    const sourceRow =\n      gutter +\n      Math.floor(sourceHeightWithoutGutter * (renderRow / renderHeight));\n\n    if (data instanceof DataView) {\n      const bytesPerPixel = data.byteLength / (sourceWidth * sourceHeight);\n      const offset = bytesPerPixel * (sourceRow * sourceWidth + sourceCol);\n      const buffer = data.buffer.slice(offset, offset + bytesPerPixel);\n      return new DataView(buffer);\n    }\n\n    const offset = this.bandCount * (sourceRow * sourceWidth + sourceCol);\n    return data.slice(offset, offset + this.bandCount);\n  }\n\n  /**\n   * Get data for a pixel.  If the tile is not loaded, null is returned.\n   * @param {number} renderCol The column index (in rendered tile space).\n   * @param {number} renderRow The row index (in rendered tile space).\n   * @return {import(\"../DataTile.js\").ArrayLike|null} The data.\n   */\n  getPixelData(renderCol, renderRow) {\n    if (!this.loaded) {\n      return null;\n    }\n\n    if (this.tile instanceof DataTile) {\n      const data = this.tile.getData();\n      const arrayData = asArrayLike(data);\n      if (arrayData) {\n        const sourceSize = this.tile.getSize();\n        return this.getArrayPixelData_(\n          arrayData,\n          sourceSize,\n          renderCol,\n          renderRow,\n        );\n      }\n      return this.getImagePixelData_(asImageLike(data), renderCol, renderRow);\n    }\n\n    return this.getImagePixelData_(this.tile.getImage(), renderCol, renderRow);\n  }\n}\n\nexport default TileTexture;\n","/**\n * @module ol/renderer/webgl/TileLayer\n */\nimport TileState from '../../TileState.js';\nimport {\n  boundingExtent,\n  containsCoordinate,\n  getIntersection,\n} from '../../extent.js';\nimport {fromUserExtent} from '../../proj.js';\nimport {toSize} from '../../size.js';\nimport {apply as applyTransform} from '../../transform.js';\nimport {fromTransform as mat4FromTransform} from '../../vec/mat4.js';\nimport WebGLArrayBuffer from '../../webgl/Buffer.js';\nimport {AttributeType} from '../../webgl/Helper.js';\nimport TileTexture from '../../webgl/TileTexture.js';\nimport {ELEMENT_ARRAY_BUFFER, STATIC_DRAW} from '../../webgl.js';\nimport WebGLBaseTileLayerRenderer, {\n  Uniforms as BaseUniforms,\n  getCacheKey,\n} from './TileLayerBase.js';\n\nexport const Uniforms = {\n  ...BaseUniforms,\n  TILE_TEXTURE_ARRAY: 'u_tileTextures',\n  TEXTURE_PIXEL_WIDTH: 'u_texturePixelWidth',\n  TEXTURE_PIXEL_HEIGHT: 'u_texturePixelHeight',\n  TEXTURE_RESOLUTION: 'u_textureResolution', // map units per texture pixel\n  TEXTURE_ORIGIN_X: 'u_textureOriginX', // map x coordinate of left edge of texture\n  TEXTURE_ORIGIN_Y: 'u_textureOriginY', // map y coordinate of top edge of texture\n};\n\nexport const Attributes = {\n  TEXTURE_COORD: 'a_textureCoord',\n};\n\n/**\n * @type {Array<import('../../webgl/Helper.js').AttributeDescription>}\n */\nconst attributeDescriptions = [\n  {\n    name: Attributes.TEXTURE_COORD,\n    size: 2,\n    type: AttributeType.FLOAT,\n  },\n];\n\n/**\n * @typedef {Object} Options\n * @property {string} vertexShader Vertex shader source.\n * @property {string} fragmentShader Fragment shader source.\n * @property {Object<string, import(\"../../webgl/Helper\").UniformValue>} [uniforms] Additional uniforms\n * made available to shaders.\n * @property {Array<import(\"../../webgl/PaletteTexture.js\").default>} [paletteTextures] Palette textures.\n * @property {number} [cacheSize=512] The texture cache size.\n * @property {Array<import('./Layer.js').PostProcessesOptions>} [postProcesses] Post-processes definitions.\n */\n\n/**\n * @typedef {import(\"../../webgl/TileTexture.js\").TileType} TileTextureType\n */\n\n/**\n * @typedef {import(\"../../webgl/TileTexture.js\").default} TileTextureRepresentation\n */\n\n/**\n * @classdesc\n * WebGL renderer for tile layers.\n * @template {import(\"../../layer/WebGLTile.js\").default|import(\"../../layer/Flow.js\").default} LayerType\n * @extends {WebGLBaseTileLayerRenderer<LayerType, TileTextureType, TileTextureRepresentation>}\n * @api\n */\nclass WebGLTileLayerRenderer extends WebGLBaseTileLayerRenderer {\n  /**\n   * @param {LayerType} tileLayer Tile layer.\n   * @param {Options} options Options.\n   */\n  constructor(tileLayer, options) {\n    super(tileLayer, options);\n\n    /**\n     * @type {WebGLProgram}\n     * @private\n     */\n    this.program_;\n\n    /**\n     * @private\n     */\n    this.vertexShader_ = options.vertexShader;\n\n    /**\n     * @private\n     */\n    this.fragmentShader_ = options.fragmentShader;\n\n    /**\n     * Tiles are rendered as a quad with the following structure:\n     *\n     *  [P3]---------[P2]\n     *   |`           |\n     *   |  `     B   |\n     *   |    `       |\n     *   |      `     |\n     *   |   A    `   |\n     *   |          ` |\n     *  [P0]---------[P1]\n     *\n     * Triangle A: P0, P1, P3\n     * Triangle B: P1, P2, P3\n     *\n     * @private\n     */\n    this.indices_ = new WebGLArrayBuffer(ELEMENT_ARRAY_BUFFER, STATIC_DRAW);\n    this.indices_.fromArray([0, 1, 3, 1, 2, 3]);\n\n    /**\n     * @type {Array<import(\"../../webgl/PaletteTexture.js\").default>}\n     * @private\n     */\n    this.paletteTextures_ = options.paletteTextures || [];\n  }\n\n  /**\n   * @param {Options} options Options.\n   * @override\n   */\n  reset(options) {\n    super.reset(options);\n    if (this.helper) {\n      const gl = this.helper.getGL();\n      for (const paletteTexture of this.paletteTextures_) {\n        paletteTexture.delete(gl);\n      }\n    }\n\n    this.vertexShader_ = options.vertexShader;\n    this.fragmentShader_ = options.fragmentShader;\n    this.paletteTextures_ = options.paletteTextures || [];\n\n    if (this.helper) {\n      this.program_ = this.helper.getProgram(\n        this.fragmentShader_,\n        this.vertexShader_,\n      );\n      const gl = this.helper.getGL();\n      for (const paletteTexture of this.paletteTextures_) {\n        // upload the texture data\n        paletteTexture.getTexture(gl);\n      }\n    }\n  }\n\n  /**\n   * @override\n   */\n  afterHelperCreated() {\n    super.afterHelperCreated();\n\n    const gl = this.helper.getGL();\n    for (const paletteTexture of this.paletteTextures_) {\n      // upload the texture data\n      paletteTexture.getTexture(gl);\n    }\n\n    this.program_ = this.helper.getProgram(\n      this.fragmentShader_,\n      this.vertexShader_,\n    );\n    this.helper.flushBufferData(this.indices_);\n  }\n\n  /**\n   * @override\n   */\n  removeHelper() {\n    if (this.helper) {\n      const gl = this.helper.getGL();\n      for (const paletteTexture of this.paletteTextures_) {\n        paletteTexture.delete(gl);\n      }\n    }\n\n    super.removeHelper();\n  }\n\n  /**\n   * @override\n   */\n  createTileRepresentation(options) {\n    return new TileTexture(options);\n  }\n\n  /**\n   * @override\n   */\n  beforeTilesRender(frameState, tilesWithAlpha) {\n    super.beforeTilesRender(frameState, tilesWithAlpha);\n    this.helper.useProgram(this.program_, frameState);\n  }\n\n  /**\n   * @override\n   */\n  renderTile(\n    tileTexture,\n    tileTransform,\n    frameState,\n    renderExtent,\n    tileResolution,\n    tileSize,\n    tileOrigin,\n    tileExtent,\n    depth,\n    gutter,\n    alpha,\n  ) {\n    const gl = this.helper.getGL();\n    this.helper.bindBuffer(tileTexture.coords);\n    this.helper.bindBuffer(this.indices_);\n    this.helper.enableAttributes(attributeDescriptions);\n\n    let textureSlot = 0;\n    while (textureSlot < tileTexture.textures.length) {\n      const uniformName = `${Uniforms.TILE_TEXTURE_ARRAY}[${textureSlot}]`;\n      this.helper.bindTexture(\n        tileTexture.textures[textureSlot],\n        textureSlot,\n        uniformName,\n      );\n      ++textureSlot;\n    }\n\n    for (\n      let paletteIndex = 0;\n      paletteIndex < this.paletteTextures_.length;\n      ++paletteIndex\n    ) {\n      const paletteTexture = this.paletteTextures_[paletteIndex];\n      const texture = paletteTexture.getTexture(gl);\n      this.helper.bindTexture(texture, textureSlot, paletteTexture.name);\n      ++textureSlot;\n    }\n\n    const viewState = frameState.viewState;\n\n    const tileWidthWithGutter = tileSize[0] + 2 * gutter;\n    const tileHeightWithGutter = tileSize[1] + 2 * gutter;\n\n    const tile = tileTexture.tile;\n    const tileCoord = tile.tileCoord;\n\n    const tileCenterI = tileCoord[1];\n    const tileCenterJ = tileCoord[2];\n\n    this.helper.setUniformMatrixValue(\n      Uniforms.TILE_TRANSFORM,\n      mat4FromTransform(this.tempMat4, tileTransform),\n    );\n\n    this.helper.setUniformFloatValue(Uniforms.TRANSITION_ALPHA, alpha);\n    this.helper.setUniformFloatValue(Uniforms.DEPTH, depth);\n\n    let gutterExtent = renderExtent;\n    if (gutter > 0) {\n      gutterExtent = tileExtent;\n      getIntersection(gutterExtent, renderExtent, gutterExtent);\n    }\n    this.helper.setUniformFloatVec4(Uniforms.RENDER_EXTENT, gutterExtent);\n\n    this.helper.setUniformFloatValue(Uniforms.RESOLUTION, viewState.resolution);\n    this.helper.setUniformFloatValue(Uniforms.ZOOM, viewState.zoom);\n\n    this.helper.setUniformFloatValue(\n      Uniforms.TEXTURE_PIXEL_WIDTH,\n      tileWidthWithGutter,\n    );\n    this.helper.setUniformFloatValue(\n      Uniforms.TEXTURE_PIXEL_HEIGHT,\n      tileHeightWithGutter,\n    );\n    this.helper.setUniformFloatValue(\n      Uniforms.TEXTURE_RESOLUTION,\n      tileResolution,\n    );\n    this.helper.setUniformFloatValue(\n      Uniforms.TEXTURE_ORIGIN_X,\n      tileOrigin[0] +\n        tileCenterI * tileSize[0] * tileResolution -\n        gutter * tileResolution,\n    );\n    this.helper.setUniformFloatValue(\n      Uniforms.TEXTURE_ORIGIN_Y,\n      tileOrigin[1] -\n        tileCenterJ * tileSize[1] * tileResolution +\n        gutter * tileResolution,\n    );\n\n    this.helper.drawElements(0, this.indices_.getSize());\n  }\n\n  /**\n   * @param {import(\"../../pixel.js\").Pixel} pixel Pixel.\n   * @return {Uint8ClampedArray|Uint8Array|Float32Array|DataView} Data at the pixel location.\n   * @override\n   */\n  getData(pixel) {\n    const gl = this.helper.getGL();\n    if (!gl) {\n      return null;\n    }\n\n    const frameState = this.frameState;\n    if (!frameState) {\n      return null;\n    }\n\n    const layer = this.getLayer();\n    const coordinate = applyTransform(\n      frameState.pixelToCoordinateTransform,\n      pixel.slice(),\n    );\n\n    const viewState = frameState.viewState;\n    const layerExtent = layer.getExtent();\n    if (layerExtent) {\n      if (\n        !containsCoordinate(\n          fromUserExtent(layerExtent, viewState.projection),\n          coordinate,\n        )\n      ) {\n        return null;\n      }\n    }\n\n    // determine last source suitable for rendering at coordinate\n    const sources = layer.getSources(\n      boundingExtent([coordinate]),\n      viewState.resolution,\n    );\n    let i, source, tileGrid;\n    for (i = sources.length - 1; i >= 0; --i) {\n      source = sources[i];\n      if (source.getState() === 'ready') {\n        tileGrid = source.getTileGridForProjection(viewState.projection);\n        if (source.getWrapX()) {\n          break;\n        }\n        const gridExtent = tileGrid.getExtent();\n        if (!gridExtent || containsCoordinate(gridExtent, coordinate)) {\n          break;\n        }\n      }\n    }\n    if (i < 0) {\n      return null;\n    }\n\n    const tileTextureCache = this.tileRepresentationCache;\n    for (\n      let z = tileGrid.getZForResolution(viewState.resolution);\n      z >= tileGrid.getMinZoom();\n      --z\n    ) {\n      const tileCoord = tileGrid.getTileCoordForCoordAndZ(coordinate, z);\n      const cacheKey = getCacheKey(source, tileCoord);\n      if (!tileTextureCache.containsKey(cacheKey)) {\n        continue;\n      }\n      const tileTexture = tileTextureCache.get(cacheKey);\n      const tile = tileTexture.tile;\n      if (tile.getState() === TileState.EMPTY) {\n        return null;\n      }\n      if (!tileTexture.loaded) {\n        continue;\n      }\n      const tileOrigin = tileGrid.getOrigin(z);\n      const tileSize = toSize(tileGrid.getTileSize(z));\n      const tileResolution = tileGrid.getResolution(z);\n\n      const col =\n        (coordinate[0] - tileOrigin[0]) / tileResolution -\n        tileCoord[1] * tileSize[0];\n\n      const row =\n        (tileOrigin[1] - coordinate[1]) / tileResolution -\n        tileCoord[2] * tileSize[1];\n\n      return tileTexture.getPixelData(col, row);\n    }\n    return null;\n  }\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    const helper = this.helper;\n    if (helper) {\n      const gl = helper.getGL();\n      for (const paletteTexture of this.paletteTextures_) {\n        paletteTexture.delete(gl);\n      }\n      this.paletteTextures_.length = 0;\n\n      gl.deleteProgram(this.program_);\n      delete this.program_;\n      helper.deleteBuffer(this.indices_);\n    }\n    super.disposeInternal();\n    delete this.indices_;\n  }\n}\n\nexport default WebGLTileLayerRenderer;\n","/**\n * @module ol/renderer/webgl/TileLayerBase\n */\nimport TileRange from '../../TileRange.js';\nimport TileState from '../../TileState.js';\nimport {descending} from '../../array.js';\nimport {getIntersection, getRotatedViewport, isEmpty} from '../../extent.js';\nimport {fromUserExtent} from '../../proj.js';\nimport {toSize} from '../../size.js';\nimport LRUCache from '../../structs/LRUCache.js';\nimport {\n  createOrUpdate as createTileCoord,\n  getKey as getTileCoordKey,\n} from '../../tilecoord.js';\nimport {\n  create as createTransform,\n  reset as resetTransform,\n  rotate as rotateTransform,\n  scale as scaleTransform,\n  translate as translateTransform,\n} from '../../transform.js';\nimport {abstract, getUid} from '../../util.js';\nimport {create as createMat4} from '../../vec/mat4.js';\nimport WebGLLayerRenderer from './Layer.js';\n\nexport const Uniforms = {\n  TILE_TRANSFORM: 'u_tileTransform',\n  TRANSITION_ALPHA: 'u_transitionAlpha',\n  DEPTH: 'u_depth',\n  RENDER_EXTENT: 'u_renderExtent', // intersection of layer, source, and view extent\n  PATTERN_ORIGIN: 'u_patternOrigin',\n  RESOLUTION: 'u_resolution',\n  ZOOM: 'u_zoom',\n  GLOBAL_ALPHA: 'u_globalAlpha',\n  PROJECTION_MATRIX: 'u_projectionMatrix',\n  SCREEN_TO_WORLD_MATRIX: 'u_screenToWorldMatrix',\n};\n\n/**\n * Transform a zoom level into a depth value; zoom level zero has a depth value of 0.5, and increasing values\n * have a depth trending towards 0\n * @param {number} z A zoom level.\n * @return {number} A depth value.\n */\nfunction depthForZ(z) {\n  return 1 / (z + 2);\n}\n\n/**\n * @typedef {import(\"../../webgl/BaseTileRepresentation.js\").default<import(\"../../Tile.js\").default>} AbstractTileRepresentation\n */\n/**\n * @typedef {Object} TileRepresentationLookup\n * @property {Set<string>} tileIds The set of tile ids in the lookup.\n * @property {Object<number, Set<AbstractTileRepresentation>>} representationsByZ Tile representations by zoom level.\n */\n\n/**\n * @return {TileRepresentationLookup} A new tile representation lookup.\n */\nexport function newTileRepresentationLookup() {\n  return {tileIds: new Set(), representationsByZ: {}};\n}\n\n/**\n * Check if a tile is already in the tile representation lookup.\n * @param {TileRepresentationLookup} tileRepresentationLookup Lookup of tile representations by zoom level.\n * @param {import(\"../../Tile.js\").default} tile A tile.\n * @return {boolean} The tile is already in the lookup.\n */\nfunction lookupHasTile(tileRepresentationLookup, tile) {\n  return tileRepresentationLookup.tileIds.has(getUid(tile));\n}\n\n/**\n * Add a tile representation to the lookup.\n * @param {TileRepresentationLookup} tileRepresentationLookup Lookup of tile representations by zoom level.\n * @param {AbstractTileRepresentation} tileRepresentation A tile representation.\n * @param {number} z The zoom level.\n */\nfunction addTileRepresentationToLookup(\n  tileRepresentationLookup,\n  tileRepresentation,\n  z,\n) {\n  const representationsByZ = tileRepresentationLookup.representationsByZ;\n  if (!(z in representationsByZ)) {\n    representationsByZ[z] = new Set();\n  }\n  representationsByZ[z].add(tileRepresentation);\n  tileRepresentationLookup.tileIds.add(getUid(tileRepresentation.tile));\n}\n\n/**\n * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n * @param {import(\"../../extent.js\").Extent} extent The frame extent.\n * @return {import(\"../../extent.js\").Extent} Frame extent intersected with layer extents.\n */\nfunction getRenderExtent(frameState, extent) {\n  const layerState = frameState.layerStatesArray[frameState.layerIndex];\n  if (layerState.extent) {\n    extent = getIntersection(\n      extent,\n      fromUserExtent(layerState.extent, frameState.viewState.projection),\n    );\n  }\n  const source = /** @type {import(\"../../source/Tile.js\").default} */ (\n    layerState.layer.getRenderSource()\n  );\n  if (!source.getWrapX()) {\n    const gridExtent = source\n      .getTileGridForProjection(frameState.viewState.projection)\n      .getExtent();\n    if (gridExtent) {\n      extent = getIntersection(extent, gridExtent);\n    }\n  }\n  return extent;\n}\n\n/**\n * @param {import(\"../../source/Tile.js\").default} source The source.\n * @param {import('../../tilecoord.js').TileCoord} tileCoord The tile coordinate.\n * @return {string} The cache key.\n */\nexport function getCacheKey(source, tileCoord) {\n  return `${getUid(source)},${source.getKey()},${source.getRevision()},${getTileCoordKey(tileCoord)}`;\n}\n\n/**\n * @typedef {Object} Options\n * @property {Object<string, import(\"../../webgl/Helper\").UniformValue>} [uniforms] Additional uniforms\n * made available to shaders.\n * @property {number} [cacheSize=512] The tile representation cache size.\n * @property {Array<import('./Layer.js').PostProcessesOptions>} [postProcesses] Post-processes definitions.\n */\n\n/**\n * @typedef {import(\"../../layer/BaseTile.js\").default} BaseLayerType\n */\n\n/**\n * @classdesc\n * Base WebGL renderer for tile layers.\n * @template {BaseLayerType} LayerType\n * @template {import(\"../../Tile.js\").default} TileType\n * @template {import(\"../../webgl/BaseTileRepresentation.js\").default<TileType>} TileRepresentation\n * @extends {WebGLLayerRenderer<LayerType>}\n */\nclass WebGLBaseTileLayerRenderer extends WebGLLayerRenderer {\n  /**\n   * @param {LayerType} tileLayer Tile layer.\n   * @param {Options} options Options.\n   */\n  constructor(tileLayer, options) {\n    super(tileLayer, {\n      uniforms: options.uniforms,\n      postProcesses: options.postProcesses,\n    });\n\n    /**\n     * The last call to `renderFrame` was completed with all tiles loaded\n     * @type {boolean}\n     */\n    this.renderComplete = false;\n\n    /**\n     * This transform converts representation coordinates to screen coordinates.\n     * @type {import(\"../../transform.js\").Transform}\n     * @private\n     */\n    this.tileTransform_ = createTransform();\n\n    /**\n     * @type {Array<number>}\n     * @protected\n     */\n    this.tempMat4 = createMat4();\n\n    /**\n     * @type {import(\"../../TileRange.js\").default}\n     * @private\n     */\n    this.tempTileRange_ = new TileRange(0, 0, 0, 0);\n\n    /**\n     * @type {import(\"../../tilecoord.js\").TileCoord}\n     * @private\n     */\n    this.tempTileCoord_ = createTileCoord(0, 0, 0);\n\n    /**\n     * @type {import(\"../../size.js\").Size}\n     * @private\n     */\n    this.tempSize_ = [0, 0];\n\n    const cacheSize = options.cacheSize !== undefined ? options.cacheSize : 512;\n    /**\n     * @type {import(\"../../structs/LRUCache.js\").default<TileRepresentation>}\n     * @protected\n     */\n    this.tileRepresentationCache = new LRUCache(cacheSize);\n\n    /**\n     * @protected\n     * @type {import(\"../../Map.js\").FrameState|null}\n     */\n    this.frameState = null;\n\n    /**\n     * @private\n     * @type {import(\"../../proj/Projection.js\").default}\n     */\n    this.renderedProjection_ = undefined;\n  }\n\n  /**\n   * @param {Options} options Options.\n   * @override\n   */\n  reset(options) {\n    super.reset({\n      uniforms: options.uniforms,\n    });\n  }\n\n  /**\n   * Determine whether renderFrame should be called.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {boolean} Layer is ready to be rendered.\n   * @override\n   */\n  prepareFrameInternal(frameState) {\n    if (!this.renderedProjection_) {\n      this.renderedProjection_ = frameState.viewState.projection;\n    } else if (frameState.viewState.projection !== this.renderedProjection_) {\n      this.clearCache();\n      this.renderedProjection_ = frameState.viewState.projection;\n    }\n\n    const layer = this.getLayer();\n    const source = layer.getRenderSource();\n    if (!source) {\n      return false;\n    }\n\n    if (isEmpty(getRenderExtent(frameState, frameState.extent))) {\n      return false;\n    }\n    return source.getState() === 'ready';\n  }\n\n  /**\n   * @abstract\n   * @param {import(\"../../webgl/BaseTileRepresentation.js\").TileRepresentationOptions<TileType>} options tile representation options\n   * @return {TileRepresentation} A new tile representation\n   * @protected\n   */\n  createTileRepresentation(options) {\n    return abstract();\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {import(\"../../extent.js\").Extent} extent The extent to be rendered.\n   * @param {number} initialZ The zoom level.\n   * @param {TileRepresentationLookup} tileRepresentationLookup The zoom level.\n   * @param {number} preload Number of additional levels to load.\n   */\n  enqueueTiles(\n    frameState,\n    extent,\n    initialZ,\n    tileRepresentationLookup,\n    preload,\n  ) {\n    const viewState = frameState.viewState;\n    const tileLayer = this.getLayer();\n    const tileSource = tileLayer.getRenderSource();\n    const tileGrid = tileSource.getTileGridForProjection(viewState.projection);\n    const gutter = tileSource.getGutterForProjection(viewState.projection);\n\n    const tileSourceKey = getUid(tileSource);\n    if (!(tileSourceKey in frameState.wantedTiles)) {\n      frameState.wantedTiles[tileSourceKey] = {};\n    }\n\n    const wantedTiles = frameState.wantedTiles[tileSourceKey];\n    const tileRepresentationCache = this.tileRepresentationCache;\n\n    const map = tileLayer.getMapInternal();\n    const minZ = Math.max(\n      initialZ - preload,\n      tileGrid.getMinZoom(),\n      tileGrid.getZForResolution(\n        Math.min(\n          tileLayer.getMaxResolution(),\n          map\n            ? map\n                .getView()\n                .getResolutionForZoom(Math.max(tileLayer.getMinZoom(), 0))\n            : tileGrid.getResolution(0),\n        ),\n        tileSource.zDirection,\n      ),\n    );\n    const rotation = viewState.rotation;\n    const viewport = rotation\n      ? getRotatedViewport(\n          viewState.center,\n          viewState.resolution,\n          rotation,\n          frameState.size,\n        )\n      : undefined;\n    for (let z = initialZ; z >= minZ; --z) {\n      const tileRange = tileGrid.getTileRangeForExtentAndZ(\n        extent,\n        z,\n        this.tempTileRange_,\n      );\n\n      const tileResolution = tileGrid.getResolution(z);\n\n      for (let x = tileRange.minX; x <= tileRange.maxX; ++x) {\n        for (let y = tileRange.minY; y <= tileRange.maxY; ++y) {\n          if (\n            rotation &&\n            !tileGrid.tileCoordIntersectsViewport([z, x, y], viewport)\n          ) {\n            continue;\n          }\n          const tileCoord = createTileCoord(z, x, y, this.tempTileCoord_);\n          const cacheKey = getCacheKey(tileSource, tileCoord);\n\n          /** @type {TileRepresentation} */\n          let tileRepresentation;\n\n          /** @type {TileType} */\n          let tile;\n\n          if (tileRepresentationCache.containsKey(cacheKey)) {\n            tileRepresentation = tileRepresentationCache.get(cacheKey);\n            tile = tileRepresentation.tile;\n          }\n          if (\n            !tileRepresentation ||\n            tileRepresentation.tile.key !== tileSource.getKey()\n          ) {\n            tile = tileSource.getTile(\n              z,\n              x,\n              y,\n              frameState.pixelRatio,\n              viewState.projection,\n            );\n            if (!tile) {\n              continue;\n            }\n          }\n\n          if (lookupHasTile(tileRepresentationLookup, tile)) {\n            continue;\n          }\n\n          if (!tileRepresentation) {\n            tileRepresentation = this.createTileRepresentation({\n              tile: tile,\n              grid: tileGrid,\n              helper: this.helper,\n              gutter: gutter,\n            });\n            tileRepresentationCache.set(cacheKey, tileRepresentation);\n          } else {\n            tileRepresentation.setTile(tile);\n          }\n\n          addTileRepresentationToLookup(\n            tileRepresentationLookup,\n            tileRepresentation,\n            z,\n          );\n\n          const tileQueueKey = tile.getKey();\n          wantedTiles[tileQueueKey] = true;\n\n          if (tile.getState() === TileState.IDLE) {\n            if (!frameState.tileQueue.isKeyQueued(tileQueueKey)) {\n              frameState.tileQueue.enqueue([\n                tile,\n                tileSourceKey,\n                tileGrid.getTileCoordCenter(tileCoord),\n                tileResolution,\n              ]);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {boolean} tilesWithAlpha True if at least one of the rendered tiles has alpha\n   * @protected\n   */\n  beforeTilesRender(frameState, tilesWithAlpha) {\n    this.helper.prepareDraw(this.frameState, !tilesWithAlpha, true);\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {boolean} If returns false, tile mask rendering will be skipped\n   * @protected\n   */\n  beforeTilesMaskRender(frameState) {\n    return false;\n  }\n\n  /**\n   * @param {TileRepresentation} tileRepresentation Tile representation\n   * @param {import(\"../../transform.js\").Transform} tileTransform Tile transform\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state\n   * @param {import(\"../../extent.js\").Extent} renderExtent Render extent\n   * @param {number} tileResolution Tile resolution\n   * @param {import(\"../../size.js\").Size} tileSize Tile size\n   * @param {import(\"../../coordinate.js\").Coordinate} tileOrigin Tile origin\n   * @param {import(\"../../extent.js\").Extent} tileExtent tile Extent\n   * @param {number} depth Depth\n   * @param {number} gutter Gutter\n   * @param {number} alpha Alpha\n   * @protected\n   */\n  renderTile(\n    tileRepresentation,\n    tileTransform,\n    frameState,\n    renderExtent,\n    tileResolution,\n    tileSize,\n    tileOrigin,\n    tileExtent,\n    depth,\n    gutter,\n    alpha,\n  ) {}\n\n  /**\n   * @param {TileRepresentation} tileRepresentation Tile representation\n   * @param {number} tileZ Tile Z\n   * @param {import(\"../../extent.js\").Extent} extent Render extent\n   * @param {number} depth Depth\n   * @protected\n   */\n  renderTileMask(tileRepresentation, tileZ, extent, depth) {}\n\n  drawTile_(\n    frameState,\n    tileRepresentation,\n    tileZ,\n    gutter,\n    extent,\n    alphaLookup,\n    tileGrid,\n  ) {\n    if (!tileRepresentation.ready) {\n      return;\n    }\n    const tile = tileRepresentation.tile;\n    const tileCoord = tile.tileCoord;\n    const tileCoordKey = getTileCoordKey(tileCoord);\n    const alpha = tileCoordKey in alphaLookup ? alphaLookup[tileCoordKey] : 1;\n\n    const tileResolution = tileGrid.getResolution(tileZ);\n    const tileSize = toSize(tileGrid.getTileSize(tileZ), this.tempSize_);\n    const tileOrigin = tileGrid.getOrigin(tileZ);\n    const tileExtent = tileGrid.getTileCoordExtent(tileCoord);\n    // tiles with alpha are rendered last to allow blending\n    const depth = alpha < 1 ? -1 : depthForZ(tileZ);\n    if (alpha < 1) {\n      frameState.animate = true;\n    }\n\n    const viewState = frameState.viewState;\n    const centerX = viewState.center[0];\n    const centerY = viewState.center[1];\n\n    const tileWidthWithGutter = tileSize[0] + 2 * gutter;\n    const tileHeightWithGutter = tileSize[1] + 2 * gutter;\n\n    const aspectRatio = tileWidthWithGutter / tileHeightWithGutter;\n\n    const centerI = (centerX - tileOrigin[0]) / (tileSize[0] * tileResolution);\n    const centerJ = (tileOrigin[1] - centerY) / (tileSize[1] * tileResolution);\n\n    const tileScale = viewState.resolution / tileResolution;\n\n    const tileCenterI = tileCoord[1];\n    const tileCenterJ = tileCoord[2];\n\n    resetTransform(this.tileTransform_);\n    scaleTransform(\n      this.tileTransform_,\n      2 / ((frameState.size[0] * tileScale) / tileWidthWithGutter),\n      -2 / ((frameState.size[1] * tileScale) / tileWidthWithGutter),\n    );\n    rotateTransform(this.tileTransform_, viewState.rotation);\n    scaleTransform(this.tileTransform_, 1, 1 / aspectRatio);\n    translateTransform(\n      this.tileTransform_,\n      (tileSize[0] * (tileCenterI - centerI) - gutter) / tileWidthWithGutter,\n      (tileSize[1] * (tileCenterJ - centerJ) - gutter) / tileHeightWithGutter,\n    );\n\n    this.renderTile(\n      /** @type {TileRepresentation} */ (tileRepresentation),\n      this.tileTransform_,\n      frameState,\n      extent,\n      tileResolution,\n      tileSize,\n      tileOrigin,\n      tileExtent,\n      depth,\n      gutter,\n      alpha,\n    );\n  }\n\n  /**\n   * Render the layer.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {HTMLElement} The rendered element.\n   * @override\n   */\n  renderFrame(frameState) {\n    this.frameState = frameState;\n    this.renderComplete = true;\n    const gl = this.helper.getGL();\n    this.preRender(gl, frameState);\n\n    const viewState = frameState.viewState;\n    const tileLayer = this.getLayer();\n    const tileSource = tileLayer.getRenderSource();\n    const tileGrid = tileSource.getTileGridForProjection(viewState.projection);\n    const gutter = tileSource.getGutterForProjection(viewState.projection);\n    const extent = getRenderExtent(frameState, frameState.extent);\n    const z = tileGrid.getZForResolution(\n      viewState.resolution,\n      tileSource.zDirection,\n    );\n\n    /**\n     * @type {TileRepresentationLookup}\n     */\n    const tileRepresentationLookup = newTileRepresentationLookup();\n\n    const preload = tileLayer.getPreload();\n    if (frameState.nextExtent) {\n      const targetZ = tileGrid.getZForResolution(\n        viewState.nextResolution,\n        tileSource.zDirection,\n      );\n      const nextExtent = getRenderExtent(frameState, frameState.nextExtent);\n      this.enqueueTiles(\n        frameState,\n        nextExtent,\n        targetZ,\n        tileRepresentationLookup,\n        preload,\n      );\n    }\n\n    this.enqueueTiles(frameState, extent, z, tileRepresentationLookup, 0);\n    if (preload > 0) {\n      setTimeout(() => {\n        this.enqueueTiles(\n          frameState,\n          extent,\n          z - 1,\n          tileRepresentationLookup,\n          preload - 1,\n        );\n      }, 0);\n    }\n\n    /**\n     * A lookup of alpha values for tiles at the target rendering resolution\n     * for tiles that are in transition.  If a tile coord key is absent from\n     * this lookup, the tile should be rendered at alpha 1.\n     * @type {Object<string, number>}\n     */\n    const alphaLookup = {};\n\n    let blend = false;\n    const representationsByZ = tileRepresentationLookup.representationsByZ;\n\n    // look for cached tiles to use if a target tile is not ready\n    if (z in representationsByZ) {\n      const uid = getUid(this);\n      const time = frameState.time;\n      for (const tileRepresentation of representationsByZ[z]) {\n        const tile = tileRepresentation.tile;\n        if (tile.getState() === TileState.EMPTY) {\n          continue;\n        }\n        const tileCoord = tile.tileCoord;\n\n        if (tileRepresentation.ready) {\n          const alpha = tile.getAlpha(uid, time);\n          if (alpha === 1) {\n            // no need to look for alt tiles\n            tile.endTransition(uid);\n            continue;\n          }\n          blend = true;\n          const tileCoordKey = getTileCoordKey(tileCoord);\n          alphaLookup[tileCoordKey] = alpha;\n        }\n        this.renderComplete = false;\n\n        // first look for child tiles (at z + 1)\n        const coveredByChildren = this.findAltTiles_(\n          tileGrid,\n          tileCoord,\n          z + 1,\n          tileRepresentationLookup,\n        );\n\n        if (coveredByChildren) {\n          continue;\n        }\n\n        // next look for parent tiles\n        const minZoom = tileGrid.getMinZoom();\n        for (let parentZ = z - 1; parentZ >= minZoom; --parentZ) {\n          const coveredByParent = this.findAltTiles_(\n            tileGrid,\n            tileCoord,\n            parentZ,\n            tileRepresentationLookup,\n          );\n\n          if (coveredByParent) {\n            break;\n          }\n        }\n      }\n    }\n\n    const zs = Object.keys(representationsByZ).map(Number).sort(descending);\n\n    const renderTileMask = this.beforeTilesMaskRender(frameState);\n\n    if (renderTileMask) {\n      for (let j = 0, jj = zs.length; j < jj; ++j) {\n        const tileZ = zs[j];\n        for (const tileRepresentation of representationsByZ[tileZ]) {\n          const tileCoord = tileRepresentation.tile.tileCoord;\n          const tileCoordKey = getTileCoordKey(tileCoord);\n          // do not render the tile mask if alpha < 1\n          if (tileCoordKey in alphaLookup) {\n            continue;\n          }\n          const tileExtent = tileGrid.getTileCoordExtent(tileCoord);\n          this.renderTileMask(\n            /** @type {TileRepresentation} */ (tileRepresentation),\n            tileZ,\n            tileExtent,\n            depthForZ(tileZ),\n          );\n        }\n      }\n    }\n\n    this.beforeTilesRender(frameState, blend);\n\n    for (let j = 0, jj = zs.length; j < jj; ++j) {\n      const tileZ = zs[j];\n      for (const tileRepresentation of representationsByZ[tileZ]) {\n        const tileCoord = tileRepresentation.tile.tileCoord;\n        const tileCoordKey = getTileCoordKey(tileCoord);\n        if (tileCoordKey in alphaLookup) {\n          continue;\n        }\n\n        this.drawTile_(\n          frameState,\n          tileRepresentation,\n          tileZ,\n          gutter,\n          extent,\n          alphaLookup,\n          tileGrid,\n        );\n      }\n    }\n\n    if (z in representationsByZ) {\n      for (const tileRepresentation of representationsByZ[z]) {\n        const tileCoord = tileRepresentation.tile.tileCoord;\n        const tileCoordKey = getTileCoordKey(tileCoord);\n        if (tileCoordKey in alphaLookup) {\n          this.drawTile_(\n            frameState,\n            tileRepresentation,\n            z,\n            gutter,\n            extent,\n            alphaLookup,\n            tileGrid,\n          );\n        }\n      }\n    }\n\n    this.beforeFinalize(frameState);\n    this.helper.finalizeDraw(\n      frameState,\n      this.dispatchPreComposeEvent,\n      this.dispatchPostComposeEvent,\n    );\n\n    const canvas = this.helper.getCanvas();\n\n    const tileRepresentationCache = this.tileRepresentationCache;\n    while (tileRepresentationCache.canExpireCache()) {\n      const tileRepresentation = tileRepresentationCache.pop();\n      tileRepresentation.dispose();\n    }\n\n    this.postRender(gl, frameState);\n    return canvas;\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @protected\n   */\n  beforeFinalize(frameState) {\n    return;\n  }\n\n  /**\n   * Look for tiles covering the provided tile coordinate at an alternate\n   * zoom level.  Loaded tiles will be added to the provided tile representation lookup.\n   * @param {import(\"../../tilegrid/TileGrid.js\").default} tileGrid The tile grid.\n   * @param {import(\"../../tilecoord.js\").TileCoord} tileCoord The target tile coordinate.\n   * @param {number} altZ The alternate zoom level.\n   * @param {TileRepresentationLookup} tileRepresentationLookup Lookup of\n   * tile representations by zoom level.\n   * @return {boolean} The tile coordinate is covered by loaded tiles at the alternate zoom level.\n   * @private\n   */\n  findAltTiles_(tileGrid, tileCoord, altZ, tileRepresentationLookup) {\n    const tileRange = tileGrid.getTileRangeForTileCoordAndZ(\n      tileCoord,\n      altZ,\n      this.tempTileRange_,\n    );\n\n    if (!tileRange) {\n      return false;\n    }\n\n    let covered = true;\n    const tileRepresentationCache = this.tileRepresentationCache;\n    const source = this.getLayer().getRenderSource();\n    for (let x = tileRange.minX; x <= tileRange.maxX; ++x) {\n      for (let y = tileRange.minY; y <= tileRange.maxY; ++y) {\n        const cacheKey = getCacheKey(source, [altZ, x, y]);\n        let loaded = false;\n        if (tileRepresentationCache.containsKey(cacheKey)) {\n          const tileRepresentation = tileRepresentationCache.get(cacheKey);\n          if (\n            tileRepresentation.ready &&\n            !lookupHasTile(tileRepresentationLookup, tileRepresentation.tile)\n          ) {\n            addTileRepresentationToLookup(\n              tileRepresentationLookup,\n              tileRepresentation,\n              altZ,\n            );\n            loaded = true;\n          }\n        }\n        if (!loaded) {\n          covered = false;\n        }\n      }\n    }\n    return covered;\n  }\n\n  /**\n   * @override\n   */\n  clearCache() {\n    super.clearCache();\n\n    const tileRepresentationCache = this.tileRepresentationCache;\n    tileRepresentationCache.forEach((tileRepresentation) =>\n      tileRepresentation.dispose(),\n    );\n    tileRepresentationCache.clear();\n  }\n\n  /**\n   * @override\n   */\n  afterHelperCreated() {\n    super.afterHelperCreated();\n\n    this.tileRepresentationCache.forEach((tileRepresentation) =>\n      tileRepresentation.setHelper(this.helper),\n    );\n  }\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    super.disposeInternal();\n    delete this.frameState;\n  }\n}\n\nexport default WebGLBaseTileLayerRenderer;\n","/**\n * @module ol/structs/LRUCache\n */\n\nimport Disposable from '../Disposable.js';\nimport {assert} from '../asserts.js';\n\n/**\n * @typedef {Object} Entry\n * @property {string} key_ Key.\n * @property {Entry|null} newer Newer.\n * @property {Entry|null} older Older.\n * @property {*} value_ Value.\n */\n\n/**\n * @classdesc\n * Implements a Least-Recently-Used cache where the keys do not conflict with\n * Object's properties (e.g. 'hasOwnProperty' is not allowed as a key). Expiring\n * items from the cache is the responsibility of the user.\n *\n * @fires import(\"../events/Event.js\").default\n * @template T\n */\nclass LRUCache {\n  /**\n   * @param {number} [highWaterMark] High water mark.\n   */\n  constructor(highWaterMark) {\n    /**\n     * Desired max cache size after expireCache(). If set to 0, no cache entries\n     * will be pruned at all.\n     * @type {number}\n     */\n    this.highWaterMark = highWaterMark !== undefined ? highWaterMark : 2048;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.count_ = 0;\n\n    /**\n     * @private\n     * @type {!Object<string, Entry>}\n     */\n    this.entries_ = {};\n\n    /**\n     * @private\n     * @type {?Entry}\n     */\n    this.oldest_ = null;\n\n    /**\n     * @private\n     * @type {?Entry}\n     */\n    this.newest_ = null;\n  }\n\n  deleteOldest() {\n    const entry = this.pop();\n    if (entry instanceof Disposable) {\n      entry.dispose();\n    }\n  }\n\n  /**\n   * @return {boolean} Can expire cache.\n   */\n  canExpireCache() {\n    return this.highWaterMark > 0 && this.getCount() > this.highWaterMark;\n  }\n\n  /**\n   * Expire the cache. When the cache entry is a {@link module:ol/Disposable~Disposable},\n   * the entry will be disposed.\n   * @param {!Object<string, boolean>} [keep] Keys to keep. To be implemented by subclasses.\n   */\n  expireCache(keep) {\n    while (this.canExpireCache()) {\n      this.deleteOldest();\n    }\n  }\n\n  /**\n   * FIXME empty description for jsdoc\n   */\n  clear() {\n    while (this.oldest_) {\n      this.deleteOldest();\n    }\n  }\n\n  /**\n   * @param {string} key Key.\n   * @return {boolean} Contains key.\n   */\n  containsKey(key) {\n    return this.entries_.hasOwnProperty(key);\n  }\n\n  /**\n   * @param {function(T, string, LRUCache<T>): ?} f The function\n   *     to call for every entry from the oldest to the newer. This function takes\n   *     3 arguments (the entry value, the entry key and the LRUCache object).\n   *     The return value is ignored.\n   */\n  forEach(f) {\n    let entry = this.oldest_;\n    while (entry) {\n      f(entry.value_, entry.key_, this);\n      entry = entry.newer;\n    }\n  }\n\n  /**\n   * @param {string} key Key.\n   * @param {*} [options] Options (reserved for subclasses).\n   * @return {T} Value.\n   */\n  get(key, options) {\n    const entry = this.entries_[key];\n    assert(\n      entry !== undefined,\n      'Tried to get a value for a key that does not exist in the cache',\n    );\n    if (entry === this.newest_) {\n      return entry.value_;\n    }\n    if (entry === this.oldest_) {\n      this.oldest_ = /** @type {Entry} */ (this.oldest_.newer);\n      this.oldest_.older = null;\n    } else {\n      entry.newer.older = entry.older;\n      entry.older.newer = entry.newer;\n    }\n    entry.newer = null;\n    entry.older = this.newest_;\n    this.newest_.newer = entry;\n    this.newest_ = entry;\n    return entry.value_;\n  }\n\n  /**\n   * Remove an entry from the cache.\n   * @param {string} key The entry key.\n   * @return {T} The removed entry.\n   */\n  remove(key) {\n    const entry = this.entries_[key];\n    assert(\n      entry !== undefined,\n      'Tried to get a value for a key that does not exist in the cache',\n    );\n    if (entry === this.newest_) {\n      this.newest_ = /** @type {Entry} */ (entry.older);\n      if (this.newest_) {\n        this.newest_.newer = null;\n      }\n    } else if (entry === this.oldest_) {\n      this.oldest_ = /** @type {Entry} */ (entry.newer);\n      if (this.oldest_) {\n        this.oldest_.older = null;\n      }\n    } else {\n      entry.newer.older = entry.older;\n      entry.older.newer = entry.newer;\n    }\n    delete this.entries_[key];\n    --this.count_;\n    return entry.value_;\n  }\n\n  /**\n   * @return {number} Count.\n   */\n  getCount() {\n    return this.count_;\n  }\n\n  /**\n   * @return {Array<string>} Keys.\n   */\n  getKeys() {\n    const keys = new Array(this.count_);\n    let i = 0;\n    let entry;\n    for (entry = this.newest_; entry; entry = entry.older) {\n      keys[i++] = entry.key_;\n    }\n    return keys;\n  }\n\n  /**\n   * @return {Array<T>} Values.\n   */\n  getValues() {\n    const values = new Array(this.count_);\n    let i = 0;\n    let entry;\n    for (entry = this.newest_; entry; entry = entry.older) {\n      values[i++] = entry.value_;\n    }\n    return values;\n  }\n\n  /**\n   * @return {T} Last value.\n   */\n  peekLast() {\n    return this.oldest_.value_;\n  }\n\n  /**\n   * @return {string} Last key.\n   */\n  peekLastKey() {\n    return this.oldest_.key_;\n  }\n\n  /**\n   * Get the key of the newest item in the cache.  Throws if the cache is empty.\n   * @return {string} The newest key.\n   */\n  peekFirstKey() {\n    return this.newest_.key_;\n  }\n\n  /**\n   * Return an entry without updating least recently used time.\n   * @param {string} key Key.\n   * @return {T|undefined} Value.\n   */\n  peek(key) {\n    return this.entries_[key]?.value_;\n  }\n\n  /**\n   * @return {T} value Value.\n   */\n  pop() {\n    const entry = this.oldest_;\n    delete this.entries_[entry.key_];\n    if (entry.newer) {\n      entry.newer.older = null;\n    }\n    this.oldest_ = /** @type {Entry} */ (entry.newer);\n    if (!this.oldest_) {\n      this.newest_ = null;\n    }\n    --this.count_;\n    return entry.value_;\n  }\n\n  /**\n   * @param {string} key Key.\n   * @param {T} value Value.\n   */\n  replace(key, value) {\n    this.get(key); // update `newest_`\n    this.entries_[key].value_ = value;\n  }\n\n  /**\n   * @param {string} key Key.\n   * @param {T} value Value.\n   */\n  set(key, value) {\n    assert(\n      !(key in this.entries_),\n      'Tried to set a value for a key that is used already',\n    );\n    const entry = {\n      key_: key,\n      newer: null,\n      older: this.newest_,\n      value_: value,\n    };\n    if (!this.newest_) {\n      this.oldest_ = entry;\n    } else {\n      this.newest_.newer = entry;\n    }\n    this.newest_ = entry;\n    this.entries_[key] = entry;\n    ++this.count_;\n  }\n\n  /**\n   * Set a maximum number of entries for the cache.\n   * @param {number} size Cache size.\n   * @api\n   */\n  setSize(size) {\n    this.highWaterMark = size;\n  }\n}\n\nexport default LRUCache;\n","/**\n * @module ol/vec/mat4\n */\n\n/** @typedef {Array<number>} Mat4 */\n\n/**\n * @return {Mat4} \"4x4 matrix representing a 3D identity transform.\"\n */\nexport function create() {\n  return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n}\n\n/**\n * @param {Mat4} mat4 Flattened 4x4 matrix receiving the result.\n * @param {import(\"../transform.js\").Transform} transform Transformation matrix.\n * @return {Mat4} \"2D transformation matrix as flattened 4x4 matrix.\"\n */\nexport function fromTransform(mat4, transform) {\n  mat4[0] = transform[0];\n  mat4[1] = transform[1];\n  mat4[4] = transform[2];\n  mat4[5] = transform[3];\n  mat4[12] = transform[4];\n  mat4[13] = transform[5];\n  return mat4;\n}\n\n/**\n * Generates a orthogonal projection matrix with the given bounds\n *\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @param {Mat4} [out] mat4 frustum matrix will be written into\n * @return {Mat4} out\n */\nexport function orthographic(left, right, bottom, top, near, far, out) {\n  out = out ?? create();\n  const lr = 1 / (left - right),\n    bt = 1 / (bottom - top),\n    nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 2 * nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = (far + near) * nf;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Scales the mat4 by the dimensions in the given vec3\n *\n * @param {Mat4} m The matrix to scale.\n * @param {number} x How much to scale in the x direction.\n * @param {number} y How much to scale in the y direction.\n * @param {number} z How much to scale in the z direction.\n * @param {Mat4} [out] The matrix to write to.\n * @return {Mat4} out\n */\nexport function scale(m, x, y, z, out) {\n  out = out ?? create();\n  out[0] = m[0] * x;\n  out[1] = m[1] * x;\n  out[2] = m[2] * x;\n  out[3] = m[3] * x;\n  out[4] = m[4] * y;\n  out[5] = m[5] * y;\n  out[6] = m[6] * y;\n  out[7] = m[7] * y;\n  out[8] = m[8] * z;\n  out[9] = m[9] * z;\n  out[10] = m[10] * z;\n  out[11] = m[11] * z;\n  out[12] = m[12];\n  out[13] = m[13];\n  out[14] = m[14];\n  out[15] = m[15];\n  return out;\n}\n\n/**\n * Translate a matrix.\n *\n * @param {Mat4} m the matrix to translate\n * @param {number} x How much to translate in the x direction.\n * @param {number} y How much to translate in the y direction.\n * @param {number} z How much to translate in the z direction.\n * @param {Mat4} [out] the receiving matrix\n * @return {Mat4} out\n */\nexport function translate(m, x, y, z, out) {\n  out = out ?? create();\n  let a00, a01, a02, a03, a10, a11, a12, a13, a20, a21, a22, a23;\n\n  if (m === out) {\n    out[12] = m[0] * x + m[4] * y + m[8] * z + m[12];\n    out[13] = m[1] * x + m[5] * y + m[9] * z + m[13];\n    out[14] = m[2] * x + m[6] * y + m[10] * z + m[14];\n    out[15] = m[3] * x + m[7] * y + m[11] * z + m[15];\n  } else {\n    a00 = m[0];\n    a01 = m[1];\n    a02 = m[2];\n    a03 = m[3];\n    a10 = m[4];\n    a11 = m[5];\n    a12 = m[6];\n    a13 = m[7];\n    a20 = m[8];\n    a21 = m[9];\n    a22 = m[10];\n    a23 = m[11];\n\n    out[0] = a00;\n    out[1] = a01;\n    out[2] = a02;\n    out[3] = a03;\n    out[4] = a10;\n    out[5] = a11;\n    out[6] = a12;\n    out[7] = a13;\n    out[8] = a20;\n    out[9] = a21;\n    out[10] = a22;\n    out[11] = a23;\n\n    out[12] = a00 * x + a10 * y + a20 * z + m[12];\n    out[13] = a01 * x + a11 * y + a21 * z + m[13];\n    out[14] = a02 * x + a12 * y + a22 * z + m[14];\n    out[15] = a03 * x + a13 * y + a23 * z + m[15];\n  }\n\n  return out;\n}\n\n/**\n * @param {number} x x translation.\n * @param {number} y y translation.\n * @param {number} z z translation.\n * @param {Mat4} [out] optional matrix to store result\n * @return {Mat4} out\n */\nexport function translation(x, y, z, out) {\n  out = out ?? create();\n\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = x;\n  out[13] = y;\n  out[14] = z;\n  out[15] = 1;\n\n  return out;\n}\n","/**\n * @module ol/webgl\n */\n\nimport {SAFARI_BUG_237906} from './has.js';\n\n/**\n * Constants taken from goog.webgl\n */\n\n/**\n * Used by {@link module:ol/webgl/Helper~WebGLHelper} for buffers containing vertices data, such as\n * position, color, texture coordinate, etc. These vertices are then referenced by an index buffer\n * to be drawn on screen (see {@link module:ol/webgl.ELEMENT_ARRAY_BUFFER}).\n * @const\n * @type {number}\n * @api\n */\nexport const ARRAY_BUFFER = 0x8892;\n\n/**\n * Used by {@link module:ol/webgl/Helper~WebGLHelper} for buffers containing indices data.\n * Index buffers are essentially lists of references to vertices defined in a vertex buffer\n * (see {@link module:ol/webgl.ARRAY_BUFFER}), and define the primitives (triangles) to be drawn.\n * @const\n * @type {number}\n * @api\n */\nexport const ELEMENT_ARRAY_BUFFER = 0x8893;\n\n/**\n * Used by {link module:ol/webgl/Buffer~WebGLArrayBuffer}.\n * @const\n * @type {number}\n * @api\n */\nexport const STREAM_DRAW = 0x88e0;\n\n/**\n * Used by {link module:ol/webgl/Buffer~WebGLArrayBuffer}.\n * @const\n * @type {number}\n * @api\n */\nexport const STATIC_DRAW = 0x88e4;\n\n/**\n * Used by {link module:ol/webgl/Buffer~WebGLArrayBuffer}.\n * @const\n * @type {number}\n * @api\n */\nexport const DYNAMIC_DRAW = 0x88e8;\n\n/**\n * @const\n * @type {number}\n */\nexport const UNSIGNED_BYTE = 0x1401;\n\n/**\n * @const\n * @type {number}\n */\nexport const UNSIGNED_SHORT = 0x1403;\n\n/**\n * @const\n * @type {number}\n */\nexport const UNSIGNED_INT = 0x1405;\n\n/**\n * @const\n * @type {number}\n */\nexport const FLOAT = 0x1406;\n\n/**\n  end of goog.webgl constants\n */\n\n/**\n * @const\n * @type {Array<string>}\n */\nconst CONTEXT_IDS = ['experimental-webgl', 'webgl', 'webkit-3d', 'moz-webgl'];\n\n/**\n * @param {HTMLCanvasElement} canvas Canvas.\n * @param {Object} [attributes] Attributes.\n * @return {WebGLRenderingContext|null} WebGL rendering context.\n */\nexport function getContext(canvas, attributes) {\n  attributes = Object.assign(\n    {\n      preserveDrawingBuffer: true,\n      antialias: SAFARI_BUG_237906 ? false : true, // https://bugs.webkit.org/show_bug.cgi?id=237906\n    },\n    attributes,\n  );\n  const ii = CONTEXT_IDS.length;\n  for (let i = 0; i < ii; ++i) {\n    try {\n      const context = canvas.getContext(CONTEXT_IDS[i], attributes);\n      if (context) {\n        return /** @type {!WebGLRenderingContext} */ (context);\n      }\n    } catch {\n      // pass\n    }\n  }\n  return null;\n}\n\n/**\n * @type {Array<string>|null}\n */\nlet supportedExtensions = null;\n\n/**\n * @return {Array<string>|null} List of supported WebGL extensions.\n */\nexport function getSupportedExtensions() {\n  if (!supportedExtensions) {\n    const canvas = document.createElement('canvas');\n    const gl = getContext(canvas);\n    if (gl) {\n      supportedExtensions = gl.getSupportedExtensions();\n    }\n  }\n  return supportedExtensions;\n}\n","/**\n * @module ol/webgl/BaseTileRepresentation\n */\n\nimport ImageTile from '../ImageTile.js';\nimport TileState from '../TileState.js';\nimport EventType from '../events/EventType.js';\nimport EventTarget from '../events/Target.js';\nimport {abstract} from '../util.js';\n\n/**\n * @typedef {import(\"../Tile.js\").default} BaseTileType\n */\n\n/**\n * @template {BaseTileType} TileType\n * @typedef {Object} TileRepresentationOptions\n * @property {TileType} tile The tile.\n * @property {import(\"../tilegrid/TileGrid.js\").default} grid Tile grid.\n * @property {import(\"../webgl/Helper.js\").default} helper WebGL helper.\n * @property {number} [gutter=0] The size in pixels of the gutter around image tiles to ignore.\n */\n\n/**\n * @classdesc\n * Base class for representing a tile in a webgl context\n * @template {import(\"../Tile.js\").default} TileType\n * @abstract\n */\nclass BaseTileRepresentation extends EventTarget {\n  /**\n   * @param {TileRepresentationOptions<TileType>} options The tile representation options.\n   */\n  constructor(options) {\n    super();\n\n    /**\n     * @type {TileType}\n     */\n    this.tile;\n\n    /**\n     * @private\n     */\n    this.handleTileChange_ = this.handleTileChange_.bind(this);\n\n    /**\n     * @type {number}\n     * @protected\n     */\n    this.gutter = options.gutter || 0;\n\n    /**\n     * @type {import(\"../webgl/Helper.js\").default}\n     * @protected\n     */\n    this.helper = options.helper;\n\n    this.loaded = false;\n    this.ready = false;\n  }\n\n  /**\n   * @param {TileType} tile Tile.\n   */\n  setTile(tile) {\n    if (tile !== this.tile) {\n      if (this.tile) {\n        this.tile.removeEventListener(EventType.CHANGE, this.handleTileChange_);\n      }\n      this.tile = tile;\n      this.loaded = tile.getState() === TileState.LOADED;\n      if (this.loaded) {\n        this.uploadTile();\n      } else {\n        if (tile instanceof ImageTile) {\n          const image = tile.getImage();\n          if (image instanceof Image && !image.crossOrigin) {\n            image.crossOrigin = 'anonymous';\n          }\n        }\n        tile.addEventListener(EventType.CHANGE, this.handleTileChange_);\n      }\n    }\n  }\n\n  /**\n   * @abstract\n   * @protected\n   */\n  uploadTile() {\n    abstract();\n  }\n\n  setReady() {\n    this.ready = true;\n    this.dispatchEvent(EventType.CHANGE);\n  }\n\n  handleTileChange_() {\n    if (this.tile.getState() === TileState.LOADED) {\n      this.loaded = true;\n      this.uploadTile();\n    }\n  }\n\n  /**\n   * @param {import(\"./Helper.js\").default} helper The WebGL helper.\n   */\n  setHelper(helper) {\n    this.helper = helper;\n    if (this.helper && this.loaded) {\n      this.uploadTile();\n    }\n  }\n\n  /**\n   * @override\n   */\n  disposeInternal() {\n    this.setHelper(null);\n    this.tile.removeEventListener(EventType.CHANGE, this.handleTileChange_);\n  }\n}\n\nexport default BaseTileRepresentation;\n","/**\n * @module ol/webgl/Buffer\n */\nimport {assert} from '../asserts.js';\nimport {\n  ARRAY_BUFFER,\n  DYNAMIC_DRAW,\n  ELEMENT_ARRAY_BUFFER,\n  STATIC_DRAW,\n  STREAM_DRAW,\n} from '../webgl.js';\n\n/**\n * Used to describe the intended usage for the data: `STATIC_DRAW`, `STREAM_DRAW`\n * or `DYNAMIC_DRAW`.\n * @enum {number}\n */\nexport const BufferUsage = {\n  STATIC_DRAW: STATIC_DRAW,\n  STREAM_DRAW: STREAM_DRAW,\n  DYNAMIC_DRAW: DYNAMIC_DRAW,\n};\n\n/**\n * @classdesc\n * Object used to store an array of data as well as usage information for that data.\n * Stores typed arrays internally, either Float32Array or Uint16/32Array depending on\n * the buffer type (ARRAY_BUFFER or ELEMENT_ARRAY_BUFFER) and available extensions.\n *\n * To populate the array, you can either use:\n * A size using `#ofSize(buffer)`\n * An `ArrayBuffer` object using `#fromArrayBuffer(buffer)`\n * A plain array using `#fromArray(array)`\n *\n * Note:\n * See the documentation of [WebGLRenderingContext.bufferData](https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/bufferData)\n * for more info on buffer usage.\n */\nclass WebGLArrayBuffer {\n  /**\n   * @param {number} type Buffer type, either ARRAY_BUFFER or ELEMENT_ARRAY_BUFFER.\n   * @param {number} [usage] Intended usage, either `STATIC_DRAW`, `STREAM_DRAW` or `DYNAMIC_DRAW`.\n   * Default is `STATIC_DRAW`.\n   */\n  constructor(type, usage) {\n    /**\n     * @private\n     * @type {Float32Array|Uint32Array|null}\n     */\n    this.array_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.type_ = type;\n\n    assert(\n      type === ARRAY_BUFFER || type === ELEMENT_ARRAY_BUFFER,\n      'A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`',\n    );\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.usage_ = usage !== undefined ? usage : BufferUsage.STATIC_DRAW;\n  }\n\n  /**\n   * Populates the buffer with an array of the given size (all values will be zeroes).\n   * @param {number} size Array size\n   * @return {WebGLArrayBuffer} This\n   */\n  ofSize(size) {\n    this.array_ = new (getArrayClassForType(this.type_))(size);\n    return this;\n  }\n\n  /**\n   * Populates the buffer with an array of the given size.\n   * @param {Array<number>} array Numerical array\n   * @return {WebGLArrayBuffer} This\n   */\n  fromArray(array) {\n    this.array_ = getArrayClassForType(this.type_).from(array);\n    return this;\n  }\n\n  /**\n   * Populates the buffer with a raw binary array buffer.\n   * @param {ArrayBuffer} buffer Raw binary buffer to populate the array with. Note that this buffer must have been\n   * initialized for the same typed array class.\n   * @return {WebGLArrayBuffer} This\n   */\n  fromArrayBuffer(buffer) {\n    this.array_ = new (getArrayClassForType(this.type_))(buffer);\n    return this;\n  }\n\n  /**\n   * @return {number} Buffer type.\n   */\n  getType() {\n    return this.type_;\n  }\n\n  /**\n   * Will return null if the buffer was not initialized\n   * @return {Float32Array|Uint32Array|null} Array.\n   */\n  getArray() {\n    return this.array_;\n  }\n\n  /**\n   * @param {Float32Array|Uint32Array} array Array.\n   */\n  setArray(array) {\n    const ArrayType = getArrayClassForType(this.type_);\n    if (!(array instanceof ArrayType)) {\n      throw new Error(`Expected ${ArrayType}`);\n    }\n    this.array_ = array;\n  }\n\n  /**\n   * @return {number} Usage.\n   */\n  getUsage() {\n    return this.usage_;\n  }\n\n  /**\n   * Will return 0 if the buffer is not initialized\n   * @return {number} Array size\n   */\n  getSize() {\n    return this.array_ ? this.array_.length : 0;\n  }\n}\n\n/**\n * Returns a typed array constructor based on the given buffer type\n * @param {number} type Buffer type, either ARRAY_BUFFER or ELEMENT_ARRAY_BUFFER.\n * @return {Float32ArrayConstructor|Uint32ArrayConstructor} The typed array class to use for this buffer.\n */\nexport function getArrayClassForType(type) {\n  switch (type) {\n    case ARRAY_BUFFER:\n      return Float32Array;\n    case ELEMENT_ARRAY_BUFFER:\n      return Uint32Array;\n    default:\n      return Float32Array;\n  }\n}\n\nexport default WebGLArrayBuffer;\n","/**\n * @module ol/webgl/ContextEventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  LOST: 'webglcontextlost',\n  RESTORED: 'webglcontextrestored',\n};\n","/**\n * @module ol/webgl/PostProcessingPass\n */\n\nimport {getUid} from '../util.js';\n\nconst DEFAULT_VERTEX_SHADER = `\n  precision mediump float;\n\n  attribute vec2 a_position;\n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n\n  uniform vec2 u_screenSize;\n\n  void main() {\n    v_texCoord = a_position * 0.5 + 0.5;\n    v_screenCoord = v_texCoord * u_screenSize;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n  }\n`;\n\nconst DEFAULT_FRAGMENT_SHADER = `\n  precision mediump float;\n\n  uniform sampler2D u_image;\n  uniform float u_opacity;\n\n  varying vec2 v_texCoord;\n\n  void main() {\n    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n  }\n`;\n\n/**\n * @typedef {Object} Options\n * @property {WebGLRenderingContext} webGlContext WebGL context; mandatory.\n * @property {number} [scaleRatio] Scale ratio; if < 1, the post process will render to a texture smaller than\n * the main canvas that will then be sampled up (useful for saving resource on blur steps).\n * @property {string} [vertexShader] Vertex shader source\n * @property {string} [fragmentShader] Fragment shader source\n * @property {Object<string,import(\"./Helper\").UniformValue>} [uniforms] Uniform definitions for the post process step\n */\n\n/**\n * @typedef {Object} UniformInternalDescription\n * @property {import(\"./Helper\").UniformValue} value Value\n * @property {WebGLUniformLocation} location Location\n * @property {WebGLTexture} [texture] Texture\n * @private\n */\n\n/**\n * @classdesc\n * This class is used to define Post Processing passes with custom shaders and uniforms.\n * This is used internally by {@link module:ol/webgl/Helper~WebGLHelper}.\n *\n * Please note that the final output on the DOM canvas is expected to have premultiplied alpha, which means that\n * a pixel which is 100% red with an opacity of 50% must have a color of (r=0.5, g=0, b=0, a=0.5).\n * Failing to provide pixel colors with premultiplied alpha will result in render anomalies.\n *\n * The default post-processing pass does *not* multiply color values with alpha value, it expects color values to be\n * premultiplied.\n *\n * Default shaders are shown hereafter:\n *\n * Vertex shader:\n *\n *   ```\n *   precision mediump float;\n *\n *   attribute vec2 a_position;\n *   varying vec2 v_texCoord;\n *   varying vec2 v_screenCoord;\n *\n *   uniform vec2 u_screenSize;\n *\n *   void main() {\n *     v_texCoord = a_position * 0.5 + 0.5;\n *     v_screenCoord = v_texCoord * u_screenSize;\n *     gl_Position = vec4(a_position, 0.0, 1.0);\n *   }\n *   ```\n *\n * Fragment shader:\n *\n *   ```\n *   precision mediump float;\n *\n *   uniform sampler2D u_image;\n *   uniform float u_opacity;\n *\n *   varying vec2 v_texCoord;\n *\n *   void main() {\n *     gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n *   }\n *   ```\n */\nclass WebGLPostProcessingPass {\n  /**\n   * @param {Options} options Options.\n   */\n  constructor(options) {\n    /**\n     * @private\n     */\n    this.gl_ = options.webGlContext;\n    const gl = this.gl_;\n\n    /**\n     * @private\n     */\n    this.scaleRatio_ = options.scaleRatio || 1;\n\n    /**\n     * @type {WebGLTexture}\n     * @private\n     */\n    this.renderTargetTexture_ = gl.createTexture();\n\n    /**\n     * @type {import('../size.js').Size|null}\n     * @private\n     */\n    this.renderTargetTextureSize_ = null;\n\n    /**\n     * @private\n     */\n    this.frameBuffer_ = gl.createFramebuffer();\n    /**\n     * @private\n     */\n    this.depthBuffer_ = gl.createRenderbuffer();\n\n    // compile the program for the frame buffer\n    // TODO: make compilation errors show up\n    const vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(\n      vertexShader,\n      options.vertexShader || DEFAULT_VERTEX_SHADER,\n    );\n    gl.compileShader(vertexShader);\n    const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(\n      fragmentShader,\n      options.fragmentShader || DEFAULT_FRAGMENT_SHADER,\n    );\n    gl.compileShader(fragmentShader);\n    /**\n     * @private\n     */\n    this.renderTargetProgram_ = gl.createProgram();\n    gl.attachShader(this.renderTargetProgram_, vertexShader);\n    gl.attachShader(this.renderTargetProgram_, fragmentShader);\n    gl.linkProgram(this.renderTargetProgram_);\n\n    // bind the vertices buffer for the frame buffer\n    /**\n     * @private\n     */\n    this.renderTargetVerticesBuffer_ = gl.createBuffer();\n    const verticesArray = [-1, -1, 1, -1, -1, 1, 1, -1, 1, 1, -1, 1];\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.renderTargetVerticesBuffer_);\n    gl.bufferData(\n      gl.ARRAY_BUFFER,\n      new Float32Array(verticesArray),\n      gl.STATIC_DRAW,\n    );\n\n    /**\n     * @private\n     */\n    this.renderTargetAttribLocation_ = gl.getAttribLocation(\n      this.renderTargetProgram_,\n      'a_position',\n    );\n    /**\n     * @private\n     */\n    this.renderTargetUniformLocation_ = gl.getUniformLocation(\n      this.renderTargetProgram_,\n      'u_screenSize',\n    );\n    /**\n     * @private\n     */\n    this.renderTargetOpacityLocation_ = gl.getUniformLocation(\n      this.renderTargetProgram_,\n      'u_opacity',\n    );\n    /**\n     * @private\n     */\n    this.renderTargetTextureLocation_ = gl.getUniformLocation(\n      this.renderTargetProgram_,\n      'u_image',\n    );\n\n    /**\n     * Holds info about custom uniforms used in the post processing pass\n     * @type {Array<UniformInternalDescription>}\n     * @private\n     */\n    this.uniforms_ = [];\n    options.uniforms &&\n      Object.keys(options.uniforms).forEach((name) => {\n        this.uniforms_.push({\n          value: options.uniforms[name],\n          location: gl.getUniformLocation(this.renderTargetProgram_, name),\n        });\n      });\n  }\n\n  getRenderTargetTexture() {\n    return this.renderTargetTexture_;\n  }\n\n  /**\n   * Get the WebGL rendering context\n   * @return {WebGLRenderingContext} The rendering context.\n   */\n  getGL() {\n    return this.gl_;\n  }\n\n  /**\n   * Initialize the render target texture of the post process, make sure it is at the\n   * right size and bind it as a render target for the next draw calls.\n   * The last step to be initialized will be the one where the primitives are rendered.\n   * @param {import(\"../Map.js\").FrameState} frameState current frame state\n   */\n  init(frameState) {\n    const gl = this.getGL();\n    const textureSize = [\n      gl.drawingBufferWidth * this.scaleRatio_,\n      gl.drawingBufferHeight * this.scaleRatio_,\n    ];\n\n    // rendering goes to my buffer\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.getFrameBuffer());\n    gl.bindRenderbuffer(gl.RENDERBUFFER, this.getDepthBuffer());\n    gl.viewport(0, 0, textureSize[0], textureSize[1]);\n\n    // if size has changed: adjust canvas & render target texture\n    if (\n      !this.renderTargetTextureSize_ ||\n      this.renderTargetTextureSize_[0] !== textureSize[0] ||\n      this.renderTargetTextureSize_[1] !== textureSize[1]\n    ) {\n      this.renderTargetTextureSize_ = textureSize;\n\n      // create a new texture\n      const level = 0;\n      const internalFormat = gl.RGBA;\n      const border = 0;\n      const format = gl.RGBA;\n      const type = gl.UNSIGNED_BYTE;\n      const data = null;\n      gl.bindTexture(gl.TEXTURE_2D, this.renderTargetTexture_);\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        level,\n        internalFormat,\n        textureSize[0],\n        textureSize[1],\n        border,\n        format,\n        type,\n        data,\n      );\n\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n      // bind the texture to the framebuffer\n      gl.framebufferTexture2D(\n        gl.FRAMEBUFFER,\n        gl.COLOR_ATTACHMENT0,\n        gl.TEXTURE_2D,\n        this.renderTargetTexture_,\n        0,\n      );\n\n      gl.renderbufferStorage(\n        gl.RENDERBUFFER,\n        gl.DEPTH_COMPONENT16,\n        textureSize[0],\n        textureSize[1],\n      );\n      gl.framebufferRenderbuffer(\n        gl.FRAMEBUFFER,\n        gl.DEPTH_ATTACHMENT,\n        gl.RENDERBUFFER,\n        this.depthBuffer_,\n      );\n    }\n  }\n\n  /**\n   * Render to the next postprocessing pass (or to the canvas if final pass).\n   * @param {import(\"../Map.js\").FrameState} frameState current frame state\n   * @param {WebGLPostProcessingPass} [nextPass] Next pass, optional\n   * @param {function(WebGLRenderingContext, import(\"../Map.js\").FrameState):void} [preCompose] Called before composing.\n   * @param {function(WebGLRenderingContext, import(\"../Map.js\").FrameState):void} [postCompose] Called before composing.\n   */\n  apply(frameState, nextPass, preCompose, postCompose) {\n    const gl = this.getGL();\n    const size = frameState.size;\n\n    gl.bindFramebuffer(\n      gl.FRAMEBUFFER,\n      nextPass ? nextPass.getFrameBuffer() : null,\n    );\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, this.renderTargetTexture_);\n\n    if (!nextPass) {\n      // clear the canvas if we are the first to render to it\n      // and preserveDrawingBuffer is true\n      const canvasId = getUid(gl.canvas);\n      if (!frameState.renderTargets[canvasId]) {\n        const attributes = gl.getContextAttributes();\n        if (attributes && attributes.preserveDrawingBuffer) {\n          gl.clearColor(0.0, 0.0, 0.0, 0.0);\n          gl.clearDepth(1.0);\n          gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        }\n\n        frameState.renderTargets[canvasId] = true;\n      }\n    }\n\n    gl.disable(gl.DEPTH_TEST);\n    gl.enable(gl.BLEND);\n    gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.renderTargetVerticesBuffer_);\n\n    gl.useProgram(this.renderTargetProgram_);\n    gl.enableVertexAttribArray(this.renderTargetAttribLocation_);\n    gl.vertexAttribPointer(\n      this.renderTargetAttribLocation_,\n      2,\n      gl.FLOAT,\n      false,\n      0,\n      0,\n    );\n    gl.uniform2f(this.renderTargetUniformLocation_, size[0], size[1]);\n    gl.uniform1i(this.renderTargetTextureLocation_, 0);\n\n    const opacity = frameState.layerStatesArray[frameState.layerIndex].opacity;\n    gl.uniform1f(this.renderTargetOpacityLocation_, opacity);\n\n    this.applyUniforms(frameState);\n\n    if (preCompose) {\n      preCompose(gl, frameState);\n    }\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n    if (postCompose) {\n      postCompose(gl, frameState);\n    }\n  }\n\n  /**\n   * @return {WebGLFramebuffer} Frame buffer\n   */\n  getFrameBuffer() {\n    return this.frameBuffer_;\n  }\n\n  /**\n   * @return {WebGLRenderbuffer} Depth buffer\n   */\n  getDepthBuffer() {\n    return this.depthBuffer_;\n  }\n\n  /**\n   * Sets the custom uniforms based on what was given in the constructor.\n   * @param {import(\"../Map.js\").FrameState} frameState Frame state.\n   * @private\n   */\n  applyUniforms(frameState) {\n    const gl = this.getGL();\n\n    let value;\n    let textureSlot = 1;\n    this.uniforms_.forEach(function (uniform) {\n      value =\n        typeof uniform.value === 'function'\n          ? uniform.value(frameState)\n          : uniform.value;\n\n      // apply value based on type\n      if (value instanceof HTMLCanvasElement || value instanceof ImageData) {\n        // create a texture & put data\n        if (!uniform.texture) {\n          uniform.texture = gl.createTexture();\n        }\n        gl.activeTexture(gl[`TEXTURE${textureSlot}`]);\n        gl.bindTexture(gl.TEXTURE_2D, uniform.texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n        if (value instanceof ImageData) {\n          gl.texImage2D(\n            gl.TEXTURE_2D,\n            0,\n            gl.RGBA,\n            gl.RGBA,\n            value.width,\n            value.height,\n            0,\n            gl.UNSIGNED_BYTE,\n            new Uint8Array(value.data),\n          );\n        } else {\n          gl.texImage2D(\n            gl.TEXTURE_2D,\n            0,\n            gl.RGBA,\n            gl.RGBA,\n            gl.UNSIGNED_BYTE,\n            value,\n          );\n        }\n\n        // fill texture slots\n        gl.uniform1i(uniform.location, textureSlot++);\n      } else if (Array.isArray(value)) {\n        switch (value.length) {\n          case 2:\n            gl.uniform2f(uniform.location, value[0], value[1]);\n            return;\n          case 3:\n            gl.uniform3f(uniform.location, value[0], value[1], value[2]);\n            return;\n          case 4:\n            gl.uniform4f(\n              uniform.location,\n              value[0],\n              value[1],\n              value[2],\n              value[3],\n            );\n            return;\n          default:\n            return;\n        }\n      } else if (typeof value === 'number') {\n        gl.uniform1f(uniform.location, value);\n      }\n    });\n  }\n}\n\nexport default WebGLPostProcessingPass;\n","/**\n * @module ol/webgl/Helper\n */\nimport Disposable from '../Disposable.js';\nimport {clear} from '../obj.js';\nimport {\n  compose as composeTransform,\n  create as createTransform,\n} from '../transform.js';\nimport {getUid} from '../util.js';\nimport {create, fromTransform} from '../vec/mat4.js';\nimport ContextEventType from '../webgl/ContextEventType.js';\nimport {\n  FLOAT,\n  UNSIGNED_BYTE,\n  UNSIGNED_INT,\n  UNSIGNED_SHORT,\n  getContext,\n} from '../webgl.js';\nimport WebGLPostProcessingPass from './PostProcessingPass.js';\n\n/**\n * @typedef {Object} BufferCacheEntry\n * @property {import(\"./Buffer.js\").default} buffer Buffer.\n * @property {WebGLBuffer} webGlBuffer WebGlBuffer.\n */\n\n/**\n * Shader types, either `FRAGMENT_SHADER` or `VERTEX_SHADER`.\n * @enum {number}\n */\nexport const ShaderType = {\n  FRAGMENT_SHADER: 0x8b30,\n  VERTEX_SHADER: 0x8b31,\n};\n\n/**\n * Names of uniforms made available to all shaders.\n * Please note: changing these *will* break custom shaders!\n * @enum {string}\n */\nexport const DefaultUniform = {\n  PROJECTION_MATRIX: 'u_projectionMatrix',\n  SCREEN_TO_WORLD_MATRIX: 'u_screenToWorldMatrix',\n  TIME: 'u_time',\n  ZOOM: 'u_zoom',\n  RESOLUTION: 'u_resolution',\n  ROTATION: 'u_rotation',\n  VIEWPORT_SIZE_PX: 'u_viewportSizePx',\n  PIXEL_RATIO: 'u_pixelRatio',\n  HIT_DETECTION: 'u_hitDetection',\n};\n\n/**\n * Attribute types, either `UNSIGNED_BYTE`, `UNSIGNED_SHORT`, `UNSIGNED_INT` or `FLOAT`\n * Note: an attribute stored in a `Float32Array` should be of type `FLOAT`.\n * @enum {number}\n */\nexport const AttributeType = {\n  UNSIGNED_BYTE: UNSIGNED_BYTE,\n  UNSIGNED_SHORT: UNSIGNED_SHORT,\n  UNSIGNED_INT: UNSIGNED_INT,\n  FLOAT: FLOAT,\n};\n\n/**\n * Description of an attribute in a buffer\n * @typedef {Object} AttributeDescription\n * @property {string} name Attribute name to use in shaders\n * @property {number} size Number of components per attributes\n * @property {AttributeType} [type] Attribute type, i.e. number of bytes used to store the value. This is\n * determined by the class of typed array which the buffer uses (eg. `Float32Array` for a `FLOAT` attribute).\n * Default is `FLOAT`.\n */\n\n/**\n * @typedef {number|Array<number>|HTMLCanvasElement|HTMLImageElement|ImageData|WebGLTexture|import(\"../transform\").Transform} UniformLiteralValue\n */\n\n/**\n * Uniform value can be a number, array of numbers (2 to 4), canvas element or a callback returning\n * one of the previous types.\n * @typedef {UniformLiteralValue|function(import(\"../Map.js\").FrameState):UniformLiteralValue} UniformValue\n */\n\n/**\n * @typedef {Object} PostProcessesOptions\n * @property {number} [scaleRatio] Scale ratio; if < 1, the post process will render to a texture smaller than\n * the main canvas which will then be sampled up (useful for saving resource on blur steps).\n * @property {string} [vertexShader] Vertex shader source\n * @property {string} [fragmentShader] Fragment shader source\n * @property {Object<string,UniformValue>} [uniforms] Uniform definitions for the post process step\n */\n\n/**\n * @typedef {Object} Options\n * @property {Object<string,UniformValue>} [uniforms] Uniform definitions; property names must match the uniform\n * names in the provided or default shaders.\n * @property {Array<PostProcessesOptions>} [postProcesses] Post-processes definitions\n * @property {string} [canvasCacheKey] The cache key for the canvas.\n */\n\n/**\n * @typedef {Object} UniformInternalDescription\n * @property {string} name Name\n * @property {UniformValue} [value] Value\n * @property {UniformValue} [prevValue] The previous value.\n * @property {WebGLTexture} [texture] Texture\n * @private\n */\n\n/**\n * @typedef {Object} CanvasCacheItem\n * @property {WebGLRenderingContext} context The context of this canvas.\n * @property {number} users The count of users of this canvas.\n */\n\n/**\n * @type {Object<string,CanvasCacheItem>}\n */\nconst canvasCache = {};\n\n/**\n * @param {string} key The cache key for the canvas.\n * @return {string} The shared cache key.\n */\nfunction getSharedCanvasCacheKey(key) {\n  return 'shared/' + key;\n}\n\nlet uniqueCanvasCacheKeyCount = 0;\n\n/**\n * @return {string} The unique cache key.\n */\nfunction getUniqueCanvasCacheKey() {\n  const key = 'unique/' + uniqueCanvasCacheKeyCount;\n  uniqueCanvasCacheKeyCount += 1;\n  return key;\n}\n\n/**\n * @param {string} key The cache key for the canvas.\n * @return {WebGLRenderingContext} The canvas.\n */\nfunction getOrCreateContext(key) {\n  let cacheItem = canvasCache[key];\n  if (!cacheItem) {\n    const canvas = document.createElement('canvas');\n    canvas.width = 1;\n    canvas.height = 1;\n    canvas.style.position = 'absolute';\n    canvas.style.left = '0';\n    const context = getContext(canvas);\n    cacheItem = {users: 0, context};\n    canvasCache[key] = cacheItem;\n  }\n\n  cacheItem.users += 1;\n  return cacheItem.context;\n}\n\n/**\n * @param {string} key The cache key for the canvas.\n */\nfunction releaseCanvas(key) {\n  const cacheItem = canvasCache[key];\n  if (!cacheItem) {\n    return;\n  }\n\n  cacheItem.users -= 1;\n  if (cacheItem.users > 0) {\n    return;\n  }\n\n  const gl = cacheItem.context;\n  const extension = gl.getExtension('WEBGL_lose_context');\n  if (extension) {\n    extension.loseContext();\n  }\n  const canvas = gl.canvas;\n  canvas.width = 1;\n  canvas.height = 1;\n\n  delete canvasCache[key];\n}\n\n/**\n * @classdesc\n * This class is intended to provide low-level functions related to WebGL rendering, so that accessing\n * directly the WebGL API should not be required anymore.\n *\n * Several operations are handled by the `WebGLHelper` class:\n *\n * ### Define custom shaders and uniforms\n *\n *   Shaders* are low-level programs executed on the GPU and written in GLSL. There are two types of shaders:\n *\n *   Vertex shaders are used to manipulate the position and attribute of *vertices* of rendered primitives (ie. corners of a square).\n *   Outputs are:\n *\n *   `gl_Position`: position of the vertex in screen space\n *\n *   Varyings usually prefixed with `v_` are passed on to the fragment shader\n *\n *   Fragment shaders are used to control the actual color of the pixels drawn on screen. Their only output is `gl_FragColor`.\n *\n *   Both shaders can take *uniforms* or *attributes* as input. Attributes are explained later. Uniforms are common, read-only values that\n *   can be changed at every frame and can be of type float, arrays of float or images.\n *\n *   Shaders must be compiled and assembled into a program like so:\n *   ```js\n *   // here we simply create two shaders and assemble them in a program which is then used\n *   // for subsequent rendering calls; note how a frameState is required to set up a program,\n *   // as several default uniforms are computed from it (projection matrix, zoom level, etc.)\n *   const vertexShader = new WebGLVertex(VERTEX_SHADER);\n *   const fragmentShader = new WebGLFragment(FRAGMENT_SHADER);\n *   const program = this.context.getProgram(fragmentShader, vertexShader);\n *   helper.useProgram(this.program, frameState);\n *   ```\n *\n *   Uniforms are defined using the `uniforms` option and can either be explicit values or callbacks taking the frame state as argument.\n *   You can also change their value along the way like so:\n *   ```js\n *   helper.setUniformFloatValue('u_value', valueAsNumber);\n *   ```\n *\n * ### Defining post processing passes\n *\n *   Post processing* describes the act of rendering primitives to a texture, and then rendering this texture to the final canvas\n *   while applying special effects in screen space.\n *   Typical uses are: blurring, color manipulation, depth of field, filtering...\n *\n *   The `WebGLHelper` class offers the possibility to define post processes at creation time using the `postProcesses` option.\n *   A post process step accepts the following options:\n *\n *   `fragmentShader` and `vertexShader`: text literals in GLSL language that will be compiled and used in the post processing step.\n *   `uniforms`: uniforms can be defined for the post processing steps just like for the main render.\n *   `scaleRatio`: allows using an intermediate texture smaller or higher than the final canvas in the post processing step.\n *     This is typically used in blur steps to reduce the performance overhead by using an already downsampled texture as input.\n *\n *   The {@link module:ol/webgl/PostProcessingPass~WebGLPostProcessingPass} class is used internally, refer to its documentation for more info.\n *\n * ### Binding WebGL buffers and flushing data into them\n *\n *   Data that must be passed to the GPU has to be transferred using {@link module:ol/webgl/Buffer~WebGLArrayBuffer} objects.\n *   A buffer has to be created only once, but must be bound every time the buffer content will be used for rendering.\n *   This is done using {@link bindBuffer}.\n *   When the buffer's array content has changed, the new data has to be flushed to the GPU memory; this is done using\n *   {@link flushBufferData}. Note: this operation is expensive and should be done as infrequently as possible.\n *\n *   When binding an array buffer, a `target` parameter must be given: it should be either {@link module:ol/webgl.ARRAY_BUFFER}\n *   (if the buffer contains vertices data) or {@link module:ol/webgl.ELEMENT_ARRAY_BUFFER} (if the buffer contains indices data).\n *\n *   Examples below:\n *   ```js\n *   // at initialization phase\n *   const verticesBuffer = new WebGLArrayBuffer([], DYNAMIC_DRAW);\n *   const indicesBuffer = new WebGLArrayBuffer([], DYNAMIC_DRAW);\n *\n *   // when array values have changed\n *   helper.flushBufferData(ARRAY_BUFFER, this.verticesBuffer);\n *   helper.flushBufferData(ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\n *\n *   // at rendering phase\n *   helper.bindBuffer(ARRAY_BUFFER, this.verticesBuffer);\n *   helper.bindBuffer(ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\n *   ```\n *\n * ### Specifying attributes\n *\n *   The GPU only receives the data as arrays of numbers. These numbers must be handled differently depending on what it describes (position, texture coordinate...).\n *   Attributes are used to specify these uses. Specify the attribute names with\n *   {@link module:ol/webgl/Helper~WebGLHelper#enableAttributes} (see code snippet below).\n *\n *   Please note that you will have to specify the type and offset of the attributes in the data array. You can refer to the documentation of [WebGLRenderingContext.vertexAttribPointer](https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer) for more explanation.\n *   ```js\n *   // here we indicate that the data array has the following structure:\n *   // [posX, posY, offsetX, offsetY, texCoordU, texCoordV, posX, posY, ...]\n *   helper.enableAttributes([\n *     {\n *        name: 'a_position',\n *        size: 2\n *     },\n *     {\n *       name: 'a_offset',\n *       size: 2\n *     },\n *     {\n *       name: 'a_texCoord',\n *       size: 2\n *     }\n *   ])\n *   ```\n *\n * ### Rendering primitives\n *\n *   Once all the steps above have been achieved, rendering primitives to the screen is done using {@link prepareDraw}, {@link drawElements} and {@link finalizeDraw}.\n *   ```js\n *   // frame preparation step\n *   helper.prepareDraw(frameState);\n *\n *   // call this for every data array that has to be rendered on screen\n *   helper.drawElements(0, this.indicesBuffer.getArray().length);\n *\n *   // finalize the rendering by applying post processes\n *   helper.finalizeDraw(frameState);\n *   ```\n *\n * For an example usage of this class, refer to {@link module:ol/renderer/webgl/PointsLayer~WebGLPointsLayerRenderer}.\n */\nclass WebGLHelper extends Disposable {\n  /**\n   * @param {Options} [options] Options.\n   */\n  constructor(options) {\n    super();\n    options = options || {};\n\n    /** @private */\n    this.boundHandleWebGLContextLost_ = this.handleWebGLContextLost.bind(this);\n\n    /** @private */\n    this.boundHandleWebGLContextRestored_ =\n      this.handleWebGLContextRestored.bind(this);\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.canvasCacheKey_ = options.canvasCacheKey\n      ? getSharedCanvasCacheKey(options.canvasCacheKey)\n      : getUniqueCanvasCacheKey();\n\n    /**\n     * @private\n     * @type {WebGLRenderingContext}\n     */\n    this.gl_ = getOrCreateContext(this.canvasCacheKey_);\n\n    /**\n     * @private\n     * @type {!Object<string, BufferCacheEntry>}\n     */\n    this.bufferCache_ = {};\n\n    /**\n     * @private\n     * @type {Object<string, Object>}\n     */\n    this.extensionCache_ = {};\n\n    /**\n     * @private\n     * @type {WebGLProgram}\n     */\n    this.currentProgram_ = null;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.needsToBeRecreated_ = false;\n\n    const canvas = this.gl_.canvas;\n\n    canvas.addEventListener(\n      ContextEventType.LOST,\n      this.boundHandleWebGLContextLost_,\n    );\n    canvas.addEventListener(\n      ContextEventType.RESTORED,\n      this.boundHandleWebGLContextRestored_,\n    );\n\n    /**\n     * @private\n     * @type {import(\"../transform.js\").Transform}\n     */\n    this.offsetRotateMatrix_ = createTransform();\n\n    /**\n     * @private\n     * @type {import(\"../transform.js\").Transform}\n     */\n    this.offsetScaleMatrix_ = createTransform();\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.tmpMat4_ = create();\n\n    /**\n     * @private\n     * @type {Object<string, Object<string, WebGLUniformLocation>>}\n     */\n    this.uniformLocationsByProgram_ = {};\n\n    /**\n     * @private\n     * @type {Object<string, Object<string, number>>}\n     */\n    this.attribLocationsByProgram_ = {};\n\n    /**\n     * Holds info about custom uniforms used in the post processing pass.\n     * If the uniform is a texture, the WebGL Texture object will be stored here.\n     * @type {Array<UniformInternalDescription>}\n     * @private\n     */\n    this.uniforms_ = [];\n    if (options.uniforms) {\n      this.setUniforms(options.uniforms);\n    }\n\n    /**\n     * An array of PostProcessingPass objects is kept in this variable, built from the steps provided in the\n     * options. If no post process was given, a default one is used (so as not to have to make an exception to\n     * the frame buffer logic).\n     * @type {Array<WebGLPostProcessingPass>}\n     * @private\n     */\n    this.postProcessPasses_ = options.postProcesses\n      ? options.postProcesses.map(\n          (options) =>\n            new WebGLPostProcessingPass({\n              webGlContext: this.gl_,\n              scaleRatio: options.scaleRatio,\n              vertexShader: options.vertexShader,\n              fragmentShader: options.fragmentShader,\n              uniforms: options.uniforms,\n            }),\n        )\n      : [new WebGLPostProcessingPass({webGlContext: this.gl_})];\n\n    /**\n     * @type {string|null}\n     * @private\n     */\n    this.shaderCompileErrors_ = null;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.startTime_ = Date.now();\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.maxAttributeCount_ = this.gl_.getParameter(\n      this.gl_.MAX_VERTEX_ATTRIBS,\n    );\n  }\n\n  /**\n   * @param {Object<string, UniformValue>} uniforms Uniform definitions.\n   */\n  setUniforms(uniforms) {\n    this.uniforms_ = [];\n    this.addUniforms(uniforms);\n  }\n\n  /**\n   * @param {Object<string, UniformValue>} uniforms Uniform definitions.\n   */\n  addUniforms(uniforms) {\n    for (const name in uniforms) {\n      this.uniforms_.push({\n        name: name,\n        value: uniforms[name],\n      });\n    }\n  }\n\n  /**\n   * @param {string} canvasCacheKey The canvas cache key.\n   * @return {boolean} The provided key matches the one this helper was constructed with.\n   */\n  canvasCacheKeyMatches(canvasCacheKey) {\n    return this.canvasCacheKey_ === getSharedCanvasCacheKey(canvasCacheKey);\n  }\n\n  /**\n   * Get a WebGL extension.  If the extension is not supported, null is returned.\n   * Extensions are cached after they are enabled for the first time.\n   * @param {string} name The extension name.\n   * @return {Object|null} The extension or null if not supported.\n   */\n  getExtension(name) {\n    if (name in this.extensionCache_) {\n      return this.extensionCache_[name];\n    }\n    const extension = this.gl_.getExtension(name);\n    this.extensionCache_[name] = extension;\n    return extension;\n  }\n\n  /**\n   * Just bind the buffer if it's in the cache. Otherwise create\n   * the WebGL buffer, bind it, populate it, and add an entry to\n   * the cache.\n   * @param {import(\"./Buffer\").default} buffer Buffer.\n   */\n  bindBuffer(buffer) {\n    const gl = this.gl_;\n    const bufferKey = getUid(buffer);\n    let bufferCache = this.bufferCache_[bufferKey];\n    if (!bufferCache) {\n      const webGlBuffer = gl.createBuffer();\n      bufferCache = {\n        buffer: buffer,\n        webGlBuffer: webGlBuffer,\n      };\n      this.bufferCache_[bufferKey] = bufferCache;\n    }\n    gl.bindBuffer(buffer.getType(), bufferCache.webGlBuffer);\n  }\n\n  /**\n   * Update the data contained in the buffer array; this is required for the\n   * new data to be rendered\n   * @param {import(\"./Buffer\").default} buffer Buffer.\n   */\n  flushBufferData(buffer) {\n    const gl = this.gl_;\n    this.bindBuffer(buffer);\n    gl.bufferData(buffer.getType(), buffer.getArray(), buffer.getUsage());\n  }\n\n  /**\n   * @param {import(\"./Buffer.js\").default} buf Buffer.\n   */\n  deleteBuffer(buf) {\n    const bufferKey = getUid(buf);\n    // Note: gl.deleteBuffer is not called here since we let WebGL garbage collect it automatically\n    delete this.bufferCache_[bufferKey];\n  }\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    const canvas = this.gl_.canvas;\n    canvas.removeEventListener(\n      ContextEventType.LOST,\n      this.boundHandleWebGLContextLost_,\n    );\n    canvas.removeEventListener(\n      ContextEventType.RESTORED,\n      this.boundHandleWebGLContextRestored_,\n    );\n\n    releaseCanvas(this.canvasCacheKey_);\n\n    delete this.gl_;\n  }\n\n  /**\n   * Clear the buffer & set the viewport to draw.\n   * Post process passes will be initialized here, the first one being bound as a render target for\n   * subsequent draw calls.\n   * @param {import(\"../Map.js\").FrameState} frameState current frame state\n   * @param {boolean} [disableAlphaBlend] If true, no alpha blending will happen.\n   * @param {boolean} [enableDepth] If true, enables depth testing.\n   */\n  prepareDraw(frameState, disableAlphaBlend, enableDepth) {\n    const gl = this.gl_;\n    const canvas = this.getCanvas();\n    const size = frameState.size;\n    const pixelRatio = frameState.pixelRatio;\n\n    if (\n      canvas.width !== size[0] * pixelRatio ||\n      canvas.height !== size[1] * pixelRatio\n    ) {\n      canvas.width = size[0] * pixelRatio;\n      canvas.height = size[1] * pixelRatio;\n      canvas.style.width = size[0] + 'px';\n      canvas.style.height = size[1] + 'px';\n    }\n\n    // loop backwards in post processes list\n    for (let i = this.postProcessPasses_.length - 1; i >= 0; i--) {\n      this.postProcessPasses_[i].init(frameState);\n    }\n\n    gl.bindTexture(gl.TEXTURE_2D, null);\n\n    gl.clearColor(0.0, 0.0, 0.0, 0.0);\n    gl.depthRange(0.0, 1.0);\n    gl.clearDepth(1.0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n    gl.enable(gl.BLEND);\n    gl.blendFunc(gl.ONE, disableAlphaBlend ? gl.ZERO : gl.ONE_MINUS_SRC_ALPHA);\n    if (enableDepth) {\n      gl.enable(gl.DEPTH_TEST);\n      gl.depthFunc(gl.LEQUAL);\n    } else {\n      gl.disable(gl.DEPTH_TEST);\n    }\n  }\n\n  /**\n   * @param {WebGLFramebuffer|null} frameBuffer The frame buffer.\n   * @param {WebGLTexture} [texture] The texture.\n   */\n  bindFrameBuffer(frameBuffer, texture) {\n    const gl = this.getGL();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, frameBuffer);\n    if (texture) {\n      gl.framebufferTexture2D(\n        gl.FRAMEBUFFER,\n        gl.COLOR_ATTACHMENT0,\n        gl.TEXTURE_2D,\n        texture,\n        0,\n      );\n    }\n  }\n\n  /**\n   * Bind the frame buffer from the initial render.\n   */\n  bindInitialFrameBuffer() {\n    const gl = this.getGL();\n    const frameBuffer = this.postProcessPasses_[0].getFrameBuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, frameBuffer);\n    const texture = this.postProcessPasses_[0].getRenderTargetTexture();\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER,\n      gl.COLOR_ATTACHMENT0,\n      gl.TEXTURE_2D,\n      texture,\n      0,\n    );\n  }\n\n  /**\n   * Prepare a program to use a texture.\n   * @param {WebGLTexture} texture The texture.\n   * @param {number} slot The texture slot.\n   * @param {string} uniformName The corresponding uniform name.\n   */\n  bindTexture(texture, slot, uniformName) {\n    const gl = this.gl_;\n    gl.activeTexture(gl.TEXTURE0 + slot);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.uniform1i(this.getUniformLocation(uniformName), slot);\n  }\n\n  /**\n   * Set up an attribute array buffer for use in the vertex shader.\n   * @param {import(\"./Buffer\").default} buffer The buffer.\n   * @param {string} attributeName The attribute name.\n   * @param {number} size The number of components per attribute vertex.\n   */\n  bindAttribute(buffer, attributeName, size) {\n    const gl = this.getGL();\n    this.bindBuffer(buffer);\n    const index = this.getAttributeLocation(attributeName);\n    gl.enableVertexAttribArray(index);\n    gl.vertexAttribPointer(index, size, gl.FLOAT, false, 0, 0);\n  }\n\n  /**\n   * Clear the render target & bind it for future draw operations.\n   * This is similar to `prepareDraw`, only post processes will not be applied.\n   * Note: the whole viewport will be drawn to the render target, regardless of its size.\n   * @param {import(\"../Map.js\").FrameState} frameState current frame state\n   * @param {import(\"./RenderTarget.js\").default} renderTarget Render target to draw to\n   * @param {boolean} [disableAlphaBlend] If true, no alpha blending will happen.\n   * @param {boolean} [enableDepth] If true, enables depth testing.\n   */\n  prepareDrawToRenderTarget(\n    frameState,\n    renderTarget,\n    disableAlphaBlend,\n    enableDepth,\n  ) {\n    const gl = this.gl_;\n    const size = renderTarget.getSize();\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, renderTarget.getFramebuffer());\n    gl.bindRenderbuffer(gl.RENDERBUFFER, renderTarget.getDepthbuffer());\n    gl.viewport(0, 0, size[0], size[1]);\n    gl.bindTexture(gl.TEXTURE_2D, renderTarget.getTexture());\n    gl.clearColor(0.0, 0.0, 0.0, 0.0);\n    gl.depthRange(0.0, 1.0);\n    gl.clearDepth(1.0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    gl.enable(gl.BLEND);\n    gl.blendFunc(gl.ONE, disableAlphaBlend ? gl.ZERO : gl.ONE_MINUS_SRC_ALPHA);\n    if (enableDepth) {\n      gl.enable(gl.DEPTH_TEST);\n      gl.depthFunc(gl.LEQUAL);\n    } else {\n      gl.disable(gl.DEPTH_TEST);\n    }\n  }\n\n  /**\n   * Execute a draw call based on the currently bound program, texture, buffers, attributes.\n   * @param {number} start Start index.\n   * @param {number} end End index.\n   */\n  drawElements(start, end) {\n    const gl = this.gl_;\n    this.getExtension('OES_element_index_uint');\n\n    const elementType = gl.UNSIGNED_INT;\n    const elementSize = 4;\n\n    const numItems = end - start;\n    const offsetInBytes = start * elementSize;\n    gl.drawElements(gl.TRIANGLES, numItems, elementType, offsetInBytes);\n  }\n\n  /**\n   * Apply the successive post process passes which will eventually render to the actual canvas.\n   * @param {import(\"../Map.js\").FrameState} frameState current frame state\n   * @param {function(WebGLRenderingContext, import(\"../Map.js\").FrameState):void} [preCompose] Called before composing.\n   * @param {function(WebGLRenderingContext, import(\"../Map.js\").FrameState):void} [postCompose] Called before composing.\n   */\n  finalizeDraw(frameState, preCompose, postCompose) {\n    // apply post processes using the next one as target\n    for (let i = 0, ii = this.postProcessPasses_.length; i < ii; i++) {\n      if (i === ii - 1) {\n        this.postProcessPasses_[i].apply(\n          frameState,\n          null,\n          preCompose,\n          postCompose,\n        );\n      } else {\n        this.postProcessPasses_[i].apply(\n          frameState,\n          this.postProcessPasses_[i + 1],\n        );\n      }\n    }\n  }\n\n  /**\n   * @return {HTMLCanvasElement} Canvas.\n   */\n  getCanvas() {\n    return /** @type {HTMLCanvasElement} */ (this.gl_.canvas);\n  }\n\n  /**\n   * Get the WebGL rendering context\n   * @return {WebGLRenderingContext} The rendering context.\n   */\n  getGL() {\n    return this.gl_;\n  }\n\n  /**\n   * Sets the default matrix uniforms for a given frame state. This is called internally in `prepareDraw`.\n   * @param {import(\"../Map.js\").FrameState} frameState Frame state.\n   */\n  applyFrameState(frameState) {\n    const size = frameState.size;\n    const rotation = frameState.viewState.rotation;\n    const pixelRatio = frameState.pixelRatio;\n\n    this.setUniformFloatValue(\n      DefaultUniform.TIME,\n      (Date.now() - this.startTime_) * 0.001,\n    );\n    this.setUniformFloatValue(DefaultUniform.ZOOM, frameState.viewState.zoom);\n    this.setUniformFloatValue(\n      DefaultUniform.RESOLUTION,\n      frameState.viewState.resolution,\n    );\n    this.setUniformFloatValue(DefaultUniform.PIXEL_RATIO, pixelRatio);\n    this.setUniformFloatVec2(DefaultUniform.VIEWPORT_SIZE_PX, [\n      size[0],\n      size[1],\n    ]);\n    this.setUniformFloatValue(DefaultUniform.ROTATION, rotation);\n  }\n\n  /**\n   * Sets the `u_hitDetection` uniform.\n   * @param {boolean} enabled Whether to enable the hit detection code path\n   */\n  applyHitDetectionUniform(enabled) {\n    const loc = this.getUniformLocation(DefaultUniform.HIT_DETECTION);\n    this.getGL().uniform1i(loc, enabled ? 1 : 0);\n\n    // hit detection uses a fixed pixel ratio\n    if (enabled) {\n      this.setUniformFloatValue(DefaultUniform.PIXEL_RATIO, 0.5);\n    }\n  }\n\n  /**\n   * Sets the custom uniforms based on what was given in the constructor. This is called internally in `prepareDraw`.\n   * @param {import(\"../Map.js\").FrameState} frameState Frame state.\n   */\n  applyUniforms(frameState) {\n    const gl = this.gl_;\n\n    let value;\n    let textureSlot = 0;\n    this.uniforms_.forEach((uniform) => {\n      value =\n        typeof uniform.value === 'function'\n          ? uniform.value(frameState)\n          : uniform.value;\n\n      // apply value based on type\n      if (\n        value instanceof HTMLCanvasElement ||\n        value instanceof HTMLImageElement ||\n        value instanceof ImageData ||\n        value instanceof WebGLTexture\n      ) {\n        // create a texture & put data\n        if (value instanceof WebGLTexture && !uniform.texture) {\n          uniform.prevValue = undefined;\n          uniform.texture = value;\n        } else if (!uniform.texture) {\n          uniform.prevValue = undefined;\n          uniform.texture = gl.createTexture();\n        }\n        this.bindTexture(uniform.texture, textureSlot, uniform.name);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n        const imageReady =\n          !(value instanceof HTMLImageElement) ||\n          /** @type {HTMLImageElement} */ (value).complete;\n        if (\n          !(value instanceof WebGLTexture) &&\n          imageReady &&\n          uniform.prevValue !== value\n        ) {\n          uniform.prevValue = value;\n          gl.texImage2D(\n            gl.TEXTURE_2D,\n            0,\n            gl.RGBA,\n            gl.RGBA,\n            gl.UNSIGNED_BYTE,\n            value,\n          );\n        }\n        textureSlot++;\n      } else if (Array.isArray(value) && value.length === 6) {\n        this.setUniformMatrixValue(\n          uniform.name,\n          fromTransform(this.tmpMat4_, value),\n        );\n      } else if (Array.isArray(value) && value.length <= 4) {\n        switch (value.length) {\n          case 2:\n            gl.uniform2f(\n              this.getUniformLocation(uniform.name),\n              value[0],\n              value[1],\n            );\n            return;\n          case 3:\n            gl.uniform3f(\n              this.getUniformLocation(uniform.name),\n              value[0],\n              value[1],\n              value[2],\n            );\n            return;\n          case 4:\n            gl.uniform4f(\n              this.getUniformLocation(uniform.name),\n              value[0],\n              value[1],\n              value[2],\n              value[3],\n            );\n            return;\n          default:\n            return;\n        }\n      } else if (typeof value === 'number') {\n        gl.uniform1f(this.getUniformLocation(uniform.name), value);\n      }\n    });\n  }\n\n  /**\n   * Set up a program for use. The program will be set as the current one. Then, the uniforms used\n   * in the program will be set based on the current frame state and the helper configuration.\n   * @param {WebGLProgram} program Program.\n   * @param {import(\"../Map.js\").FrameState} [frameState] Frame state.\n   */\n  useProgram(program, frameState) {\n    this.disableAllAttributes_();\n    const gl = this.gl_;\n    gl.useProgram(program);\n    this.currentProgram_ = program;\n    if (frameState) {\n      this.applyFrameState(frameState);\n      this.applyUniforms(frameState);\n    }\n  }\n\n  /**\n   * Will attempt to compile a vertex or fragment shader based on source\n   * On error, the shader will be returned but\n   * `gl.getShaderParameter(shader, gl.COMPILE_STATUS)` will return `true`\n   * Use `gl.getShaderInfoLog(shader)` to have details\n   * @param {string} source Shader source\n   * @param {ShaderType} type VERTEX_SHADER or FRAGMENT_SHADER\n   * @return {WebGLShader} Shader object\n   */\n  compileShader(source, type) {\n    const gl = this.gl_;\n    const shader = gl.createShader(type);\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n    return shader;\n  }\n\n  /**\n   * Create a program for a vertex and fragment shader.  Throws if shader compilation fails.\n   * @param {string} fragmentShaderSource Fragment shader source.\n   * @param {string} vertexShaderSource Vertex shader source.\n   * @return {WebGLProgram} Program\n   */\n  getProgram(fragmentShaderSource, vertexShaderSource) {\n    const gl = this.gl_;\n\n    const fragmentShader = this.compileShader(\n      fragmentShaderSource,\n      gl.FRAGMENT_SHADER,\n    );\n\n    const vertexShader = this.compileShader(\n      vertexShaderSource,\n      gl.VERTEX_SHADER,\n    );\n\n    const program = gl.createProgram();\n    gl.attachShader(program, fragmentShader);\n    gl.attachShader(program, vertexShader);\n    gl.linkProgram(program);\n\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n      const message = `Fragment shader compilation failed: ${gl.getShaderInfoLog(\n        fragmentShader,\n      )}`;\n      throw new Error(message);\n    }\n    gl.deleteShader(fragmentShader);\n\n    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n      const message = `Vertex shader compilation failed: ${gl.getShaderInfoLog(\n        vertexShader,\n      )}`;\n      throw new Error(message);\n    }\n    gl.deleteShader(vertexShader);\n\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      const message = `GL program linking failed: ${gl.getProgramInfoLog(\n        program,\n      )}`;\n      throw new Error(message);\n    }\n\n    return program;\n  }\n\n  /**\n   * Will get the location from the shader or the cache\n   * @param {string} name Uniform name\n   * @return {WebGLUniformLocation} uniformLocation\n   */\n  getUniformLocation(name) {\n    const programUid = getUid(this.currentProgram_);\n    if (this.uniformLocationsByProgram_[programUid] === undefined) {\n      this.uniformLocationsByProgram_[programUid] = {};\n    }\n    if (this.uniformLocationsByProgram_[programUid][name] === undefined) {\n      this.uniformLocationsByProgram_[programUid][name] =\n        this.gl_.getUniformLocation(this.currentProgram_, name);\n    }\n    return this.uniformLocationsByProgram_[programUid][name];\n  }\n\n  /**\n   * Will get the location from the shader or the cache\n   * @param {string} name Attribute name\n   * @return {number} attribLocation\n   */\n  getAttributeLocation(name) {\n    const programUid = getUid(this.currentProgram_);\n    if (this.attribLocationsByProgram_[programUid] === undefined) {\n      this.attribLocationsByProgram_[programUid] = {};\n    }\n    if (this.attribLocationsByProgram_[programUid][name] === undefined) {\n      this.attribLocationsByProgram_[programUid][name] =\n        this.gl_.getAttribLocation(this.currentProgram_, name);\n    }\n    return this.attribLocationsByProgram_[programUid][name];\n  }\n\n  /**\n   * Sets the given transform to apply the rotation/translation/scaling of the given frame state.\n   * The resulting transform can be used to convert world space coordinates to view coordinates in the [-1, 1] range.\n   * @param {import(\"../Map.js\").FrameState} frameState Frame state.\n   * @param {import(\"../transform\").Transform} transform Transform to update.\n   * @return {import(\"../transform\").Transform} The updated transform object.\n   */\n  makeProjectionTransform(frameState, transform) {\n    const size = frameState.size;\n    const rotation = frameState.viewState.rotation;\n    const resolution = frameState.viewState.resolution;\n    const center = frameState.viewState.center;\n    composeTransform(\n      transform,\n      0,\n      0,\n      2 / (resolution * size[0]),\n      2 / (resolution * size[1]),\n      -rotation,\n      -center[0],\n      -center[1],\n    );\n    return transform;\n  }\n\n  /**\n   * Give a value for a standard float uniform\n   * @param {string} uniform Uniform name\n   * @param {number} value Value\n   */\n  setUniformFloatValue(uniform, value) {\n    this.gl_.uniform1f(this.getUniformLocation(uniform), value);\n  }\n\n  /**\n   * Give a value for a vec2 uniform\n   * @param {string} uniform Uniform name\n   * @param {Array<number>} value Array of length 4.\n   */\n  setUniformFloatVec2(uniform, value) {\n    this.gl_.uniform2fv(this.getUniformLocation(uniform), value);\n  }\n\n  /**\n   * Give a value for a vec4 uniform\n   * @param {string} uniform Uniform name\n   * @param {Array<number>} value Array of length 4.\n   */\n  setUniformFloatVec4(uniform, value) {\n    this.gl_.uniform4fv(this.getUniformLocation(uniform), value);\n  }\n\n  /**\n   * Give a value for a standard matrix4 uniform\n   * @param {string} uniform Uniform name\n   * @param {Array<number>} value Matrix value\n   */\n  setUniformMatrixValue(uniform, value) {\n    this.gl_.uniformMatrix4fv(this.getUniformLocation(uniform), false, value);\n  }\n\n  /**\n   * Disable all vertex attributes.\n   * @private\n   */\n  disableAllAttributes_() {\n    for (let i = 0; i < this.maxAttributeCount_; i++) {\n      this.gl_.disableVertexAttribArray(i);\n    }\n  }\n\n  /**\n   * Will set the currently bound buffer to an attribute of the shader program. Used by `#enableAttributes`\n   * internally.\n   * @param {string} attribName Attribute name\n   * @param {number} size Number of components per attributes\n   * @param {number} type UNSIGNED_INT, UNSIGNED_BYTE, UNSIGNED_SHORT or FLOAT\n   * @param {number} stride Stride in bytes (0 means attribs are packed)\n   * @param {number} offset Offset in bytes\n   * @private\n   */\n  enableAttributeArray_(attribName, size, type, stride, offset) {\n    const location = this.getAttributeLocation(attribName);\n    // the attribute has not been found in the shaders or is not used; do not enable it\n    if (location < 0) {\n      return;\n    }\n    this.gl_.enableVertexAttribArray(location);\n    this.gl_.vertexAttribPointer(location, size, type, false, stride, offset);\n  }\n\n  /**\n   * Will enable the following attributes to be read from the currently bound buffer,\n   * i.e. tell the GPU where to read the different attributes in the buffer. An error in the\n   * size/type/order of attributes will most likely break the rendering and throw a WebGL exception.\n   * @param {Array<AttributeDescription>} attributes Ordered list of attributes to read from the buffer\n   */\n  enableAttributes(attributes) {\n    const stride = computeAttributesStride(attributes);\n    let offset = 0;\n    for (let i = 0; i < attributes.length; i++) {\n      const attr = attributes[i];\n      this.enableAttributeArray_(\n        attr.name,\n        attr.size,\n        attr.type || FLOAT,\n        stride,\n        offset,\n      );\n      offset += attr.size * getByteSizeFromType(attr.type);\n    }\n  }\n\n  /**\n   * WebGL context was lost\n   * @param {WebGLContextEvent} event The context loss event.\n   * @private\n   */\n  handleWebGLContextLost(event) {\n    clear(this.bufferCache_);\n    this.currentProgram_ = null;\n\n    event.preventDefault();\n  }\n\n  /**\n   * WebGL context was restored\n   * @private\n   */\n  handleWebGLContextRestored() {\n    this.needsToBeRecreated_ = true;\n  }\n\n  /**\n   * Returns whether this helper needs to be recreated, as the context was lost and then restored.\n   * @return {boolean} Whether this helper needs to be recreated.\n   */\n  needsToBeRecreated() {\n    return this.needsToBeRecreated_;\n  }\n\n  /**\n   * Will create or reuse a given webgl texture and apply the given size. If no image data\n   * specified, the texture will be empty, otherwise image data will be used and the `size`\n   * parameter will be ignored.  If a Uint8Array is provided for data, a size must also be provided.\n   * Note: wrap parameters are set to clamp to edge, min filter is set to linear.\n   * @param {Array<number>} size Expected size of the texture\n   * @param {ImageData|HTMLImageElement|HTMLCanvasElement|Uint8Array|null} data Image data/object to bind to the texture\n   * @param {WebGLTexture} [texture] Existing texture to reuse\n   * @param {boolean} [nearest] Use gl.NEAREST for min/mag filter.\n   * @return {WebGLTexture} The generated texture\n   */\n  createTexture(size, data, texture, nearest) {\n    const gl = this.gl_;\n    texture = texture || gl.createTexture();\n    const filter = nearest ? gl.NEAREST : gl.LINEAR;\n\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n    const level = 0;\n    const internalFormat = gl.RGBA;\n    const border = 0;\n    const format = gl.RGBA;\n    const type = gl.UNSIGNED_BYTE;\n\n    if (data instanceof Uint8Array) {\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        level,\n        internalFormat,\n        size[0],\n        size[1],\n        border,\n        format,\n        type,\n        data,\n      );\n    } else if (data) {\n      gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, format, type, data);\n    } else {\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        level,\n        internalFormat,\n        size[0],\n        size[1],\n        border,\n        format,\n        type,\n        null,\n      );\n    }\n    return texture;\n  }\n}\n\n/**\n * Compute a stride in bytes based on a list of attributes\n * @param {Array<AttributeDescription>} attributes Ordered list of attributes\n * @return {number} Stride, ie amount of values for each vertex in the vertex buffer\n */\nexport function computeAttributesStride(attributes) {\n  let stride = 0;\n  for (let i = 0; i < attributes.length; i++) {\n    const attr = attributes[i];\n    stride += attr.size * getByteSizeFromType(attr.type);\n  }\n  return stride;\n}\n\n/**\n * Computes the size in byte of an attribute type.\n * @param {AttributeType} type Attribute type\n * @return {number} The size in bytes\n */\nfunction getByteSizeFromType(type) {\n  switch (type) {\n    case AttributeType.UNSIGNED_BYTE:\n      return Uint8Array.BYTES_PER_ELEMENT;\n    case AttributeType.UNSIGNED_SHORT:\n      return Uint16Array.BYTES_PER_ELEMENT;\n    case AttributeType.UNSIGNED_INT:\n      return Uint32Array.BYTES_PER_ELEMENT;\n    case AttributeType.FLOAT:\n    default:\n      return Float32Array.BYTES_PER_ELEMENT;\n  }\n}\n\nexport default WebGLHelper;\n"],"names":["asImageLike","data","Image","HTMLCanvasElement","HTMLVideoElement","ImageBitmap","asArrayLike","Uint8Array","Uint8ClampedArray","Float32Array","DataView","disposedError","Error","sharedContext","toArray","image","width","height","undefined","willReadFrequently","canvas","clearRect","drawImage","getImageData","defaultSize","DataTile","constructor","options","state","IDLE","super","tileCoord","transition","interpolate","this","loader_","loader","data_","error_","size_","size","controller_","controller","getSize","imageData","getData","getError","load","ERROR","LOADING","changed","self","then","LOADED","catch","error","disposeInternal","abort","PaletteTexture","name","texture_","getTexture","gl","texture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","texImage2D","RGBA","length","UNSIGNED_BYTE","deleteTexture","computeOperatorFunctionName","operator","context","Object","keys","functions","numberToGlsl","v","s","toString","includes","arrayToGlsl","array","map","join","colorToGlsl","color","alpha","sizeToGlsl","stringToFloatMap","stringToFloatCounter","getStringNumberEquivalent","string","stringToGlsl","uniformNameForVariable","variableName","newCompilationContext","variables","properties","bandCount","featureId","geometryType","GET_BAND_VALUE_FUNC","PALETTE_TEXTURE_ARRAY","FEATURE_ID_PROPERTY_NAME","GEOMETRY_TYPE_PROPERTY_NAME","UNDEFINED_PROP_VALUE","buildExpression","encoded","type","parsingContext","compilationContext","expression","compile","createCompiler","output","args","Array","i","compilers","Get","firstArg","propName","isExisting","Id","GeometryType","LineMetric","Var","varName","Has","Resolution","Zoom","Time","Any","compiledArgs","All","Not","value","Equal","firstValue","secondValue","NotEqual","GreaterThan","GreaterThanOrEqualTo","LessThan","LessThanOrEqualTo","Multiply","Divide","Add","Subtract","Clamp","min","max","Mod","modulo","Pow","power","Abs","Floor","Ceil","Round","Sin","Cos","Atan","Sqrt","Match","input","fallback","result","match","Between","Interpolate","exponent","stop1","output1","stop2","output2","ratio","Case","condition","In","needle","haystack","funcName","tests","push","Color","rgb","slice","Band","band","xOffset","yOffset","ifBlocks","colorIndex","Math","floor","bandIndex","textureName","TILE_TEXTURE_ARRAY","TEXTURE_PIXEL_WIDTH","TEXTURE_PIXEL_HEIGHT","Palette","index","colors","numColors","palette","parsedValue","offset","paletteTextures","paletteName","paletteTexture","compiledIndex","returnType","compiler","JSON","stringify","expressionToGlsl","expectedType","packColor","r","g","b","a","round","UNPACK_COLOR_FN","getGlslSizeFromType","getGlslTypeFromType","applyContextToBuilder","builder","variable","uniformName","glslType","addUniform","property","attributeName","addAttribute","addVertexShaderFunction","functionName","addFragmentShaderFunction","generateUniformsFromContext","uniforms","generateAttributesFromContext","attributes","callback","feature","get","WebGLLayerRenderer","layer","inversePixelTransform_","postProcesses_","postProcesses","uniforms_","helper","onMapChanged_","clearCache","removeHelper","addChangeListener","MAP","dispatchPreComposeEvent","bind","dispatchPostComposeEvent","frameState","getLayer","hasListener","PRECOMPOSE","event","dispatchEvent","POSTCOMPOSE","reset","setUniforms","dispose","prepareFrame","getRenderSource","className","incrementGroup","groupNumber","ii","layerStatesArray","renderer","getRenderer","layerClassName","getClassName","canvasCacheKey","mapId","canvasCacheKeyMatches","needsToBeRecreated","getCanvas","afterHelperCreated","prepareFrameInternal","removeChangeListener","dispatchRenderEvent_","pixelRatio","preRender","PRERENDER","postRender","POSTRENDER","bindAndConfigure","resampleFilter","LINEAR","uploadImageTexture","uploadDataTexture","getGL","textureType","canInterpolate","FLOAT","getExtension","extension","bytesPerRow","byteLength","format","unpackAlignment","LUMINANCE","LUMINANCE_ALPHA","RGB","oldUnpackAlignment","getParameter","UNPACK_ALIGNMENT","pixelStorei","pixelContext","createPixelContext","TileTexture","BaseTileRepresentation","textures","renderSize_","grid","getTileSize","tile","NaN","coords","fromArray","flushBufferData","setTile","setHelper","deleteBuffer","uploadTile","ImageTile","getImage","setReady","sourceTileSize","pixelSize","gutter","isFloat","pixelCount","DataType","bytesPerElement","BYTES_PER_ELEMENT","textureCount","ceil","textureDataArrays","textureIndex","dataIndex","rowOffset","colCount","rowIndex","colIndex","dataValue","pixelIndex","textureData","textureBandIndex","getImagePixelData_","renderCol","renderRow","renderWidth","renderHeight","sourceWidth","sourceHeight","sourceWidthWithoutGutter","sourceHeightWithoutGutter","sourceCol","sourceRow","getArrayPixelData_","sourceSize","bytesPerPixel","buffer","getPixelData","loaded","arrayData","Uniforms","TEXTURE_RESOLUTION","TEXTURE_ORIGIN_X","TEXTURE_ORIGIN_Y","Attributes","TEXTURE_COORD","attributeDescriptions","WebGLTileLayerRenderer","tileLayer","program_","vertexShader_","vertexShader","fragmentShader_","fragmentShader","indices_","paletteTextures_","delete","getProgram","createTileRepresentation","beforeTilesRender","tilesWithAlpha","useProgram","renderTile","tileTexture","tileTransform","renderExtent","tileResolution","tileSize","tileOrigin","tileExtent","depth","bindBuffer","enableAttributes","textureSlot","paletteIndex","viewState","tileWidthWithGutter","tileHeightWithGutter","tileCenterI","tileCenterJ","setUniformMatrixValue","TILE_TRANSFORM","mat4","tempMat4","setUniformFloatValue","TRANSITION_ALPHA","DEPTH","gutterExtent","setUniformFloatVec4","RENDER_EXTENT","RESOLUTION","resolution","ZOOM","zoom","drawElements","pixel","coordinate","pixelToCoordinateTransform","layerExtent","getExtent","projection","sources","getSources","source","tileGrid","getState","getTileGridForProjection","getWrapX","gridExtent","tileTextureCache","tileRepresentationCache","z","getZForResolution","getMinZoom","getTileCoordForCoordAndZ","cacheKey","containsKey","TileState","EMPTY","getOrigin","getResolution","col","row","deleteProgram","PATTERN_ORIGIN","GLOBAL_ALPHA","PROJECTION_MATRIX","SCREEN_TO_WORLD_MATRIX","depthForZ","newTileRepresentationLookup","tileIds","Set","representationsByZ","lookupHasTile","tileRepresentationLookup","has","addTileRepresentationToLookup","tileRepresentation","add","getRenderExtent","extent","layerState","layerIndex","getCacheKey","getKey","getRevision","WebGLBaseTileLayerRenderer","renderComplete","tileTransform_","tempTileRange_","tempTileCoord_","tempSize_","cacheSize","renderedProjection_","enqueueTiles","initialZ","preload","tileSource","getGutterForProjection","tileSourceKey","wantedTiles","getMapInternal","minZ","getMaxResolution","getView","getResolutionForZoom","zDirection","rotation","viewport","center","tileRange","getTileRangeForExtentAndZ","x","minX","maxX","y","minY","maxY","tileCoordIntersectsViewport","key","getTile","set","tileQueueKey","tileQueue","isKeyQueued","enqueue","getTileCoordCenter","prepareDraw","beforeTilesMaskRender","renderTileMask","tileZ","drawTile_","alphaLookup","ready","tileCoordKey","getTileCoordExtent","animate","centerX","centerY","aspectRatio","centerI","centerJ","tileScale","renderFrame","getPreload","nextExtent","targetZ","nextResolution","setTimeout","blend","uid","time","getAlpha","endTransition","coveredByChildren","findAltTiles_","minZoom","parentZ","coveredByParent","zs","Number","sort","j","jj","beforeFinalize","finalizeDraw","canExpireCache","pop","altZ","getTileRangeForTileCoordAndZ","covered","forEach","clear","LRUCache","highWaterMark","count_","entries_","oldest_","newest_","deleteOldest","entry","getCount","expireCache","keep","hasOwnProperty","f","value_","key_","newer","older","remove","getKeys","getValues","values","peekLast","peekLastKey","peekFirstKey","peek","replace","setSize","create","fromTransform","transform","orthographic","left","right","bottom","top","near","far","out","lr","bt","nf","scale","m","translate","a00","a01","a02","a03","a10","a11","a12","a13","a20","a21","a22","a23","translation","ARRAY_BUFFER","ELEMENT_ARRAY_BUFFER","STREAM_DRAW","STATIC_DRAW","DYNAMIC_DRAW","UNSIGNED_SHORT","UNSIGNED_INT","CONTEXT_IDS","getContext","assign","preserveDrawingBuffer","antialias","handleTileChange_","removeEventListener","CHANGE","crossOrigin","addEventListener","BufferUsage","WebGLArrayBuffer","usage","array_","type_","usage_","ofSize","getArrayClassForType","from","fromArrayBuffer","getType","getArray","setArray","ArrayType","getUsage","Uint32Array","LOST","RESTORED","DEFAULT_VERTEX_SHADER","DEFAULT_FRAGMENT_SHADER","WebGLPostProcessingPass","gl_","webGlContext","scaleRatio_","scaleRatio","renderTargetTexture_","renderTargetTextureSize_","frameBuffer_","createFramebuffer","depthBuffer_","createRenderbuffer","createShader","VERTEX_SHADER","shaderSource","compileShader","FRAGMENT_SHADER","renderTargetProgram_","createProgram","attachShader","linkProgram","renderTargetVerticesBuffer_","createBuffer","verticesArray","bufferData","renderTargetAttribLocation_","getAttribLocation","renderTargetUniformLocation_","getUniformLocation","renderTargetOpacityLocation_","renderTargetTextureLocation_","location","getRenderTargetTexture","init","textureSize","drawingBufferWidth","drawingBufferHeight","bindFramebuffer","FRAMEBUFFER","getFrameBuffer","bindRenderbuffer","RENDERBUFFER","getDepthBuffer","level","internalFormat","border","framebufferTexture2D","COLOR_ATTACHMENT0","renderbufferStorage","DEPTH_COMPONENT16","framebufferRenderbuffer","DEPTH_ATTACHMENT","apply","nextPass","preCompose","postCompose","activeTexture","TEXTURE0","canvasId","renderTargets","getContextAttributes","clearColor","clearDepth","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","disable","DEPTH_TEST","enable","BLEND","blendFunc","ONE","ONE_MINUS_SRC_ALPHA","enableVertexAttribArray","vertexAttribPointer","uniform2f","uniform1i","opacity","uniform1f","applyUniforms","drawArrays","TRIANGLES","uniform","ImageData","isArray","uniform3f","uniform4f","DefaultUniform","TIME","ROTATION","VIEWPORT_SIZE_PX","PIXEL_RATIO","HIT_DETECTION","AttributeType","canvasCache","getSharedCanvasCacheKey","uniqueCanvasCacheKeyCount","getUniqueCanvasCacheKey","getOrCreateContext","cacheItem","document","createElement","style","position","users","releaseCanvas","loseContext","WebGLHelper","Disposable","boundHandleWebGLContextLost_","handleWebGLContextLost","boundHandleWebGLContextRestored_","handleWebGLContextRestored","canvasCacheKey_","bufferCache_","extensionCache_","currentProgram_","needsToBeRecreated_","ContextEventType","offsetRotateMatrix_","offsetScaleMatrix_","tmpMat4_","uniformLocationsByProgram_","attribLocationsByProgram_","postProcessPasses_","shaderCompileErrors_","startTime_","Date","now","maxAttributeCount_","MAX_VERTEX_ATTRIBS","addUniforms","bufferKey","bufferCache","webGlBuffer","buf","disableAlphaBlend","enableDepth","depthRange","ZERO","depthFunc","LEQUAL","bindFrameBuffer","frameBuffer","bindInitialFrameBuffer","slot","bindAttribute","getAttributeLocation","prepareDrawToRenderTarget","renderTarget","getFramebuffer","getDepthbuffer","start","end","elementType","elementSize","numItems","offsetInBytes","applyFrameState","setUniformFloatVec2","applyHitDetectionUniform","enabled","loc","HTMLImageElement","WebGLTexture","prevValue","imageReady","complete","program","disableAllAttributes_","shader","fragmentShaderSource","vertexShaderSource","getShaderParameter","COMPILE_STATUS","message","getShaderInfoLog","deleteShader","getProgramParameter","LINK_STATUS","getProgramInfoLog","programUid","makeProjectionTransform","uniform2fv","uniform4fv","uniformMatrix4fv","disableVertexAttribArray","enableAttributeArray_","attribName","stride","computeAttributesStride","attr","getByteSizeFromType","preventDefault","nearest","filter","Uint16Array"],"sourceRoot":""}